var XmlDSigJs=function(e){"use strict";function t(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function r(e){for(var r=1;r<arguments.length;r++){var a=null!=arguments[r]?arguments[r]:{};r%2?t(Object(a),!0).forEach((function(t){c(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):t(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function a(){a=function(){return e};var e={},t=Object.prototype,r=t.hasOwnProperty,n=Object.defineProperty||function(e,t,r){e[t]=r.value},i="function"==typeof Symbol?Symbol:{},s=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",o=i.toStringTag||"@@toStringTag";function l(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,r){return e[t]=r}}function c(e,t,r,a){var i=t&&t.prototype instanceof m?t:m,s=Object.create(i.prototype),u=new x(a||[]);return n(s,"_invoke",{value:S(e,r,u)}),s}function h(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=c;var f={};function m(){}function v(){}function d(){}var g={};l(g,s,(function(){return this}));var p=Object.getPrototypeOf,y=p&&p(p(E([])));y&&y!==t&&r.call(y,s)&&(g=y);var k=d.prototype=m.prototype=Object.create(g);function w(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function b(e,t){function a(n,i,s,u){var o=h(e[n],e,i);if("throw"!==o.type){var l=o.arg,c=l.value;return c&&"object"==typeof c&&r.call(c,"__await")?t.resolve(c.__await).then((function(e){a("next",e,s,u)}),(function(e){a("throw",e,s,u)})):t.resolve(c).then((function(e){l.value=e,s(l)}),(function(e){return a("throw",e,s,u)}))}u(o.arg)}var i;n(this,"_invoke",{value:function(e,r){function n(){return new t((function(t,n){a(e,r,t,n)}))}return i=i?i.then(n,n):n()}})}function S(e,t,r){var a="suspendedStart";return function(n,i){if("executing"===a)throw new Error("Generator is already running");if("completed"===a){if("throw"===n)throw i;return I()}for(r.method=n,r.arg=i;;){var s=r.delegate;if(s){var u=A(s,r);if(u){if(u===f)continue;return u}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===a)throw a="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);a="executing";var o=h(e,t,r);if("normal"===o.type){if(a=r.done?"completed":"suspendedYield",o.arg===f)continue;return{value:o.arg,done:r.done}}"throw"===o.type&&(a="completed",r.method="throw",r.arg=o.arg)}}}function A(e,t){var r=t.method,a=e.iterator[r];if(void 0===a)return t.delegate=null,"throw"===r&&e.iterator.return&&(t.method="return",t.arg=void 0,A(e,t),"throw"===t.method)||"return"!==r&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+r+"' method")),f;var n=h(a,e.iterator,t.arg);if("throw"===n.type)return t.method="throw",t.arg=n.arg,t.delegate=null,f;var i=n.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,f):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,f)}function N(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function C(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function x(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(N,this),this.reset(!0)}function E(e){if(e){var t=e[s];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var a=-1,n=function t(){for(;++a<e.length;)if(r.call(e,a))return t.value=e[a],t.done=!1,t;return t.value=void 0,t.done=!0,t};return n.next=n}}return{next:I}}function I(){return{value:void 0,done:!0}}return v.prototype=d,n(k,"constructor",{value:d,configurable:!0}),n(d,"constructor",{value:v,configurable:!0}),v.displayName=l(d,o,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===v||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,d):(e.__proto__=d,l(e,o,"GeneratorFunction")),e.prototype=Object.create(k),e},e.awrap=function(e){return{__await:e}},w(b.prototype),l(b.prototype,u,(function(){return this})),e.AsyncIterator=b,e.async=function(t,r,a,n,i){void 0===i&&(i=Promise);var s=new b(c(t,r,a,n),i);return e.isGeneratorFunction(r)?s:s.next().then((function(e){return e.done?e.value:s.next()}))},w(k),l(k,o,"Generator"),l(k,s,(function(){return this})),l(k,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),r=[];for(var a in t)r.push(a);return r.reverse(),function e(){for(;r.length;){var a=r.pop();if(a in t)return e.value=a,e.done=!1,e}return e.done=!0,e}},e.values=E,x.prototype={constructor:x,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(C),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function a(r,a){return s.type="throw",s.arg=e,t.next=r,a&&(t.method="next",t.arg=void 0),!!a}for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n],s=i.completion;if("root"===i.tryLoc)return a("end");if(i.tryLoc<=this.prev){var u=r.call(i,"catchLoc"),o=r.call(i,"finallyLoc");if(u&&o){if(this.prev<i.catchLoc)return a(i.catchLoc,!0);if(this.prev<i.finallyLoc)return a(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return a(i.catchLoc,!0)}else{if(!o)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return a(i.finallyLoc)}}}},abrupt:function(e,t){for(var a=this.tryEntries.length-1;a>=0;--a){var n=this.tryEntries[a];if(n.tryLoc<=this.prev&&r.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var i=n;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var s=i?i.completion:{};return s.type=e,s.arg=t,i?(this.method="next",this.next=i.finallyLoc,f):this.complete(s)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),f},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),C(r),f}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var a=r.completion;if("throw"===a.type){var n=a.arg;C(r)}return n}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:E(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),f}},e}function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function i(e,t,r,a,n,i,s){try{var u=e[i](s),o=u.value}catch(e){return void r(e)}u.done?t(o):Promise.resolve(o).then(a,n)}function s(e){return function(){var t=this,r=arguments;return new Promise((function(a,n){var s=e.apply(t,r);function u(e){i(s,a,n,u,o,"next",e)}function o(e){i(s,a,n,u,o,"throw",e)}u(void 0)}))}}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,I(a.key),a)}}function l(e,t,r){return t&&o(e.prototype,t),r&&o(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function c(e,t,r){return(t=I(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function h(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&m(e,t)}function f(e){return f=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},f(e)}function m(e,t){return m=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},m(e,t)}function v(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function d(e,t,r){return d=v()?Reflect.construct.bind():function(e,t,r){var a=[null];a.push.apply(a,t);var n=new(Function.bind.apply(e,a));return r&&m(n,r.prototype),n},d.apply(null,arguments)}function g(e){var t="function"==typeof Map?new Map:void 0;return g=function(e){if(null===e||(r=e,-1===Function.toString.call(r).indexOf("[native code]")))return e;var r;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,a)}function a(){return d(e,arguments,f(this).constructor)}return a.prototype=Object.create(e.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),m(a,e)},g(e)}function p(e){if(null==e)throw new TypeError("Cannot destructure "+e)}function y(e,t){if(null==e)return{};var r,a,n=function(e,t){if(null==e)return{};var r,a,n={},i=Object.keys(e);for(a=0;a<i.length;a++)r=i[a],t.indexOf(r)>=0||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)r=i[a],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}function k(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function w(e){var t=v();return function(){var r,a=f(e);if(t){var n=f(this).constructor;r=Reflect.construct(a,arguments,n)}else r=a.apply(this,arguments);return k(this,r)}}function b(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=f(e)););return e}function S(){return S="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,r){var a=b(e,t);if(a){var n=Object.getOwnPropertyDescriptor(a,t);return n.get?n.get.call(arguments.length<3?e:r):n.value}},S.apply(this,arguments)}function A(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var a,n,i,s,u=[],o=!0,l=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;o=!1}else for(;!(o=(a=i.call(r)).done)&&(u.push(a.value),u.length!==t);o=!0);}catch(e){l=!0,n=e}finally{try{if(!o&&null!=r.return&&(s=r.return(),Object(s)!==s))return}finally{if(l)throw n}}return u}}(e,t)||C(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function N(e){return function(e){if(Array.isArray(e))return x(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||C(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function C(e,t){if(e){if("string"==typeof e)return x(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?x(e,t):void 0}}function x(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}function E(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=C(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var a=0,n=function(){};return{s:n,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,u=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){u=!0,i=e},f:function(){try{s||null==r.return||r.return()}finally{if(u)throw i}}}}function I(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var a=r.call(e,t||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}var B=["name","optional","primitiveSchema"],V=["value"],D=["isHexOnly"],O=["value","isIndefiniteForm"],P=["value"],R=["isConstructed"],U=["idBlock","lenBlock"],T=["unusedBits","isConstructed"],L=["idBlock","lenBlock"],H=["value"],M=["valueDec","isFirstSid"],K=["value"],_=["valueDec"],j=["value"],J=["value","valueDate"],F=["value"],q=["value","local"],X="element",W="attribute",G="content",z=1e9;function Q(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),a=1;a<t;a++)r[a-1]=arguments[a];for(var n=arguments[0],i=1;i<arguments.length;i++){var s=arguments[i];for(var u in s)s.hasOwnProperty(u)&&(n[u]=s[u])}return n}function Y(e){return function(t){var r=t;r.localName=e.localName||r.name,r.namespaceURI=e.namespaceURI||r.namespaceURI||null,r.prefix=e.prefix||r.prefix||null,r.parser=e.parser||r.parser,r.target!==r&&(r.items=Q({},r.items)),r.target=t}}function Z(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function(t,r){var a=t.constructor,n=r;a.items||(a.items={}),a.target!==a&&(a.items=Q({},a.items)),a.target=t,e.parser?a.items[n]={parser:e.parser,required:e.required||!1,maxOccurs:e.maxOccurs||z,minOccurs:void 0===e.minOccurs?0:e.minOccurs,noRoot:e.noRoot||!1}:a.items[n]={namespaceURI:e.namespaceURI||null,required:e.required||!1,prefix:e.prefix||null,defaultValue:e.defaultValue,converter:e.converter,noRoot:e.noRoot||!1},e.localName=e.localName||e.parser&&e.parser.localName||n,a.items[n].namespaceURI=e.namespaceURI||e.parser&&e.parser.namespaceURI||null,a.items[n].prefix=e.prefix||e.parser&&e.parser.prefix||null,a.items[n].localName=e.localName,a.items[n].type=X,ee(t,n,e)}}function $(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{required:!1,namespaceURI:null};return function(t,r){var a=t.constructor,n=r;e.localName||(e.localName=r),a.items||(a.items={}),a.target!==a&&(a.items=Q({},a.items)),a.target=t,a.items[r]=e,a.items[r].type=W,ee(t,n,e)}}function ee(e,t,r){var a="_".concat(t),n={set:function(e){this[a]!==e&&(this.element=null,this[a]=e)},get:function(){if(void 0===this[a]){var e=r.defaultValue;r.parser&&((e=new r.parser).localName=r.localName),this[a]=e}return this[a]}};Object.defineProperty(e,a,{writable:!0,enumerable:!1}),Object.defineProperty(e,t,n)}var te=function(){function e(t){u(this,e),this.items=new Array,t&&(this.items=t)}return l(e,[{key:"Count",get:function(){return this.items.length}},{key:"Item",value:function(e){return this.items[e]||null}},{key:"Add",value:function(e){this.items.push(e)}},{key:"Pop",value:function(){return this.items.pop()}},{key:"RemoveAt",value:function(e){this.items=this.items.filter((function(t,r){return r!==e}))}},{key:"Clear",value:function(){this.items=new Array}},{key:"GetIterator",value:function(){return this.items}},{key:"ForEach",value:function(e){this.GetIterator().forEach(e)}},{key:"Map",value:function(t){return new e(this.GetIterator().map(t))}},{key:"Filter",value:function(t){return new e(this.GetIterator().filter(t))}},{key:"Sort",value:function(t){return new e(this.GetIterator().sort(t))}},{key:"Every",value:function(e){return this.GetIterator().every(e)}},{key:"Some",value:function(e){return this.GetIterator().some(e)}},{key:"IsEmpty",value:function(){return 0===this.Count}}]),e}();function re(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),a=1;a<t;a++)r[a-1]=arguments[a];for(var n=e,i=/[^%](%\d+)/g,s=null,u=[];s=i.exec(n);)u.push({arg:s[1],index:s.index});for(var o=u.length-1;o>=0;o--){var l=u[o],c=l.arg.substring(1),h=l.index+1;n=n.substring(0,h)+arguments[+c]+n.substring(h+1+c.length)}return n=n.replace("%%","%")}function ae(e,t){for(var r=e+"";r.length<t;)r="0"+r;return r}var ne,ie=l((function e(t){for(var r=arguments.length,a=new Array(r>1?r-1:0),n=1;n<r;n++)a[n-1]=arguments[n];u(this,e),this.prefix="XMLJS",this.code=t,this.name=this.constructor.name,arguments[0]=se[t];var i=re.apply(this,arguments);this.message="".concat(this.prefix).concat(ae(t,4),": ").concat(i),this.stack=new Error(this.message).stack}));!function(e){e[e.NONE=0]="NONE",e[e.NULL_REFERENCE=1]="NULL_REFERENCE",e[e.NULL_PARAM=2]="NULL_PARAM",e[e.DECORATOR_NULL_PARAM=3]="DECORATOR_NULL_PARAM",e[e.COLLECTION_LIMIT=4]="COLLECTION_LIMIT",e[e.METHOD_NOT_IMPLEMENTED=5]="METHOD_NOT_IMPLEMENTED",e[e.METHOD_NOT_SUPPORTED=6]="METHOD_NOT_SUPPORTED",e[e.PARAM_REQUIRED=7]="PARAM_REQUIRED",e[e.CONVERTER_UNSUPPORTED=8]="CONVERTER_UNSUPPORTED",e[e.ELEMENT_MALFORMED=9]="ELEMENT_MALFORMED",e[e.ELEMENT_MISSING=10]="ELEMENT_MISSING",e[e.ATTRIBUTE_MISSING=11]="ATTRIBUTE_MISSING",e[e.CONTENT_MISSING=12]="CONTENT_MISSING",e[e.CRYPTOGRAPHIC=13]="CRYPTOGRAPHIC",e[e.CRYPTOGRAPHIC_NO_MODULE=14]="CRYPTOGRAPHIC_NO_MODULE",e[e.CRYPTOGRAPHIC_UNKNOWN_TRANSFORM=15]="CRYPTOGRAPHIC_UNKNOWN_TRANSFORM",e[e.ALGORITHM_NOT_SUPPORTED=16]="ALGORITHM_NOT_SUPPORTED",e[e.ALGORITHM_WRONG_NAME=17]="ALGORITHM_WRONG_NAME",e[e.XML_EXCEPTION=18]="XML_EXCEPTION"}(ne||(ne={}));var se={};se[ne.NONE]="No description",se[ne.NULL_REFERENCE]="Null reference",se[ne.NULL_PARAM]="'%1' has empty '%2' object",se[ne.DECORATOR_NULL_PARAM]="Decorator '%1' has empty '%2' parameter",se[ne.COLLECTION_LIMIT]="Collection of '%1' in element '%2' has wrong amount of items",se[ne.METHOD_NOT_IMPLEMENTED]="Method is not implemented",se[ne.METHOD_NOT_SUPPORTED]="Method is not supported",se[ne.PARAM_REQUIRED]="Required parameter is missing '%1'",se[ne.CONVERTER_UNSUPPORTED]="Converter is not supported",se[ne.ELEMENT_MALFORMED]="Malformed element '%1'",se[ne.ELEMENT_MISSING]="Element '%1' is missing in '%2'",se[ne.ATTRIBUTE_MISSING]="Attribute '%1' is missing in '%2'",se[ne.CONTENT_MISSING]="Content is missing in '%1'",se[ne.CRYPTOGRAPHIC]="Cryptographic error: %1",se[ne.CRYPTOGRAPHIC_NO_MODULE]="WebCrypto module is not found",se[ne.CRYPTOGRAPHIC_UNKNOWN_TRANSFORM]="Unknown transform %1",se[ne.ALGORITHM_NOT_SUPPORTED]="Algorithm is not supported '%1'",se[ne.ALGORITHM_WRONG_NAME]="Algorithm wrong name in use '%1'",se[ne.XML_EXCEPTION]="XML exception: %1";var ue,oe=function(){function e(){u(this,e)}return l(e,null,[{key:"ToString",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"utf8",r=new Uint8Array(e);switch(t.toLowerCase()){case"utf8":return this.ToUtf8String(r);case"binary":return this.ToBinary(r);case"hex":return this.ToHex(r);case"base64":return this.ToBase64(r);case"base64url":return this.ToBase64Url(r);default:throw new ie(ne.CONVERTER_UNSUPPORTED)}}},{key:"FromString",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"utf8";switch(t.toLowerCase()){case"utf8":return this.FromUtf8String(e);case"binary":return this.FromBinary(e);case"hex":return this.FromHex(e);case"base64":return this.FromBase64(e);case"base64url":return this.FromBase64Url(e);default:throw new ie(ne.CONVERTER_UNSUPPORTED)}}},{key:"ToBase64",value:function(e){if("undefined"!=typeof btoa){var t=this.ToString(e,"binary");return btoa(t)}if("undefined"!=typeof Buffer)return Buffer.from(e).toString("base64");throw new ie(ne.CONVERTER_UNSUPPORTED)}},{key:"FromBase64",value:function(e){if(e=e.replace(/\n/g,"").replace(/\r/g,"").replace(/\t/g,"").replace(/\s/g,""),"undefined"!=typeof atob)return this.FromBinary(atob(e));if("undefined"!=typeof Buffer)return new Uint8Array(Buffer.from(e,"base64"));throw new ie(ne.CONVERTER_UNSUPPORTED)}},{key:"FromBase64Url",value:function(e){return this.FromBase64(this.Base64Padding(e.replace(/\-/g,"+").replace(/\_/g,"/")))}},{key:"ToBase64Url",value:function(e){return this.ToBase64(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/\=/g,"")}},{key:"FromUtf8String",value:function(e){for(var t=unescape(encodeURIComponent(e)),r=new Uint8Array(t.length),a=0;a<t.length;a++)r[a]=t.charCodeAt(a);return r}},{key:"ToUtf8String",value:function(e){var t=String.fromCharCode.apply(null,e);return decodeURIComponent(escape(t))}},{key:"FromBinary",value:function(e){for(var t=e.length,r=new Uint8Array(t),a=0;a<t;a++)r[a]=e.charCodeAt(a);return r}},{key:"ToBinary",value:function(e){for(var t="",r=0;r<e.length;r++)t+=String.fromCharCode(e[r]);return t}},{key:"ToHex",value:function(e){for(var t=[],r=0;r<e.length;r++){var a=e[r].toString(16);t.push(1===a.length?"0"+a:a)}return t.join("")}},{key:"FromHex",value:function(e){for(var t=new Uint8Array(e.length/2),r=0;r<e.length;r+=2){var a=e.slice(r,r+2);t[r/2]=parseInt(a,16)}return t}},{key:"ToDateTime",value:function(e){return new Date(e)}},{key:"FromDateTime",value:function(e){return e.toISOString()}},{key:"Base64Padding",value:function(e){var t=4-e.length%4;if(t<4)for(var r=0;r<t;r++)e+="=";return e}}]),e}(),le="application/xml";!function(e){e[e.None=0]="None",e[e.Element=1]="Element",e[e.Attribute=2]="Attribute",e[e.Text=3]="Text",e[e.CDATA=4]="CDATA",e[e.EntityReference=5]="EntityReference",e[e.Entity=6]="Entity",e[e.ProcessingInstruction=7]="ProcessingInstruction",e[e.Comment=8]="Comment",e[e.Document=9]="Document",e[e.DocumentType=10]="DocumentType",e[e.DocumentFragment=11]="DocumentFragment",e[e.Notation=12]="Notation",e[e.Whitespace=13]="Whitespace",e[e.SignificantWhitespace=14]="SignificantWhitespace",e[e.EndElement=15]="EndElement",e[e.EndEntity=16]="EndEntity",e[e.XmlDeclaration=17]="XmlDeclaration"}(ue||(ue={}));var ce,he=function(e,t){throw new Error("Not implemented")};if("undefined"==typeof self){ce=global;var fe=require("@xmldom/xmldom");he=require("xpath.js"),ce.XMLSerializer=fe.XMLSerializer,ce.DOMParser=fe.DOMParser,ce.DOMImplementation=fe.DOMImplementation,ce.document=(new DOMImplementation).createDocument("http://www.w3.org/1999/xhtml","html",null)}else ce=self;var me="undefined"!=typeof self?function(e,t){for(var r,a=null==e.ownerDocument?e:e.ownerDocument,n=document.createNSResolver(null==e.ownerDocument?e.documentElement:e.ownerDocument.documentElement),i=a.evaluate(t,e,n,XPathResult.ANY_TYPE,null),s=[];r=i.iterateNext();)s.push(r);return s}:he;function ve(e){return e=e.replace(/\r\n/g,"\n").replace(/\r/g,"\n"),(new DOMParser).parseFromString(e,le)}function de(e,t){var r=me(e,t);return r&&r.length>0?r[0]:null}function ge(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(we(e)){e.namespaceURI&&"http://www.w3.org/XML/1998/namespace"!==e.namespaceURI&&!t[e.prefix||""]&&(t[e.prefix?e.prefix:""]=e.namespaceURI);for(var r=0;r<e.childNodes.length;r++){var a=e.childNodes.item(r);a&&a.nodeType===ue.Element&&ge(a,t)}}}function pe(e){var t={};return ge(e,t),t}function ye(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),a=1;a<t;a++)r[a-1]=arguments[a];for(var n=arguments[0],i=1;i<arguments.length;i++){var s=arguments[i];for(var u in s)s.hasOwnProperty(u)&&(n[u]=s[u])}return n}function ke(e,t){return e&&e.nodeType===t}function we(e){return ke(e,ue.Element)}function be(e){return ke(e,ue.Document)}var Se={get:function(e){if(e)return oe.ToBase64(e)},set:function(e){return oe.FromBase64(e)}},Ae={get:function(e){return e?e.toString():"0"},set:function(e){return Number(e)}},Ne="xml_root",Ce=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(u(this,e),this.prefix=this.GetStatic().prefix||null,this.localName=this.GetStatic().localName,this.namespaceURI=this.GetStatic().namespaceURI,t)for(var r=0,a=Object.entries(t);r<a.length;r++){var n=A(a[r],2),i=n[0],s=n[1];void 0!==s&&(this[i]=s)}}return l(e,[{key:"Element",get:function(){return this.element}},{key:"Prefix",get:function(){return this.prefix},set:function(e){this.prefix=e}},{key:"LocalName",get:function(){return this.localName}},{key:"NamespaceURI",get:function(){return this.namespaceURI||null}},{key:"HasChanged",value:function(){var e=this.GetStatic();if(e.items)for(var t in e.items)if(e.items.hasOwnProperty(t)){var r=e.items[t],a=this[t];if(r.parser&&a&&a.HasChanged())return!0}return null===this.element}},{key:"GetXml",value:function(t){if(!t&&!this.HasChanged())return this.element||null;var r=this.CreateDocument(),a=this.CreateElement(),n=this.GetStatic(),i=this.localName;if(n.items)for(var s in n.items)if(n.items.hasOwnProperty(s)){var u=this[s],o=n.items[s];switch(o.type){case G:var l=o,c=l.converter?l.converter.get(u):u;if(l.required&&null==c)throw new ie(ne.CONTENT_MISSING,i);(l.defaultValue!==u||l.required)&&(a.textContent=c);break;case W:var h=o,f=h.converter?h.converter.get(u):u;if(h.required&&null==f)throw new ie(ne.ATTRIBUTE_MISSING,h.localName,i);(h.defaultValue!==u||h.required)&&(h.namespaceURI?a.setAttributeNS(h.namespaceURI,h.localName,f):a.setAttribute(h.localName,f));break;case X:var m=o,v=null;if(m.parser){if(m.required&&!u||m.minOccurs&&!u.Count)throw new ie(ne.ELEMENT_MISSING,u.localName,i);u&&(v=u.GetXml(void 0===u.element&&(m.required||u.Count)))}else{var d=m.converter?m.converter.get(u):u;if(m.required&&void 0===d)throw new ie(ne.ELEMENT_MISSING,m.localName,i);if(u!==m.defaultValue||m.required)if(v=m.namespaceURI?r.createElementNS(m.namespaceURI,"".concat(m.prefix?m.prefix+":":"").concat(m.localName)):r.createElement("".concat(m.prefix?m.prefix+":":"").concat(m.localName)),Array.isArray(d)){var g,p=E(d);try{for(p.s();!(g=p.n()).done;){var y=g.value,k=y instanceof e?y.GetXml(!0):y;null!==k&&v.appendChild(k)}}catch(e){p.e(e)}finally{p.f()}}else d instanceof e?v.appendChild(d.GetXml(!0)):v.textContent=d}if(v)if(m.noRoot){for(var w=[],b=0;b<v.childNodes.length;b++){var S=v.childNodes.item(b);we(S)&&w.push(S)}if(w.length<m.minOccurs||w.length>m.maxOccurs)throw new ie(ne.COLLECTION_LIMIT,u.localName,n.localName);w.forEach((function(e){return a.appendChild(e.cloneNode(!0))}))}else{if(v.childNodes.length<m.minOccurs||v.childNodes.length>m.maxOccurs)throw new ie(ne.COLLECTION_LIMIT,u.localName,n.localName);a.appendChild(v)}}}return this.OnGetXml(a),this.element=a,a}},{key:"LoadXml",value:function(e){var t,r=this;"string"==typeof e?t=ve(e).documentElement:t=e;if(!t)throw new ie(ne.PARAM_REQUIRED,"element");var a=this.GetStatic(),n=this.localName;if(t.localName!==n||t.namespaceURI!=this.NamespaceURI)throw new ie(ne.ELEMENT_MALFORMED,n);if(a.items)for(var i in a.items)if(a.items.hasOwnProperty(i)){var s=a.items[i];switch(s.type){case G:var u=s;if(u.required&&!t.textContent)throw new ie(ne.CONTENT_MISSING,n);if(t.textContent){var o=u.converter?u.converter.set(t.textContent):t.textContent;r[i]=o}else r[i]=u.defaultValue;break;case W:var l=s,c=void 0,h=void 0;if(!l.localName)throw new ie(ne.PARAM_REQUIRED,"localName");if(l.namespaceURI?(c=t.hasAttributeNS.bind(t,l.namespaceURI,l.localName),h=t.getAttributeNS.bind(t,l.namespaceURI,l.localName)):(c=t.hasAttribute.bind(t,l.localName),h=t.getAttribute.bind(t,l.localName)),l.required&&!c())throw new ie(ne.ATTRIBUTE_MISSING,l.localName,n);if(c()){var f=l.converter?l.converter.set(h()):h();r[i]=f}else r[i]=l.defaultValue;break;case X:var m=s;if(m.noRoot){if(!m.parser)throw new ie(ne.XML_EXCEPTION,"Schema for '".concat(m.localName,"' with flag noRoot must have 'parser'"));var v=new m.parser;if(!(v instanceof xe))throw new ie(ne.XML_EXCEPTION,"Schema for '".concat(m.localName,"' with flag noRoot must have 'parser' like instance of XmlCollection"));if(v.OnLoadXml(t),delete v.element,v.Count<m.minOccurs||v.Count>m.maxOccurs)throw new ie(ne.COLLECTION_LIMIT,m.parser.localName,n);r[i]=v;continue}for(var d=null,g=0;g<t.childNodes.length;g++){var p=t.childNodes.item(g);if(we(p)){var y=p;if(y.localName===m.localName&&y.namespaceURI==m.namespaceURI){d=y;break}}}if(m.required&&!d)throw new ie(ne.ELEMENT_MISSING,m.parser?m.parser.localName:m.localName,n);if(m.parser){if(d){var k=new m.parser;k.localName=m.localName,k.namespaceURI=m.namespaceURI,r[i]=k,k.LoadXml(d)}}else if(d){var w=m.converter?m.converter.set(d.textContent):d.textContent;r[i]=w}else r[i]=m.defaultValue}}this.OnLoadXml(t),this.prefix=t.prefix||"",this.element=t}},{key:"toString",value:function(){var e=this.GetXml();return e?(new XMLSerializer).serializeToString(e):""}},{key:"GetElement",value:function(t){var r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this.element)throw new ie(ne.NULL_PARAM,this.localName);return e.GetElement(this.element,t,r)}},{key:"GetChildren",value:function(t,r){if(!this.element)throw new ie(ne.NULL_PARAM,this.localName);return e.GetChildren(this.element,t,r||this.NamespaceURI||void 0)}},{key:"GetChild",value:function(t){var r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this.element)throw new ie(ne.NULL_PARAM,this.localName);return e.GetChild(this.element,t,this.NamespaceURI||void 0,r)}},{key:"GetFirstChild",value:function(t,r){if(!this.element)throw new ie(ne.NULL_PARAM,this.localName);return e.GetFirstChild(this.element,t,r)}},{key:"GetAttribute",value:function(t,r){var a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(!this.element)throw new ie(ne.NULL_PARAM,this.localName);return e.GetAttribute(this.element,t,r,a)}},{key:"IsEmpty",value:function(){return void 0===this.Element}},{key:"OnLoadXml",value:function(e){}},{key:"GetStatic",value:function(){return this.constructor}},{key:"GetPrefix",value:function(){return this.Prefix?this.prefix+":":""}},{key:"OnGetXml",value:function(e){}},{key:"CreateElement",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;e||(e=this.CreateDocument()),t=t||this.localName,r=r||this.NamespaceURI;var n=((a=a||this.prefix)?"".concat(a,":"):"")+t,i=r?e.createElementNS(r,n):e.createElement(n);return e.importNode(i,!0),i}},{key:"CreateDocument",value:function(){return e.CreateDocument(this.localName,this.NamespaceURI,this.Prefix)}}],[{key:"LoadXml",value:function(e){var t=new this;return t.LoadXml(e),t}},{key:"GetElement",value:function(e,t){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],a=e.getElementsByTagName(t);if(r&&0===a.length)throw new ie(ne.ELEMENT_MISSING,t,e.localName);return a[0]||null}},{key:"GetAttribute",value:function(e,t,r){var a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(e.hasAttribute(t))return e.getAttribute(t);if(a)throw new ie(ne.ATTRIBUTE_MISSING,t,e.localName);return r}},{key:"GetElementById",value:function(e,t){if(null==e||null==t)return null;var r=null;return be(e)&&(r=e.getElementById(t)),null==r&&null==(r=de(e,"//*[@*[local-name()='Id']='".concat(t,"']")))&&null==(r=de(e,"//*[@*[local-name()='ID']='".concat(t,"']")))&&(r=de(e,"//*[@*[local-name()='id']='".concat(t,"']"))),r}},{key:"CreateDocument",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ne,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a="",n="",i="";r&&(a=r+":",n=":"+r),t&&(i=" xmlns".concat(n,'="').concat(t,'"'));var s="".concat(a).concat(e),u=(new DOMParser).parseFromString("<".concat(s).concat(i,"></").concat(s,">"),le);return u}},{key:"GetChildren",value:function(e,t,r){e=be(e)?e.documentElement:e;for(var a=[],n=0;n<e.childNodes.length;n++){var i=e.childNodes[n];!we(i)||i.localName!==t||i.namespaceURI!==r&&r||a.push(i)}return a}},{key:"GetFirstChild",value:function(e,t,r){e=be(e)?e.documentElement:e;for(var a=0;a<e.childNodes.length;a++){var n=e.childNodes[a];if(we(n)&&n.localName===t&&(n.namespaceURI===r||!r))return n}return null}},{key:"GetChild",value:function(e,t,r){for(var a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],n=0;n<e.childNodes.length;n++){var i=e.childNodes[n];if(we(i)&&i.localName===t&&(i.namespaceURI===r||!r))return i}if(a)throw new ie(ne.ELEMENT_MISSING,t,e.localName);return null}}]),e}(),xe=function(e){h(r,e);var t=w(r);function r(){var e;return u(this,r),(e=t.apply(this,arguments)).MaxOccurs=Number.MAX_VALUE,e.MinOccurs=0,e.items=[],e}return l(r,[{key:"HasChanged",value:function(){var e=S(f(r.prototype),"HasChanged",this).call(this),t=this.Some((function(e){return e.HasChanged()}));return e||t}},{key:"Count",get:function(){return this.items.length}},{key:"Item",value:function(e){return this.items[e]||null}},{key:"Add",value:function(e){this.items.push(e),this.element=null}},{key:"Pop",value:function(){return this.element=null,this.items.pop()}},{key:"RemoveAt",value:function(e){this.items=this.items.filter((function(t,r){return r!==e})),this.element=null}},{key:"Clear",value:function(){this.items=new Array,this.element=null}},{key:"GetIterator",value:function(){return this.items}},{key:"ForEach",value:function(e){this.GetIterator().forEach(e)}},{key:"Map",value:function(e){return new te(this.GetIterator().map(e))}},{key:"Filter",value:function(e){return new te(this.GetIterator().filter(e))}},{key:"Sort",value:function(e){return new te(this.GetIterator().sort(e))}},{key:"Every",value:function(e){return this.GetIterator().every(e)}},{key:"Some",value:function(e){return this.GetIterator().some(e)}},{key:"IsEmpty",value:function(){return 0===this.Count}},{key:"OnGetXml",value:function(e){var t,r=E(this.GetIterator());try{for(r.s();!(t=r.n()).done;){var a=t.value.GetXml();a&&e.appendChild(a)}}catch(e){r.e(e)}finally{r.f()}}},{key:"OnLoadXml",value:function(e){var t=this.GetStatic();if(!t.parser)throw new ie(ne.XML_EXCEPTION,"".concat(t.localName," doesn't have required 'parser' in @XmlElement"));for(var r=0;r<e.childNodes.length;r++){var a=e.childNodes.item(r);if(we(a)&&a.localName===t.parser.localName&&a.namespaceURI==t.namespaceURI){var n=a,i=new t.parser;i.LoadXml(n),this.Add(i)}}}}]),r}(Ce),Ee=function(e){h(r,e);var t=w(r);function r(){return u(this,r),t.apply(this,arguments)}return l(r,[{key:"Add",value:function(e){e.prefix=e.prefix||"",e.namespace=e.namespace||"",S(f(r.prototype),"Add",this).call(this,e)}},{key:"GetPrefix",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.Count-1,r=this.Count-1;e=e||"",t>r&&(t=r);for(var a=t;a>=0;a--){var n=this.items[a];if(n.prefix===e)return n}return null}},{key:"GetNamespace",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.Count-1,r=this.Count-1;e=e||"",t>r&&(t=r);for(var a=t;a>=0;a--){var n=this.items[a];if(n.namespace===e)return n}return null}}]),r}(te),Ie=function(){function e(){u(this,e)}return l(e,null,[{key:"isArrayBuffer",value:function(e){return"[object ArrayBuffer]"===Object.prototype.toString.call(e)}},{key:"toArrayBuffer",value:function(e){return this.isArrayBuffer(e)?e:e.byteLength===e.buffer.byteLength?e.buffer:this.toUint8Array(e).slice().buffer}},{key:"toUint8Array",value:function(e){return this.toView(e,Uint8Array)}},{key:"toView",value:function(e,t){if(e.constructor===t)return e;if(this.isArrayBuffer(e))return new t(e);if(this.isArrayBufferView(e))return new t(e.buffer,e.byteOffset,e.byteLength);throw new TypeError("The provided value is not of type '(ArrayBuffer or ArrayBufferView)'")}},{key:"isBufferSource",value:function(e){return this.isArrayBufferView(e)||this.isArrayBuffer(e)}},{key:"isArrayBufferView",value:function(e){return ArrayBuffer.isView(e)||e&&this.isArrayBuffer(e.buffer)}},{key:"isEqual",value:function(t,r){var a=e.toUint8Array(t),n=e.toUint8Array(r);if(a.length!==n.byteLength)return!1;for(var i=0;i<a.length;i++)if(a[i]!==n[i])return!1;return!0}},{key:"concat",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];if(Array.isArray(t[0])){var a,n=t[0],i=0,s=E(n);try{for(s.s();!(a=s.n()).done;){var u=a.value;i+=u.byteLength}}catch(e){s.e(e)}finally{s.f()}var o,l=new Uint8Array(i),c=0,h=E(n);try{for(h.s();!(o=h.n()).done;){var f=o.value,m=this.toUint8Array(f);l.set(m,c),c+=m.length}}catch(e){h.e(e)}finally{h.f()}return t[1]?this.toView(l,t[1]):l.buffer}return this.concat(t)}}]),e}(),Be=function(){function e(){u(this,e)}return l(e,null,[{key:"fromString",value:function(e){for(var t=unescape(encodeURIComponent(e)),r=new Uint8Array(t.length),a=0;a<t.length;a++)r[a]=t.charCodeAt(a);return r.buffer}},{key:"toString",value:function(e){for(var t=Ie.toUint8Array(e),r="",a=0;a<t.length;a++)r+=String.fromCharCode(t[a]);return decodeURIComponent(escape(r))}}]),e}(),Ve=function(){function e(){u(this,e)}return l(e,null,[{key:"toString",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=Ie.toArrayBuffer(e),a=new DataView(r),n="",i=0;i<r.byteLength;i+=2){var s=a.getUint16(i,t);n+=String.fromCharCode(s)}return n}},{key:"fromString",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=new ArrayBuffer(2*e.length),a=new DataView(r),n=0;n<e.length;n++)a.setUint16(2*n,e.charCodeAt(n),t);return r}}]),e}(),De=function(){function e(){u(this,e)}return l(e,null,[{key:"isHex",value:function(e){return"string"==typeof e&&/^[a-z0-9]+$/i.test(e)}},{key:"isBase64",value:function(e){return"string"==typeof e&&/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(e)}},{key:"isBase64Url",value:function(e){return"string"==typeof e&&/^[a-zA-Z0-9-_]+$/i.test(e)}},{key:"ToString",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"utf8",r=Ie.toUint8Array(e);switch(t.toLowerCase()){case"utf8":return this.ToUtf8String(r);case"binary":return this.ToBinary(r);case"hex":return this.ToHex(r);case"base64":return this.ToBase64(r);case"base64url":return this.ToBase64Url(r);case"utf16le":return Ve.toString(r,!0);case"utf16":case"utf16be":return Ve.toString(r);default:throw new Error("Unknown type of encoding '".concat(t,"'"))}}},{key:"FromString",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"utf8";if(!e)return new ArrayBuffer(0);switch(t.toLowerCase()){case"utf8":return this.FromUtf8String(e);case"binary":return this.FromBinary(e);case"hex":return this.FromHex(e);case"base64":return this.FromBase64(e);case"base64url":return this.FromBase64Url(e);case"utf16le":return Ve.fromString(e,!0);case"utf16":case"utf16be":return Ve.fromString(e);default:throw new Error("Unknown type of encoding '".concat(t,"'"))}}},{key:"ToBase64",value:function(e){var t=Ie.toUint8Array(e);if("undefined"!=typeof btoa){var r=this.ToString(t,"binary");return btoa(r)}return Buffer.from(t).toString("base64")}},{key:"FromBase64",value:function(t){var r=this.formatString(t);if(!r)return new ArrayBuffer(0);if(!e.isBase64(r))throw new TypeError("Argument 'base64Text' is not Base64 encoded");return"undefined"!=typeof atob?this.FromBinary(atob(r)):new Uint8Array(Buffer.from(r,"base64")).buffer}},{key:"FromBase64Url",value:function(t){var r=this.formatString(t);if(!r)return new ArrayBuffer(0);if(!e.isBase64Url(r))throw new TypeError("Argument 'base64url' is not Base64Url encoded");return this.FromBase64(this.Base64Padding(r.replace(/\-/g,"+").replace(/\_/g,"/")))}},{key:"ToBase64Url",value:function(e){return this.ToBase64(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/\=/g,"")}},{key:"FromUtf8String",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.DEFAULT_UTF8_ENCODING;switch(r){case"ascii":return this.FromBinary(t);case"utf8":return Be.fromString(t);case"utf16":case"utf16be":return Ve.fromString(t);case"utf16le":case"usc2":return Ve.fromString(t,!0);default:throw new Error("Unknown type of encoding '".concat(r,"'"))}}},{key:"ToUtf8String",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.DEFAULT_UTF8_ENCODING;switch(r){case"ascii":return this.ToBinary(t);case"utf8":return Be.toString(t);case"utf16":case"utf16be":return Ve.toString(t);case"utf16le":case"usc2":return Ve.toString(t,!0);default:throw new Error("Unknown type of encoding '".concat(r,"'"))}}},{key:"FromBinary",value:function(e){for(var t=e.length,r=new Uint8Array(t),a=0;a<t;a++)r[a]=e.charCodeAt(a);return r.buffer}},{key:"ToBinary",value:function(e){for(var t=Ie.toUint8Array(e),r="",a=0;a<t.length;a++)r+=String.fromCharCode(t[a]);return r}},{key:"ToHex",value:function(e){for(var t=Ie.toUint8Array(e),r=[],a=t.length,n=0;n<a;n++){var i=t[n].toString(16).padStart(2,"0");r.push(i)}return r.join("")}},{key:"FromHex",value:function(t){var r=this.formatString(t);if(!r)return new ArrayBuffer(0);if(!e.isHex(r))throw new TypeError("Argument 'hexString' is not HEX encoded");r.length%2&&(r="0".concat(r));for(var a=new Uint8Array(r.length/2),n=0;n<r.length;n+=2){var i=r.slice(n,n+2);a[n/2]=parseInt(i,16)}return a.buffer}},{key:"ToUtf16String",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return Ve.toString(e,t)}},{key:"FromUtf16String",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return Ve.fromString(e,t)}},{key:"Base64Padding",value:function(e){var t=4-e.length%4;if(t<4)for(var r=0;r<t;r++)e+="=";return e}},{key:"formatString",value:function(e){return(null==e?void 0:e.replace(/[\n\r\t ]/g,""))||""}}]),e}();function Oe(e,t,r){var a;return e instanceof Object==!1?r:null!==(a=e[t])&&void 0!==a?a:r}function Pe(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.byteLength-r,n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i="",s=E(new Uint8Array(e,r,a));try{for(s.s();!(t=s.n()).done;){var u=t.value,o=u.toString(16).toUpperCase();1===o.length&&(i+="0"),i+=o,n&&(i+=" ")}}catch(e){s.e(e)}finally{s.f()}return i.trim()}function Re(e,t){var r=0;if(1===e.length)return e[0];for(var a=e.length-1;a>=0;a--)r+=e[e.length-1-a]*Math.pow(2,t*a);return r}function Ue(e,t){for(var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1,a=r,n=e,i=0,s=Math.pow(2,t),u=1;u<8;u++){if(e<s){var o=void 0;if(a<0)o=new ArrayBuffer(u),i=u;else{if(a<u)return new ArrayBuffer(0);o=new ArrayBuffer(a),i=a}for(var l=new Uint8Array(o),c=u-1;c>=0;c--){var h=Math.pow(2,c*t);l[i-c-1]=Math.floor(n/h),n-=l[i-c-1]*h}return o}s*=Math.pow(2,t)}return new ArrayBuffer(0)}function Te(){for(var e=0,t=0,r=arguments.length,a=new Array(r),n=0;n<r;n++)a[n]=arguments[n];for(var i=0,s=a;i<s.length;i++){var u=s[i];e+=u.byteLength}for(var o=new ArrayBuffer(e),l=new Uint8Array(o),c=0,h=a;c<h.length;c++){var f=h[c];l.set(new Uint8Array(f),t),t+=f.byteLength}return o}function Le(){for(var e=0,t=0,r=arguments.length,a=new Array(r),n=0;n<r;n++)a[n]=arguments[n];for(var i=0,s=a;i<s.length;i++){var u=s[i];e+=u.length}for(var o=new ArrayBuffer(e),l=new Uint8Array(o),c=0,h=a;c<h.length;c++){var f=h[c];l.set(f,t),t+=f.length}return l}function He(){var e=new Uint8Array(this.valueHex);if(this.valueHex.byteLength>=2){var t=255===e[0]&&128&e[1],r=0===e[0]&&0==(128&e[1]);(t||r)&&this.warnings.push("Needlessly long format")}for(var a=new ArrayBuffer(this.valueHex.byteLength),n=new Uint8Array(a),i=0;i<this.valueHex.byteLength;i++)n[i]=0;n[0]=128&e[0];for(var s=Re(n,8),u=new ArrayBuffer(this.valueHex.byteLength),o=new Uint8Array(u),l=0;l<this.valueHex.byteLength;l++)o[l]=e[l];return o[0]&=127,Re(o,8)-s}function Me(e,t){if(e.byteLength!==t.byteLength)return!1;for(var r=new Uint8Array(e),a=new Uint8Array(t),n=0;n<r.length;n++)if(r[n]!==a[n])return!1;return!0}function Ke(e,t){var r=e.toString(10);if(t<r.length)return"";for(var a=t-r.length,n=new Array(a),i=0;i<a;i++)n[i]="0";return n.join("").concat(r)}De.DEFAULT_UTF8_ENCODING="utf8";var _e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",je="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=";function Je(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],n=0,i=0,s=0,u="",o=t?je:_e;if(a){for(var l=0,c=0;c<e.length;c++)if(0!==e.charCodeAt(c)){l=c;break}e=e.slice(l)}for(;n<e.length;){var h=e.charCodeAt(n++);n>=e.length&&(i=1);var f=e.charCodeAt(n++);n>=e.length&&(s=1);var m=e.charCodeAt(n++),v=h>>2,d=(3&h)<<4|f>>4,g=(15&f)<<2|m>>6,p=63&m;1===i?g=p=64:1===s&&(p=64),u+=r?64===g?"".concat(o.charAt(v)).concat(o.charAt(d)):64===p?"".concat(o.charAt(v)).concat(o.charAt(d)).concat(o.charAt(g)):"".concat(o.charAt(v)).concat(o.charAt(d)).concat(o.charAt(g)).concat(o.charAt(p)):"".concat(o.charAt(v)).concat(o.charAt(d)).concat(o.charAt(g)).concat(o.charAt(p))}return u}function Fe(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=t?je:_e;function n(e){for(var t=0;t<64;t++)if(a.charAt(t)===e)return t;return 64}function i(e){return 64===e?0:e}for(var s=0,u="";s<e.length;){var o=n(e.charAt(s++)),l=s>=e.length?0:n(e.charAt(s++)),c=s>=e.length?0:n(e.charAt(s++)),h=s>=e.length?0:n(e.charAt(s++)),f=i(o)<<2|i(l)>>4,m=(15&i(l))<<4|i(c)>>2,v=(3&i(c))<<6|i(h);u+=String.fromCharCode(f),64!==c&&(u+=String.fromCharCode(m)),64!==h&&(u+=String.fromCharCode(v))}if(r){for(var d=u.length,g=-1,p=d-1;p>=0;p--)if(0!==u.charCodeAt(p)){g=p;break}u=-1!==g?u.slice(0,g+1):""}return u}function qe(e){var t,r="",a=E(new Uint8Array(e));try{for(a.s();!(t=a.n()).done;){var n=t.value;r+=String.fromCharCode(n)}}catch(e){a.e(e)}finally{a.f()}return r}function Xe(e){for(var t=e.length,r=new ArrayBuffer(t),a=new Uint8Array(r),n=0;n<t;n++)a[n]=e.charCodeAt(n);return r}var We=Math.log(2);function Ge(e,t){var r,a=E(t);try{for(a.s();!(r=a.n()).done;){delete e[r.value]}}catch(e){a.e(e)}finally{a.f()}}function ze(){if("undefined"==typeof BigInt)throw new Error("BigInt is not defined. Your environment doesn't implement BigInt.")}function Qe(e){for(var t=0,r=0,a=0;a<e.length;a++){t+=e[a].byteLength}for(var n=new Uint8Array(t),i=0;i<e.length;i++){var s=e[i];n.set(new Uint8Array(s),r),r+=s.byteLength}return n.buffer}function Ye(e,t,r,a){return t instanceof Uint8Array?t.byteLength?r<0?(e.error="Wrong parameter: inputOffset less than zero",!1):a<0?(e.error="Wrong parameter: inputLength less than zero",!1):!(t.byteLength-r-a<0)||(e.error="End of input reached before message was fully decoded (inconsistent offset and length values)",!1):(e.error="Wrong parameter: inputBuffer has zero length",!1):(e.error="Wrong parameter: inputBuffer must be 'Uint8Array'",!1)}var Ze=function(){function e(){u(this,e),this.items=[]}return l(e,[{key:"write",value:function(e){this.items.push(e)}},{key:"final",value:function(){return Qe(this.items)}}]),e}(),$e=[new Uint8Array([1])],et="0123456789",tt="name",rt="valueHexView",at="",nt=new ArrayBuffer(0),it=new Uint8Array(0),st="EndOfContent",ut="OCTET STRING",ot="BIT STRING";function lt(e){var t;return t=function(e){h(a,e);var t=w(a);function a(){var e,r;u(this,a);for(var n=arguments.length,i=new Array(n),s=0;s<n;s++)i[s]=arguments[s];e=t.call.apply(t,[this].concat(i));var o=i[0]||{};return e.isHexOnly=null!==(r=o.isHexOnly)&&void 0!==r&&r,e.valueHexView=o.valueHex?Ie.toUint8Array(o.valueHex):it,e}return l(a,[{key:"valueHex",get:function(){return this.valueHexView.slice().buffer},set:function(e){this.valueHexView=new Uint8Array(e)}},{key:"fromBER",value:function(e,t,r){var a=e instanceof ArrayBuffer?new Uint8Array(e):e;if(!Ye(this,a,t,r))return-1;var n=t+r;return this.valueHexView=a.subarray(t,n),this.valueHexView.length?(this.blockLength=r,n):(this.warnings.push("Zero buffer length"),t)}},{key:"toBER",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this.isHexOnly?e?new ArrayBuffer(this.valueHexView.byteLength):this.valueHexView.byteLength===this.valueHexView.buffer.byteLength?this.valueHexView.buffer:this.valueHexView.slice().buffer:(this.error="Flag 'isHexOnly' is not set, abort",nt)}},{key:"toJSON",value:function(){return r(r({},S(f(a.prototype),"toJSON",this).call(this)),{},{isHexOnly:this.isHexOnly,valueHex:De.ToHex(this.valueHexView)})}}]),a}(e),t.NAME="hexBlock",t}var ct=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.blockLength,a=void 0===r?0:r,n=t.error,i=void 0===n?at:n,s=t.warnings,o=void 0===s?[]:s,l=t.valueBeforeDecode,c=void 0===l?it:l;u(this,e),this.blockLength=a,this.error=i,this.warnings=o,this.valueBeforeDecodeView=Ie.toUint8Array(c)}return l(e,[{key:"valueBeforeDecode",get:function(){return this.valueBeforeDecodeView.slice().buffer},set:function(e){this.valueBeforeDecodeView=new Uint8Array(e)}},{key:"toJSON",value:function(){return{blockName:this.constructor.NAME,blockLength:this.blockLength,error:this.error,warnings:this.warnings,valueBeforeDecode:De.ToHex(this.valueBeforeDecodeView)}}}],[{key:"blockName",value:function(){return this.NAME}}]),e}();ct.NAME="baseBlock";var ht=function(e){h(r,e);var t=w(r);function r(){return u(this,r),t.apply(this,arguments)}return l(r,[{key:"fromBER",value:function(e,t,r){throw TypeError("User need to make a specific function in a class which extends 'ValueBlock'")}},{key:"toBER",value:function(e,t){throw TypeError("User need to make a specific function in a class which extends 'ValueBlock'")}}]),r}(ct);ht.NAME="valueBlock";var ft=function(e){h(a,e);var t=w(a);function a(){var e,r,n,i,s,o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},l=o.idBlock,c=void 0===l?{}:l;return u(this,a),e=t.call(this),c?(e.isHexOnly=null!==(r=c.isHexOnly)&&void 0!==r&&r,e.valueHexView=c.valueHex?Ie.toUint8Array(c.valueHex):it,e.tagClass=null!==(n=c.tagClass)&&void 0!==n?n:-1,e.tagNumber=null!==(i=c.tagNumber)&&void 0!==i?i:-1,e.isConstructed=null!==(s=c.isConstructed)&&void 0!==s&&s):(e.tagClass=-1,e.tagNumber=-1,e.isConstructed=!1),e}return l(a,[{key:"toBER",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=0;switch(this.tagClass){case 1:t|=0;break;case 2:t|=64;break;case 3:t|=128;break;case 4:t|=192;break;default:return this.error="Unknown tag class",nt}if(this.isConstructed&&(t|=32),this.tagNumber<31&&!this.isHexOnly){var r=new Uint8Array(1);if(!e){var a=this.tagNumber;t|=a&=31,r[0]=t}return r.buffer}if(!this.isHexOnly){var n=Ue(this.tagNumber,7),i=new Uint8Array(n),s=n.byteLength,u=new Uint8Array(s+1);if(u[0]=31|t,!e){for(var o=0;o<s-1;o++)u[o+1]=128|i[o];u[s]=i[s-1]}return u.buffer}var l=new Uint8Array(this.valueHexView.byteLength+1);if(l[0]=31|t,!e){for(var c=this.valueHexView,h=0;h<c.length-1;h++)l[h+1]=128|c[h];l[this.valueHexView.byteLength]=c[c.length-1]}return l.buffer}},{key:"fromBER",value:function(e,t,r){var a=Ie.toUint8Array(e);if(!Ye(this,a,t,r))return-1;var n=a.subarray(t,t+r);if(0===n.length)return this.error="Zero buffer length",-1;switch(192&n[0]){case 0:this.tagClass=1;break;case 64:this.tagClass=2;break;case 128:this.tagClass=3;break;case 192:this.tagClass=4;break;default:return this.error="Unknown tag class",-1}this.isConstructed=32==(32&n[0]),this.isHexOnly=!1;var i=31&n[0];if(31!==i)this.tagNumber=i,this.blockLength=1;else{for(var s=1,u=this.valueHexView=new Uint8Array(255),o=255;128&n[s];){if(u[s-1]=127&n[s],++s>=n.length)return this.error="End of input reached before message was fully decoded",-1;if(s===o){o+=255;for(var l=new Uint8Array(o),c=0;c<u.length;c++)l[c]=u[c];u=this.valueHexView=new Uint8Array(o)}}this.blockLength=s+1,u[s-1]=127&n[s];for(var h=new Uint8Array(s),f=0;f<s;f++)h[f]=u[f];(u=this.valueHexView=new Uint8Array(s)).set(h),this.blockLength<=9?this.tagNumber=Re(u,7):(this.isHexOnly=!0,this.warnings.push("Tag too long, represented as hex-coded"))}if(1===this.tagClass&&this.isConstructed)switch(this.tagNumber){case 1:case 2:case 5:case 6:case 9:case 13:case 14:case 23:case 24:case 31:case 32:case 33:case 34:return this.error="Constructed encoding used for primitive type",-1}return t+this.blockLength}},{key:"toJSON",value:function(){return r(r({},S(f(a.prototype),"toJSON",this).call(this)),{},{tagClass:this.tagClass,tagNumber:this.tagNumber,isConstructed:this.isConstructed})}}]),a}(lt(ct));ft.NAME="identificationBlock";var mt=function(e){h(a,e);var t=w(a);function a(){var e,r,n,i,s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=s.lenBlock,l=void 0===o?{}:o;return u(this,a),(e=t.call(this)).isIndefiniteForm=null!==(r=l.isIndefiniteForm)&&void 0!==r&&r,e.longFormUsed=null!==(n=l.longFormUsed)&&void 0!==n&&n,e.length=null!==(i=l.length)&&void 0!==i?i:0,e}return l(a,[{key:"fromBER",value:function(e,t,r){var a=Ie.toUint8Array(e);if(!Ye(this,a,t,r))return-1;var n=a.subarray(t,t+r);if(0===n.length)return this.error="Zero buffer length",-1;if(255===n[0])return this.error="Length block 0xFF is reserved by standard",-1;if(this.isIndefiniteForm=128===n[0],this.isIndefiniteForm)return this.blockLength=1,t+this.blockLength;if(this.longFormUsed=!!(128&n[0]),!1===this.longFormUsed)return this.length=n[0],this.blockLength=1,t+this.blockLength;var i=127&n[0];if(i>8)return this.error="Too big integer",-1;if(i+1>n.length)return this.error="End of input reached before message was fully decoded",-1;var s=t+1,u=a.subarray(s,s+i);return 0===u[i-1]&&this.warnings.push("Needlessly long encoded length"),this.length=Re(u,8),this.longFormUsed&&this.length<=127&&this.warnings.push("Unnecessary usage of long length form"),this.blockLength=i+1,t+this.blockLength}},{key:"toBER",value:function(){var e,t,r=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.length>127&&(this.longFormUsed=!0),this.isIndefiniteForm)return e=new ArrayBuffer(1),!1===r&&((t=new Uint8Array(e))[0]=128),e;if(this.longFormUsed){var a=Ue(this.length,8);if(a.byteLength>127)return this.error="Too big length",nt;if(e=new ArrayBuffer(a.byteLength+1),r)return e;var n=new Uint8Array(a);(t=new Uint8Array(e))[0]=128|a.byteLength;for(var i=0;i<a.byteLength;i++)t[i+1]=n[i];return e}return e=new ArrayBuffer(1),!1===r&&((t=new Uint8Array(e))[0]=this.length),e}},{key:"toJSON",value:function(){return r(r({},S(f(a.prototype),"toJSON",this).call(this)),{},{isIndefiniteForm:this.isIndefiniteForm,longFormUsed:this.longFormUsed,length:this.length})}}]),a}(ct);mt.NAME="lengthBlock";var vt={},dt=function(e){h(a,e);var t=w(a);function a(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0,i=r.name,s=void 0===i?at:i,o=r.optional,l=void 0!==o&&o,c=r.primitiveSchema,h=y(r,B);return u(this,a),(e=t.call(this,h)).name=s,e.optional=l,c&&(e.primitiveSchema=c),e.idBlock=new ft(h),e.lenBlock=new mt(h),e.valueBlock=n?new n(h):new ht(h),e}return l(a,[{key:"fromBER",value:function(e,t,r){var a=this.valueBlock.fromBER(e,t,this.lenBlock.isIndefiniteForm?r:this.lenBlock.length);return-1===a?(this.error=this.valueBlock.error,a):(this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength),a)}},{key:"toBER",value:function(e,t){var r=t||new Ze;t||gt(this);var a=this.idBlock.toBER(e);if(r.write(a),this.lenBlock.isIndefiniteForm)r.write(new Uint8Array([128]).buffer),this.valueBlock.toBER(e,r),r.write(new ArrayBuffer(2));else{var n=this.valueBlock.toBER(e);this.lenBlock.length=n.byteLength;var i=this.lenBlock.toBER(e);r.write(i),r.write(n)}return t?nt:r.final()}},{key:"toJSON",value:function(){var e=r(r({},S(f(a.prototype),"toJSON",this).call(this)),{},{idBlock:this.idBlock.toJSON(),lenBlock:this.lenBlock.toJSON(),valueBlock:this.valueBlock.toJSON(),name:this.name,optional:this.optional});return this.primitiveSchema&&(e.primitiveSchema=this.primitiveSchema.toJSON()),e}},{key:"toString",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"ascii";return"ascii"===e?this.onAsciiEncoding():De.ToHex(this.toBER())}},{key:"onAsciiEncoding",value:function(){return"".concat(this.constructor.NAME," : ").concat(De.ToHex(this.valueBlock.valueBeforeDecodeView))}},{key:"isEqual",value:function(e){return this===e||e instanceof this.constructor&&Me(this.toBER(),e.toBER())}}]),a}(ct);function gt(e){if(e instanceof vt.Constructed){var t,r=E(e.valueBlock.value);try{for(r.s();!(t=r.n()).done;){gt(t.value)&&(e.lenBlock.isIndefiniteForm=!0)}}catch(e){r.e(e)}finally{r.f()}}return!!e.lenBlock.isIndefiniteForm}dt.NAME="BaseBlock";var pt=function(e){h(r,e);var t=w(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0,i=a.value,s=void 0===i?at:i,o=y(a,V);return u(this,r),e=t.call(this,o,n),s&&e.fromString(s),e}return l(r,[{key:"getValue",value:function(){return this.valueBlock.value}},{key:"setValue",value:function(e){this.valueBlock.value=e}},{key:"fromBER",value:function(e,t,r){var a=this.valueBlock.fromBER(e,t,this.lenBlock.isIndefiniteForm?r:this.lenBlock.length);return-1===a?(this.error=this.valueBlock.error,a):(this.fromBuffer(this.valueBlock.valueHexView),this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength),a)}},{key:"onAsciiEncoding",value:function(){return"".concat(this.constructor.NAME," : '").concat(this.valueBlock.value,"'")}}]),r}(dt);pt.NAME="BaseStringBlock";var yt,kt=function(e){h(r,e);var t=w(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=a.isHexOnly,i=void 0===n||n,s=y(a,D);return u(this,r),(e=t.call(this,s)).isHexOnly=i,e}return l(r)}(lt(ht));kt.NAME="PrimitiveValueBlock";var wt=function(e){h(r,e);var t=w(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return u(this,r),(e=t.call(this,a,kt)).idBlock.isConstructed=!1,e}return l(r)}(dt);function bt(e,t){if(e instanceof t)return e;var r=new t;return r.idBlock=e.idBlock,r.lenBlock=e.lenBlock,r.warnings=e.warnings,r.valueBeforeDecodeView=e.valueBeforeDecodeView,r}function St(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.length,a=t,n=new dt({},ht),i=new ct;if(!Ye(i,e,t,r))return n.error=i.error,{offset:-1,result:n};var s=e.subarray(t,t+r);if(!s.length)return n.error="Zero buffer length",{offset:-1,result:n};var u=n.idBlock.fromBER(e,t,r);if(n.idBlock.warnings.length&&n.warnings.concat(n.idBlock.warnings),-1===u)return n.error=n.idBlock.error,{offset:-1,result:n};if(t=u,r-=n.idBlock.blockLength,u=n.lenBlock.fromBER(e,t,r),n.lenBlock.warnings.length&&n.warnings.concat(n.lenBlock.warnings),-1===u)return n.error=n.lenBlock.error,{offset:-1,result:n};if(t=u,r-=n.lenBlock.blockLength,!n.idBlock.isConstructed&&n.lenBlock.isIndefiniteForm)return n.error="Indefinite length form used for primitive encoding form",{offset:-1,result:n};var o=dt;if(1===n.idBlock.tagClass){if(n.idBlock.tagNumber>=37&&!1===n.idBlock.isHexOnly)return n.error="UNIVERSAL 37 and upper tags are reserved by ASN.1 standard",{offset:-1,result:n};switch(n.idBlock.tagNumber){case 0:if(n.idBlock.isConstructed&&n.lenBlock.length>0)return n.error="Type [UNIVERSAL 0] is reserved",{offset:-1,result:n};o=vt.EndOfContent;break;case 1:o=vt.Boolean;break;case 2:o=vt.Integer;break;case 3:o=vt.BitString;break;case 4:o=vt.OctetString;break;case 5:o=vt.Null;break;case 6:o=vt.ObjectIdentifier;break;case 10:o=vt.Enumerated;break;case 12:o=vt.Utf8String;break;case 13:o=vt.RelativeObjectIdentifier;break;case 14:o=vt.TIME;break;case 15:return n.error="[UNIVERSAL 15] is reserved by ASN.1 standard",{offset:-1,result:n};case 16:o=vt.Sequence;break;case 17:o=vt.Set;break;case 18:o=vt.NumericString;break;case 19:o=vt.PrintableString;break;case 20:o=vt.TeletexString;break;case 21:o=vt.VideotexString;break;case 22:o=vt.IA5String;break;case 23:o=vt.UTCTime;break;case 24:o=vt.GeneralizedTime;break;case 25:o=vt.GraphicString;break;case 26:o=vt.VisibleString;break;case 27:o=vt.GeneralString;break;case 28:o=vt.UniversalString;break;case 29:o=vt.CharacterString;break;case 30:o=vt.BmpString;break;case 31:o=vt.DATE;break;case 32:o=vt.TimeOfDay;break;case 33:o=vt.DateTime;break;case 34:o=vt.Duration;break;default:var l=n.idBlock.isConstructed?new vt.Constructed:new vt.Primitive;l.idBlock=n.idBlock,l.lenBlock=n.lenBlock,l.warnings=n.warnings,n=l}}else o=n.idBlock.isConstructed?vt.Constructed:vt.Primitive;return u=(n=bt(n,o)).fromBER(e,t,n.lenBlock.isIndefiniteForm?r:n.lenBlock.length),n.valueBeforeDecodeView=e.subarray(a,a+n.blockLength),{offset:u,result:n}}function At(e){if(!e.byteLength){var t=new dt({},ht);return t.error="Input buffer has zero length",{offset:-1,result:t}}return St(Ie.toUint8Array(e).slice(),0,e.byteLength)}yt=wt,vt.Primitive=yt,wt.NAME="PRIMITIVE";var Nt,Ct=function(e){h(a,e);var t=w(a);function a(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=r.value,i=void 0===n?[]:n,s=r.isIndefiniteForm,o=void 0!==s&&s,l=y(r,O);return u(this,a),(e=t.call(this,l)).value=i,e.isIndefiniteForm=o,e}return l(a,[{key:"fromBER",value:function(e,t,r){var a=Ie.toUint8Array(e);if(!Ye(this,a,t,r))return-1;if(this.valueBeforeDecodeView=a.subarray(t,t+r),0===this.valueBeforeDecodeView.length)return this.warnings.push("Zero buffer length"),t;for(var n,i,s=t;n=this.isIndefiniteForm,i=r,(n?1:i)>0;){var u=St(a,s,r);if(-1===u.offset)return this.error=u.result.error,this.warnings.concat(u.result.warnings),-1;if(s=u.offset,this.blockLength+=u.result.blockLength,r-=u.result.blockLength,this.value.push(u.result),this.isIndefiniteForm&&u.result.constructor.NAME===st)break}return this.isIndefiniteForm&&(this.value[this.value.length-1].constructor.NAME===st?this.value.pop():this.warnings.push("No EndOfContent block encoded")),s}},{key:"toBER",value:function(e,t){for(var r=t||new Ze,a=0;a<this.value.length;a++)this.value[a].toBER(e,r);return t?nt:r.final()}},{key:"toJSON",value:function(){var e,t=r(r({},S(f(a.prototype),"toJSON",this).call(this)),{},{isIndefiniteForm:this.isIndefiniteForm,value:[]}),n=E(this.value);try{for(n.s();!(e=n.n()).done;){var i=e.value;t.value.push(i.toJSON())}}catch(e){n.e(e)}finally{n.f()}return t}}]),a}(ht);Ct.NAME="ConstructedValueBlock";var xt=function(e){h(r,e);var t=w(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return u(this,r),(e=t.call(this,a,Ct)).idBlock.isConstructed=!0,e}return l(r,[{key:"fromBER",value:function(e,t,r){this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm;var a=this.valueBlock.fromBER(e,t,this.lenBlock.isIndefiniteForm?r:this.lenBlock.length);return-1===a?(this.error=this.valueBlock.error,a):(this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength),a)}},{key:"onAsciiEncoding",value:function(){var e,t=[],r=E(this.valueBlock.value);try{for(r.s();!(e=r.n()).done;){var a=e.value;t.push(a.toString("ascii").split("\n").map((function(e){return"  ".concat(e)})).join("\n"))}}catch(e){r.e(e)}finally{r.f()}var n=3===this.idBlock.tagClass?"[".concat(this.idBlock.tagNumber,"]"):this.constructor.NAME;return t.length?"".concat(n," :\n").concat(t.join("\n")):"".concat(n," :")}}]),r}(dt);Nt=xt,vt.Constructed=Nt,xt.NAME="CONSTRUCTED";var Et,It=function(e){h(r,e);var t=w(r);function r(){return u(this,r),t.apply(this,arguments)}return l(r,[{key:"fromBER",value:function(e,t,r){return t}},{key:"toBER",value:function(e){return nt}}]),r}(ht);It.override="EndOfContentValueBlock";var Bt,Vt=function(e){h(r,e);var t=w(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return u(this,r),(e=t.call(this,a,It)).idBlock.tagClass=1,e.idBlock.tagNumber=0,e}return l(r)}(dt);Et=Vt,vt.EndOfContent=Et,Vt.NAME=st;var Dt=function(e){h(r,e);var t=w(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return u(this,r),(e=t.call(this,a,ht)).idBlock.tagClass=1,e.idBlock.tagNumber=5,e}return l(r,[{key:"fromBER",value:function(e,t,r){return this.lenBlock.length>0&&this.warnings.push("Non-zero length of value block for Null type"),this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.blockLength+=r,t+r>e.byteLength?(this.error="End of input reached before message was fully decoded (inconsistent offset and length values)",-1):t+r}},{key:"toBER",value:function(e,t){var r=new ArrayBuffer(2);if(!e){var a=new Uint8Array(r);a[0]=5,a[1]=0}return t&&t.write(r),r}},{key:"onAsciiEncoding",value:function(){return"".concat(this.constructor.NAME)}}]),r}(dt);Bt=Dt,vt.Null=Bt,Dt.NAME="NULL";var Ot,Pt=function(e){h(a,e);var t=w(a);function a(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=r.value,i=y(r,P);return u(this,a),e=t.call(this,i),i.valueHex?e.valueHexView=Ie.toUint8Array(i.valueHex):e.valueHexView=new Uint8Array(1),n&&(e.value=n),e}return l(a,[{key:"value",get:function(){var e,t=E(this.valueHexView);try{for(t.s();!(e=t.n()).done;){if(e.value>0)return!0}}catch(e){t.e(e)}finally{t.f()}return!1},set:function(e){this.valueHexView[0]=e?255:0}},{key:"fromBER",value:function(e,t,r){var a=Ie.toUint8Array(e);return Ye(this,a,t,r)?(this.valueHexView=a.subarray(t,t+r),r>1&&this.warnings.push("Boolean value encoded in more then 1 octet"),this.isHexOnly=!0,He.call(this),this.blockLength=r,t+r):-1}},{key:"toBER",value:function(){return this.valueHexView.slice()}},{key:"toJSON",value:function(){return r(r({},S(f(a.prototype),"toJSON",this).call(this)),{},{value:this.value})}}]),a}(lt(ht));Pt.NAME="BooleanValueBlock";var Rt=function(e){h(r,e);var t=w(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return u(this,r),(e=t.call(this,a,Pt)).idBlock.tagClass=1,e.idBlock.tagNumber=1,e}return l(r,[{key:"getValue",value:function(){return this.valueBlock.value}},{key:"setValue",value:function(e){this.valueBlock.value=e}},{key:"onAsciiEncoding",value:function(){return"".concat(this.constructor.NAME," : ").concat(this.getValue)}}]),r}(dt);Ot=Rt,vt.Boolean=Ot,Rt.NAME="BOOLEAN";var Ut,Tt=function(e){h(a,e);var t=w(a);function a(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=r.isConstructed,i=void 0!==n&&n,s=y(r,R);return u(this,a),(e=t.call(this,s)).isConstructed=i,e}return l(a,[{key:"fromBER",value:function(e,t,r){var n=0;if(this.isConstructed){if(this.isHexOnly=!1,-1===(n=Ct.prototype.fromBER.call(this,e,t,r)))return n;for(var i=0;i<this.value.length;i++){var s=this.value[i].constructor.NAME;if(s===st){if(this.isIndefiniteForm)break;return this.error="EndOfContent is unexpected, OCTET STRING may consists of OCTET STRINGs only",-1}if(s!==ut)return this.error="OCTET STRING may consists of OCTET STRINGs only",-1}}else this.isHexOnly=!0,n=S(f(a.prototype),"fromBER",this).call(this,e,t,r),this.blockLength=r;return n}},{key:"toBER",value:function(e,t){return this.isConstructed?Ct.prototype.toBER.call(this,e,t):e?new ArrayBuffer(this.valueHexView.byteLength):this.valueHexView.slice().buffer}},{key:"toJSON",value:function(){return r(r({},S(f(a.prototype),"toJSON",this).call(this)),{},{isConstructed:this.isConstructed})}}]),a}(lt(Ct));Tt.NAME="OctetStringValueBlock";var Lt=function(e){h(a,e);var t=w(a);function a(){var e,n,i,s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=s.idBlock,l=void 0===o?{}:o,c=s.lenBlock,h=void 0===c?{}:c,f=y(s,U);return u(this,a),null!==(n=f.isConstructed)&&void 0!==n||(f.isConstructed=!!(null===(i=f.value)||void 0===i?void 0:i.length)),(e=t.call(this,r({idBlock:r({isConstructed:f.isConstructed},l),lenBlock:r(r({},h),{},{isIndefiniteForm:!!f.isIndefiniteForm})},f),Tt)).idBlock.tagClass=1,e.idBlock.tagNumber=4,e}return l(a,[{key:"fromBER",value:function(e,t,r){if(this.valueBlock.isConstructed=this.idBlock.isConstructed,this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm,0===r)return 0===this.idBlock.error.length&&(this.blockLength+=this.idBlock.blockLength),0===this.lenBlock.error.length&&(this.blockLength+=this.lenBlock.blockLength),t;if(!this.valueBlock.isConstructed){var n=(e instanceof ArrayBuffer?new Uint8Array(e):e).subarray(t,t+r);try{if(n.byteLength){var i=St(n,0,n.byteLength);-1!==i.offset&&i.offset===r&&(this.valueBlock.value=[i.result])}}catch(e){}}return S(f(a.prototype),"fromBER",this).call(this,e,t,r)}},{key:"onAsciiEncoding",value:function(){return this.valueBlock.isConstructed||this.valueBlock.value&&this.valueBlock.value.length?xt.prototype.onAsciiEncoding.call(this):"".concat(this.constructor.NAME," : ").concat(De.ToHex(this.valueBlock.valueHexView))}},{key:"getValue",value:function(){if(!this.idBlock.isConstructed)return this.valueBlock.valueHexView.slice().buffer;var e,t=[],r=E(this.valueBlock.value);try{for(r.s();!(e=r.n()).done;){var n=e.value;n instanceof a&&t.push(n.valueBlock.valueHexView)}}catch(e){r.e(e)}finally{r.f()}return Ie.concat(t)}}]),a}(dt);Ut=Lt,vt.OctetString=Ut,Lt.NAME=ut;var Ht,Mt=function(e){h(a,e);var t=w(a);function a(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=r.unusedBits,i=void 0===n?0:n,s=r.isConstructed,o=void 0!==s&&s,l=y(r,T);return u(this,a),(e=t.call(this,l)).unusedBits=i,e.isConstructed=o,e.blockLength=e.valueHexView.byteLength,e}return l(a,[{key:"fromBER",value:function(e,t,r){if(!r)return t;var a=-1;if(this.isConstructed){if(-1===(a=Ct.prototype.fromBER.call(this,e,t,r)))return a;var n,i=E(this.value);try{for(i.s();!(n=i.n()).done;){var s=n.value,u=s.constructor.NAME;if(u===st){if(this.isIndefiniteForm)break;return this.error="EndOfContent is unexpected, BIT STRING may consists of BIT STRINGs only",-1}if(u!==ot)return this.error="BIT STRING may consists of BIT STRINGs only",-1;var o=s.valueBlock;if(this.unusedBits>0&&o.unusedBits>0)return this.error='Using of "unused bits" inside constructive BIT STRING allowed for least one only',-1;this.unusedBits=o.unusedBits}}catch(e){i.e(e)}finally{i.f()}return a}var l=Ie.toUint8Array(e);if(!Ye(this,l,t,r))return-1;var c=l.subarray(t,t+r);if(this.unusedBits=c[0],this.unusedBits>7)return this.error="Unused bits for BitString must be in range 0-7",-1;if(!this.unusedBits){var h=c.subarray(1);try{if(h.byteLength){var f=St(h,0,h.byteLength);-1!==f.offset&&f.offset===r-1&&(this.value=[f.result])}}catch(e){}}return this.valueHexView=c.subarray(1),this.blockLength=c.length,t+r}},{key:"toBER",value:function(e,t){if(this.isConstructed)return Ct.prototype.toBER.call(this,e,t);if(e)return new ArrayBuffer(this.valueHexView.byteLength+1);if(!this.valueHexView.byteLength)return nt;var r=new Uint8Array(this.valueHexView.length+1);return r[0]=this.unusedBits,r.set(this.valueHexView,1),r.buffer}},{key:"toJSON",value:function(){return r(r({},S(f(a.prototype),"toJSON",this).call(this)),{},{unusedBits:this.unusedBits,isConstructed:this.isConstructed})}}]),a}(lt(Ct));Mt.NAME="BitStringValueBlock";var Kt,_t=function(e){h(a,e);var t=w(a);function a(){var e,n,i,s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=s.idBlock,l=void 0===o?{}:o,c=s.lenBlock,h=void 0===c?{}:c,f=y(s,L);return u(this,a),null!==(n=f.isConstructed)&&void 0!==n||(f.isConstructed=!!(null===(i=f.value)||void 0===i?void 0:i.length)),(e=t.call(this,r({idBlock:r({isConstructed:f.isConstructed},l),lenBlock:r(r({},h),{},{isIndefiniteForm:!!f.isIndefiniteForm})},f),Mt)).idBlock.tagClass=1,e.idBlock.tagNumber=3,e}return l(a,[{key:"fromBER",value:function(e,t,r){return this.valueBlock.isConstructed=this.idBlock.isConstructed,this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm,S(f(a.prototype),"fromBER",this).call(this,e,t,r)}},{key:"onAsciiEncoding",value:function(){if(this.valueBlock.isConstructed||this.valueBlock.value&&this.valueBlock.value.length)return xt.prototype.onAsciiEncoding.call(this);var e,t=[],r=E(this.valueBlock.valueHexView);try{for(r.s();!(e=r.n()).done;){var a=e.value;t.push(a.toString(2).padStart(8,"0"))}}catch(e){r.e(e)}finally{r.f()}var n=t.join("");return"".concat(this.constructor.NAME," : ").concat(n.substring(0,n.length-this.valueBlock.unusedBits))}}]),a}(dt);function jt(e,t){for(var r=new Uint8Array([0]),a=new Uint8Array(e),n=new Uint8Array(t),i=a.slice(0),s=i.length-1,u=n.slice(0),o=u.length-1,l=0,c=0,h=o<s?s:o;h>=0;h--,c++){if(!0==c<u.length)l=i[s-c]+u[o-c]+r[0];else l=i[s-c]+r[0];if(r[0]=l/10,!0==c>=i.length)i=Le(new Uint8Array([l%10]),i);else i[s-c]=l%10}return r[0]>0&&(i=Le(r,i)),i}function Jt(e){if(e>=$e.length)for(var t=$e.length;t<=e;t++){for(var r=new Uint8Array([0]),a=$e[t-1].slice(0),n=a.length-1;n>=0;n--){var i=new Uint8Array([(a[n]<<1)+r[0]]);r[0]=i[0]/10,a[n]=i[0]%10}r[0]>0&&(a=Le(r,a)),$e.push(a)}return $e[e]}function Ft(e,t){for(var r,a=0,n=new Uint8Array(e),i=new Uint8Array(t),s=n.slice(0),u=s.length-1,o=i.slice(0),l=o.length-1,c=0,h=l;h>=0;h--,c++)if(!0==(r=s[u-c]-o[l-c]-a)<0)a=1,s[u-c]=r+10;else a=0,s[u-c]=r;if(a>0)for(var f=u-l+1;f>=0;f--,c++){if(!((r=s[u-c]-a)<0)){a=0,s[u-c]=r;break}a=1,s[u-c]=r+10}return s.slice()}Ht=_t,vt.BitString=Ht,_t.NAME=ot;var qt,Xt=function(e){h(a,e);var t=w(a);function a(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=r.value,i=y(r,H);return u(this,a),(e=t.call(this,i))._valueDec=0,i.valueHex&&e.setValueHex(),void 0!==n&&(e.valueDec=n),e}return l(a,[{key:"setValueHex",value:function(){this.valueHexView.length>=4?(this.warnings.push("Too big Integer for decoding, hex only"),this.isHexOnly=!0,this._valueDec=0):(this.isHexOnly=!1,this.valueHexView.length>0&&(this._valueDec=He.call(this)))}},{key:"valueDec",get:function(){return this._valueDec},set:function(e){this._valueDec=e,this.isHexOnly=!1,this.valueHexView=new Uint8Array(function(e){for(var t=e<0?-1*e:e,r=128,a=1;a<8;a++){if(t<=r){if(e<0){var n=Ue(r-t,8,a);return new Uint8Array(n)[0]|=128,n}var i=Ue(t,8,a),s=new Uint8Array(i);if(128&s[0]){var u=i.slice(0),o=new Uint8Array(u);i=new ArrayBuffer(i.byteLength+1),s=new Uint8Array(i);for(var l=0;l<u.byteLength;l++)s[l+1]=o[l];s[0]=0}return i}r*=Math.pow(2,8)}return new ArrayBuffer(0)}(e))}},{key:"fromDER",value:function(e,t,r){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,n=this.fromBER(e,t,r);if(-1===n)return n;var i=this.valueHexView;return 0===i[0]&&0!=(128&i[1])?this.valueHexView=i.subarray(1):0!==a&&i.length<a&&(a-i.length>1&&(a=i.length+1),this.valueHexView=i.subarray(a-i.length)),n}},{key:"toDER",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.valueHexView;switch(!0){case 0!=(128&t[0]):var r=new Uint8Array(this.valueHexView.length+1);r[0]=0,r.set(t,1),this.valueHexView=r;break;case 0===t[0]&&0==(128&t[1]):this.valueHexView=this.valueHexView.subarray(1)}return this.toBER(e)}},{key:"fromBER",value:function(e,t,r){var n=S(f(a.prototype),"fromBER",this).call(this,e,t,r);return-1===n||this.setValueHex(),n}},{key:"toBER",value:function(e){return e?new ArrayBuffer(this.valueHexView.length):this.valueHexView.slice().buffer}},{key:"toJSON",value:function(){return r(r({},S(f(a.prototype),"toJSON",this).call(this)),{},{valueDec:this.valueDec})}},{key:"toString",value:function(){for(var e,t=8*this.valueHexView.length-1,r=new Uint8Array(8*this.valueHexView.length/3),a=0,n=this.valueHexView,i="",s=!1,u=n.byteLength-1;u>=0;u--){e=n[u];for(var o=0;o<8;o++){if(1==(1&e))if(a===t)r=Ft(Jt(a),r),i="-";else r=jt(r,Jt(a));a++,e>>=1}}for(var l=0;l<r.length;l++)r[l]&&(s=!0),s&&(i+=et.charAt(r[l]));return!1===s&&(i+=et.charAt(0)),i}}]),a}(lt(ht));Kt=Xt,Xt.NAME="IntegerValueBlock",Object.defineProperty(Kt.prototype,"valueHex",{set:function(e){this.valueHexView=new Uint8Array(e),this.setValueHex()},get:function(){return this.valueHexView.slice().buffer}});var Wt,Gt=function(e){h(r,e);var t=w(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return u(this,r),(e=t.call(this,a,Xt)).idBlock.tagClass=1,e.idBlock.tagNumber=2,e}return l(r,[{key:"toBigInt",value:function(){return ze(),BigInt(this.valueBlock.toString())}},{key:"convertToDER",value:function(){var e=new r({valueHex:this.valueBlock.valueHexView});return e.valueBlock.toDER(),e}},{key:"convertFromDER",value:function(){return new r({valueHex:0===this.valueBlock.valueHexView[0]?this.valueBlock.valueHexView.subarray(1):this.valueBlock.valueHexView})}},{key:"onAsciiEncoding",value:function(){return"".concat(this.constructor.NAME," : ").concat(this.valueBlock.toString())}}],[{key:"fromBigInt",value:function(e){ze();var t=BigInt(e),a=new Ze,n=t.toString(16).replace(/^-/,""),i=new Uint8Array(De.FromHex(n));if(t<0){var s=new Uint8Array(i.length+(128&i[0]?1:0));s[0]|=128;var u=BigInt("0x".concat(De.ToHex(s)))+t,o=Ie.toUint8Array(De.FromHex(u.toString(16)));o[0]|=128,a.write(o)}else 128&i[0]&&a.write(new Uint8Array([0])),a.write(i);return new r({valueHex:a.final()})}}]),r}(dt);qt=Gt,vt.Integer=qt,Gt.NAME="INTEGER";var zt=function(e){h(r,e);var t=w(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return u(this,r),(e=t.call(this,a)).idBlock.tagClass=1,e.idBlock.tagNumber=10,e}return l(r)}(Gt);Wt=zt,vt.Enumerated=Wt,zt.NAME="ENUMERATED";var Qt=function(e){h(a,e);var t=w(a);function a(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=r.valueDec,i=void 0===n?-1:n,s=r.isFirstSid,o=void 0!==s&&s,l=y(r,M);return u(this,a),(e=t.call(this,l)).valueDec=i,e.isFirstSid=o,e}return l(a,[{key:"fromBER",value:function(e,t,r){if(!r)return t;var a=Ie.toUint8Array(e);if(!Ye(this,a,t,r))return-1;var n=a.subarray(t,t+r);this.valueHexView=new Uint8Array(r);for(var i=0;i<r&&(this.valueHexView[i]=127&n[i],this.blockLength++,0!=(128&n[i]));i++);for(var s=new Uint8Array(this.blockLength),u=0;u<this.blockLength;u++)s[u]=this.valueHexView[u];return this.valueHexView=s,0!=(128&n[this.blockLength-1])?(this.error="End of input reached before message was fully decoded",-1):(0===this.valueHexView[0]&&this.warnings.push("Needlessly long format of SID encoding"),this.blockLength<=8?this.valueDec=Re(this.valueHexView,7):(this.isHexOnly=!0,this.warnings.push("Too big SID for decoding, hex only")),t+this.blockLength)}},{key:"valueBigInt",set:function(e){ze();for(var t=BigInt(e).toString(2);t.length%7;)t="0"+t;for(var r=new Uint8Array(t.length/7),a=0;a<r.length;a++)r[a]=parseInt(t.slice(7*a,7*a+7),2)+(a+1<r.length?128:0);this.fromBER(r.buffer,0,r.length)}},{key:"toBER",value:function(e){if(this.isHexOnly){if(e)return new ArrayBuffer(this.valueHexView.byteLength);for(var t=this.valueHexView,r=new Uint8Array(this.blockLength),a=0;a<this.blockLength-1;a++)r[a]=128|t[a];return r[this.blockLength-1]=t[this.blockLength-1],r.buffer}var n=Ue(this.valueDec,7);if(0===n.byteLength)return this.error="Error during encoding SID value",nt;var i=new Uint8Array(n.byteLength);if(!e){for(var s=new Uint8Array(n),u=n.byteLength-1,o=0;o<u;o++)i[o]=128|s[o];i[u]=s[u]}return i}},{key:"toString",value:function(){var e="";if(this.isHexOnly)e=De.ToHex(this.valueHexView);else if(this.isFirstSid){var t=this.valueDec;this.valueDec<=39?e="0.":this.valueDec<=79?(e="1.",t-=40):(e="2.",t-=80),e+=t.toString()}else e=this.valueDec.toString();return e}},{key:"toJSON",value:function(){return r(r({},S(f(a.prototype),"toJSON",this).call(this)),{},{valueDec:this.valueDec,isFirstSid:this.isFirstSid})}}]),a}(lt(ht));Qt.NAME="sidBlock";var Yt,Zt=function(e){h(a,e);var t=w(a);function a(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=r.value,i=void 0===n?at:n,s=y(r,K);return u(this,a),(e=t.call(this,s)).value=[],i&&e.fromString(i),e}return l(a,[{key:"fromBER",value:function(e,t,r){for(var a=t;r>0;){var n=new Qt;if(-1===(a=n.fromBER(e,a,r)))return this.blockLength=0,this.error=n.error,a;0===this.value.length&&(n.isFirstSid=!0),this.blockLength+=n.blockLength,r-=n.blockLength,this.value.push(n)}return a}},{key:"toBER",value:function(e){for(var t=[],r=0;r<this.value.length;r++){var a=this.value[r].toBER(e);if(0===a.byteLength)return this.error=this.value[r].error,nt;t.push(a)}return Qe(t)}},{key:"fromString",value:function(e){this.value=[];var t=0,r=0,a="",n=!1;do{if(a=-1===(r=e.indexOf(".",t))?e.substring(t):e.substring(t,r),t=r+1,n){var i=this.value[0],s=0;switch(i.valueDec){case 0:break;case 1:s=40;break;case 2:s=80;break;default:return void(this.value=[])}var u=parseInt(a,10);if(isNaN(u))return;i.valueDec=u+s,n=!1}else{var o=new Qt;if(a>Number.MAX_SAFE_INTEGER){ze();var l=BigInt(a);o.valueBigInt=l}else if(o.valueDec=parseInt(a,10),isNaN(o.valueDec))return;this.value.length||(o.isFirstSid=!0,n=!0),this.value.push(o)}}while(-1!==r)}},{key:"toString",value:function(){for(var e="",t=!1,r=0;r<this.value.length;r++){t=this.value[r].isHexOnly;var a=this.value[r].toString();0!==r&&(e="".concat(e,".")),t?(a="{".concat(a,"}"),this.value[r].isFirstSid?e="2.{".concat(a," - 80}"):e+=a):e+=a}return e}},{key:"toJSON",value:function(){for(var e=r(r({},S(f(a.prototype),"toJSON",this).call(this)),{},{value:this.toString(),sidArray:[]}),t=0;t<this.value.length;t++)e.sidArray.push(this.value[t].toJSON());return e}}]),a}(ht);Zt.NAME="ObjectIdentifierValueBlock";var $t=function(e){h(a,e);var t=w(a);function a(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return u(this,a),(e=t.call(this,r,Zt)).idBlock.tagClass=1,e.idBlock.tagNumber=6,e}return l(a,[{key:"getValue",value:function(){return this.valueBlock.toString()}},{key:"setValue",value:function(e){this.valueBlock.fromString(e)}},{key:"onAsciiEncoding",value:function(){return"".concat(this.constructor.NAME," : ").concat(this.valueBlock.toString()||"empty")}},{key:"toJSON",value:function(){return r(r({},S(f(a.prototype),"toJSON",this).call(this)),{},{value:this.getValue()})}}]),a}(dt);Yt=$t,vt.ObjectIdentifier=Yt,$t.NAME="OBJECT IDENTIFIER";var er=function(e){h(a,e);var t=w(a);function a(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=r.valueDec,i=void 0===n?0:n,s=y(r,_);return u(this,a),(e=t.call(this,s)).valueDec=i,e}return l(a,[{key:"fromBER",value:function(e,t,r){if(0===r)return t;var a=Ie.toUint8Array(e);if(!Ye(this,a,t,r))return-1;var n=a.subarray(t,t+r);this.valueHexView=new Uint8Array(r);for(var i=0;i<r&&(this.valueHexView[i]=127&n[i],this.blockLength++,0!=(128&n[i]));i++);for(var s=new Uint8Array(this.blockLength),u=0;u<this.blockLength;u++)s[u]=this.valueHexView[u];return this.valueHexView=s,0!=(128&n[this.blockLength-1])?(this.error="End of input reached before message was fully decoded",-1):(0===this.valueHexView[0]&&this.warnings.push("Needlessly long format of SID encoding"),this.blockLength<=8?this.valueDec=Re(this.valueHexView,7):(this.isHexOnly=!0,this.warnings.push("Too big SID for decoding, hex only")),t+this.blockLength)}},{key:"toBER",value:function(e){if(this.isHexOnly){if(e)return new ArrayBuffer(this.valueHexView.byteLength);for(var t=this.valueHexView,r=new Uint8Array(this.blockLength),a=0;a<this.blockLength-1;a++)r[a]=128|t[a];return r[this.blockLength-1]=t[this.blockLength-1],r.buffer}var n=Ue(this.valueDec,7);if(0===n.byteLength)return this.error="Error during encoding SID value",nt;var i=new Uint8Array(n.byteLength);if(!e){for(var s=new Uint8Array(n),u=n.byteLength-1,o=0;o<u;o++)i[o]=128|s[o];i[u]=s[u]}return i.buffer}},{key:"toString",value:function(){return this.isHexOnly?De.ToHex(this.valueHexView):this.valueDec.toString()}},{key:"toJSON",value:function(){return r(r({},S(f(a.prototype),"toJSON",this).call(this)),{},{valueDec:this.valueDec})}}]),a}(lt(ct));er.NAME="relativeSidBlock";var tr,rr=function(e){h(a,e);var t=w(a);function a(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=r.value,i=void 0===n?at:n,s=y(r,j);return u(this,a),(e=t.call(this,s)).value=[],i&&e.fromString(i),e}return l(a,[{key:"fromBER",value:function(e,t,r){for(var a=t;r>0;){var n=new er;if(-1===(a=n.fromBER(e,a,r)))return this.blockLength=0,this.error=n.error,a;this.blockLength+=n.blockLength,r-=n.blockLength,this.value.push(n)}return a}},{key:"toBER",value:function(e,t){for(var r=[],a=0;a<this.value.length;a++){var n=this.value[a].toBER(e);if(0===n.byteLength)return this.error=this.value[a].error,nt;r.push(n)}return Qe(r)}},{key:"fromString",value:function(e){this.value=[];var t=0,r=0,a="";do{a=-1===(r=e.indexOf(".",t))?e.substring(t):e.substring(t,r),t=r+1;var n=new er;if(n.valueDec=parseInt(a,10),isNaN(n.valueDec))return!0;this.value.push(n)}while(-1!==r);return!0}},{key:"toString",value:function(){for(var e="",t=!1,r=0;r<this.value.length;r++){t=this.value[r].isHexOnly;var a=this.value[r].toString();0!==r&&(e="".concat(e,".")),e+=t?a="{".concat(a,"}"):a}return e}},{key:"toJSON",value:function(){for(var e=r(r({},S(f(a.prototype),"toJSON",this).call(this)),{},{value:this.toString(),sidArray:[]}),t=0;t<this.value.length;t++)e.sidArray.push(this.value[t].toJSON());return e}}]),a}(ht);rr.NAME="RelativeObjectIdentifierValueBlock";var ar,nr=function(e){h(a,e);var t=w(a);function a(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return u(this,a),(e=t.call(this,r,rr)).idBlock.tagClass=1,e.idBlock.tagNumber=13,e}return l(a,[{key:"getValue",value:function(){return this.valueBlock.toString()}},{key:"setValue",value:function(e){this.valueBlock.fromString(e)}},{key:"onAsciiEncoding",value:function(){return"".concat(this.constructor.NAME," : ").concat(this.valueBlock.toString()||"empty")}},{key:"toJSON",value:function(){return r(r({},S(f(a.prototype),"toJSON",this).call(this)),{},{value:this.getValue()})}}]),a}(dt);tr=nr,vt.RelativeObjectIdentifier=tr,nr.NAME="RelativeObjectIdentifier";var ir,sr=function(e){h(r,e);var t=w(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return u(this,r),(e=t.call(this,a)).idBlock.tagClass=1,e.idBlock.tagNumber=16,e}return l(r)}(xt);ar=sr,vt.Sequence=ar,sr.NAME="SEQUENCE";var ur=function(e){h(r,e);var t=w(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return u(this,r),(e=t.call(this,a)).idBlock.tagClass=1,e.idBlock.tagNumber=17,e}return l(r)}(xt);ir=ur,vt.Set=ir,ur.NAME="SET";var or=function(e){h(a,e);var t=w(a);function a(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=Object.assign({},(p(r),r));return u(this,a),(e=t.call(this,n)).isHexOnly=!0,e.value=at,e}return l(a,[{key:"toJSON",value:function(){return r(r({},S(f(a.prototype),"toJSON",this).call(this)),{},{value:this.value})}}]),a}(lt(ht));or.NAME="StringValueBlock";var lr=function(e){h(r,e);var t=w(r);function r(){return u(this,r),t.apply(this,arguments)}return l(r)}(or);lr.NAME="SimpleStringValueBlock";var cr=function(e){h(r,e);var t=w(r);function r(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=Object.assign({},(p(e),e));return u(this,r),t.call(this,a,lr)}return l(r,[{key:"fromBuffer",value:function(e){this.valueBlock.value=String.fromCharCode.apply(null,Ie.toUint8Array(e))}},{key:"fromString",value:function(e){for(var t=e.length,r=this.valueBlock.valueHexView=new Uint8Array(t),a=0;a<t;a++)r[a]=e.charCodeAt(a);this.valueBlock.value=e}}]),r}(pt);cr.NAME="SIMPLE STRING";var hr,fr=function(e){h(r,e);var t=w(r);function r(){return u(this,r),t.apply(this,arguments)}return l(r,[{key:"fromBuffer",value:function(e){this.valueBlock.valueHexView=Ie.toUint8Array(e);try{this.valueBlock.value=De.ToUtf8String(e)}catch(t){this.warnings.push('Error during "decodeURIComponent": '.concat(t,", using raw string")),this.valueBlock.value=De.ToBinary(e)}}},{key:"fromString",value:function(e){this.valueBlock.valueHexView=new Uint8Array(De.FromUtf8String(e)),this.valueBlock.value=e}}]),r}(cr);fr.NAME="Utf8StringValueBlock";var mr=function(e){h(r,e);var t=w(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return u(this,r),(e=t.call(this,a)).idBlock.tagClass=1,e.idBlock.tagNumber=12,e}return l(r)}(fr);hr=mr,vt.Utf8String=hr,mr.NAME="UTF8String";var vr,dr=function(e){h(r,e);var t=w(r);function r(){return u(this,r),t.apply(this,arguments)}return l(r,[{key:"fromBuffer",value:function(e){this.valueBlock.value=De.ToUtf16String(e),this.valueBlock.valueHexView=Ie.toUint8Array(e)}},{key:"fromString",value:function(e){this.valueBlock.value=e,this.valueBlock.valueHexView=new Uint8Array(De.FromUtf16String(e))}}]),r}(cr);dr.NAME="BmpStringValueBlock";var gr=function(e){h(r,e);var t=w(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=Object.assign({},(p(a),a));return u(this,r),(e=t.call(this,n)).idBlock.tagClass=1,e.idBlock.tagNumber=30,e}return l(r)}(dr);vr=gr,vt.BmpString=vr,gr.NAME="BMPString";var pr,yr=function(e){h(r,e);var t=w(r);function r(){return u(this,r),t.apply(this,arguments)}return l(r,[{key:"fromBuffer",value:function(e){for(var t=ArrayBuffer.isView(e)?e.slice().buffer:e.slice(0),r=new Uint8Array(t),a=0;a<r.length;a+=4)r[a]=r[a+3],r[a+1]=r[a+2],r[a+2]=0,r[a+3]=0;this.valueBlock.value=String.fromCharCode.apply(null,new Uint32Array(t))}},{key:"fromString",value:function(e){for(var t=e.length,r=this.valueBlock.valueHexView=new Uint8Array(4*t),a=0;a<t;a++){var n=Ue(e.charCodeAt(a),8),i=new Uint8Array(n);if(!(i.length>4))for(var s=4-i.length,u=i.length-1;u>=0;u--)r[4*a+u+s]=i[u]}this.valueBlock.value=e}}]),r}(cr);yr.NAME="UniversalStringValueBlock";var kr,wr=function(e){h(r,e);var t=w(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=Object.assign({},(p(a),a));return u(this,r),(e=t.call(this,n)).idBlock.tagClass=1,e.idBlock.tagNumber=28,e}return l(r)}(yr);pr=wr,vt.UniversalString=pr,wr.NAME="UniversalString";var br,Sr=function(e){h(r,e);var t=w(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return u(this,r),(e=t.call(this,a)).idBlock.tagClass=1,e.idBlock.tagNumber=18,e}return l(r)}(cr);kr=Sr,vt.NumericString=kr,Sr.NAME="NumericString";var Ar,Nr=function(e){h(r,e);var t=w(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return u(this,r),(e=t.call(this,a)).idBlock.tagClass=1,e.idBlock.tagNumber=19,e}return l(r)}(cr);br=Nr,vt.PrintableString=br,Nr.NAME="PrintableString";var Cr,xr=function(e){h(r,e);var t=w(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return u(this,r),(e=t.call(this,a)).idBlock.tagClass=1,e.idBlock.tagNumber=20,e}return l(r)}(cr);Ar=xr,vt.TeletexString=Ar,xr.NAME="TeletexString";var Er,Ir=function(e){h(r,e);var t=w(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return u(this,r),(e=t.call(this,a)).idBlock.tagClass=1,e.idBlock.tagNumber=21,e}return l(r)}(cr);Cr=Ir,vt.VideotexString=Cr,Ir.NAME="VideotexString";var Br,Vr=function(e){h(r,e);var t=w(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return u(this,r),(e=t.call(this,a)).idBlock.tagClass=1,e.idBlock.tagNumber=22,e}return l(r)}(cr);Er=Vr,vt.IA5String=Er,Vr.NAME="IA5String";var Dr,Or=function(e){h(r,e);var t=w(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return u(this,r),(e=t.call(this,a)).idBlock.tagClass=1,e.idBlock.tagNumber=25,e}return l(r)}(cr);Br=Or,vt.GraphicString=Br,Or.NAME="GraphicString";var Pr,Rr=function(e){h(r,e);var t=w(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return u(this,r),(e=t.call(this,a)).idBlock.tagClass=1,e.idBlock.tagNumber=26,e}return l(r)}(cr);Dr=Rr,vt.VisibleString=Dr,Rr.NAME="VisibleString";var Ur,Tr=function(e){h(r,e);var t=w(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return u(this,r),(e=t.call(this,a)).idBlock.tagClass=1,e.idBlock.tagNumber=27,e}return l(r)}(cr);Pr=Tr,vt.GeneralString=Pr,Tr.NAME="GeneralString";var Lr,Hr=function(e){h(r,e);var t=w(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return u(this,r),(e=t.call(this,a)).idBlock.tagClass=1,e.idBlock.tagNumber=29,e}return l(r)}(cr);Ur=Hr,vt.CharacterString=Ur,Hr.NAME="CharacterString";var Mr,Kr=function(e){h(a,e);var t=w(a);function a(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=r.value,i=r.valueDate,s=y(r,J);if(u(this,a),(e=t.call(this,s)).year=0,e.month=0,e.day=0,e.hour=0,e.minute=0,e.second=0,n){e.fromString(n),e.valueBlock.valueHexView=new Uint8Array(n.length);for(var o=0;o<n.length;o++)e.valueBlock.valueHexView[o]=n.charCodeAt(o)}return i&&(e.fromDate(i),e.valueBlock.valueHexView=new Uint8Array(e.toBuffer())),e.idBlock.tagClass=1,e.idBlock.tagNumber=23,e}return l(a,[{key:"fromBuffer",value:function(e){this.fromString(String.fromCharCode.apply(null,Ie.toUint8Array(e)))}},{key:"toBuffer",value:function(){for(var e=this.toString(),t=new ArrayBuffer(e.length),r=new Uint8Array(t),a=0;a<e.length;a++)r[a]=e.charCodeAt(a);return t}},{key:"fromDate",value:function(e){this.year=e.getUTCFullYear(),this.month=e.getUTCMonth()+1,this.day=e.getUTCDate(),this.hour=e.getUTCHours(),this.minute=e.getUTCMinutes(),this.second=e.getUTCSeconds()}},{key:"toDate",value:function(){return new Date(Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second))}},{key:"fromString",value:function(e){var t=/(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})Z/gi.exec(e);if(null!==t){var r=parseInt(t[1],10);this.year=r>=50?1900+r:2e3+r,this.month=parseInt(t[2],10),this.day=parseInt(t[3],10),this.hour=parseInt(t[4],10),this.minute=parseInt(t[5],10),this.second=parseInt(t[6],10)}else this.error="Wrong input string for conversion"}},{key:"toString",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"iso";if("iso"===e){var t=new Array(7);return t[0]=Ke(this.year<2e3?this.year-1900:this.year-2e3,2),t[1]=Ke(this.month,2),t[2]=Ke(this.day,2),t[3]=Ke(this.hour,2),t[4]=Ke(this.minute,2),t[5]=Ke(this.second,2),t[6]="Z",t.join("")}return S(f(a.prototype),"toString",this).call(this,e)}},{key:"onAsciiEncoding",value:function(){return"".concat(this.constructor.NAME," : ").concat(this.toDate().toISOString())}},{key:"toJSON",value:function(){return r(r({},S(f(a.prototype),"toJSON",this).call(this)),{},{year:this.year,month:this.month,day:this.day,hour:this.hour,minute:this.minute,second:this.second})}}]),a}(Rr);Lr=Kr,vt.UTCTime=Lr,Kr.NAME="UTCTime";var _r,jr=function(e){h(a,e);var t=w(a);function a(){var e,r,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return u(this,a),null!==(r=(e=t.call(this,n)).millisecond)&&void 0!==r||(e.millisecond=0),e.idBlock.tagClass=1,e.idBlock.tagNumber=24,e}return l(a,[{key:"fromDate",value:function(e){S(f(a.prototype),"fromDate",this).call(this,e),this.millisecond=e.getUTCMilliseconds()}},{key:"toDate",value:function(){return new Date(Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second,this.millisecond))}},{key:"fromString",value:function(e){var t,r=!1,a="",n="",i=0,s=0,u=0;if("Z"===e[e.length-1])a=e.substring(0,e.length-1),r=!0;else{var o=new Number(e[e.length-1]);if(isNaN(o.valueOf()))throw new Error("Wrong input string for conversion");a=e}if(r){if(-1!==a.indexOf("+"))throw new Error("Wrong input string for conversion");if(-1!==a.indexOf("-"))throw new Error("Wrong input string for conversion")}else{var l=1,c=a.indexOf("+"),h="";if(-1===c&&(c=a.indexOf("-"),l=-1),-1!==c){if(h=a.substring(c+1),a=a.substring(0,c),2!==h.length&&4!==h.length)throw new Error("Wrong input string for conversion");var f=parseInt(h.substring(0,2),10);if(isNaN(f.valueOf()))throw new Error("Wrong input string for conversion");if(s=l*f,4===h.length){if(f=parseInt(h.substring(2,4),10),isNaN(f.valueOf()))throw new Error("Wrong input string for conversion");u=l*f}}}var m=a.indexOf(".");if(-1===m&&(m=a.indexOf(",")),-1!==m){var v=new Number("0".concat(a.substring(m)));if(isNaN(v.valueOf()))throw new Error("Wrong input string for conversion");i=v.valueOf(),n=a.substring(0,m)}else n=a;switch(!0){case 8===n.length:if(t=/(\d{4})(\d{2})(\d{2})/gi,-1!==m)throw new Error("Wrong input string for conversion");break;case 10===n.length:if(t=/(\d{4})(\d{2})(\d{2})(\d{2})/gi,-1!==m){var d=60*i;this.minute=Math.floor(d),d=60*(d-this.minute),this.second=Math.floor(d),d=1e3*(d-this.second),this.millisecond=Math.floor(d)}break;case 12===n.length:if(t=/(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})/gi,-1!==m){var g=60*i;this.second=Math.floor(g),g=1e3*(g-this.second),this.millisecond=Math.floor(g)}break;case 14===n.length:if(t=/(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})/gi,-1!==m){var p=1e3*i;this.millisecond=Math.floor(p)}break;default:throw new Error("Wrong input string for conversion")}var y=t.exec(n);if(null===y)throw new Error("Wrong input string for conversion");for(var k=1;k<y.length;k++)switch(k){case 1:this.year=parseInt(y[k],10);break;case 2:this.month=parseInt(y[k],10);break;case 3:this.day=parseInt(y[k],10);break;case 4:this.hour=parseInt(y[k],10)+s;break;case 5:this.minute=parseInt(y[k],10)+u;break;case 6:this.second=parseInt(y[k],10);break;default:throw new Error("Wrong input string for conversion")}if(!1===r){var w=new Date(this.year,this.month,this.day,this.hour,this.minute,this.second,this.millisecond);this.year=w.getUTCFullYear(),this.month=w.getUTCMonth(),this.day=w.getUTCDay(),this.hour=w.getUTCHours(),this.minute=w.getUTCMinutes(),this.second=w.getUTCSeconds(),this.millisecond=w.getUTCMilliseconds()}}},{key:"toString",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"iso";if("iso"===e){var t=[];return t.push(Ke(this.year,4)),t.push(Ke(this.month,2)),t.push(Ke(this.day,2)),t.push(Ke(this.hour,2)),t.push(Ke(this.minute,2)),t.push(Ke(this.second,2)),0!==this.millisecond&&(t.push("."),t.push(Ke(this.millisecond,3))),t.push("Z"),t.join("")}return S(f(a.prototype),"toString",this).call(this,e)}},{key:"toJSON",value:function(){return r(r({},S(f(a.prototype),"toJSON",this).call(this)),{},{millisecond:this.millisecond})}}]),a}(Kr);Mr=jr,vt.GeneralizedTime=Mr,jr.NAME="GeneralizedTime";var Jr,Fr=function(e){h(r,e);var t=w(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return u(this,r),(e=t.call(this,a)).idBlock.tagClass=1,e.idBlock.tagNumber=31,e}return l(r)}(mr);_r=Fr,vt.DATE=_r,Fr.NAME="DATE";var qr,Xr=function(e){h(r,e);var t=w(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return u(this,r),(e=t.call(this,a)).idBlock.tagClass=1,e.idBlock.tagNumber=32,e}return l(r)}(mr);Jr=Xr,vt.TimeOfDay=Jr,Xr.NAME="TimeOfDay";var Wr,Gr=function(e){h(r,e);var t=w(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return u(this,r),(e=t.call(this,a)).idBlock.tagClass=1,e.idBlock.tagNumber=33,e}return l(r)}(mr);qr=Gr,vt.DateTime=qr,Gr.NAME="DateTime";var zr,Qr=function(e){h(r,e);var t=w(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return u(this,r),(e=t.call(this,a)).idBlock.tagClass=1,e.idBlock.tagNumber=34,e}return l(r)}(mr);Wr=Qr,vt.Duration=Wr,Qr.NAME="Duration";var Yr=function(e){h(r,e);var t=w(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return u(this,r),(e=t.call(this,a)).idBlock.tagClass=1,e.idBlock.tagNumber=14,e}return l(r)}(mr);zr=Yr,vt.TIME=zr,Yr.NAME="TIME";var Zr=l((function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.name,a=void 0===r?at:r,n=t.optional,i=void 0!==n&&n;u(this,e),this.name=a,this.optional=i})),$r=function(e){h(r,e);var t=w(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=a.value,i=void 0===n?[]:n,s=y(a,F);return u(this,r),(e=t.call(this,s)).value=i,e}return l(r)}(Zr),ea=function(e){h(r,e);var t=w(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=a.value,i=void 0===n?new Zr:n,s=a.local,o=void 0!==s&&s,l=y(a,q);return u(this,r),(e=t.call(this,l)).value=i,e.local=o,e}return l(r)}(Zr),ta=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.data,a=void 0===r?it:r;u(this,e),this.dataView=Ie.toUint8Array(a)}return l(e,[{key:"data",get:function(){return this.dataView.slice().buffer},set:function(e){this.dataView=Ie.toUint8Array(e)}},{key:"fromBER",value:function(e,t,r){var a=t+r;return this.dataView=Ie.toUint8Array(e).subarray(t,a),a}},{key:"toBER",value:function(e){return this.dataView.slice().buffer}}]),e}();function ra(e,t,r){if(r instanceof $r){for(var a=0;a<r.value.length;a++){if(ra(e,t,r.value[a]).verified)return{verified:!0,result:e}}var n={verified:!1,result:{error:"Wrong values for Choice type"}};return r.hasOwnProperty(tt)&&(n.name=r.name),n}if(r instanceof Zr)return r.hasOwnProperty(tt)&&(e[r.name]=t),{verified:!0,result:e};if(e instanceof Object==!1)return{verified:!1,result:{error:"Wrong root object"}};if(t instanceof Object==!1)return{verified:!1,result:{error:"Wrong ASN.1 data"}};if(r instanceof Object==!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if("idBlock"in r==!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if("fromBER"in r.idBlock==!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if("toBER"in r.idBlock==!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};var i=r.idBlock.toBER(!1);if(0===i.byteLength)return{verified:!1,result:{error:"Error encoding idBlock for ASN.1 schema"}};if(-1===r.idBlock.fromBER(i,0,i.byteLength))return{verified:!1,result:{error:"Error decoding idBlock for ASN.1 schema"}};if(!1===r.idBlock.hasOwnProperty("tagClass"))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(r.idBlock.tagClass!==t.idBlock.tagClass)return{verified:!1,result:e};if(!1===r.idBlock.hasOwnProperty("tagNumber"))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(r.idBlock.tagNumber!==t.idBlock.tagNumber)return{verified:!1,result:e};if(!1===r.idBlock.hasOwnProperty("isConstructed"))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(r.idBlock.isConstructed!==t.idBlock.isConstructed)return{verified:!1,result:e};if(!("isHexOnly"in r.idBlock))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(r.idBlock.isHexOnly!==t.idBlock.isHexOnly)return{verified:!1,result:e};if(r.idBlock.isHexOnly){if(rt in r.idBlock==!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};var s=r.idBlock.valueHexView,u=t.idBlock.valueHexView;if(s.length!==u.length)return{verified:!1,result:e};for(var o=0;o<s.length;o++)if(s[o]!==u[1])return{verified:!1,result:e}}if(r.name&&(r.name=r.name.replace(/^\s+|\s+$/g,at),r.name&&(e[r.name]=t)),r instanceof vt.Constructed){var l=0,c={verified:!1,result:{error:"Unknown error"}},h=r.valueBlock.value.length;if(h>0&&r.valueBlock.value[0]instanceof ea&&(h=t.valueBlock.value.length),0===h)return{verified:!0,result:e};if(0===t.valueBlock.value.length&&0!==r.valueBlock.value.length){for(var f=!0,m=0;m<r.valueBlock.value.length;m++)f=f&&(r.valueBlock.value[m].optional||!1);return f?{verified:!0,result:e}:(r.name&&(r.name=r.name.replace(/^\s+|\s+$/g,at),r.name&&delete e[r.name]),e.error="Inconsistent object length",{verified:!1,result:e})}for(var v=0;v<h;v++)if(v-l>=t.valueBlock.value.length){if(!1===r.valueBlock.value[v].optional){var d={verified:!1,result:e};return e.error="Inconsistent length between ASN.1 data and schema",r.name&&(r.name=r.name.replace(/^\s+|\s+$/g,at),r.name&&(delete e[r.name],d.name=r.name)),d}}else if(r.valueBlock.value[0]instanceof ea){if(!1===(c=ra(e,t.valueBlock.value[v],r.valueBlock.value[0].value)).verified){if(!r.valueBlock.value[0].optional)return r.name&&(r.name=r.name.replace(/^\s+|\s+$/g,at),r.name&&delete e[r.name]),c;l++}if(tt in r.valueBlock.value[0]&&r.valueBlock.value[0].name.length>0){var g={};void 0===(g="local"in r.valueBlock.value[0]&&r.valueBlock.value[0].local?t:e)[r.valueBlock.value[0].name]&&(g[r.valueBlock.value[0].name]=[]),g[r.valueBlock.value[0].name].push(t.valueBlock.value[v])}}else if(!1===(c=ra(e,t.valueBlock.value[v-l],r.valueBlock.value[v])).verified){if(!r.valueBlock.value[v].optional)return r.name&&(r.name=r.name.replace(/^\s+|\s+$/g,at),r.name&&delete e[r.name]),c;l++}if(!1===c.verified){var p={verified:!1,result:e};return r.name&&(r.name=r.name.replace(/^\s+|\s+$/g,at),r.name&&(delete e[r.name],p.name=r.name)),p}return{verified:!0,result:e}}if(r.primitiveSchema&&rt in t.valueBlock){var y=St(t.valueBlock.valueHexView);if(-1===y.offset){var k={verified:!1,result:y.result};return r.name&&(r.name=r.name.replace(/^\s+|\s+$/g,at),r.name&&(delete e[r.name],k.name=r.name)),k}return ra(e,y.result,r.primitiveSchema)}return{verified:!0,result:e}}var aa=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(u(this,e),"view"in t)this.fromUint8Array(t.view);else if("buffer"in t)this.fromArrayBuffer(t.buffer);else if("string"in t)this.fromString(t.string);else if("hexstring"in t)this.fromHexString(t.hexstring);else if("length"in t&&t.length>0){if(this.length=t.length,t.stub)for(var r=0;r<this._view.length;r++)this._view[r]=t.stub}else this.length=0}return l(e,[{key:"buffer",get:function(){return this._buffer},set:function(e){this._buffer=e,this._view=new Uint8Array(this._buffer)}},{key:"view",get:function(){return this._view},set:function(e){this._buffer=new ArrayBuffer(e.length),this._view=new Uint8Array(this._buffer),this._view.set(e)}},{key:"length",get:function(){return this.view.byteLength},set:function(e){this._buffer=new ArrayBuffer(e),this._view=new Uint8Array(this._buffer)}},{key:"clear",value:function(){this._buffer=new ArrayBuffer(0),this._view=new Uint8Array(this._buffer)}},{key:"fromArrayBuffer",value:function(e){this._buffer=e,this._view=new Uint8Array(this._buffer)}},{key:"fromUint8Array",value:function(e){this.fromArrayBuffer(new Uint8Array(e).buffer)}},{key:"fromString",value:function(e){var t=e.length;this.length=t;for(var r=0;r<t;r++)this.view[r]=e.charCodeAt(r)}},{key:"toString",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.view.length-e,r="";(e>=this.view.length||e<0)&&(e=0),(t>=this.view.length||t<0)&&(t=this.view.length-e);for(var a=e;a<e+t;a++)r+=String.fromCharCode(this.view[a]);return r}},{key:"fromHexString",value:function(e){var t=e.length;this.buffer=new ArrayBuffer(t>>1),this.view=new Uint8Array(this.buffer);var r=new Map;r.set("0",0),r.set("1",1),r.set("2",2),r.set("3",3),r.set("4",4),r.set("5",5),r.set("6",6),r.set("7",7),r.set("8",8),r.set("9",9),r.set("A",10),r.set("a",10),r.set("B",11),r.set("b",11),r.set("C",12),r.set("c",12),r.set("D",13),r.set("d",13),r.set("E",14),r.set("e",14),r.set("F",15),r.set("f",15);for(var a=0,n=0,i=0;i<t;i++)i%2?(n|=r.get(e.charAt(i)),this.view[a]=n,a++):n=r.get(e.charAt(i))<<4}},{key:"toHexString",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.view.length-e,r="";(e>=this.view.length||e<0)&&(e=0),(t>=this.view.length||t<0)&&(t=this.view.length-e);for(var a=e;a<e+t;a++){var n=this.view[a].toString(16).toUpperCase();r=r+(1==n.length?"0":"")+n}return r}},{key:"copy",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.length-t;if(!t&&!this.length)return new e;if(t<0||t>this.length-1)throw new Error("Wrong start position: ".concat(t));var a=new e({buffer:this._buffer.slice(t,t+r)});return a}},{key:"slice",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.length;if(!t&&!this.length)return new e;if(t<0||t>this.length-1)throw new Error("Wrong start position: ".concat(t));var a=new e({buffer:this._buffer.slice(t,r)});return a}},{key:"realloc",value:function(e){var t=new ArrayBuffer(e),r=new Uint8Array(t);e>this._view.length?r.set(this._view):r.set(new Uint8Array(this._buffer,0,e)),this._buffer=t,this._view=new Uint8Array(this._buffer)}},{key:"append",value:function(e){var t=this.length,r=e.length,a=e._view.subarray();this.realloc(t+r),this._view.set(a,t)}},{key:"insert",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.length-t;return!(t>this.length-1)&&(r>this.length-t&&(r=this.length-t),r>e.length&&(r=e.length),r==e.length?this._view.set(e._view,t):this._view.set(e._view.subarray(0,r),t),!0)}},{key:"isEqual",value:function(e){if(this.length!=e.length)return!1;for(var t=0;t<e.length;t++)if(this.view[t]!=e.view[t])return!1;return!0}},{key:"isEqualView",value:function(e){if(e.length!=this.view.length)return!1;for(var t=0;t<e.length;t++)if(this.view[t]!=e[t])return!1;return!0}},{key:"findPattern",value:function(e,t,r,a){var n=this.prepareFindParameters(t,r,a),i=n.start,s=n.length,u=n.backward,o=e.length;if(o>s)return-1;for(var l=[],c=0;c<o;c++)l.push(e.view[c]);for(var h=0;h<=s-o;h++){for(var f=!0,m=u?i-o-h:i+h,v=0;v<o;v++)if(this.view[v+m]!=l[v]){f=!1;break}if(f)return u?i-o-h:i+o+h}return-1}},{key:"findFirstIn",value:function(e,t,r,a){for(var n=this.prepareFindParameters(t,r,a),i=n.start,s=n.length,u=n.backward,o={id:-1,position:u?0:i+s,length:0},l=0;l<e.length;l++){var c=this.findPattern(e[l],i,s,u);if(-1!=c){var h=!1,f=e[l].length;u?c-f>=o.position-o.length&&(h=!0):c-f<=o.position-o.length&&(h=!0),h&&(o.position=c,o.id=l,o.length=f)}}return o}},{key:"findAllIn",value:function(e,t,r){for(var a=this.prepareFindParameters(t,r),n=a.start,i=a.length,s=[],u={id:-1,position:n};;){var o=u.position;if(-1==(u=this.findFirstIn(e,u.position,i)).id)break;i-=u.position-o,s.push({id:u.id,position:u.position})}return s}},{key:"findAllPatternIn",value:function(e,t,r){var a=this.prepareFindParameters(t,r),n=a.start,i=a.length,s=[],u=e.length;if(u>i)return-1;for(var o=Array.from(e.view),l=0;l<=i-u;l++){for(var c=!0,h=n+l,f=0;f<u;f++)if(this.view[f+h]!=o[f]){c=!1;break}c&&(s.push(n+u+l),l+=u-1)}return s}},{key:"findFirstNotIn",value:function(t,r,a,n){for(var i=this.prepareFindParameters(r,a,n),s=i.start,u=i.length,o=i.backward,l={left:{id:-1,position:s},right:{id:-1,position:0},value:new e},c=u;c>0;){if(l.right=this.findFirstIn(t,o?s-u+c:s+u-c,c,o),-1==l.right.id){u=c,o?s-=u:s=l.left.position,l.value=new e({buffer:this._buffer.slice(s,s+u)});break}if(l.right.position!=(o?l.left.position-t[l.right.id].length:l.left.position+t[l.right.id].length)){o?(s=l.right.position+t[l.right.id].length,u=l.left.position-l.right.position-t[l.right.id].length):(s=l.left.position,u=l.right.position-l.left.position-t[l.right.id].length),l.value=new e({buffer:this._buffer.slice(s,s+u)});break}l.left=l.right,c-=t[l.right.id].length}if(o){var h=l.right;l.right=l.left,l.left=h}return l}},{key:"findAllNotIn",value:function(t,r,a){var n=this.prepareFindParameters(r,a),i=n.start,s=n.length,u=[],o={left:{id:-1,position:i},right:{id:-1,position:i},value:new e};do{var l=o.right.position;s-=(o=this.findFirstNotIn(t,o.right.position,s)).right.position-l,u.push({left:{id:o.left.id,position:o.left.position},right:{id:o.right.id,position:o.right.position},value:o.value})}while(-1!=o.right.id);return u}},{key:"findFirstSequence",value:function(t,r,a,n){var i=this.prepareFindParameters(r,a,n),s=i.start,u=i.length,o=i.backward,l=this.skipNotPatterns(t,s,u,o);if(-1==l)return{position:-1,value:new e};var c=this.skipPatterns(t,l,u-(o?s-l:l-s),o);return o?(s=c,u=l-c):(s=l,u=c-l),{position:c,value:new e({buffer:this._buffer.slice(s,s+u)})}}},{key:"findAllSequences",value:function(t,r,a){var n=this.prepareFindParameters(r,a),i=n.start,s=n.length,u=[],o={position:i,value:new e};do{var l=o.position;-1!=(o=this.findFirstSequence(t,o.position,s)).position&&(s-=o.position-l,u.push({position:o.position,value:o.value}))}while(-1!=o.position);return u}},{key:"findPairedPatterns",value:function(e,t,r,a){var n=[];if(e.isEqual(t))return n;var i=this.prepareFindParameters(r,a),s=i.start,u=i.length,o=0,l=this.findAllPatternIn(e,s,u);if(!Array.isArray(l)||0==l.length)return n;var c=this.findAllPatternIn(t,s,u);if(!Array.isArray(c)||0==c.length)return n;for(;o<l.length&&0!=c.length;)if(l[0]!=c[0]){if(l[o]>c[0])break;for(;l[o]<c[0]&&!(++o>=l.length););n.push({left:l[o-1],right:c[0]}),l.splice(o-1,1),c.splice(0,1),o=0}else n.push({left:l[0],right:c[0]}),l.splice(0,1),c.splice(0,1);return n.sort((function(e,t){return e.left-t.left})),n}},{key:"findPairedArrays",value:function(e,t,r,a){var n=this.prepareFindParameters(r,a),i=n.start,s=n.length,u=[],o=0,l=this.findAllIn(e,i,s);if(0==l.length)return u;var c=this.findAllIn(t,i,s);if(0==c.length)return u;for(;o<l.length&&0!=c.length;)if(l[0].position!=c[0].position){if(l[o].position>c[0].position)break;for(;l[o].position<c[0].position&&!(++o>=l.length););u.push({left:l[o-1],right:c[0]}),l.splice(o-1,1),c.splice(0,1),o=0}else u.push({left:l[0],right:c[0]}),l.splice(0,1),c.splice(0,1);return u.sort((function(e,t){return e.left.position-t.left.position})),u}},{key:"replacePattern",value:function(e,t,r,a){var n,i,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,u=[],o={status:-1,searchPatternPositions:[],replacePatternPositions:[]},l=this.prepareFindParameters(r,a),c=l.start,h=l.length;if(null==s){if(0==(u=this.findAllIn([e],c,h)).length)return o}else u=s;(n=o.searchPatternPositions).push.apply(n,N(Array.from(u,(function(e){return e.position}))));var f=e.length-t.length,m=new ArrayBuffer(this.view.length-u.length*f),v=new Uint8Array(m);for(v.set(new Uint8Array(this.buffer,0,c)),i=0;i<u.length;i++){var d=0==i?c:u[i-1].position;v.set(new Uint8Array(this.buffer,d,u[i].position-e.length-d),d-i*f),v.set(t.view,u[i].position-e.length-i*f),o.replacePatternPositions.push(u[i].position-e.length-i*f)}return i--,v.set(new Uint8Array(this.buffer,u[i].position,this.length-u[i].position),u[i].position-e.length+t.length-i*f),this.buffer=m,this.view=new Uint8Array(this.buffer),o.status=1,o}},{key:"skipPatterns",value:function(e,t,r,a){for(var n=this.prepareFindParameters(t,r,a),i=n.start,s=n.length,u=n.backward,o=i,l=0;l<e.length;l++){for(var c=e[l].length,h=u?o-c:o,f=!0,m=0;m<c;m++)if(this.view[m+h]!=e[l].view[m]){f=!1;break}if(f)if(l=-1,u){if((o-=c)<=0)return o}else if((o+=c)>=i+s)return o}return o}},{key:"skipNotPatterns",value:function(e,t,r,a){for(var n=this.prepareFindParameters(t,r,a),i=n.start,s=n.length,u=n.backward,o=-1,l=0;l<s;l++){for(var c=0;c<e.length;c++){for(var h=e[c].length,f=u?i-l-h:i+l,m=!0,v=0;v<h;v++)if(this.view[v+f]!=e[c].view[v]){m=!1;break}if(m){o=u?i-l:i+l;break}}if(-1!=o)break}return o}},{key:"prepareFindParameters",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return null===e&&(e=r?this.length:0),e>this.length&&(e=this.length),r?(null===t&&(t=e),t>e&&(t=e)):(null===t&&(t=this.length-e),t>this.length-e&&(t=this.length-e)),{start:e,length:t,backward:r}}}]),e}(),na=16777216,ia=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};u(this,e),this._stream=new aa,this._length=0,this._start=0,this.backward=!1,this.appendBlock=0,this.prevLength=0,this.prevStart=0,this.stream="view"in t?new aa({view:t.view}):"buffer"in t?new aa({buffer:t.buffer}):"string"in t?new aa({string:t.string}):"hexstring"in t?new aa({hexstring:t.hexstring}):"stream"in t?t.stream.slice():new aa,"backward"in t&&t.backward&&(this.backward=t.backward,this._start=this.stream.length),"length"in t&&t.length>0&&(this._length=t.length),"start"in t&&t.start&&t.start>0&&(this._start=t.start),"appendBlock"in t&&t.appendBlock&&t.appendBlock>0&&(this.appendBlock=t.appendBlock)}return l(e,[{key:"stream",get:function(){return this._stream},set:function(e){this._stream=e,this.prevLength=this._length,this._length=e.length,this.prevStart=this._start,this._start=0}},{key:"length",get:function(){return this.appendBlock?this.start:this._length},set:function(e){this.prevLength=this._length,this._length=e}},{key:"start",get:function(){return this._start},set:function(e){e>this.stream.length||(this.prevStart=this._start,this.prevLength=this._length,this._length-=this.backward?this._start-e:e-this._start,this._start=e)}},{key:"buffer",get:function(){return this._stream.buffer.slice(0,this._length)}},{key:"resetPosition",value:function(){this._start=this.prevStart,this._length=this.prevLength}},{key:"findPattern",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;(null==t||t>this.length)&&(t=this.length);var r=this.stream.findPattern(e,this.start,this.length,this.backward);if(-1==r)return r;if(this.backward){if(r<this.start-e.length-t)return-1}else if(r>this.start+e.length+t)return-1;return this.start=r,r}},{key:"findFirstIn",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;(null==t||t>this.length)&&(t=this.length);var r=this.stream.findFirstIn(e,this.start,this.length,this.backward);if(-1==r.id)return r;if(this.backward){if(r.position<this.start-e[r.id].length-t)return{id:-1,position:this.backward?0:this.start+this.length}}else if(r.position>this.start+e[r.id].length+t)return{id:-1,position:this.backward?0:this.start+this.length};return this.start=r.position,r}},{key:"findAllIn",value:function(e){var t=this.backward?this.start-this.length:this.start;return this.stream.findAllIn(e,t,this.length)}},{key:"findFirstNotIn",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;(null==t||t>this._length)&&(t=this._length);var r=this._stream.findFirstNotIn(e,this._start,this._length,this.backward);if(-1==r.left.id&&-1==r.right.id)return r;if(this.backward){if(-1!=r.right.id&&r.right.position<this._start-e[r.right.id].length-t)return{left:{id:-1,position:this._start},right:{id:-1,position:0},value:new aa}}else if(-1!=r.left.id&&r.left.position>this._start+e[r.left.id].length+t)return{left:{id:-1,position:this._start},right:{id:-1,position:0},value:new aa};return this.backward?-1==r.left.id?this.start=0:this.start=r.left.position:-1==r.right.id?this.start=this._start+this._length:this.start=r.right.position,r}},{key:"findAllNotIn",value:function(e){var t=this.backward?this._start-this._length:this._start;return this._stream.findAllNotIn(e,t,this._length)}},{key:"findFirstSequence",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;(null==t||t>this._length)&&(t=this._length),(null==r||r>t)&&(r=t);var a=this._stream.findFirstSequence(e,this._start,t,this.backward);if(0==a.value.length)return a;if(this.backward){if(a.position<this._start-a.value.length-r)return{position:-1,value:new aa}}else if(a.position>this._start+a.value.length+r)return{position:-1,value:new aa};return this.start=a.position,a}},{key:"findAllSequences",value:function(e){var t=this.backward?this.start-this.length:this.start;return this.stream.findAllSequences(e,t,this.length)}},{key:"findPairedPatterns",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;(null==r||r>this.length)&&(r=this.length);var a=this.backward?this.start-this.length:this.start,n=this.stream.findPairedPatterns(e,t,a,this.length);if(n.length)if(this.backward){if(n[0].right<this.start-t.length-r)return[]}else if(n[0].left>this.start+e.length+r)return[];return n}},{key:"findPairedArrays",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;(null==r||r>this.length)&&(r=this.length);var a=this.backward?this.start-this.length:this.start,n=this.stream.findPairedArrays(e,t,a,this.length);if(n.length)if(this.backward){if(n[0].right.position<this.start-t[n[0].right.id].length-r)return[]}else if(n[0].left.position>this.start+e[n[0].left.id].length+r)return[];return n}},{key:"replacePattern",value:function(e,t){var r=this.backward?this.start-this.length:this.start;return this.stream.replacePattern(e,t,r,this.length)}},{key:"skipPatterns",value:function(e){var t=this.stream.skipPatterns(e,this.start,this.length,this.backward);return this.start=t,t}},{key:"skipNotPatterns",value:function(e){var t=this.stream.skipNotPatterns(e,this.start,this.length,this.backward);return-1==t?-1:(this.start=t,t)}},{key:"append",value:function(e){this.beforeAppend(e.length),this._stream.view.set(e.view,this._start),this._length+=2*e.length,this.start=this._start+e.length,this.prevLength-=2*e.length}},{key:"appendView",value:function(e){this.beforeAppend(e.length),this._stream.view.set(e,this._start),this._length+=2*e.length,this.start=this._start+e.length,this.prevLength-=2*e.length}},{key:"appendChar",value:function(e){this.beforeAppend(1),this._stream.view[this._start]=e,this._length+=2,this.start=this._start+1,this.prevLength-=2}},{key:"appendUint16",value:function(e){this.beforeAppend(2);var t=new Uint16Array([e]),r=new Uint8Array(t.buffer);this.stream.view[this._start]=r[1],this._stream.view[this._start+1]=r[0],this._length+=4,this.start=this._start+2,this.prevLength-=4}},{key:"appendUint24",value:function(e){this.beforeAppend(3);var t=new Uint32Array([e]),r=new Uint8Array(t.buffer);this._stream.view[this._start]=r[2],this._stream.view[this._start+1]=r[1],this._stream.view[this._start+2]=r[0],this._length+=6,this.start=this._start+3,this.prevLength-=6}},{key:"appendUint32",value:function(e){this.beforeAppend(4);var t=new Uint32Array([e]),r=new Uint8Array(t.buffer);this._stream.view[this._start]=r[3],this._stream.view[this._start+1]=r[2],this._stream.view[this._start+2]=r[1],this._stream.view[this._start+3]=r[0],this._length+=8,this.start=this._start+4,this.prevLength-=8}},{key:"appendInt16",value:function(e){this.beforeAppend(2);var t=new Int16Array([e]),r=new Uint8Array(t.buffer);this._stream.view[this._start]=r[1],this._stream.view[this._start+1]=r[0],this._length+=4,this.start=this._start+2,this.prevLength-=4}},{key:"appendInt32",value:function(e){this.beforeAppend(4);var t=new Int32Array([e]),r=new Uint8Array(t.buffer);this._stream.view[this._start]=r[3],this._stream.view[this._start+1]=r[2],this._stream.view[this._start+2]=r[1],this._stream.view[this._start+3]=r[0],this._length+=8,this.start=this._start+4,this.prevLength-=8}},{key:"getBlock",value:function(e){var t,r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this._length<=0)return new Uint8Array(0);if(this._length<e&&(e=this._length),this.backward){var a=this._stream.view.subarray(this._length-e,this._length);t=new Uint8Array(e);for(var n=0;n<e;n++)t[e-1-n]=a[n]}else t=this._stream.view.subarray(this._start,this._start+e);return r&&(this.start+=this.backward?-1*e:e),t}},{key:"getUint16",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=this.getBlock(2,e);return t.length<2?0:t[0]<<8|t[1]}},{key:"getInt16",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=this.getUint16(e),r=32768;return t&r?-(r-(t^r)):t}},{key:"getUint24",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=this.getBlock(4,e);return t.length<3?0:t[0]<<16|t[1]<<8|t[2]}},{key:"getUint32",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=this.getBlock(4,e);return t.length<4?0:t[0]*na+(t[1]<<16)+(t[2]<<8)+t[3]}},{key:"getInt32",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=this.getUint32(e),r=2147483648;return t&r?-(r-(t^r)):t}},{key:"beforeAppend",value:function(t){this._start+t>this._stream.length&&(t>this.appendBlock&&(this.appendBlock=t+e.APPEND_BLOCK),this._stream.realloc(this._stream.length+this.appendBlock))}}]),e}();ia.APPEND_BLOCK=1e3;var sa=new ArrayBuffer(0),ua="",oa=function(e){h(r,e);var t=w(r);function r(){var e;return u(this,r),(e=t.apply(this,arguments)).name=r.NAME,e}return l(r,null,[{key:"isType",value:function(e,t){if("string"==typeof t){if("Array"===t&&Array.isArray(e))return!0;if("ArrayBuffer"===t&&e instanceof ArrayBuffer)return!0;if("ArrayBufferView"===t&&ArrayBuffer.isView(e))return!0;if(n(e)===t)return!0}else if(e instanceof t)return!0;return!1}},{key:"assert",value:function(e,t){for(var a=arguments.length,n=new Array(a>2?a-2:0),i=2;i<a;i++)n[i-2]=arguments[i];for(var s=0,u=n;s<u.length;s++){var o=u[s];if(this.isType(e,o))return}var l=n.map((function(e){return e instanceof Function&&"name"in e?e.name:"".concat(e)}));throw new r("Parameter '".concat(t,"' is not of type ").concat(l.length>1?"(".concat(l.join(" or "),")"):l[0]))}}]),r}(g(TypeError));oa.NAME="ArgumentError";var la=function(e){h(r,e);var t=w(r);function r(e){var a,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2?arguments[2]:void 0;return u(this,r),(a=t.call(this)).name=r.NAME,a.field=e,n&&(a.target=n),a.message=i||"Absent mandatory parameter '".concat(e,"' ").concat(n?" in '".concat(n,"'"):ua),a}return l(r,null,[{key:"assert",value:function(){for(var e,t,a=null,n=arguments.length,i=new Array(n),s=0;s<n;s++)i[s]=arguments[s];"string"==typeof i[0]?(a=i[0],e=i[1],t=i.slice(2)):(e=i[0],t=i.slice(1)),oa.assert(e,"parameters","object");var u,o=E(t);try{for(o.s();!(u=o.n()).done;){var l=u.value,c=e[l];if(null==c)throw new r(l,a)}}catch(e){o.e(e)}finally{o.f()}}},{key:"assertEmpty",value:function(e,t,a){if(null==e)throw new r(t,a)}}]),r}(g(TypeError));la.NAME="ParameterError";var ca=function(e){h(r,e);var t=w(r);function r(e){var a;return u(this,r),(a=t.call(this,e)).name="AsnError",a}return l(r,null,[{key:"assertSchema",value:function(e,t){if(!e.verified)throw new Error("Object's schema was not verified against input data for ".concat(t))}},{key:"assert",value:function(e,t){if(-1===e.offset)throw new r("Error during parsing of ASN.1 data. Data is not correct for '".concat(t,"'."))}}]),r}(g(Error)),ha=function(){function e(){u(this,e)}return l(e,[{key:"className",get:function(){return this.constructor.CLASS_NAME}},{key:"toString",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"hex";try{e=this.toSchema()}catch(t){e=this.toSchema(!0)}return De.ToString(e.toBER(),t)}}],[{key:"blockName",value:function(){return this.CLASS_NAME}},{key:"fromBER",value:function(e){var t=At(e);ca.assert(t,this.name);try{return new this({schema:t.result})}catch(e){throw new ca("Cannot create '".concat(this.CLASS_NAME,"' from ASN.1 object"))}}},{key:"defaultValues",value:function(e){throw new Error("Invalid member name for ".concat(this.CLASS_NAME," class: ").concat(e))}},{key:"schema",value:function(){throw new Error("Method '".concat(this.CLASS_NAME,".schema' should be overridden"))}}]),e}();function fa(e){for(var t=!1,r=ua,a=e.trim(),n=0;n<a.length;n++)32===a.charCodeAt(n)?!1===t&&(t=!0):(t&&(r+=" ",t=!1),r+=a[n]);return r.toLowerCase()}ha.CLASS_NAME="PkiObject";var ma="type",va="value",da=function(e){h(r,e);var t=w(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return u(this,r),(e=t.call(this)).type=Oe(a,ma,r.defaultValues(ma)),e.value=Oe(a,va,r.defaultValues(va)),a.schema&&e.fromSchema(a.schema),e}return l(r,[{key:"fromSchema",value:function(e){Ge(e,[ma,"typeValue"]);var t=ra(e,e,r.schema({names:{type:ma,value:"typeValue"}}));ca.assertSchema(t,this.className),this.type=t.result.type.valueBlock.toString(),this.value=t.result.typeValue}},{key:"toSchema",value:function(){return new sr({value:[new $t({value:this.type}),this.value]})}},{key:"toJSON",value:function(){var e={type:this.type};return 0!==Object.keys(this.value).length?e.value=this.value.toJSON():e.value=this.value,e}},{key:"isEqual",value:function(e){var t=[mr.blockName(),gr.blockName(),wr.blockName(),Sr.blockName(),Nr.blockName(),xr.blockName(),Ir.blockName(),Vr.blockName(),Or.blockName(),Rr.blockName(),Tr.blockName(),Hr.blockName()];if(e instanceof ArrayBuffer)return Ie.isEqual(this.value.valueBeforeDecodeView,e);if(e.constructor.blockName()===r.blockName()){if(this.type!==e.type)return!1;var a,n=[!1,!1],i=this.value.constructor.blockName(),s=E(t);try{for(s.s();!(a=s.n()).done;){var u=a.value;i===u&&(n[0]=!0),e.value.constructor.blockName()===u&&(n[1]=!0)}}catch(e){s.e(e)}finally{s.f()}if(n[0]!==n[1])return!1;if(n[0]&&n[1]){var o=fa(this.value.valueBlock.value),l=fa(e.value.valueBlock.value);if(0!==o.localeCompare(l))return!1}else if(!Ie.isEqual(this.value.valueBeforeDecodeView,e.value.valueBeforeDecodeView))return!1;return!0}return!1}}],[{key:"defaultValues",value:function(e){switch(e){case ma:return ua;case va:return{};default:return S(f(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Oe(e,"names",{});return new sr({name:t.blockName||ua,value:[new $t({name:t.type||ua}),new Zr({name:t.value||ua})]})}}]),r}(ha);da.CLASS_NAME="AttributeTypeAndValue";var ga="typesAndValues",pa="valueBeforeDecode",ya=function(e){h(r,e);var t=w(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return u(this,r),(e=t.call(this)).typesAndValues=Oe(a,ga,r.defaultValues(ga)),e.valueBeforeDecode=Oe(a,pa,r.defaultValues(pa)),a.schema&&e.fromSchema(a.schema),e}return l(r,[{key:"fromSchema",value:function(e){Ge(e,["RDN",ga]);var t=ra(e,e,r.schema({names:{blockName:"RDN",repeatedSet:ga}}));ca.assertSchema(t,this.className),ga in t.result&&(this.typesAndValues=Array.from(t.result.typesAndValues,(function(e){return new da({schema:e})}))),this.valueBeforeDecode=t.result.RDN.valueBeforeDecodeView.slice().buffer}},{key:"toSchema",value:function(){if(0===this.valueBeforeDecode.byteLength)return new sr({value:[new ur({value:Array.from(this.typesAndValues,(function(e){return e.toSchema()}))})]});var e=At(this.valueBeforeDecode);if(ca.assert(e,"RelativeDistinguishedNames"),!(e.result instanceof sr))throw new Error("ASN.1 result should be SEQUENCE");return e.result}},{key:"toJSON",value:function(){return{typesAndValues:Array.from(this.typesAndValues,(function(e){return e.toJSON()}))}}},{key:"isEqual",value:function(e){if(e instanceof r){if(this.typesAndValues.length!==e.typesAndValues.length)return!1;var t,a=E(this.typesAndValues.entries());try{for(a.s();!(t=a.n()).done;){var n=A(t.value,2),i=n[0];if(!1===n[1].isEqual(e.typesAndValues[i]))return!1}}catch(e){a.e(e)}finally{a.f()}return!0}return e instanceof ArrayBuffer&&Me(this.valueBeforeDecode,e)}}],[{key:"defaultValues",value:function(e){switch(e){case ga:return[];case pa:return sa;default:return S(f(r),"defaultValues",this).call(this,e)}}},{key:"compareWithDefault",value:function(e,t){switch(e){case ga:return 0===t.length;case pa:return 0===t.byteLength;default:return S(f(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Oe(e,"names",{});return new sr({name:t.blockName||ua,value:[new ea({name:t.repeatedSequence||ua,value:new ur({value:[new ea({name:t.repeatedSet||ua,value:da.schema(t.typeAndValue||{})})]})})]})}}]),r}(ha);ya.CLASS_NAME="RelativeDistinguishedNames";var ka="type",wa="value";function ba(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=Oe(e,"names",{});return new sr({optional:t,value:[new xt({optional:!0,idBlock:{tagClass:2,tagNumber:1},name:r.country_name||ua,value:[new $r({value:[new Sr,new Nr]})]}),new xt({optional:!0,idBlock:{tagClass:2,tagNumber:2},name:r.administration_domain_name||ua,value:[new $r({value:[new Sr,new Nr]})]}),new wt({optional:!0,idBlock:{tagClass:3,tagNumber:0},name:r.network_address||ua,isHexOnly:!0}),new wt({optional:!0,idBlock:{tagClass:3,tagNumber:1},name:r.terminal_identifier||ua,isHexOnly:!0}),new xt({optional:!0,idBlock:{tagClass:3,tagNumber:2},name:r.private_domain_name||ua,value:[new $r({value:[new Sr,new Nr]})]}),new wt({optional:!0,idBlock:{tagClass:3,tagNumber:3},name:r.organization_name||ua,isHexOnly:!0}),new wt({optional:!0,name:r.numeric_user_identifier||ua,idBlock:{tagClass:3,tagNumber:4},isHexOnly:!0}),new xt({optional:!0,name:r.personal_name||ua,idBlock:{tagClass:3,tagNumber:5},value:[new wt({idBlock:{tagClass:3,tagNumber:0},isHexOnly:!0}),new wt({optional:!0,idBlock:{tagClass:3,tagNumber:1},isHexOnly:!0}),new wt({optional:!0,idBlock:{tagClass:3,tagNumber:2},isHexOnly:!0}),new wt({optional:!0,idBlock:{tagClass:3,tagNumber:3},isHexOnly:!0})]}),new xt({optional:!0,name:r.organizational_unit_names||ua,idBlock:{tagClass:3,tagNumber:6},value:[new ea({value:new Nr})]})]})}function Sa(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return new sr({optional:e,value:[new Nr,new Nr]})}function Aa(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return new ur({optional:e,value:[new wt({optional:!0,idBlock:{tagClass:3,tagNumber:0},isHexOnly:!0}),new xt({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new Zr]})]})}var Na=function(e){h(r,e);var t=w(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return u(this,r),(e=t.call(this)).type=Oe(a,ka,r.defaultValues(ka)),e.value=Oe(a,wa,r.defaultValues(wa)),a.schema&&e.fromSchema(a.schema),e}return l(r,[{key:"fromSchema",value:function(e){Ge(e,["blockName","otherName","rfc822Name","dNSName","x400Address","directoryName","ediPartyName","uniformResourceIdentifier","iPAddress","registeredID"]);var t=ra(e,e,r.schema({names:{blockName:"blockName",otherName:"otherName",rfc822Name:"rfc822Name",dNSName:"dNSName",x400Address:"x400Address",directoryName:{names:{blockName:"directoryName"}},ediPartyName:"ediPartyName",uniformResourceIdentifier:"uniformResourceIdentifier",iPAddress:"iPAddress",registeredID:"registeredID"}}));switch(ca.assertSchema(t,this.className),this.type=t.result.blockName.idBlock.tagNumber,this.type){case 0:case 3:this.value=t.result.blockName;break;case 1:case 2:case 6:var a=t.result.blockName;a.idBlock.tagClass=1,a.idBlock.tagNumber=22;var n=At(a.toBER(!1));ca.assert(n,"GeneralName value"),this.value=n.result.valueBlock.value;break;case 4:this.value=new ya({schema:t.result.directoryName});break;case 5:this.value=t.result.ediPartyName;break;case 7:this.value=new Lt({valueHex:t.result.blockName.valueBlock.valueHex});break;case 8:var i=t.result.blockName;i.idBlock.tagClass=1,i.idBlock.tagNumber=6;var s=At(i.toBER(!1));ca.assert(s,"GeneralName registeredID"),this.value=s.result.valueBlock.toString()}}},{key:"toSchema",value:function(){switch(this.type){case 0:case 3:case 5:return new xt({idBlock:{tagClass:3,tagNumber:this.type},value:[this.value]});case 1:case 2:case 6:var e=new Vr({value:this.value});return e.idBlock.tagClass=3,e.idBlock.tagNumber=this.type,e;case 4:return new xt({idBlock:{tagClass:3,tagNumber:4},value:[this.value.toSchema()]});case 7:var t=this.value;return t.idBlock.tagClass=3,t.idBlock.tagNumber=this.type,t;case 8:var a=new $t({value:this.value});return a.idBlock.tagClass=3,a.idBlock.tagNumber=this.type,a;default:return r.schema()}}},{key:"toJSON",value:function(){var e={type:this.type,value:ua};if("string"==typeof this.value)e.value=this.value;else try{e.value=this.value.toJSON()}catch(e){}return e}}],[{key:"defaultValues",value:function(e){switch(e){case ka:return 9;case wa:return{};default:return S(f(r),"defaultValues",this).call(this,e)}}},{key:"compareWithDefault",value:function(e,t){switch(e){case ka:return t===r.defaultValues(e);case wa:return 0===Object.keys(t).length;default:return S(f(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Oe(e,"names",{});return new $r({value:[new xt({idBlock:{tagClass:3,tagNumber:0},name:t.blockName||ua,value:[new $t,new xt({idBlock:{tagClass:3,tagNumber:0},value:[new Zr]})]}),new wt({name:t.blockName||ua,idBlock:{tagClass:3,tagNumber:1}}),new wt({name:t.blockName||ua,idBlock:{tagClass:3,tagNumber:2}}),new xt({idBlock:{tagClass:3,tagNumber:3},name:t.blockName||ua,value:[ba(t.builtInStandardAttributes||{},!1),Sa(!0),Aa(!0)]}),new xt({idBlock:{tagClass:3,tagNumber:4},name:t.blockName||ua,value:[ya.schema(t.directoryName||{})]}),new xt({idBlock:{tagClass:3,tagNumber:5},name:t.blockName||ua,value:[new xt({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new $r({value:[new xr,new Nr,new wr,new mr,new gr]})]}),new xt({idBlock:{tagClass:3,tagNumber:1},value:[new $r({value:[new xr,new Nr,new wr,new mr,new gr]})]})]}),new wt({name:t.blockName||ua,idBlock:{tagClass:3,tagNumber:6}}),new wt({name:t.blockName||ua,idBlock:{tagClass:3,tagNumber:7}}),new wt({name:t.blockName||ua,idBlock:{tagClass:3,tagNumber:8}})]})}}]),r}(ha);Na.CLASS_NAME="GeneralName";var Ca="accessMethod",xa="accessLocation",Ea=[Ca,xa],Ia=function(e){h(r,e);var t=w(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return u(this,r),(e=t.call(this)).accessMethod=Oe(a,Ca,r.defaultValues(Ca)),e.accessLocation=Oe(a,xa,r.defaultValues(xa)),a.schema&&e.fromSchema(a.schema),e}return l(r,[{key:"fromSchema",value:function(e){Ge(e,Ea);var t=ra(e,e,r.schema({names:{accessMethod:Ca,accessLocation:{names:{blockName:xa}}}}));ca.assertSchema(t,this.className),this.accessMethod=t.result.accessMethod.valueBlock.toString(),this.accessLocation=new Na({schema:t.result.accessLocation})}},{key:"toSchema",value:function(){return new sr({value:[new $t({value:this.accessMethod}),this.accessLocation.toSchema()]})}},{key:"toJSON",value:function(){return{accessMethod:this.accessMethod,accessLocation:this.accessLocation.toJSON()}}}],[{key:"defaultValues",value:function(e){switch(e){case Ca:return ua;case xa:return new Na;default:return S(f(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Oe(e,"names",{});return new sr({name:t.blockName||ua,value:[new $t({name:t.accessMethod||ua}),Na.schema(t.accessLocation||{})]})}}]),r}(ha);Ia.CLASS_NAME="AccessDescription";var Ba="seconds",Va="millis",Da="micros",Oa=function(e){h(r,e);var t=w(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return u(this,r),e=t.call(this),Ba in a&&(e.seconds=Oe(a,Ba,r.defaultValues(Ba))),Va in a&&(e.millis=Oe(a,Va,r.defaultValues(Va))),Da in a&&(e.micros=Oe(a,Da,r.defaultValues(Da))),a.schema&&e.fromSchema(a.schema),e}return l(r,[{key:"fromSchema",value:function(e){Ge(e,[Ba,Va,Da]);var t=ra(e,e,r.schema({names:{seconds:Ba,millis:Va,micros:Da}}));if(ca.assertSchema(t,this.className),"seconds"in t.result&&(this.seconds=t.result.seconds.valueBlock.valueDec),"millis"in t.result){var a=new Gt({valueHex:t.result.millis.valueBlock.valueHex});this.millis=a.valueBlock.valueDec}if("micros"in t.result){var n=new Gt({valueHex:t.result.micros.valueBlock.valueHex});this.micros=n.valueBlock.valueDec}}},{key:"toSchema",value:function(){var e=[];if(void 0!==this.seconds&&e.push(new Gt({value:this.seconds})),void 0!==this.millis){var t=new Gt({value:this.millis});e.push(new wt({idBlock:{tagClass:3,tagNumber:0},valueHex:t.valueBlock.valueHexView}))}if(void 0!==this.micros){var r=new Gt({value:this.micros});e.push(new wt({idBlock:{tagClass:3,tagNumber:1},valueHex:r.valueBlock.valueHexView}))}return new sr({value:e})}},{key:"toJSON",value:function(){var e={};return void 0!==this.seconds&&(e.seconds=this.seconds),void 0!==this.millis&&(e.millis=this.millis),void 0!==this.micros&&(e.micros=this.micros),e}}],[{key:"defaultValues",value:function(e){switch(e){case Ba:case Va:case Da:return 0;default:return S(f(r),"defaultValues",this).call(this,e)}}},{key:"compareWithDefault",value:function(e,t){switch(e){case Ba:case Va:case Da:return t===r.defaultValues(e);default:return S(f(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Oe(e,"names",{});return new sr({name:t.blockName||ua,optional:!0,value:[new Gt({optional:!0,name:t.seconds||ua}),new wt({name:t.millis||ua,optional:!0,idBlock:{tagClass:3,tagNumber:0}}),new wt({name:t.micros||ua,optional:!0,idBlock:{tagClass:3,tagNumber:1}})]})}}]),r}(ha);Oa.CLASS_NAME="Accuracy";var Pa="algorithmId",Ra="algorithmParams",Ua="algorithm",Ta="params",La=[Ua,Ta],Ha=function(e){h(r,e);var t=w(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return u(this,r),(e=t.call(this)).algorithmId=Oe(a,Pa,r.defaultValues(Pa)),Ra in a&&(e.algorithmParams=Oe(a,Ra,r.defaultValues(Ra))),a.schema&&e.fromSchema(a.schema),e}return l(r,[{key:"fromSchema",value:function(e){Ge(e,La);var t=ra(e,e,r.schema({names:{algorithmIdentifier:Ua,algorithmParams:Ta}}));ca.assertSchema(t,this.className),this.algorithmId=t.result.algorithm.valueBlock.toString(),Ta in t.result&&(this.algorithmParams=t.result.params)}},{key:"toSchema",value:function(){var e=[];return e.push(new $t({value:this.algorithmId})),!this.algorithmParams||this.algorithmParams instanceof Zr||e.push(this.algorithmParams),new sr({value:e})}},{key:"toJSON",value:function(){var e={algorithmId:this.algorithmId};return!this.algorithmParams||this.algorithmParams instanceof Zr||(e.algorithmParams=this.algorithmParams.toJSON()),e}},{key:"isEqual",value:function(e){return e instanceof r&&(this.algorithmId===e.algorithmId&&(this.algorithmParams?!!e.algorithmParams&&JSON.stringify(this.algorithmParams)===JSON.stringify(e.algorithmParams):!e.algorithmParams))}}],[{key:"defaultValues",value:function(e){switch(e){case Pa:return ua;case Ra:return new Zr;default:return S(f(r),"defaultValues",this).call(this,e)}}},{key:"compareWithDefault",value:function(e,t){switch(e){case Pa:return t===ua;case Ra:return t instanceof Zr;default:return S(f(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Oe(e,"names",{});return new sr({name:t.blockName||ua,optional:t.optional||!1,value:[new $t({name:t.algorithmIdentifier||ua}),new Zr({name:t.algorithmParams||ua,optional:!0})]})}}]),r}(ha);Ha.CLASS_NAME="AlgorithmIdentifier";var Ma="altNames",Ka=[Ma],_a=function(e){h(r,e);var t=w(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return u(this,r),(e=t.call(this)).altNames=Oe(a,Ma,r.defaultValues(Ma)),a.schema&&e.fromSchema(a.schema),e}return l(r,[{key:"fromSchema",value:function(e){Ge(e,Ka);var t=ra(e,e,r.schema({names:{altNames:Ma}}));ca.assertSchema(t,this.className),Ma in t.result&&(this.altNames=Array.from(t.result.altNames,(function(e){return new Na({schema:e})})))}},{key:"toSchema",value:function(){return new sr({value:Array.from(this.altNames,(function(e){return e.toSchema()}))})}},{key:"toJSON",value:function(){return{altNames:Array.from(this.altNames,(function(e){return e.toJSON()}))}}}],[{key:"defaultValues",value:function(e){return e===Ma?[]:S(f(r),"defaultValues",this).call(this,e)}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Oe(e,"names",{});return new sr({name:t.blockName||ua,value:[new ea({name:t.altNames||ua,value:Na.schema()})]})}}]),r}(ha);_a.CLASS_NAME="AltName";var ja="type",Ja="values",Fa=[ja,Ja],qa=function(e){h(r,e);var t=w(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return u(this,r),(e=t.call(this)).type=Oe(a,ja,r.defaultValues(ja)),e.values=Oe(a,Ja,r.defaultValues(Ja)),a.schema&&e.fromSchema(a.schema),e}return l(r,[{key:"fromSchema",value:function(e){Ge(e,Fa);var t=ra(e,e,r.schema({names:{type:ja,values:Ja}}));ca.assertSchema(t,this.className),this.type=t.result.type.valueBlock.toString(),this.values=t.result.values}},{key:"toSchema",value:function(){return new sr({value:[new $t({value:this.type}),new ur({value:this.values})]})}},{key:"toJSON",value:function(){return{type:this.type,values:Array.from(this.values,(function(e){return e.toJSON()}))}}}],[{key:"defaultValues",value:function(e){switch(e){case ja:return ua;case Ja:return[];default:return S(f(r),"defaultValues",this).call(this,e)}}},{key:"compareWithDefault",value:function(e,t){switch(e){case ja:return t===ua;case Ja:return 0===t.length;default:return S(f(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Oe(e,"names",{});return new sr({name:t.blockName||ua,value:[new $t({name:t.type||ua}),new ur({name:t.setName||ua,value:[new ea({name:t.values||ua,value:new Zr})]})]})}}]),r}(ha);qa.CLASS_NAME="Attribute";var Xa="notBeforeTime",Wa="notAfterTime",Ga=[Xa,Wa],za=function(e){h(r,e);var t=w(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return u(this,r),(e=t.call(this)).notBeforeTime=Oe(a,Xa,r.defaultValues(Xa)),e.notAfterTime=Oe(a,Wa,r.defaultValues(Wa)),a.schema&&e.fromSchema(a.schema),e}return l(r,[{key:"fromSchema",value:function(e){Ge(e,Ga);var t=ra(e,e,r.schema({names:{notBeforeTime:Xa,notAfterTime:Wa}}));ca.assertSchema(t,this.className),this.notBeforeTime=t.result.notBeforeTime.toDate(),this.notAfterTime=t.result.notAfterTime.toDate()}},{key:"toSchema",value:function(){return new sr({value:[new jr({valueDate:this.notBeforeTime}),new jr({valueDate:this.notAfterTime})]})}},{key:"toJSON",value:function(){return{notBeforeTime:this.notBeforeTime,notAfterTime:this.notAfterTime}}}],[{key:"defaultValues",value:function(e){switch(e){case Xa:case Wa:return new Date(0,0,0);default:return S(f(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Oe(e,"names",{});return new sr({name:t.blockName||ua,value:[new jr({name:t.notBeforeTime||ua}),new jr({name:t.notAfterTime||ua})]})}}]),r}(ha);za.CLASS_NAME="AttCertValidityPeriod";var Qa="names",Ya="generalNames",Za=function(e){h(r,e);var t=w(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return u(this,r),(e=t.call(this)).names=Oe(a,Qa,r.defaultValues(Qa)),a.schema&&e.fromSchema(a.schema),e}return l(r,[{key:"fromSchema",value:function(e){Ge(e,[Qa,Ya]);var t=ra(e,e,r.schema({names:{blockName:Qa,generalNames:Ya}}));ca.assertSchema(t,this.className),this.names=Array.from(t.result.generalNames,(function(e){return new Na({schema:e})}))}},{key:"toSchema",value:function(){return new sr({value:Array.from(this.names,(function(e){return e.toSchema()}))})}},{key:"toJSON",value:function(){return{names:Array.from(this.names,(function(e){return e.toJSON()}))}}}],[{key:"defaultValues",value:function(e){return"names"===e?[]:S(f(r),"defaultValues",this).call(this,e)}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=Oe(e,Qa,{});return new sr({optional:t,name:r.blockName||ua,value:[new ea({name:r.generalNames||ua,value:Na.schema()})]})}}]),r}(ha);Za.CLASS_NAME="GeneralNames";var $a="2.5.29.14",en="2.5.29.15",tn="2.5.29.17",rn="2.5.29.18",an="2.5.29.19",nn="2.5.29.28",sn="2.5.29.29",un="2.5.29.30",on="2.5.29.31",ln="2.5.29.46",cn="2.5.29.32",hn="2.5.29.32.0",fn="2.5.29.33",mn="2.5.29.35",vn="2.5.29.36",dn="2.5.29.54",gn="1.3.6.1.5.5.7.1.1",pn="1.2.840.113549.1.7.1",yn="1.2.840.113549.1.7.2",kn="1.2.840.113549.1.7.3",wn="1.2.840.113549.1.7.6",bn="1.2.840.113549.1.9.16.1.4",Sn="1.2.840.113549.1.9.22.1",An="1.2.840.113549.1.9.22.3",Nn="1.2.840.113549.1.9.23.1",Cn="".concat("1.3.6.1.5.5.7",".48"),xn="".concat(Cn,".1.1"),En="keyIdentifier",In="authorityCertIssuer",Bn="authorityCertSerialNumber",Vn=[En,In,Bn],Dn=function(e){h(r,e);var t=w(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return u(this,r),e=t.call(this),En in a&&(e.keyIdentifier=Oe(a,En,r.defaultValues(En))),In in a&&(e.authorityCertIssuer=Oe(a,In,r.defaultValues(In))),Bn in a&&(e.authorityCertSerialNumber=Oe(a,Bn,r.defaultValues(Bn))),a.schema&&e.fromSchema(a.schema),e}return l(r,[{key:"fromSchema",value:function(e){Ge(e,Vn);var t=ra(e,e,r.schema({names:{keyIdentifier:En,authorityCertIssuer:In,authorityCertSerialNumber:Bn}}));ca.assertSchema(t,this.className),En in t.result&&(this.keyIdentifier=new Lt({valueHex:t.result.keyIdentifier.valueBlock.valueHex})),In in t.result&&(this.authorityCertIssuer=Array.from(t.result.authorityCertIssuer,(function(e){return new Na({schema:e})}))),Bn in t.result&&(this.authorityCertSerialNumber=new Gt({valueHex:t.result.authorityCertSerialNumber.valueBlock.valueHex}))}},{key:"toSchema",value:function(){var e=[];return this.keyIdentifier&&e.push(new wt({idBlock:{tagClass:3,tagNumber:0},valueHex:this.keyIdentifier.valueBlock.valueHexView})),this.authorityCertIssuer&&e.push(new xt({idBlock:{tagClass:3,tagNumber:1},value:Array.from(this.authorityCertIssuer,(function(e){return e.toSchema()}))})),this.authorityCertSerialNumber&&e.push(new wt({idBlock:{tagClass:3,tagNumber:2},valueHex:this.authorityCertSerialNumber.valueBlock.valueHexView})),new sr({value:e})}},{key:"toJSON",value:function(){var e={};return this.keyIdentifier&&(e.keyIdentifier=this.keyIdentifier.toJSON()),this.authorityCertIssuer&&(e.authorityCertIssuer=Array.from(this.authorityCertIssuer,(function(e){return e.toJSON()}))),this.authorityCertSerialNumber&&(e.authorityCertSerialNumber=this.authorityCertSerialNumber.toJSON()),e}}],[{key:"defaultValues",value:function(e){switch(e){case En:return new Lt;case In:return[];case Bn:return new Gt;default:return S(f(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Oe(e,"names",{});return new sr({name:t.blockName||ua,value:[new wt({name:t.keyIdentifier||ua,optional:!0,idBlock:{tagClass:3,tagNumber:0}}),new xt({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new ea({name:t.authorityCertIssuer||ua,value:Na.schema()})]}),new wt({name:t.authorityCertSerialNumber||ua,optional:!0,idBlock:{tagClass:3,tagNumber:2}})]})}}]),r}(ha);Dn.CLASS_NAME="AuthorityKeyIdentifier";var On="pathLenConstraint",Pn="cA",Rn=function(e){h(r,e);var t=w(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return u(this,r),(e=t.call(this)).cA=Oe(a,Pn,!1),On in a&&(e.pathLenConstraint=Oe(a,On,0)),a.schema&&e.fromSchema(a.schema),e}return l(r,[{key:"fromSchema",value:function(e){Ge(e,[Pn,On]);var t=ra(e,e,r.schema({names:{cA:Pn,pathLenConstraint:On}}));ca.assertSchema(t,this.className),Pn in t.result&&(this.cA=t.result.cA.valueBlock.value),On in t.result&&(t.result.pathLenConstraint.valueBlock.isHexOnly?this.pathLenConstraint=t.result.pathLenConstraint:this.pathLenConstraint=t.result.pathLenConstraint.valueBlock.valueDec)}},{key:"toSchema",value:function(){var e=[];return this.cA!==r.defaultValues(Pn)&&e.push(new Rt({value:this.cA})),On in this&&(this.pathLenConstraint instanceof Gt?e.push(this.pathLenConstraint):e.push(new Gt({value:this.pathLenConstraint}))),new sr({value:e})}},{key:"toJSON",value:function(){var e={};return this.cA!==r.defaultValues(Pn)&&(e.cA=this.cA),On in this&&(this.pathLenConstraint instanceof Gt?e.pathLenConstraint=this.pathLenConstraint.toJSON():e.pathLenConstraint=this.pathLenConstraint),e}}],[{key:"defaultValues",value:function(e){return e!==Pn&&S(f(r),"defaultValues",this).call(this,e)}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Oe(e,"names",{});return new sr({name:t.blockName||ua,value:[new Rt({optional:!0,name:t.cA||ua}),new Gt({optional:!0,name:t.pathLenConstraint||ua})]})}}]),r}(ha);Rn.CLASS_NAME="BasicConstraints";var Un="certificateIndex",Tn="keyIndex",Ln=function(e){h(r,e);var t=w(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return u(this,r),(e=t.call(this)).certificateIndex=Oe(a,Un,r.defaultValues(Un)),e.keyIndex=Oe(a,Tn,r.defaultValues(Tn)),a.schema&&e.fromSchema(a.schema),e}return l(r,[{key:"fromSchema",value:function(e){if(e.constructor.blockName()!==Gt.blockName())throw new Error("Object's schema was not verified against input data for CAVersion");var t=e.valueBlock.valueHex.slice(0),r=new Uint8Array(t);switch(!0){case t.byteLength<4:var a=new ArrayBuffer(4);new Uint8Array(a).set(r,4-t.byteLength),t=a.slice(0);break;case t.byteLength>4:var n=new ArrayBuffer(4);new Uint8Array(n).set(r.slice(0,4)),t=n.slice(0)}var i=t.slice(0,2),s=new Uint8Array(i),u=s[0];s[0]=s[1],s[1]=u;var o=new Uint16Array(i);this.keyIndex=o[0];var l=t.slice(2),c=new Uint8Array(l);u=c[0],c[0]=c[1],c[1]=u;var h=new Uint16Array(l);this.certificateIndex=h[0]}},{key:"toSchema",value:function(){var e=new ArrayBuffer(2);new Uint16Array(e)[0]=this.certificateIndex;var t=new Uint8Array(e),r=t[0];t[0]=t[1],t[1]=r;var a=new ArrayBuffer(2);new Uint16Array(a)[0]=this.keyIndex;var n=new Uint8Array(a);return r=n[0],n[0]=n[1],n[1]=r,new Gt({valueHex:Te(a,e)})}},{key:"toJSON",value:function(){return{certificateIndex:this.certificateIndex,keyIndex:this.keyIndex}}}],[{key:"defaultValues",value:function(e){switch(e){case Un:case Tn:return 0;default:return S(f(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){return new Gt}}]),r}(ha);Ln.CLASS_NAME="CAVersion";var Hn="policyQualifierId",Mn="qualifier",Kn=[Hn,Mn],_n=function(e){h(r,e);var t=w(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return u(this,r),(e=t.call(this)).policyQualifierId=Oe(a,Hn,r.defaultValues(Hn)),e.qualifier=Oe(a,Mn,r.defaultValues(Mn)),a.schema&&e.fromSchema(a.schema),e}return l(r,[{key:"fromSchema",value:function(e){Ge(e,Kn);var t=ra(e,e,r.schema({names:{policyQualifierId:Hn,qualifier:Mn}}));ca.assertSchema(t,this.className),this.policyQualifierId=t.result.policyQualifierId.valueBlock.toString(),this.qualifier=t.result.qualifier}},{key:"toSchema",value:function(){return new sr({value:[new $t({value:this.policyQualifierId}),this.qualifier]})}},{key:"toJSON",value:function(){return{policyQualifierId:this.policyQualifierId,qualifier:this.qualifier.toJSON()}}}],[{key:"defaultValues",value:function(e){switch(e){case Hn:return ua;case Mn:return new Zr;default:return S(f(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Oe(e,"names",{});return new sr({name:t.blockName||ua,value:[new $t({name:t.policyQualifierId||ua}),new Zr({name:t.qualifier||ua})]})}}]),r}(ha);_n.CLASS_NAME="PolicyQualifierInfo";var jn="policyIdentifier",Jn="policyQualifiers",Fn=[jn,Jn],qn=function(e){h(r,e);var t=w(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return u(this,r),(e=t.call(this)).policyIdentifier=Oe(a,jn,r.defaultValues(jn)),Jn in a&&(e.policyQualifiers=Oe(a,Jn,r.defaultValues(Jn))),a.schema&&e.fromSchema(a.schema),e}return l(r,[{key:"fromSchema",value:function(e){Ge(e,Fn);var t=ra(e,e,r.schema({names:{policyIdentifier:jn,policyQualifiers:Jn}}));ca.assertSchema(t,this.className),this.policyIdentifier=t.result.policyIdentifier.valueBlock.toString(),Jn in t.result&&(this.policyQualifiers=Array.from(t.result.policyQualifiers,(function(e){return new _n({schema:e})})))}},{key:"toSchema",value:function(){var e=[];return e.push(new $t({value:this.policyIdentifier})),this.policyQualifiers&&e.push(new sr({value:Array.from(this.policyQualifiers,(function(e){return e.toSchema()}))})),new sr({value:e})}},{key:"toJSON",value:function(){var e={policyIdentifier:this.policyIdentifier};return this.policyQualifiers&&(e.policyQualifiers=Array.from(this.policyQualifiers,(function(e){return e.toJSON()}))),e}}],[{key:"defaultValues",value:function(e){switch(e){case jn:return ua;case Jn:return[];default:return S(f(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Oe(e,"names",{});return new sr({name:t.blockName||ua,value:[new $t({name:t.policyIdentifier||ua}),new sr({optional:!0,value:[new ea({name:t.policyQualifiers||ua,value:_n.schema()})]})]})}}]),r}(ha);qn.CLASS_NAME="PolicyInformation";var Xn="certificatePolicies",Wn=[Xn],Gn=function(e){h(r,e);var t=w(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return u(this,r),(e=t.call(this)).certificatePolicies=Oe(a,Xn,r.defaultValues(Xn)),a.schema&&e.fromSchema(a.schema),e}return l(r,[{key:"fromSchema",value:function(e){Ge(e,Wn);var t=ra(e,e,r.schema({names:{certificatePolicies:Xn}}));ca.assertSchema(t,this.className),this.certificatePolicies=Array.from(t.result.certificatePolicies,(function(e){return new qn({schema:e})}))}},{key:"toSchema",value:function(){return new sr({value:Array.from(this.certificatePolicies,(function(e){return e.toSchema()}))})}},{key:"toJSON",value:function(){return{certificatePolicies:Array.from(this.certificatePolicies,(function(e){return e.toJSON()}))}}}],[{key:"defaultValues",value:function(e){return e===Xn?[]:S(f(r),"defaultValues",this).call(this,e)}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Oe(e,"names",{});return new sr({name:t.blockName||ua,value:[new ea({name:t.certificatePolicies||ua,value:qn.schema()})]})}}]),r}(ha);Gn.CLASS_NAME="CertificatePolicies";var zn="templateID",Qn="templateMajorVersion",Yn="templateMinorVersion",Zn=[zn,Qn,Yn],$n=function(e){h(r,e);var t=w(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return u(this,r),(e=t.call(this)).templateID=Oe(a,zn,r.defaultValues(zn)),Qn in a&&(e.templateMajorVersion=Oe(a,Qn,r.defaultValues(Qn))),Yn in a&&(e.templateMinorVersion=Oe(a,Yn,r.defaultValues(Yn))),a.schema&&e.fromSchema(a.schema),e}return l(r,[{key:"fromSchema",value:function(e){Ge(e,Zn);var t=ra(e,e,r.schema({names:{templateID:zn,templateMajorVersion:Qn,templateMinorVersion:Yn}}));ca.assertSchema(t,this.className),this.templateID=t.result.templateID.valueBlock.toString(),Qn in t.result&&(this.templateMajorVersion=t.result.templateMajorVersion.valueBlock.valueDec),Yn in t.result&&(this.templateMinorVersion=t.result.templateMinorVersion.valueBlock.valueDec)}},{key:"toSchema",value:function(){var e=[];return e.push(new $t({value:this.templateID})),Qn in this&&e.push(new Gt({value:this.templateMajorVersion})),Yn in this&&e.push(new Gt({value:this.templateMinorVersion})),new sr({value:e})}},{key:"toJSON",value:function(){var e={templateID:this.templateID};return Qn in this&&(e.templateMajorVersion=this.templateMajorVersion),Yn in this&&(e.templateMinorVersion=this.templateMinorVersion),e}}],[{key:"defaultValues",value:function(e){switch(e){case zn:return ua;case Qn:case Yn:return 0;default:return S(f(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Oe(e,"names",{});return new sr({name:t.blockName||ua,value:[new $t({name:t.templateID||ua}),new Gt({name:t.templateMajorVersion||ua,optional:!0}),new Gt({name:t.templateMinorVersion||ua,optional:!0})]})}}]),r}(ha),ei="distributionPoint",ti="distributionPointNames",ri="reasons",ai="cRLIssuer",ni="cRLIssuerNames",ii=[ei,ti,ri,ai,ni],si=function(e){h(r,e);var t=w(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return u(this,r),e=t.call(this),ei in a&&(e.distributionPoint=Oe(a,ei,r.defaultValues(ei))),ri in a&&(e.reasons=Oe(a,ri,r.defaultValues(ri))),ai in a&&(e.cRLIssuer=Oe(a,ai,r.defaultValues(ai))),a.schema&&e.fromSchema(a.schema),e}return l(r,[{key:"fromSchema",value:function(e){Ge(e,ii);var t=ra(e,e,r.schema({names:{distributionPoint:ei,distributionPointNames:ti,reasons:ri,cRLIssuer:ai,cRLIssuerNames:ni}}));ca.assertSchema(t,this.className),ei in t.result&&(0===t.result.distributionPoint.idBlock.tagNumber&&(this.distributionPoint=Array.from(t.result.distributionPointNames,(function(e){return new Na({schema:e})}))),1===t.result.distributionPoint.idBlock.tagNumber&&(this.distributionPoint=new ya({schema:new sr({value:t.result.distributionPoint.valueBlock.value})}))),ri in t.result&&(this.reasons=new _t({valueHex:t.result.reasons.valueBlock.valueHex})),ai in t.result&&(this.cRLIssuer=Array.from(t.result.cRLIssuerNames,(function(e){return new Na({schema:e})})))}},{key:"toSchema",value:function(){var e,t=[];this.distributionPoint&&(e=this.distributionPoint instanceof Array?new xt({idBlock:{tagClass:3,tagNumber:0},value:Array.from(this.distributionPoint,(function(e){return e.toSchema()}))}):new xt({idBlock:{tagClass:3,tagNumber:1},value:[this.distributionPoint.toSchema()]}),t.push(new xt({idBlock:{tagClass:3,tagNumber:0},value:[e]})));return this.reasons&&t.push(new wt({idBlock:{tagClass:3,tagNumber:1},valueHex:this.reasons.valueBlock.valueHexView})),this.cRLIssuer&&t.push(new xt({idBlock:{tagClass:3,tagNumber:2},value:Array.from(this.cRLIssuer,(function(e){return e.toSchema()}))})),new sr({value:t})}},{key:"toJSON",value:function(){var e={};return this.distributionPoint&&(this.distributionPoint instanceof Array?e.distributionPoint=Array.from(this.distributionPoint,(function(e){return e.toJSON()})):e.distributionPoint=this.distributionPoint.toJSON()),this.reasons&&(e.reasons=this.reasons.toJSON()),this.cRLIssuer&&(e.cRLIssuer=Array.from(this.cRLIssuer,(function(e){return e.toJSON()}))),e}}],[{key:"defaultValues",value:function(e){switch(e){case ei:return[];case ri:return new _t;case ai:return[];default:return S(f(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Oe(e,"names",{});return new sr({name:t.blockName||ua,value:[new xt({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new $r({value:[new xt({name:t.distributionPoint||ua,optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new ea({name:t.distributionPointNames||ua,value:Na.schema()})]}),new xt({name:t.distributionPoint||ua,optional:!0,idBlock:{tagClass:3,tagNumber:1},value:ya.schema().valueBlock.value})]})]}),new wt({name:t.reasons||ua,optional:!0,idBlock:{tagClass:3,tagNumber:1}}),new xt({name:t.cRLIssuer||ua,optional:!0,idBlock:{tagClass:3,tagNumber:2},value:[new ea({name:t.cRLIssuerNames||ua,value:Na.schema()})]})]})}}]),r}(ha);si.CLASS_NAME="DistributionPoint";var ui="distributionPoints",oi=[ui],li=function(e){h(r,e);var t=w(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return u(this,r),(e=t.call(this)).distributionPoints=Oe(a,ui,r.defaultValues(ui)),a.schema&&e.fromSchema(a.schema),e}return l(r,[{key:"fromSchema",value:function(e){Ge(e,oi);var t=ra(e,e,r.schema({names:{distributionPoints:ui}}));ca.assertSchema(t,this.className),this.distributionPoints=Array.from(t.result.distributionPoints,(function(e){return new si({schema:e})}))}},{key:"toSchema",value:function(){return new sr({value:Array.from(this.distributionPoints,(function(e){return e.toSchema()}))})}},{key:"toJSON",value:function(){return{distributionPoints:Array.from(this.distributionPoints,(function(e){return e.toJSON()}))}}}],[{key:"defaultValues",value:function(e){return e===ui?[]:S(f(r),"defaultValues",this).call(this,e)}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Oe(e,"names",{});return new sr({name:t.blockName||ua,value:[new ea({name:t.distributionPoints||ua,value:si.schema()})]})}}]),r}(ha);li.CLASS_NAME="CRLDistributionPoints";var ci="keyPurposes",hi=[ci],fi=function(e){h(r,e);var t=w(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return u(this,r),(e=t.call(this)).keyPurposes=Oe(a,ci,r.defaultValues(ci)),a.schema&&e.fromSchema(a.schema),e}return l(r,[{key:"fromSchema",value:function(e){Ge(e,hi);var t=ra(e,e,r.schema({names:{keyPurposes:ci}}));ca.assertSchema(t,this.className),this.keyPurposes=Array.from(t.result.keyPurposes,(function(e){return e.valueBlock.toString()}))}},{key:"toSchema",value:function(){return new sr({value:Array.from(this.keyPurposes,(function(e){return new $t({value:e})}))})}},{key:"toJSON",value:function(){return{keyPurposes:Array.from(this.keyPurposes)}}}],[{key:"defaultValues",value:function(e){return e===ci?[]:S(f(r),"defaultValues",this).call(this,e)}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Oe(e,"names",{});return new sr({name:t.blockName||ua,value:[new ea({name:t.keyPurposes||ua,value:new $t})]})}}]),r}(ha);fi.CLASS_NAME="ExtKeyUsage";var mi="accessDescriptions",vi=function(e){h(r,e);var t=w(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return u(this,r),(e=t.call(this)).accessDescriptions=Oe(a,mi,r.defaultValues(mi)),a.schema&&e.fromSchema(a.schema),e}return l(r,[{key:"fromSchema",value:function(e){Ge(e,[mi]);var t=ra(e,e,r.schema({names:{accessDescriptions:mi}}));ca.assertSchema(t,this.className),this.accessDescriptions=Array.from(t.result.accessDescriptions,(function(e){return new Ia({schema:e})}))}},{key:"toSchema",value:function(){return new sr({value:Array.from(this.accessDescriptions,(function(e){return e.toSchema()}))})}},{key:"toJSON",value:function(){return{accessDescriptions:Array.from(this.accessDescriptions,(function(e){return e.toJSON()}))}}}],[{key:"defaultValues",value:function(e){return e===mi?[]:S(f(r),"defaultValues",this).call(this,e)}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Oe(e,"names",{});return new sr({name:t.blockName||ua,value:[new ea({name:t.accessDescriptions||ua,value:Ia.schema()})]})}}]),r}(ha);vi.CLASS_NAME="InfoAccess";var di="distributionPoint",gi="distributionPointNames",pi="onlyContainsUserCerts",yi="onlyContainsCACerts",ki="onlySomeReasons",wi="indirectCRL",bi="onlyContainsAttributeCerts",Si=[di,gi,pi,yi,ki,wi,bi],Ai=function(e){h(r,e);var t=w(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return u(this,r),e=t.call(this),di in a&&(e.distributionPoint=Oe(a,di,r.defaultValues(di))),e.onlyContainsUserCerts=Oe(a,pi,r.defaultValues(pi)),e.onlyContainsCACerts=Oe(a,yi,r.defaultValues(yi)),ki in a&&(e.onlySomeReasons=Oe(a,ki,r.defaultValues(ki))),e.indirectCRL=Oe(a,wi,r.defaultValues(wi)),e.onlyContainsAttributeCerts=Oe(a,bi,r.defaultValues(bi)),a.schema&&e.fromSchema(a.schema),e}return l(r,[{key:"fromSchema",value:function(e){Ge(e,Si);var t=ra(e,e,r.schema({names:{distributionPoint:di,distributionPointNames:gi,onlyContainsUserCerts:pi,onlyContainsCACerts:yi,onlySomeReasons:ki,indirectCRL:wi,onlyContainsAttributeCerts:bi}}));if(ca.assertSchema(t,this.className),di in t.result)switch(!0){case 0===t.result.distributionPoint.idBlock.tagNumber:this.distributionPoint=Array.from(t.result.distributionPointNames,(function(e){return new Na({schema:e})}));break;case 1===t.result.distributionPoint.idBlock.tagNumber:this.distributionPoint=new ya({schema:new sr({value:t.result.distributionPoint.valueBlock.value})});break;default:throw new Error("Unknown tagNumber for distributionPoint: {$asn1.result.distributionPoint.idBlock.tagNumber}")}if(pi in t.result){var a=new Uint8Array(t.result.onlyContainsUserCerts.valueBlock.valueHex);this.onlyContainsUserCerts=0!==a[0]}if(yi in t.result){var n=new Uint8Array(t.result.onlyContainsCACerts.valueBlock.valueHex);this.onlyContainsCACerts=0!==n[0]}if(ki in t.result){var i=new Uint8Array(t.result.onlySomeReasons.valueBlock.valueHex);this.onlySomeReasons=i[0]}if(wi in t.result){var s=new Uint8Array(t.result.indirectCRL.valueBlock.valueHex);this.indirectCRL=0!==s[0]}if(bi in t.result){var u=new Uint8Array(t.result.onlyContainsAttributeCerts.valueBlock.valueHex);this.onlyContainsAttributeCerts=0!==u[0]}}},{key:"toSchema",value:function(){var e,t=[];this.distributionPoint&&(this.distributionPoint instanceof Array?e=new xt({idBlock:{tagClass:3,tagNumber:0},value:Array.from(this.distributionPoint,(function(e){return e.toSchema()}))}):((e=this.distributionPoint.toSchema()).idBlock.tagClass=3,e.idBlock.tagNumber=1),t.push(new xt({idBlock:{tagClass:3,tagNumber:0},value:[e]})));if(this.onlyContainsUserCerts!==r.defaultValues(pi)&&t.push(new wt({idBlock:{tagClass:3,tagNumber:1},valueHex:new Uint8Array([255]).buffer})),this.onlyContainsCACerts!==r.defaultValues(yi)&&t.push(new wt({idBlock:{tagClass:3,tagNumber:2},valueHex:new Uint8Array([255]).buffer})),void 0!==this.onlySomeReasons){var a=new ArrayBuffer(1);new Uint8Array(a)[0]=this.onlySomeReasons,t.push(new wt({idBlock:{tagClass:3,tagNumber:3},valueHex:a}))}return this.indirectCRL!==r.defaultValues(wi)&&t.push(new wt({idBlock:{tagClass:3,tagNumber:4},valueHex:new Uint8Array([255]).buffer})),this.onlyContainsAttributeCerts!==r.defaultValues(bi)&&t.push(new wt({idBlock:{tagClass:3,tagNumber:5},valueHex:new Uint8Array([255]).buffer})),new sr({value:t})}},{key:"toJSON",value:function(){var e={};return this.distributionPoint&&(this.distributionPoint instanceof Array?e.distributionPoint=Array.from(this.distributionPoint,(function(e){return e.toJSON()})):e.distributionPoint=this.distributionPoint.toJSON()),this.onlyContainsUserCerts!==r.defaultValues(pi)&&(e.onlyContainsUserCerts=this.onlyContainsUserCerts),this.onlyContainsCACerts!==r.defaultValues(yi)&&(e.onlyContainsCACerts=this.onlyContainsCACerts),ki in this&&(e.onlySomeReasons=this.onlySomeReasons),this.indirectCRL!==r.defaultValues(wi)&&(e.indirectCRL=this.indirectCRL),this.onlyContainsAttributeCerts!==r.defaultValues(bi)&&(e.onlyContainsAttributeCerts=this.onlyContainsAttributeCerts),e}}],[{key:"defaultValues",value:function(e){switch(e){case di:return[];case pi:case yi:return!1;case ki:return 0;case wi:case bi:return!1;default:return S(f(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Oe(e,"names",{});return new sr({name:t.blockName||ua,value:[new xt({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new $r({value:[new xt({name:t.distributionPoint||ua,idBlock:{tagClass:3,tagNumber:0},value:[new ea({name:t.distributionPointNames||ua,value:Na.schema()})]}),new xt({name:t.distributionPoint||ua,idBlock:{tagClass:3,tagNumber:1},value:ya.schema().valueBlock.value})]})]}),new wt({name:t.onlyContainsUserCerts||ua,optional:!0,idBlock:{tagClass:3,tagNumber:1}}),new wt({name:t.onlyContainsCACerts||ua,optional:!0,idBlock:{tagClass:3,tagNumber:2}}),new wt({name:t.onlySomeReasons||ua,optional:!0,idBlock:{tagClass:3,tagNumber:3}}),new wt({name:t.indirectCRL||ua,optional:!0,idBlock:{tagClass:3,tagNumber:4}}),new wt({name:t.onlyContainsAttributeCerts||ua,optional:!0,idBlock:{tagClass:3,tagNumber:5}})]})}}]),r}(ha);Ai.CLASS_NAME="IssuingDistributionPoint";var Ni="base",Ci="minimum",xi="maximum",Ei=[Ni,Ci,xi],Ii=function(e){h(r,e);var t=w(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return u(this,r),(e=t.call(this)).base=Oe(a,Ni,r.defaultValues(Ni)),e.minimum=Oe(a,Ci,r.defaultValues(Ci)),xi in a&&(e.maximum=Oe(a,xi,r.defaultValues(xi))),a.schema&&e.fromSchema(a.schema),e}return l(r,[{key:"fromSchema",value:function(e){Ge(e,Ei);var t=ra(e,e,r.schema({names:{base:{names:{blockName:Ni}},minimum:Ci,maximum:xi}}));ca.assertSchema(t,this.className),this.base=new Na({schema:t.result.base}),Ci in t.result&&(t.result.minimum.valueBlock.isHexOnly?this.minimum=t.result.minimum:this.minimum=t.result.minimum.valueBlock.valueDec),xi in t.result&&(t.result.maximum.valueBlock.isHexOnly?this.maximum=t.result.maximum:this.maximum=t.result.maximum.valueBlock.valueDec)}},{key:"toSchema",value:function(){var e=[];if(e.push(this.base.toSchema()),0!==this.minimum){var t=0;t=this.minimum instanceof Gt?this.minimum:new Gt({value:this.minimum}),e.push(new xt({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[t]}))}if(xi in this){var r=0;r=this.maximum instanceof Gt?this.maximum:new Gt({value:this.maximum}),e.push(new xt({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[r]}))}return new sr({value:e})}},{key:"toJSON",value:function(){var e={base:this.base.toJSON()};return 0!==this.minimum&&("number"==typeof this.minimum?e.minimum=this.minimum:e.minimum=this.minimum.toJSON()),void 0!==this.maximum&&("number"==typeof this.maximum?e.maximum=this.maximum:e.maximum=this.maximum.toJSON()),e}}],[{key:"defaultValues",value:function(e){switch(e){case Ni:return new Na;case Ci:case xi:return 0;default:return S(f(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Oe(e,"names",{});return new sr({name:t.blockName||ua,value:[Na.schema(t.base||{}),new xt({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new Gt({name:t.minimum||ua})]}),new xt({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new Gt({name:t.maximum||ua})]})]})}}]),r}(ha);Ii.CLASS_NAME="GeneralSubtree";var Bi="permittedSubtrees",Vi="excludedSubtrees",Di=[Bi,Vi],Oi=function(e){h(r,e);var t=w(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return u(this,r),e=t.call(this),Bi in a&&(e.permittedSubtrees=Oe(a,Bi,r.defaultValues(Bi))),Vi in a&&(e.excludedSubtrees=Oe(a,Vi,r.defaultValues(Vi))),a.schema&&e.fromSchema(a.schema),e}return l(r,[{key:"fromSchema",value:function(e){Ge(e,Di);var t=ra(e,e,r.schema({names:{permittedSubtrees:Bi,excludedSubtrees:Vi}}));ca.assertSchema(t,this.className),Bi in t.result&&(this.permittedSubtrees=Array.from(t.result.permittedSubtrees,(function(e){return new Ii({schema:e})}))),Vi in t.result&&(this.excludedSubtrees=Array.from(t.result.excludedSubtrees,(function(e){return new Ii({schema:e})})))}},{key:"toSchema",value:function(){var e=[];return this.permittedSubtrees&&e.push(new xt({idBlock:{tagClass:3,tagNumber:0},value:Array.from(this.permittedSubtrees,(function(e){return e.toSchema()}))})),this.excludedSubtrees&&e.push(new xt({idBlock:{tagClass:3,tagNumber:1},value:Array.from(this.excludedSubtrees,(function(e){return e.toSchema()}))})),new sr({value:e})}},{key:"toJSON",value:function(){var e={};return this.permittedSubtrees&&(e.permittedSubtrees=Array.from(this.permittedSubtrees,(function(e){return e.toJSON()}))),this.excludedSubtrees&&(e.excludedSubtrees=Array.from(this.excludedSubtrees,(function(e){return e.toJSON()}))),e}}],[{key:"defaultValues",value:function(e){switch(e){case Bi:case Vi:return[];default:return S(f(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Oe(e,"names",{});return new sr({name:t.blockName||ua,value:[new xt({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new ea({name:t.permittedSubtrees||ua,value:Ii.schema()})]}),new xt({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new ea({name:t.excludedSubtrees||ua,value:Ii.schema()})]})]})}}]),r}(ha);Oi.CLASS_NAME="NameConstraints";var Pi="requireExplicitPolicy",Ri="inhibitPolicyMapping",Ui=[Pi,Ri],Ti=function(e){h(r,e);var t=w(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return u(this,r),e=t.call(this),Pi in a&&(e.requireExplicitPolicy=Oe(a,Pi,r.defaultValues(Pi))),Ri in a&&(e.inhibitPolicyMapping=Oe(a,Ri,r.defaultValues(Ri))),a.schema&&e.fromSchema(a.schema),e}return l(r,[{key:"fromSchema",value:function(e){Ge(e,Ui);var t=ra(e,e,r.schema({names:{requireExplicitPolicy:Pi,inhibitPolicyMapping:Ri}}));if(ca.assertSchema(t,this.className),Pi in t.result){var a=t.result.requireExplicitPolicy;a.idBlock.tagClass=1,a.idBlock.tagNumber=2;var n=At(a.toBER(!1));ca.assert(n,"Integer"),this.requireExplicitPolicy=n.result.valueBlock.valueDec}if(Ri in t.result){var i=t.result.inhibitPolicyMapping;i.idBlock.tagClass=1,i.idBlock.tagNumber=2;var s=At(i.toBER(!1));ca.assert(s,"Integer"),this.inhibitPolicyMapping=s.result.valueBlock.valueDec}}},{key:"toSchema",value:function(){var e=[];if(Pi in this){var t=new Gt({value:this.requireExplicitPolicy});t.idBlock.tagClass=3,t.idBlock.tagNumber=0,e.push(t)}if(Ri in this){var r=new Gt({value:this.inhibitPolicyMapping});r.idBlock.tagClass=3,r.idBlock.tagNumber=1,e.push(r)}return new sr({value:e})}},{key:"toJSON",value:function(){var e={};return Pi in this&&(e.requireExplicitPolicy=this.requireExplicitPolicy),Ri in this&&(e.inhibitPolicyMapping=this.inhibitPolicyMapping),e}}],[{key:"defaultValues",value:function(e){switch(e){case Pi:case Ri:return 0;default:return S(f(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Oe(e,"names",{});return new sr({name:t.blockName||ua,value:[new wt({name:t.requireExplicitPolicy||ua,optional:!0,idBlock:{tagClass:3,tagNumber:0}}),new wt({name:t.inhibitPolicyMapping||ua,optional:!0,idBlock:{tagClass:3,tagNumber:1}})]})}}]),r}(ha);Ti.CLASS_NAME="PolicyConstraints";var Li="issuerDomainPolicy",Hi="subjectDomainPolicy",Mi=[Li,Hi],Ki=function(e){h(r,e);var t=w(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return u(this,r),(e=t.call(this)).issuerDomainPolicy=Oe(a,Li,r.defaultValues(Li)),e.subjectDomainPolicy=Oe(a,Hi,r.defaultValues(Hi)),a.schema&&e.fromSchema(a.schema),e}return l(r,[{key:"fromSchema",value:function(e){Ge(e,Mi);var t=ra(e,e,r.schema({names:{issuerDomainPolicy:Li,subjectDomainPolicy:Hi}}));ca.assertSchema(t,this.className),this.issuerDomainPolicy=t.result.issuerDomainPolicy.valueBlock.toString(),this.subjectDomainPolicy=t.result.subjectDomainPolicy.valueBlock.toString()}},{key:"toSchema",value:function(){return new sr({value:[new $t({value:this.issuerDomainPolicy}),new $t({value:this.subjectDomainPolicy})]})}},{key:"toJSON",value:function(){return{issuerDomainPolicy:this.issuerDomainPolicy,subjectDomainPolicy:this.subjectDomainPolicy}}}],[{key:"defaultValues",value:function(e){switch(e){case Li:case Hi:return ua;default:return S(f(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Oe(e,"names",{});return new sr({name:t.blockName||ua,value:[new $t({name:t.issuerDomainPolicy||ua}),new $t({name:t.subjectDomainPolicy||ua})]})}}]),r}(ha);Ki.CLASS_NAME="PolicyMapping";var _i="mappings",ji=[_i],Ji=function(e){h(r,e);var t=w(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return u(this,r),(e=t.call(this)).mappings=Oe(a,_i,r.defaultValues(_i)),a.schema&&e.fromSchema(a.schema),e}return l(r,[{key:"fromSchema",value:function(e){Ge(e,ji);var t=ra(e,e,r.schema({names:{mappings:_i}}));ca.assertSchema(t,this.className),this.mappings=Array.from(t.result.mappings,(function(e){return new Ki({schema:e})}))}},{key:"toSchema",value:function(){return new sr({value:Array.from(this.mappings,(function(e){return e.toSchema()}))})}},{key:"toJSON",value:function(){return{mappings:Array.from(this.mappings,(function(e){return e.toJSON()}))}}}],[{key:"defaultValues",value:function(e){return e===_i?[]:S(f(r),"defaultValues",this).call(this,e)}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Oe(e,"names",{});return new sr({name:t.blockName||ua,value:[new ea({name:t.mappings||ua,value:Ki.schema()})]})}}]),r}(ha);Ji.CLASS_NAME="PolicyMappings";var Fi="notBefore",qi="notAfter",Xi=[Fi,qi],Wi=function(e){h(r,e);var t=w(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return u(this,r),e=t.call(this),Fi in a&&(e.notBefore=Oe(a,Fi,r.defaultValues(Fi))),qi in a&&(e.notAfter=Oe(a,qi,r.defaultValues(qi))),a.schema&&e.fromSchema(a.schema),e}return l(r,[{key:"fromSchema",value:function(e){Ge(e,Xi);var t=ra(e,e,r.schema({names:{notBefore:Fi,notAfter:qi}}));if(ca.assertSchema(t,this.className),Fi in t.result){var a=new jr;a.fromBuffer(t.result.notBefore.valueBlock.valueHex),this.notBefore=a.toDate()}if(qi in t.result){var n=new jr({valueHex:t.result.notAfter.valueBlock.valueHex});n.fromBuffer(t.result.notAfter.valueBlock.valueHex),this.notAfter=n.toDate()}}},{key:"toSchema",value:function(){var e=[];return Fi in this&&e.push(new wt({idBlock:{tagClass:3,tagNumber:0},valueHex:new jr({valueDate:this.notBefore}).valueBlock.valueHexView})),qi in this&&e.push(new wt({idBlock:{tagClass:3,tagNumber:1},valueHex:new jr({valueDate:this.notAfter}).valueBlock.valueHexView})),new sr({value:e})}},{key:"toJSON",value:function(){var e={};return this.notBefore&&(e.notBefore=this.notBefore),this.notAfter&&(e.notAfter=this.notAfter),e}}],[{key:"defaultValues",value:function(e){switch(e){case Fi:case qi:return new Date;default:return S(f(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Oe(e,"names",{});return new sr({name:t.blockName||ua,value:[new wt({name:t.notBefore||ua,optional:!0,idBlock:{tagClass:3,tagNumber:0}}),new wt({name:t.notAfter||ua,optional:!0,idBlock:{tagClass:3,tagNumber:1}})]})}}]),r}(ha);Wi.CLASS_NAME="PrivateKeyUsagePeriod";var Gi="id",zi="type",Qi="values",Yi=[Gi,zi],Zi=[Qi],$i=function(e){h(r,e);var t=w(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return u(this,r),(e=t.call(this)).id=Oe(a,Gi,r.defaultValues(Gi)),zi in a&&(e.type=Oe(a,zi,r.defaultValues(zi))),a.schema&&e.fromSchema(a.schema),e}return l(r,[{key:"fromSchema",value:function(e){Ge(e,Yi);var t=ra(e,e,r.schema({names:{id:Gi,type:zi}}));ca.assertSchema(t,this.className),this.id=t.result.id.valueBlock.toString(),zi in t.result&&(this.type=t.result.type)}},{key:"toSchema",value:function(){var e=[new $t({value:this.id})];return zi in this&&e.push(this.type),new sr({value:e})}},{key:"toJSON",value:function(){var e={id:this.id};return this.type&&(e.type=this.type.toJSON()),e}}],[{key:"defaultValues",value:function(e){switch(e){case Gi:return ua;case zi:return new Dt;default:return S(f(r),"defaultValues",this).call(this,e)}}},{key:"compareWithDefault",value:function(e,t){switch(e){case Gi:return t===ua;case zi:return t instanceof Dt;default:return S(f(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Oe(e,"names",{});return new sr({name:t.blockName||ua,value:[new $t({name:t.id||ua}),new Zr({name:t.type||ua,optional:!0})]})}}]),r}(ha);$i.CLASS_NAME="QCStatement";var es,ts=function(e){h(r,e);var t=w(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return u(this,r),(e=t.call(this)).values=Oe(a,Qi,r.defaultValues(Qi)),a.schema&&e.fromSchema(a.schema),e}return l(r,[{key:"fromSchema",value:function(e){Ge(e,Zi);var t=ra(e,e,r.schema({names:{values:Qi}}));ca.assertSchema(t,this.className),this.values=Array.from(t.result.values,(function(e){return new $i({schema:e})}))}},{key:"toSchema",value:function(){return new sr({value:Array.from(this.values,(function(e){return e.toSchema()}))})}},{key:"toJSON",value:function(){return{values:Array.from(this.values,(function(e){return e.toJSON()}))}}}],[{key:"defaultValues",value:function(e){return e===Qi?[]:S(f(r),"defaultValues",this).call(this,e)}},{key:"compareWithDefault",value:function(e,t){return e===Qi?0===t.length:S(f(r),"defaultValues",this).call(this,e)}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Oe(e,"names",{});return new sr({name:t.blockName||ua,value:[new ea({name:t.values||ua,value:$i.schema(t.value||{})})]})}}]),r}(ha);ts.CLASS_NAME="QCStatements";var rs=function(){function e(){u(this,e)}return l(e,null,[{key:"register",value:function(e,t,r){this.namedCurves[e.toLowerCase()]=this.namedCurves[t]={name:e,id:t,size:r}}},{key:"find",value:function(e){return this.namedCurves[e.toLowerCase()]||null}}]),e}();es=rs,rs.namedCurves={},es.register("P-256","1.2.840.10045.3.1.7",32),es.register("P-384","1.3.132.0.34",48),es.register("P-521","1.3.132.0.35",66),es.register("brainpoolP256r1","1.3.36.3.3.2.8.1.1.7",32),es.register("brainpoolP384r1","1.3.36.3.3.2.8.1.1.11",48),es.register("brainpoolP512r1","1.3.36.3.3.2.8.1.1.13",64);var as="x",ns="y",is="namedCurve",ss=function(e){h(r,e);var t=w(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return u(this,r),(e=t.call(this)).x=Oe(a,as,r.defaultValues(as)),e.y=Oe(a,ns,r.defaultValues(ns)),e.namedCurve=Oe(a,is,r.defaultValues(is)),a.json&&e.fromJSON(a.json),a.schema&&e.fromSchema(a.schema),e}return l(r,[{key:"fromSchema",value:function(e){var t=Ie.toUint8Array(e);if(4!==t[0])throw new Error("Object's schema was not verified against input data for ECPublicKey");var r=rs.find(this.namedCurve);if(!r)throw new Error("Incorrect curve OID: ".concat(this.namedCurve));var a=r.size;if(t.byteLength!==2*a+1)throw new Error("Object's schema was not verified against input data for ECPublicKey");this.namedCurve=r.name,this.x=t.slice(1,a+1).buffer,this.y=t.slice(1+a,2*a+1).buffer}},{key:"toSchema",value:function(){return new ta({data:Te(new Uint8Array([4]).buffer,this.x,this.y)})}},{key:"toJSON",value:function(){var e=rs.find(this.namedCurve);return{crv:e?e.name:this.namedCurve,x:Je(qe(this.x),!0,!0,!1),y:Je(qe(this.y),!0,!0,!1)}}},{key:"fromJSON",value:function(e){la.assert("json",e,"crv","x","y");var t=0,r=rs.find(e.crv);r&&(this.namedCurve=r.id,t=r.size);var a=Xe(Fe(e.x,!0));if(a.byteLength<t){this.x=new ArrayBuffer(t);var n=new Uint8Array(this.x),i=new Uint8Array(a);n.set(i,1)}else this.x=a.slice(0,t);var s=Xe(Fe(e.y,!0));if(s.byteLength<t){this.y=new ArrayBuffer(t);var u=new Uint8Array(this.y),o=new Uint8Array(s);u.set(o,1)}else this.y=s.slice(0,t)}}],[{key:"defaultValues",value:function(e){switch(e){case as:case ns:return sa;case is:return ua;default:return S(f(r),"defaultValues",this).call(this,e)}}},{key:"compareWithDefault",value:function(e,t){switch(e){case as:case ns:return t instanceof ArrayBuffer&&Me(t,r.defaultValues(e));case is:return"string"==typeof t&&t===r.defaultValues(e);default:return S(f(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){return new ta}}]),r}(ha);ss.CLASS_NAME="ECPublicKey";var us="modulus",os="publicExponent",ls=[us,os],cs=function(e){h(r,e);var t=w(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return u(this,r),(e=t.call(this)).modulus=Oe(a,us,r.defaultValues(us)),e.publicExponent=Oe(a,os,r.defaultValues(os)),a.json&&e.fromJSON(a.json),a.schema&&e.fromSchema(a.schema),e}return l(r,[{key:"fromSchema",value:function(e){Ge(e,ls);var t=ra(e,e,r.schema({names:{modulus:us,publicExponent:os}}));ca.assertSchema(t,this.className),this.modulus=t.result.modulus.convertFromDER(256),this.publicExponent=t.result.publicExponent}},{key:"toSchema",value:function(){return new sr({value:[this.modulus.convertToDER(),this.publicExponent]})}},{key:"toJSON",value:function(){return{n:De.ToBase64Url(this.modulus.valueBlock.valueHexView),e:De.ToBase64Url(this.publicExponent.valueBlock.valueHexView)}}},{key:"fromJSON",value:function(e){la.assert("json",e,"n","e");var t,r,a,n,i=Xe(Fe(e.n,!0));this.modulus=new Gt({valueHex:i.slice(0,Math.pow(2,(t=i.byteLength,r=Math.log(t)/We,a=Math.floor(r),n=Math.round(r),a===n?a:n)))}),this.publicExponent=new Gt({valueHex:Xe(Fe(e.e,!0)).slice(0,3)})}}],[{key:"defaultValues",value:function(e){switch(e){case us:case os:return new Gt;default:return S(f(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Oe(e,"names",{});return new sr({name:t.blockName||ua,value:[new Gt({name:t.modulus||ua}),new Gt({name:t.publicExponent||ua})]})}}]),r}(ha);cs.CLASS_NAME="RSAPublicKey";var hs="algorithm",fs="subjectPublicKey",ms=[hs,fs],vs=function(e){h(n,e);var t,r=w(n);function n(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};u(this,n),(e=r.call(this)).algorithm=Oe(t,hs,n.defaultValues(hs)),e.subjectPublicKey=Oe(t,fs,n.defaultValues(fs));var a=Oe(t,"parsedKey",null);return a&&(e.parsedKey=a),t.json&&e.fromJSON(t.json),t.schema&&e.fromSchema(t.schema),e}return l(n,[{key:"parsedKey",get:function(){if(void 0===this._parsedKey){switch(this.algorithm.algorithmId){case"1.2.840.10045.2.1":if("algorithmParams"in this.algorithm&&this.algorithm.algorithmParams.constructor.blockName()===$t.blockName())try{this._parsedKey=new ss({namedCurve:this.algorithm.algorithmParams.valueBlock.toString(),schema:this.subjectPublicKey.valueBlock.valueHexView})}catch(e){}break;case"1.2.840.113549.1.1.1":var e=At(this.subjectPublicKey.valueBlock.valueHexView);if(-1!==e.offset)try{this._parsedKey=new cs({schema:e.result})}catch(e){}}this._parsedKey||(this._parsedKey=null)}return this._parsedKey||void 0},set:function(e){this._parsedKey=e}},{key:"fromSchema",value:function(e){Ge(e,ms);var t=ra(e,e,n.schema({names:{algorithm:{names:{blockName:hs}},subjectPublicKey:fs}}));ca.assertSchema(t,this.className),this.algorithm=new Ha({schema:t.result.algorithm}),this.subjectPublicKey=t.result.subjectPublicKey}},{key:"toSchema",value:function(){return new sr({value:[this.algorithm.toSchema(),this.subjectPublicKey]})}},{key:"toJSON",value:function(){if(!this.parsedKey)return{algorithm:this.algorithm.toJSON(),subjectPublicKey:this.subjectPublicKey.toJSON()};var e={};switch(this.algorithm.algorithmId){case"1.2.840.10045.2.1":e.kty="EC";break;case"1.2.840.113549.1.1.1":e.kty="RSA"}var t=this.parsedKey.toJSON();return Object.assign(e,t),e}},{key:"fromJSON",value:function(e){if("kty"in e){switch(e.kty.toUpperCase()){case"EC":this.parsedKey=new ss({json:e}),this.algorithm=new Ha({algorithmId:"1.2.840.10045.2.1",algorithmParams:new $t({value:this.parsedKey.namedCurve})});break;case"RSA":this.parsedKey=new cs({json:e}),this.algorithm=new Ha({algorithmId:"1.2.840.113549.1.1.1",algorithmParams:new Dt});break;default:throw new Error('Invalid value for "kty" parameter: '.concat(e.kty))}this.subjectPublicKey=new _t({valueHex:this.parsedKey.toSchema().toBER(!1)})}}},{key:"importKey",value:(t=s(a().mark((function e(t){var r,n,i,s,u=arguments;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=u.length>1&&void 0!==u[1]?u[1]:bu(!0),e.prev=1,t){e.next=4;break}throw new Error("Need to provide publicKey input parameter");case 4:return e.next=6,r.exportKey("spki",t);case 6:n=e.sent,i=At(n),e.prev=8,this.fromSchema(i.result),e.next=15;break;case 12:throw e.prev=12,e.t0=e.catch(8),new Error("Error during initializing object from schema");case 15:e.next=21;break;case 17:throw e.prev=17,e.t1=e.catch(1),s=e.t1 instanceof Error?e.t1.message:"".concat(e.t1),new Error("Error during exporting public key: ".concat(s));case 21:case"end":return e.stop()}}),e,this,[[1,17],[8,12]])}))),function(e){return t.apply(this,arguments)})}],[{key:"defaultValues",value:function(e){switch(e){case hs:return new Ha;case fs:return new _t;default:return S(f(n),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Oe(e,"names",{});return new sr({name:t.blockName||ua,value:[Ha.schema(t.algorithm||{}),new _t({name:t.subjectPublicKey||ua})]})}}]),n}(ha);vs.CLASS_NAME="PublicKeyInfo";var ds="version",gs="privateKey",ps="namedCurve",ys="publicKey",ks=[ds,gs,ps,ys],ws=function(e){h(r,e);var t=w(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return u(this,r),(e=t.call(this)).version=Oe(a,ds,r.defaultValues(ds)),e.privateKey=Oe(a,gs,r.defaultValues(gs)),ps in a&&(e.namedCurve=Oe(a,ps,r.defaultValues(ps))),ys in a&&(e.publicKey=Oe(a,ys,r.defaultValues(ys))),a.json&&e.fromJSON(a.json),a.schema&&e.fromSchema(a.schema),e}return l(r,[{key:"fromSchema",value:function(e){Ge(e,ks);var t=ra(e,e,r.schema({names:{version:ds,privateKey:gs,namedCurve:ps,publicKey:ys}}));if(ca.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,this.privateKey=t.result.privateKey,ps in t.result&&(this.namedCurve=t.result.namedCurve.valueBlock.toString()),ys in t.result){var a={schema:t.result.publicKey.valueBlock.valueHex};ps in this&&(a.namedCurve=this.namedCurve),this.publicKey=new ss(a)}}},{key:"toSchema",value:function(){var e=[new Gt({value:this.version}),this.privateKey];return this.namedCurve&&e.push(new xt({idBlock:{tagClass:3,tagNumber:0},value:[new $t({value:this.namedCurve})]})),this.publicKey&&e.push(new xt({idBlock:{tagClass:3,tagNumber:1},value:[new _t({valueHex:this.publicKey.toSchema().toBER(!1)})]})),new sr({value:e})}},{key:"toJSON",value:function(){if(!this.namedCurve||r.compareWithDefault(ps,this.namedCurve))throw new Error('Not enough information for making JSON: absent "namedCurve" value');var e=rs.find(this.namedCurve),t={crv:e?e.name:this.namedCurve,d:De.ToBase64Url(this.privateKey.valueBlock.valueHexView)};if(this.publicKey){var a=this.publicKey.toJSON();t.x=a.x,t.y=a.y}return t}},{key:"fromJSON",value:function(e){la.assert("json",e,"crv","d");var t=0,r=rs.find(e.crv);r&&(this.namedCurve=r.id,t=r.size);var a=De.FromBase64Url(e.d);if(a.byteLength<t){var n=new ArrayBuffer(t),i=new Uint8Array(n),s=new Uint8Array(a);i.set(s,1),this.privateKey=new Lt({valueHex:n})}else this.privateKey=new Lt({valueHex:a.slice(0,t)});e.x&&e.y&&(this.publicKey=new ss({json:e}))}}],[{key:"defaultValues",value:function(e){switch(e){case ds:return 1;case gs:return new Lt;case ps:return ua;case ys:return new ss;default:return S(f(r),"defaultValues",this).call(this,e)}}},{key:"compareWithDefault",value:function(e,t){switch(e){case ds:return t===r.defaultValues(e);case gs:return t.isEqual(r.defaultValues(e));case ps:return t===ua;case ys:return ss.compareWithDefault(ps,t.namedCurve)&&ss.compareWithDefault("x",t.x)&&ss.compareWithDefault("y",t.y);default:return S(f(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Oe(e,"names",{});return new sr({name:t.blockName||ua,value:[new Gt({name:t.version||ua}),new Lt({name:t.privateKey||ua}),new xt({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new $t({name:t.namedCurve||ua})]}),new xt({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new _t({name:t.publicKey||ua})]})]})}}]),r}(ha);ws.CLASS_NAME="ECPrivateKey";var bs="prime",Ss="exponent",As="coefficient",Ns=[bs,Ss,As],Cs=function(e){h(r,e);var t=w(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return u(this,r),(e=t.call(this)).prime=Oe(a,bs,r.defaultValues(bs)),e.exponent=Oe(a,Ss,r.defaultValues(Ss)),e.coefficient=Oe(a,As,r.defaultValues(As)),a.json&&e.fromJSON(a.json),a.schema&&e.fromSchema(a.schema),e}return l(r,[{key:"fromSchema",value:function(e){Ge(e,Ns);var t=ra(e,e,r.schema({names:{prime:bs,exponent:Ss,coefficient:As}}));ca.assertSchema(t,this.className),this.prime=t.result.prime.convertFromDER(),this.exponent=t.result.exponent.convertFromDER(),this.coefficient=t.result.coefficient.convertFromDER()}},{key:"toSchema",value:function(){return new sr({value:[this.prime.convertToDER(),this.exponent.convertToDER(),this.coefficient.convertToDER()]})}},{key:"toJSON",value:function(){return{r:De.ToBase64Url(this.prime.valueBlock.valueHexView),d:De.ToBase64Url(this.exponent.valueBlock.valueHexView),t:De.ToBase64Url(this.coefficient.valueBlock.valueHexView)}}},{key:"fromJSON",value:function(e){la.assert("json",e,"r","d","r"),this.prime=new Gt({valueHex:De.FromBase64Url(e.r)}),this.exponent=new Gt({valueHex:De.FromBase64Url(e.d)}),this.coefficient=new Gt({valueHex:De.FromBase64Url(e.t)})}}],[{key:"defaultValues",value:function(e){switch(e){case bs:case Ss:case As:return new Gt;default:return S(f(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Oe(e,"names",{});return new sr({name:t.blockName||ua,value:[new Gt({name:t.prime||ua}),new Gt({name:t.exponent||ua}),new Gt({name:t.coefficient||ua})]})}}]),r}(ha);Cs.CLASS_NAME="OtherPrimeInfo";var xs="version",Es="modulus",Is="publicExponent",Bs="privateExponent",Vs="prime1",Ds="prime2",Os="exponent1",Ps="exponent2",Rs="coefficient",Us="otherPrimeInfos",Ts=[xs,Es,Is,Bs,Vs,Ds,Os,Ps,Rs,Us],Ls=function(e){h(r,e);var t=w(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return u(this,r),(e=t.call(this)).version=Oe(a,xs,r.defaultValues(xs)),e.modulus=Oe(a,Es,r.defaultValues(Es)),e.publicExponent=Oe(a,Is,r.defaultValues(Is)),e.privateExponent=Oe(a,Bs,r.defaultValues(Bs)),e.prime1=Oe(a,Vs,r.defaultValues(Vs)),e.prime2=Oe(a,Ds,r.defaultValues(Ds)),e.exponent1=Oe(a,Os,r.defaultValues(Os)),e.exponent2=Oe(a,Ps,r.defaultValues(Ps)),e.coefficient=Oe(a,Rs,r.defaultValues(Rs)),Us in a&&(e.otherPrimeInfos=Oe(a,Us,r.defaultValues(Us))),a.json&&e.fromJSON(a.json),a.schema&&e.fromSchema(a.schema),e}return l(r,[{key:"fromSchema",value:function(e){Ge(e,Ts);var t=ra(e,e,r.schema({names:{version:xs,modulus:Es,publicExponent:Is,privateExponent:Bs,prime1:Vs,prime2:Ds,exponent1:Os,exponent2:Ps,coefficient:Rs,otherPrimeInfo:{names:{blockName:Us}}}}));ca.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,this.modulus=t.result.modulus.convertFromDER(256),this.publicExponent=t.result.publicExponent,this.privateExponent=t.result.privateExponent.convertFromDER(256),this.prime1=t.result.prime1.convertFromDER(128),this.prime2=t.result.prime2.convertFromDER(128),this.exponent1=t.result.exponent1.convertFromDER(128),this.exponent2=t.result.exponent2.convertFromDER(128),this.coefficient=t.result.coefficient.convertFromDER(128),Us in t.result&&(this.otherPrimeInfos=Array.from(t.result.otherPrimeInfos,(function(e){return new Cs({schema:e})})))}},{key:"toSchema",value:function(){var e=[];return e.push(new Gt({value:this.version})),e.push(this.modulus.convertToDER()),e.push(this.publicExponent),e.push(this.privateExponent.convertToDER()),e.push(this.prime1.convertToDER()),e.push(this.prime2.convertToDER()),e.push(this.exponent1.convertToDER()),e.push(this.exponent2.convertToDER()),e.push(this.coefficient.convertToDER()),this.otherPrimeInfos&&e.push(new sr({value:Array.from(this.otherPrimeInfos,(function(e){return e.toSchema()}))})),new sr({value:e})}},{key:"toJSON",value:function(){var e={n:De.ToBase64Url(this.modulus.valueBlock.valueHexView),e:De.ToBase64Url(this.publicExponent.valueBlock.valueHexView),d:De.ToBase64Url(this.privateExponent.valueBlock.valueHexView),p:De.ToBase64Url(this.prime1.valueBlock.valueHexView),q:De.ToBase64Url(this.prime2.valueBlock.valueHexView),dp:De.ToBase64Url(this.exponent1.valueBlock.valueHexView),dq:De.ToBase64Url(this.exponent2.valueBlock.valueHexView),qi:De.ToBase64Url(this.coefficient.valueBlock.valueHexView)};return this.otherPrimeInfos&&(e.oth=Array.from(this.otherPrimeInfos,(function(e){return e.toJSON()}))),e}},{key:"fromJSON",value:function(e){la.assert("json",e,"n","e","d","p","q","dp","dq","qi"),this.modulus=new Gt({valueHex:De.FromBase64Url(e.n)}),this.publicExponent=new Gt({valueHex:De.FromBase64Url(e.e)}),this.privateExponent=new Gt({valueHex:De.FromBase64Url(e.d)}),this.prime1=new Gt({valueHex:De.FromBase64Url(e.p)}),this.prime2=new Gt({valueHex:De.FromBase64Url(e.q)}),this.exponent1=new Gt({valueHex:De.FromBase64Url(e.dp)}),this.exponent2=new Gt({valueHex:De.FromBase64Url(e.dq)}),this.coefficient=new Gt({valueHex:De.FromBase64Url(e.qi)}),e.oth&&(this.otherPrimeInfos=Array.from(e.oth,(function(e){return new Cs({json:e})})))}}],[{key:"defaultValues",value:function(e){switch(e){case xs:return 0;case Es:case Is:case Bs:case Vs:case Ds:case Os:case Ps:case Rs:return new Gt;case Us:return[];default:return S(f(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Oe(e,"names",{});return new sr({name:t.blockName||ua,value:[new Gt({name:t.version||ua}),new Gt({name:t.modulus||ua}),new Gt({name:t.publicExponent||ua}),new Gt({name:t.privateExponent||ua}),new Gt({name:t.prime1||ua}),new Gt({name:t.prime2||ua}),new Gt({name:t.exponent1||ua}),new Gt({name:t.exponent2||ua}),new Gt({name:t.coefficient||ua}),new sr({optional:!0,value:[new ea({name:t.otherPrimeInfosName||ua,value:Cs.schema(t.otherPrimeInfo||{})})]})]})}}]),r}(ha);Ls.CLASS_NAME="RSAPrivateKey";var Hs="version",Ms="privateKeyAlgorithm",Ks="privateKey",_s="attributes",js="parsedKey",Js=[Hs,Ms,Ks,_s],Fs=function(e){h(r,e);var t=w(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return u(this,r),(e=t.call(this)).version=Oe(a,Hs,r.defaultValues(Hs)),e.privateKeyAlgorithm=Oe(a,Ms,r.defaultValues(Ms)),e.privateKey=Oe(a,Ks,r.defaultValues(Ks)),_s in a&&(e.attributes=Oe(a,_s,r.defaultValues(_s))),js in a&&(e.parsedKey=Oe(a,js,r.defaultValues(js))),a.json&&e.fromJSON(a.json),a.schema&&e.fromSchema(a.schema),e}return l(r,[{key:"fromSchema",value:function(e){Ge(e,Js);var t=ra(e,e,r.schema({names:{version:Hs,privateKeyAlgorithm:{names:{blockName:Ms}},privateKey:Ks,attributes:_s}}));switch(ca.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,this.privateKeyAlgorithm=new Ha({schema:t.result.privateKeyAlgorithm}),this.privateKey=t.result.privateKey,_s in t.result&&(this.attributes=Array.from(t.result.attributes,(function(e){return new qa({schema:e})}))),this.privateKeyAlgorithm.algorithmId){case"1.2.840.113549.1.1.1":var a=At(this.privateKey.valueBlock.valueHexView);-1!==a.offset&&(this.parsedKey=new Ls({schema:a.result}));break;case"1.2.840.10045.2.1":if("algorithmParams"in this.privateKeyAlgorithm&&this.privateKeyAlgorithm.algorithmParams instanceof $t){var n=At(this.privateKey.valueBlock.valueHexView);-1!==n.offset&&(this.parsedKey=new ws({namedCurve:this.privateKeyAlgorithm.algorithmParams.valueBlock.toString(),schema:n.result}))}}}},{key:"toSchema",value:function(){var e=[new Gt({value:this.version}),this.privateKeyAlgorithm.toSchema(),this.privateKey];return this.attributes&&e.push(new xt({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:Array.from(this.attributes,(function(e){return e.toSchema()}))})),new sr({value:e})}},{key:"toJSON",value:function(){if(!this.parsedKey){var e={version:this.version,privateKeyAlgorithm:this.privateKeyAlgorithm.toJSON(),privateKey:this.privateKey.toJSON()};return this.attributes&&(e.attributes=Array.from(this.attributes,(function(e){return e.toJSON()}))),e}var t={};switch(this.privateKeyAlgorithm.algorithmId){case"1.2.840.10045.2.1":t.kty="EC";break;case"1.2.840.113549.1.1.1":t.kty="RSA"}var r=this.parsedKey.toJSON();return Object.assign(t,r),t}},{key:"fromJSON",value:function(e){if("kty"in e){switch(e.kty.toUpperCase()){case"EC":this.parsedKey=new ws({json:e}),this.privateKeyAlgorithm=new Ha({algorithmId:"1.2.840.10045.2.1",algorithmParams:new $t({value:this.parsedKey.namedCurve})});break;case"RSA":this.parsedKey=new Ls({json:e}),this.privateKeyAlgorithm=new Ha({algorithmId:"1.2.840.113549.1.1.1",algorithmParams:new Dt});break;default:throw new Error('Invalid value for "kty" parameter: '.concat(e.kty))}this.privateKey=new Lt({valueHex:this.parsedKey.toSchema().toBER(!1)})}}}],[{key:"defaultValues",value:function(e){switch(e){case Hs:return 0;case Ms:return new Ha;case Ks:return new Lt;case _s:return[];case js:return{};default:return S(f(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Oe(e,"names",{});return new sr({name:t.blockName||ua,value:[new Gt({name:t.version||ua}),Ha.schema(t.privateKeyAlgorithm||{}),new Lt({name:t.privateKey||ua}),new xt({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new ea({name:t.attributes||ua,value:qa.schema()})]})]})}}]),r}(ha);Fs.CLASS_NAME="PrivateKeyInfo";var qs="contentType",Xs="contentEncryptionAlgorithm",Ws="encryptedContent",Gs=[qs,Xs,Ws],zs=function(e){h(r,e);var t=w(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(u(this,r),(e=t.call(this)).contentType=Oe(a,qs,r.defaultValues(qs)),e.contentEncryptionAlgorithm=Oe(a,Xs,r.defaultValues(Xs)),Ws in a&&a.encryptedContent&&(e.encryptedContent=a.encryptedContent,1===e.encryptedContent.idBlock.tagClass&&4===e.encryptedContent.idBlock.tagNumber&&!1===e.encryptedContent.idBlock.isConstructed)){for(var n=new Lt({idBlock:{isConstructed:!0},isConstructed:!0}),i=0,s=e.encryptedContent.valueBlock.valueHexView.slice().buffer,o=s.byteLength,l=1024;o>0;){for(var c=new Uint8Array(s,i,i+l>s.byteLength?s.byteLength-i:l),h=new ArrayBuffer(c.length),f=new Uint8Array(h),m=0;m<f.length;m++)f[m]=c[m];n.valueBlock.value.push(new Lt({valueHex:h})),o-=c.length,i+=c.length}e.encryptedContent=n}return a.schema&&e.fromSchema(a.schema),e}return l(r,[{key:"fromSchema",value:function(e){Ge(e,Gs);var t=ra(e,e,r.schema({names:{contentType:qs,contentEncryptionAlgorithm:{names:{blockName:Xs}},encryptedContent:Ws}}));ca.assertSchema(t,this.className),this.contentType=t.result.contentType.valueBlock.toString(),this.contentEncryptionAlgorithm=new Ha({schema:t.result.contentEncryptionAlgorithm}),Ws in t.result&&(this.encryptedContent=t.result.encryptedContent,this.encryptedContent.idBlock.tagClass=1,this.encryptedContent.idBlock.tagNumber=4)}},{key:"toSchema",value:function(){var e={isIndefiniteForm:!1},t=[];if(t.push(new $t({value:this.contentType})),t.push(this.contentEncryptionAlgorithm.toSchema()),this.encryptedContent){e.isIndefiniteForm=this.encryptedContent.idBlock.isConstructed;var r=this.encryptedContent;r.idBlock.tagClass=3,r.idBlock.tagNumber=0,r.lenBlock.isIndefiniteForm=this.encryptedContent.idBlock.isConstructed,t.push(r)}return new sr({lenBlock:e,value:t})}},{key:"toJSON",value:function(){var e={contentType:this.contentType,contentEncryptionAlgorithm:this.contentEncryptionAlgorithm.toJSON()};return this.encryptedContent&&(e.encryptedContent=this.encryptedContent.toJSON()),e}},{key:"getEncryptedContent",value:function(){if(!this.encryptedContent)throw new Error("Parameter 'encryptedContent' is undefined");return Lt.prototype.getValue.call(this.encryptedContent)}}],[{key:"defaultValues",value:function(e){switch(e){case qs:return ua;case Xs:return new Ha;case Ws:return new Lt;default:return S(f(r),"defaultValues",this).call(this,e)}}},{key:"compareWithDefault",value:function(e,t){switch(e){case qs:return t===ua;case Xs:return t.algorithmId===ua&&"algorithmParams"in t==!1;case Ws:return t.isEqual(r.defaultValues(Ws));default:return S(f(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Oe(e,"names",{});return new sr({name:t.blockName||ua,value:[new $t({name:t.contentType||ua}),Ha.schema(t.contentEncryptionAlgorithm||{}),new $r({value:[new xt({name:t.encryptedContent||ua,idBlock:{tagClass:3,tagNumber:0},value:[new ea({value:new Lt})]}),new wt({name:t.encryptedContent||ua,idBlock:{tagClass:3,tagNumber:0}})]})]})}}]),r}(ha);zs.CLASS_NAME="EncryptedContentInfo";var Qs="hashAlgorithm",Ys="maskGenAlgorithm",Zs="saltLength",$s="trailerField",eu=[Qs,Ys,Zs,$s],tu=function(e){h(r,e);var t=w(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return u(this,r),(e=t.call(this)).hashAlgorithm=Oe(a,Qs,r.defaultValues(Qs)),e.maskGenAlgorithm=Oe(a,Ys,r.defaultValues(Ys)),e.saltLength=Oe(a,Zs,r.defaultValues(Zs)),e.trailerField=Oe(a,$s,r.defaultValues($s)),a.schema&&e.fromSchema(a.schema),e}return l(r,[{key:"fromSchema",value:function(e){Ge(e,eu);var t=ra(e,e,r.schema({names:{hashAlgorithm:{names:{blockName:Qs}},maskGenAlgorithm:{names:{blockName:Ys}},saltLength:Zs,trailerField:$s}}));ca.assertSchema(t,this.className),Qs in t.result&&(this.hashAlgorithm=new Ha({schema:t.result.hashAlgorithm})),Ys in t.result&&(this.maskGenAlgorithm=new Ha({schema:t.result.maskGenAlgorithm})),Zs in t.result&&(this.saltLength=t.result.saltLength.valueBlock.valueDec),$s in t.result&&(this.trailerField=t.result.trailerField.valueBlock.valueDec)}},{key:"toSchema",value:function(){var e=[];return this.hashAlgorithm.isEqual(r.defaultValues(Qs))||e.push(new xt({idBlock:{tagClass:3,tagNumber:0},value:[this.hashAlgorithm.toSchema()]})),this.maskGenAlgorithm.isEqual(r.defaultValues(Ys))||e.push(new xt({idBlock:{tagClass:3,tagNumber:1},value:[this.maskGenAlgorithm.toSchema()]})),this.saltLength!==r.defaultValues(Zs)&&e.push(new xt({idBlock:{tagClass:3,tagNumber:2},value:[new Gt({value:this.saltLength})]})),this.trailerField!==r.defaultValues($s)&&e.push(new xt({idBlock:{tagClass:3,tagNumber:3},value:[new Gt({value:this.trailerField})]})),new sr({value:e})}},{key:"toJSON",value:function(){var e={};return this.hashAlgorithm.isEqual(r.defaultValues(Qs))||(e.hashAlgorithm=this.hashAlgorithm.toJSON()),this.maskGenAlgorithm.isEqual(r.defaultValues(Ys))||(e.maskGenAlgorithm=this.maskGenAlgorithm.toJSON()),this.saltLength!==r.defaultValues(Zs)&&(e.saltLength=this.saltLength),this.trailerField!==r.defaultValues($s)&&(e.trailerField=this.trailerField),e}}],[{key:"defaultValues",value:function(e){switch(e){case Qs:return new Ha({algorithmId:"1.3.14.3.2.26",algorithmParams:new Dt});case Ys:return new Ha({algorithmId:"1.2.840.113549.1.1.8",algorithmParams:new Ha({algorithmId:"1.3.14.3.2.26",algorithmParams:new Dt}).toSchema()});case Zs:return 20;case $s:return 1;default:return S(f(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Oe(e,"names",{});return new sr({name:t.blockName||ua,value:[new xt({idBlock:{tagClass:3,tagNumber:0},optional:!0,value:[Ha.schema(t.hashAlgorithm||{})]}),new xt({idBlock:{tagClass:3,tagNumber:1},optional:!0,value:[Ha.schema(t.maskGenAlgorithm||{})]}),new xt({idBlock:{tagClass:3,tagNumber:2},optional:!0,value:[new Gt({name:t.saltLength||ua})]}),new xt({idBlock:{tagClass:3,tagNumber:3},optional:!0,value:[new Gt({name:t.trailerField||ua})]})]})}}]),r}(ha);tu.CLASS_NAME="RSASSAPSSParams";var ru="salt",au="iterationCount",nu="keyLength",iu="prf",su=[ru,au,nu,iu],uu=function(e){h(r,e);var t=w(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return u(this,r),(e=t.call(this)).salt=Oe(a,ru,r.defaultValues(ru)),e.iterationCount=Oe(a,au,r.defaultValues(au)),nu in a&&(e.keyLength=Oe(a,nu,r.defaultValues(nu))),iu in a&&(e.prf=Oe(a,iu,r.defaultValues(iu))),a.schema&&e.fromSchema(a.schema),e}return l(r,[{key:"fromSchema",value:function(e){Ge(e,su);var t=ra(e,e,r.schema({names:{saltPrimitive:ru,saltConstructed:{names:{blockName:ru}},iterationCount:au,keyLength:nu,prf:{names:{blockName:iu,optional:!0}}}}));ca.assertSchema(t,this.className),this.salt=t.result.salt,this.iterationCount=t.result.iterationCount.valueBlock.valueDec,nu in t.result&&(this.keyLength=t.result.keyLength.valueBlock.valueDec),iu in t.result&&(this.prf=new Ha({schema:t.result.prf}))}},{key:"toSchema",value:function(){var e=[];return e.push(this.salt),e.push(new Gt({value:this.iterationCount})),nu in this&&r.defaultValues(nu)!==this.keyLength&&e.push(new Gt({value:this.keyLength})),this.prf&&!1===r.defaultValues(iu).isEqual(this.prf)&&e.push(this.prf.toSchema()),new sr({value:e})}},{key:"toJSON",value:function(){var e={salt:this.salt.toJSON(),iterationCount:this.iterationCount};return nu in this&&r.defaultValues(nu)!==this.keyLength&&(e.keyLength=this.keyLength),this.prf&&!1===r.defaultValues(iu).isEqual(this.prf)&&(e.prf=this.prf.toJSON()),e}}],[{key:"defaultValues",value:function(e){switch(e){case ru:return{};case au:return-1;case nu:return 0;case iu:return new Ha({algorithmId:"1.3.14.3.2.26",algorithmParams:new Dt});default:return S(f(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Oe(e,"names",{});return new sr({name:t.blockName||ua,value:[new $r({value:[new Lt({name:t.saltPrimitive||ua}),Ha.schema(t.saltConstructed||{})]}),new Gt({name:t.iterationCount||ua}),new Gt({name:t.keyLength||ua,optional:!0}),Ha.schema(t.prf||{names:{optional:!0}})]})}}]),r}(ha);uu.CLASS_NAME="PBKDF2Params";var ou="keyDerivationFunc",lu="encryptionScheme",cu=[ou,lu],hu=function(e){h(r,e);var t=w(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return u(this,r),(e=t.call(this)).keyDerivationFunc=Oe(a,ou,r.defaultValues(ou)),e.encryptionScheme=Oe(a,lu,r.defaultValues(lu)),a.schema&&e.fromSchema(a.schema),e}return l(r,[{key:"fromSchema",value:function(e){Ge(e,cu);var t=ra(e,e,r.schema({names:{keyDerivationFunc:{names:{blockName:ou}},encryptionScheme:{names:{blockName:lu}}}}));ca.assertSchema(t,this.className),this.keyDerivationFunc=new Ha({schema:t.result.keyDerivationFunc}),this.encryptionScheme=new Ha({schema:t.result.encryptionScheme})}},{key:"toSchema",value:function(){return new sr({value:[this.keyDerivationFunc.toSchema(),this.encryptionScheme.toSchema()]})}},{key:"toJSON",value:function(){return{keyDerivationFunc:this.keyDerivationFunc.toJSON(),encryptionScheme:this.encryptionScheme.toJSON()}}}],[{key:"defaultValues",value:function(e){switch(e){case ou:case lu:return new Ha;default:return S(f(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Oe(e,"names",{});return new sr({name:t.blockName||ua,value:[Ha.schema(t.keyDerivationFunc||{}),Ha.schema(t.encryptionScheme||{})]})}}]),r}(ha);hu.CLASS_NAME="PBES2Params";var fu=function(){function e(t){u(this,e),this.crypto=t.crypto,this.subtle="webkitSubtle"in t.crypto?t.crypto.webkitSubtle:t.crypto.subtle,this.name=Oe(t,"name",ua)}var t,r,n,i,o,c,h,f,m;return l(e,[{key:"encrypt",value:(m=s(a().mark((function e(){var t,r=arguments;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(t=this.subtle).encrypt.apply(t,r));case 1:case"end":return e.stop()}}),e,this)}))),function(){return m.apply(this,arguments)})},{key:"decrypt",value:(f=s(a().mark((function e(){var t,r=arguments;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(t=this.subtle).decrypt.apply(t,r));case 1:case"end":return e.stop()}}),e,this)}))),function(){return f.apply(this,arguments)})},{key:"sign",value:function(){var e;return(e=this.subtle).sign.apply(e,arguments)}},{key:"verify",value:(h=s(a().mark((function e(){var t,r=arguments;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(t=this.subtle).verify.apply(t,r));case 1:case"end":return e.stop()}}),e,this)}))),function(){return h.apply(this,arguments)})},{key:"digest",value:(c=s(a().mark((function e(){var t,r=arguments;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(t=this.subtle).digest.apply(t,r));case 1:case"end":return e.stop()}}),e,this)}))),function(){return c.apply(this,arguments)})},{key:"generateKey",value:(o=s(a().mark((function e(){var t,r=arguments;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(t=this.subtle).generateKey.apply(t,r));case 1:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)})},{key:"deriveKey",value:(i=s(a().mark((function e(){var t,r=arguments;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(t=this.subtle).deriveKey.apply(t,r));case 1:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"deriveBits",value:(n=s(a().mark((function e(){var t,r=arguments;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(t=this.subtle).deriveBits.apply(t,r));case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"wrapKey",value:(r=s(a().mark((function e(){var t,r=arguments;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(t=this.subtle).wrapKey.apply(t,r));case 1:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"unwrapKey",value:(t=s(a().mark((function e(){var t,r=arguments;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(t=this.subtle).unwrapKey.apply(t,r));case 1:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"exportKey",value:function(){var e;return(e=this.subtle).exportKey.apply(e,arguments)}},{key:"importKey",value:function(){var e;return(e=this.subtle).importKey.apply(e,arguments)}},{key:"getRandomValues",value:function(e){return this.crypto.getRandomValues(e)}}]),e}();function mu(e,t,r,a,n,i){return vu.apply(this,arguments)}function vu(){return(vu=s(a().mark((function e(t,r,n,i,s,u){var o,l,c,h,f,m,v,d,g,p,y,k,w,b,S,A,C,x,E,I,B,V,D,O,P,R,U,T,L;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:c=[],e.t0=r.toUpperCase(),e.next="SHA-1"===e.t0?4:"SHA-256"===e.t0?7:"SHA-384"===e.t0?10:"SHA-512"===e.t0?13:16;break;case 4:return o=20,l=64,e.abrupt("break",17);case 7:return o=32,l=64,e.abrupt("break",17);case 10:return o=48,l=128,e.abrupt("break",17);case 13:return o=64,l=128,e.abrupt("break",17);case 16:throw new Error("Unsupported hashing algorithm");case 17:for(h=new Uint8Array(i),f=new ArrayBuffer(2*i.byteLength+2),m=new Uint8Array(f),v=0;v<h.length;v++)m[2*v]=0,m[2*v+1]=h[v];for(m[m.length-2]=0,m[m.length-1]=0,i=f.slice(0),d=new ArrayBuffer(l),g=new Uint8Array(d),p=0;p<d.byteLength;p++)g[p]=3;for(y=s.byteLength,k=l*Math.ceil(y/l),w=new ArrayBuffer(k),b=new Uint8Array(w),S=new Uint8Array(s),A=0;A<k;A++)b[A]=S[A%y];for(C=i.byteLength,x=l*Math.ceil(C/l),E=new ArrayBuffer(x),I=new Uint8Array(E),B=new Uint8Array(i),V=0;V<x;V++)I[V]=B[V%C];for(D=w.byteLength+E.byteLength,O=new ArrayBuffer(D),(P=new Uint8Array(O)).set(b),P.set(I,b.length),R=Math.ceil((n>>3)/o),U=Promise.resolve(O),T=0;T<=R;T++){for(U=U.then((function(e){var t=new ArrayBuffer(d.byteLength+e.byteLength),r=new Uint8Array(t);return r.set(g),r.set(P,g.length),t})),L=0;L<u;L++)U=U.then((function(e){return t.digest({name:r},new Uint8Array(e))}));U=U.then((function(e){for(var t=new ArrayBuffer(l),r=new Uint8Array(t),a=0;a<t.byteLength;a++)r[a]=e[a%e.byteLength];for(var n=Math.ceil(y/l)+Math.ceil(C/l),i=[],s=0,u=l,o=0;o<n;o++){var h=Array.from(new Uint8Array(O.slice(s,s+u)));(s+=l)+l>O.byteLength&&(u=O.byteLength-s);for(var f=511,m=t.byteLength-1;m>=0;m--)f>>=8,f+=r[m]+h[m],h[m]=255&f;i.push.apply(i,h)}return O=new ArrayBuffer(i.length),(P=new Uint8Array(O)).set(i),c.push.apply(c,N(new Uint8Array(e))),O}))}return U=U.then((function(){var e=new ArrayBuffer(n>>3);return new Uint8Array(e).set(new Uint8Array(c).slice(0,n>>3)),e})),e.abrupt("return",U);case 49:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function du(e){var t="string"==typeof e?{name:e}:e;return"hash"in t?r(r({},t),{},{hash:du(t.hash)}):t}var gu=function(e){h(y,e);var t,r,n,i,o,c,f,m,v,d,g,p=w(y);function y(){return u(this,y),p.apply(this,arguments)}return l(y,[{key:"importKey",value:(g=s(a().mark((function e(t,r,n,i,s){var u,o,l,c,h,f,m,v,d,g,p,y,k,w,b,S,A,N,C,x;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:m={},v=du(n),e.t0=t.toLowerCase(),e.next="raw"===e.t0?5:"spki"===e.t0?6:"pkcs8"===e.t0?97:"jwk"===e.t0?185:187;break;case 5:return e.abrupt("return",this.subtle.importKey("raw",r,n,i,s));case 6:d=At(Ie.toArrayBuffer(r)),ca.assert(d,"keyData"),g=new vs,e.prev=9,g.fromSchema(d.result),e.next=16;break;case 13:throw e.prev=13,e.t1=e.catch(9),new oa("Incorrect keyData");case 16:e.t2=v.name.toUpperCase(),e.next="RSA-PSS"===e.t2?19:"RSASSA-PKCS1-V1_5"===e.t2?33:"ECDSA"===e.t2?57:"ECDH"===e.t2?58:"RSA-OAEP"===e.t2?64:"RSAES-PKCS1-V1_5"===e.t2?88:95;break;case 19:if(v.hash){e.next=21;break}throw new la("hash","algorithm.hash","Incorrect hash algorithm: Hash algorithm is missed");case 21:e.t3=v.hash.name.toUpperCase(),e.next="SHA-1"===e.t3?24:"SHA-256"===e.t3?26:"SHA-384"===e.t3?28:"SHA-512"===e.t3?30:32;break;case 24:return m.alg="PS1",e.abrupt("break",33);case 26:return m.alg="PS256",e.abrupt("break",33);case 28:return m.alg="PS384",e.abrupt("break",33);case 30:return m.alg="PS512",e.abrupt("break",33);case 32:throw new Error("Incorrect hash algorithm: ".concat(v.hash.name.toUpperCase()));case 33:if(s=["verify"],m.kty="RSA",m.ext=i,m.key_ops=s,"1.2.840.113549.1.1.1"===g.algorithm.algorithmId){e.next=39;break}throw new Error("Incorrect public key algorithm: ".concat(g.algorithm.algorithmId));case 39:if(m.alg){e.next=54;break}if(v.hash){e.next=42;break}throw new la("hash","algorithm.hash","Incorrect hash algorithm: Hash algorithm is missed");case 42:e.t4=v.hash.name.toUpperCase(),e.next="SHA-1"===e.t4?45:"SHA-256"===e.t4?47:"SHA-384"===e.t4?49:"SHA-512"===e.t4?51:53;break;case 45:return m.alg="RS1",e.abrupt("break",54);case 47:return m.alg="RS256",e.abrupt("break",54);case 49:return m.alg="RS384",e.abrupt("break",54);case 51:return m.alg="RS512",e.abrupt("break",54);case 53:throw new Error("Incorrect hash algorithm: ".concat(v.hash.name.toUpperCase()));case 54:return p=g.toJSON(),Object.assign(m,p),e.abrupt("break",96);case 57:s=["verify"];case 58:if(m={kty:"EC",ext:i,key_ops:s},"1.2.840.10045.2.1"===g.algorithm.algorithmId){e.next=61;break}throw new Error("Incorrect public key algorithm: ".concat(g.algorithm.algorithmId));case 61:return y=g.toJSON(),Object.assign(m,y),e.abrupt("break",96);case 64:if(m.kty="RSA",m.ext=i,m.key_ops=s,"safari"!==this.name.toLowerCase()){e.next=71;break}m.alg="RSA-OAEP",e.next=85;break;case 71:if(v.hash){e.next=73;break}throw new la("hash","algorithm.hash","Incorrect hash algorithm: Hash algorithm is missed");case 73:e.t5=v.hash.name.toUpperCase(),e.next="SHA-1"===e.t5?76:"SHA-256"===e.t5?78:"SHA-384"===e.t5?80:"SHA-512"===e.t5?82:84;break;case 76:return m.alg="RSA-OAEP",e.abrupt("break",85);case 78:return m.alg="RSA-OAEP-256",e.abrupt("break",85);case 80:return m.alg="RSA-OAEP-384",e.abrupt("break",85);case 82:return m.alg="RSA-OAEP-512",e.abrupt("break",85);case 84:throw new Error("Incorrect hash algorithm: ".concat(v.hash.name.toUpperCase()));case 85:return k=g.toJSON(),Object.assign(m,k),e.abrupt("break",96);case 88:return m.kty="RSA",m.ext=i,m.key_ops=s,m.alg="PS1",w=g.toJSON(),Object.assign(m,w),e.abrupt("break",96);case 95:throw new Error("Incorrect algorithm name: ".concat(v.name.toUpperCase()));case 96:return e.abrupt("break",188);case 97:b=new Fs,S=At(Ie.toArrayBuffer(r)),ca.assert(S,"keyData"),e.prev=100,b.fromSchema(S.result),e.next=107;break;case 104:throw e.prev=104,e.t6=e.catch(100),new Error("Incorrect keyData");case 107:if(b.parsedKey){e.next=109;break}throw new Error("Incorrect keyData");case 109:e.t7=v.name.toUpperCase(),e.next="RSA-PSS"===e.t7?112:"RSASSA-PKCS1-V1_5"===e.t7?124:"ECDSA"===e.t7?146:"ECDH"===e.t7?147:"RSA-OAEP"===e.t7?153:"RSAES-PKCS1-V1_5"===e.t7?175:183;break;case 112:e.t8=null===(u=v.hash)||void 0===u?void 0:u.name.toUpperCase(),e.next="SHA-1"===e.t8?115:"SHA-256"===e.t8?117:"SHA-384"===e.t8?119:"SHA-512"===e.t8?121:123;break;case 115:return m.alg="PS1",e.abrupt("break",124);case 117:return m.alg="PS256",e.abrupt("break",124);case 119:return m.alg="PS384",e.abrupt("break",124);case 121:return m.alg="PS512",e.abrupt("break",124);case 123:throw new Error("Incorrect hash algorithm: ".concat(null===(o=v.hash)||void 0===o?void 0:o.name.toUpperCase()));case 124:if(s=["sign"],m.kty="RSA",m.ext=i,m.key_ops=s,"1.2.840.113549.1.1.1"===b.privateKeyAlgorithm.algorithmId){e.next=130;break}throw new Error("Incorrect private key algorithm: ".concat(b.privateKeyAlgorithm.algorithmId));case 130:if("alg"in m!=0){e.next=143;break}e.t9=null===(l=v.hash)||void 0===l?void 0:l.name.toUpperCase(),e.next="SHA-1"===e.t9?134:"SHA-256"===e.t9?136:"SHA-384"===e.t9?138:"SHA-512"===e.t9?140:142;break;case 134:return m.alg="RS1",e.abrupt("break",143);case 136:return m.alg="RS256",e.abrupt("break",143);case 138:return m.alg="RS384",e.abrupt("break",143);case 140:return m.alg="RS512",e.abrupt("break",143);case 142:throw new Error("Incorrect hash algorithm: ".concat(null===(c=v.hash)||void 0===c?void 0:c.name.toUpperCase()));case 143:return A=b.toJSON(),Object.assign(m,A),e.abrupt("break",184);case 146:s=["sign"];case 147:if(m={kty:"EC",ext:i,key_ops:s},"1.2.840.10045.2.1"===b.privateKeyAlgorithm.algorithmId){e.next=150;break}throw new Error("Incorrect algorithm: ".concat(b.privateKeyAlgorithm.algorithmId));case 150:return N=b.toJSON(),Object.assign(m,N),e.abrupt("break",184);case 153:if(m.kty="RSA",m.ext=i,m.key_ops=s,"safari"!==this.name.toLowerCase()){e.next=160;break}m.alg="RSA-OAEP",e.next=172;break;case 160:e.t10=null===(h=v.hash)||void 0===h?void 0:h.name.toUpperCase(),e.next="SHA-1"===e.t10?163:"SHA-256"===e.t10?165:"SHA-384"===e.t10?167:"SHA-512"===e.t10?169:171;break;case 163:return m.alg="RSA-OAEP",e.abrupt("break",172);case 165:return m.alg="RSA-OAEP-256",e.abrupt("break",172);case 167:return m.alg="RSA-OAEP-384",e.abrupt("break",172);case 169:return m.alg="RSA-OAEP-512",e.abrupt("break",172);case 171:throw new Error("Incorrect hash algorithm: ".concat(null===(f=v.hash)||void 0===f?void 0:f.name.toUpperCase()));case 172:return C=b.toJSON(),Object.assign(m,C),e.abrupt("break",184);case 175:return s=["decrypt"],m.kty="RSA",m.ext=i,m.key_ops=s,m.alg="PS1",x=b.toJSON(),Object.assign(m,x),e.abrupt("break",184);case 183:throw new Error("Incorrect algorithm name: ".concat(v.name.toUpperCase()));case 184:return e.abrupt("break",188);case 185:return m=r,e.abrupt("break",188);case 187:throw new Error("Incorrect format: ".concat(t));case 188:if("safari"!==this.name.toLowerCase()){e.next=196;break}return e.prev=189,e.abrupt("return",this.subtle.importKey("jwk",Xe(JSON.stringify(m)),n,i,s));case 193:return e.prev=193,e.t11=e.catch(189),e.abrupt("return",this.subtle.importKey("jwk",m,n,i,s));case 196:return e.abrupt("return",this.subtle.importKey("jwk",m,n,i,s));case 197:case"end":return e.stop()}}),e,this,[[9,13],[100,104],[189,193]])}))),function(e,t,r,a,n){return g.apply(this,arguments)})},{key:"exportKey",value:(d=s(a().mark((function e(t,r){var n,i,s;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.subtle.exportKey("jwk",r);case 2:n=e.sent,"safari"===this.name.toLowerCase()&&n instanceof ArrayBuffer&&(n=JSON.parse(qe(n))),e.t0=t.toLowerCase(),e.next="raw"===e.t0?7:"spki"===e.t0?8:"pkcs8"===e.t0?17:"jwk"===e.t0?26:27;break;case 7:return e.abrupt("return",this.subtle.exportKey("raw",r));case 8:i=new vs,e.prev=9,i.fromJSON(n),e.next=16;break;case 13:throw e.prev=13,e.t1=e.catch(9),new Error("Incorrect key data");case 16:return e.abrupt("return",i.toSchema().toBER(!1));case 17:s=new Fs,e.prev=18,s.fromJSON(n),e.next=25;break;case 22:throw e.prev=22,e.t2=e.catch(18),new Error("Incorrect key data");case 25:return e.abrupt("return",s.toSchema().toBER(!1));case 26:return e.abrupt("return",n);case 27:throw new Error("Incorrect format: ".concat(t));case 28:case"end":return e.stop()}}),e,this,[[9,13],[18,22]])}))),function(e,t){return d.apply(this,arguments)})},{key:"convert",value:(v=s(a().mark((function e(t,r,n,i,s,u){var o;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.toLowerCase()!==r.toLowerCase()){e.next=2;break}return e.abrupt("return",n);case 2:return e.next=4,this.importKey(t,n,i,s,u);case 4:return o=e.sent,e.abrupt("return",this.exportKey(r,o));case 6:case"end":return e.stop()}}),e,this)}))),function(e,t,r,a,n,i){return v.apply(this,arguments)})},{key:"getAlgorithmByOID",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2?arguments[2]:void 0;switch(e){case"1.2.840.113549.1.1.1":return{name:"RSAES-PKCS1-v1_5"};case"1.2.840.113549.1.1.5":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-1"}};case"1.2.840.113549.1.1.11":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"1.2.840.113549.1.1.12":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-384"}};case"1.2.840.113549.1.1.13":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-512"}};case"1.2.840.113549.1.1.10":return{name:"RSA-PSS"};case"1.2.840.113549.1.1.7":return{name:"RSA-OAEP"};case"1.2.840.10045.2.1":case"1.2.840.10045.4.1":return{name:"ECDSA",hash:{name:"SHA-1"}};case"1.2.840.10045.4.3.2":return{name:"ECDSA",hash:{name:"SHA-256"}};case"1.2.840.10045.4.3.3":return{name:"ECDSA",hash:{name:"SHA-384"}};case"1.2.840.10045.4.3.4":return{name:"ECDSA",hash:{name:"SHA-512"}};case"1.3.133.16.840.63.0.2":return{name:"ECDH",kdf:"SHA-1"};case"1.3.132.1.11.1":return{name:"ECDH",kdf:"SHA-256"};case"1.3.132.1.11.2":return{name:"ECDH",kdf:"SHA-384"};case"1.3.132.1.11.3":return{name:"ECDH",kdf:"SHA-512"};case"2.16.840.1.101.3.4.1.2":return{name:"AES-CBC",length:128};case"2.16.840.1.101.3.4.1.22":return{name:"AES-CBC",length:192};case"2.16.840.1.101.3.4.1.42":return{name:"AES-CBC",length:256};case"2.16.840.1.101.3.4.1.6":return{name:"AES-GCM",length:128};case"2.16.840.1.101.3.4.1.26":return{name:"AES-GCM",length:192};case"2.16.840.1.101.3.4.1.46":return{name:"AES-GCM",length:256};case"2.16.840.1.101.3.4.1.4":return{name:"AES-CFB",length:128};case"2.16.840.1.101.3.4.1.24":return{name:"AES-CFB",length:192};case"2.16.840.1.101.3.4.1.44":return{name:"AES-CFB",length:256};case"2.16.840.1.101.3.4.1.5":return{name:"AES-KW",length:128};case"2.16.840.1.101.3.4.1.25":return{name:"AES-KW",length:192};case"2.16.840.1.101.3.4.1.45":return{name:"AES-KW",length:256};case"1.2.840.113549.2.7":return{name:"HMAC",hash:{name:"SHA-1"}};case"1.2.840.113549.2.9":return{name:"HMAC",hash:{name:"SHA-256"}};case"1.2.840.113549.2.10":return{name:"HMAC",hash:{name:"SHA-384"}};case"1.2.840.113549.2.11":return{name:"HMAC",hash:{name:"SHA-512"}};case"1.2.840.113549.1.9.16.3.5":return{name:"DH"};case"1.3.14.3.2.26":return{name:"SHA-1"};case"2.16.840.1.101.3.4.2.1":return{name:"SHA-256"};case"2.16.840.1.101.3.4.2.2":return{name:"SHA-384"};case"2.16.840.1.101.3.4.2.3":return{name:"SHA-512"};case"1.2.840.113549.1.5.12":return{name:"PBKDF2"};case"1.2.840.10045.3.1.7":return{name:"P-256"};case"1.3.132.0.34":return{name:"P-384"};case"1.3.132.0.35":return{name:"P-521"}}if(t)throw new Error("Unsupported algorithm identifier ".concat(r?"for ".concat(r," "):ua,": ").concat(e));return{}}},{key:"getOIDByAlgorithm",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2?arguments[2]:void 0,a=ua;switch(e.name.toUpperCase()){case"RSAES-PKCS1-V1_5":a="1.2.840.113549.1.1.1";break;case"RSASSA-PKCS1-V1_5":switch(e.hash.name.toUpperCase()){case"SHA-1":a="1.2.840.113549.1.1.5";break;case"SHA-256":a="1.2.840.113549.1.1.11";break;case"SHA-384":a="1.2.840.113549.1.1.12";break;case"SHA-512":a="1.2.840.113549.1.1.13"}break;case"RSA-PSS":a="1.2.840.113549.1.1.10";break;case"RSA-OAEP":a="1.2.840.113549.1.1.7";break;case"ECDSA":switch(e.hash.name.toUpperCase()){case"SHA-1":a="1.2.840.10045.4.1";break;case"SHA-256":a="1.2.840.10045.4.3.2";break;case"SHA-384":a="1.2.840.10045.4.3.3";break;case"SHA-512":a="1.2.840.10045.4.3.4"}break;case"ECDH":switch(e.kdf.toUpperCase()){case"SHA-1":a="1.3.133.16.840.63.0.2";break;case"SHA-256":a="1.3.132.1.11.1";break;case"SHA-384":a="1.3.132.1.11.2";break;case"SHA-512":a="1.3.132.1.11.3"}break;case"AES-CTR":case"AES-CMAC":case"CONCAT":case"HKDF":break;case"AES-CBC":switch(e.length){case 128:a="2.16.840.1.101.3.4.1.2";break;case 192:a="2.16.840.1.101.3.4.1.22";break;case 256:a="2.16.840.1.101.3.4.1.42"}break;case"AES-GCM":switch(e.length){case 128:a="2.16.840.1.101.3.4.1.6";break;case 192:a="2.16.840.1.101.3.4.1.26";break;case 256:a="2.16.840.1.101.3.4.1.46"}break;case"AES-CFB":switch(e.length){case 128:a="2.16.840.1.101.3.4.1.4";break;case 192:a="2.16.840.1.101.3.4.1.24";break;case 256:a="2.16.840.1.101.3.4.1.44"}break;case"AES-KW":switch(e.length){case 128:a="2.16.840.1.101.3.4.1.5";break;case 192:a="2.16.840.1.101.3.4.1.25";break;case 256:a="2.16.840.1.101.3.4.1.45"}break;case"HMAC":switch(e.hash.name.toUpperCase()){case"SHA-1":a="1.2.840.113549.2.7";break;case"SHA-256":a="1.2.840.113549.2.9";break;case"SHA-384":a="1.2.840.113549.2.10";break;case"SHA-512":a="1.2.840.113549.2.11"}break;case"DH":a="1.2.840.113549.1.9.16.3.5";break;case"SHA-1":a="1.3.14.3.2.26";break;case"SHA-256":a="2.16.840.1.101.3.4.2.1";break;case"SHA-384":a="2.16.840.1.101.3.4.2.2";break;case"SHA-512":a="2.16.840.1.101.3.4.2.3";break;case"PBKDF2":a="1.2.840.113549.1.5.12";break;case"P-256":a="1.2.840.10045.3.1.7";break;case"P-384":a="1.3.132.0.34";break;case"P-521":a="1.3.132.0.35"}if(!a&&t)throw new Error("Unsupported algorithm ".concat(r?"for ".concat(r," "):ua,": ").concat(e.name));return a}},{key:"getAlgorithmParameters",value:function(e,t){var r={algorithm:{},usages:[]};switch(e.toUpperCase()){case"RSAES-PKCS1-V1_5":case"RSASSA-PKCS1-V1_5":switch(t.toLowerCase()){case"generatekey":r={algorithm:{name:"RSASSA-PKCS1-v1_5",modulusLength:2048,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},usages:["sign","verify"]};break;case"verify":case"sign":case"importkey":r={algorithm:{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},usages:["verify"]};break;default:return{algorithm:{name:"RSASSA-PKCS1-v1_5"},usages:[]}}break;case"RSA-PSS":switch(t.toLowerCase()){case"sign":case"verify":r={algorithm:{name:"RSA-PSS",hash:{name:"SHA-1"},saltLength:20},usages:["sign","verify"]};break;case"generatekey":r={algorithm:{name:"RSA-PSS",modulusLength:2048,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-1"}},usages:["sign","verify"]};break;case"importkey":r={algorithm:{name:"RSA-PSS",hash:{name:"SHA-1"}},usages:["verify"]};break;default:return{algorithm:{name:"RSA-PSS"},usages:[]}}break;case"RSA-OAEP":switch(t.toLowerCase()){case"encrypt":case"decrypt":r={algorithm:{name:"RSA-OAEP"},usages:["encrypt","decrypt"]};break;case"generatekey":r={algorithm:{name:"RSA-OAEP",modulusLength:2048,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;case"importkey":r={algorithm:{name:"RSA-OAEP",hash:{name:"SHA-256"}},usages:["encrypt"]};break;default:return{algorithm:{name:"RSA-OAEP"},usages:[]}}break;case"ECDSA":switch(t.toLowerCase()){case"generatekey":r={algorithm:{name:"ECDSA",namedCurve:"P-256"},usages:["sign","verify"]};break;case"importkey":r={algorithm:{name:"ECDSA",namedCurve:"P-256"},usages:["verify"]};break;case"verify":case"sign":r={algorithm:{name:"ECDSA",hash:{name:"SHA-256"}},usages:["sign"]};break;default:return{algorithm:{name:"ECDSA"},usages:[]}}break;case"ECDH":switch(t.toLowerCase()){case"exportkey":case"importkey":case"generatekey":r={algorithm:{name:"ECDH",namedCurve:"P-256"},usages:["deriveKey","deriveBits"]};break;case"derivekey":case"derivebits":r={algorithm:{name:"ECDH",namedCurve:"P-256",public:[]},usages:["encrypt","decrypt"]};break;default:return{algorithm:{name:"ECDH"},usages:[]}}break;case"AES-CTR":switch(t.toLowerCase()){case"importkey":case"exportkey":case"generatekey":r={algorithm:{name:"AES-CTR",length:256},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;case"decrypt":case"encrypt":r={algorithm:{name:"AES-CTR",counter:new Uint8Array(16),length:10},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;default:return{algorithm:{name:"AES-CTR"},usages:[]}}break;case"AES-CBC":switch(t.toLowerCase()){case"importkey":case"exportkey":case"generatekey":r={algorithm:{name:"AES-CBC",length:256},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;case"decrypt":case"encrypt":r={algorithm:{name:"AES-CBC",iv:this.getRandomValues(new Uint8Array(16))},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;default:return{algorithm:{name:"AES-CBC"},usages:[]}}break;case"AES-GCM":switch(t.toLowerCase()){case"importkey":case"exportkey":case"generatekey":r={algorithm:{name:"AES-GCM",length:256},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;case"decrypt":case"encrypt":r={algorithm:{name:"AES-GCM",iv:this.getRandomValues(new Uint8Array(16))},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;default:return{algorithm:{name:"AES-GCM"},usages:[]}}break;case"AES-KW":switch(t.toLowerCase()){case"importkey":case"exportkey":case"generatekey":case"wrapkey":case"unwrapkey":r={algorithm:{name:"AES-KW",length:256},usages:["wrapKey","unwrapKey"]};break;default:return{algorithm:{name:"AES-KW"},usages:[]}}break;case"HMAC":switch(t.toLowerCase()){case"sign":case"verify":r={algorithm:{name:"HMAC"},usages:["sign","verify"]};break;case"importkey":case"exportkey":case"generatekey":r={algorithm:{name:"HMAC",length:32,hash:{name:"SHA-256"}},usages:["sign","verify"]};break;default:return{algorithm:{name:"HMAC"},usages:[]}}break;case"HKDF":if("derivekey"!==t.toLowerCase())return{algorithm:{name:"HKDF"},usages:[]};r={algorithm:{name:"HKDF",hash:"SHA-256",salt:new Uint8Array([]),info:new Uint8Array([])},usages:["encrypt","decrypt"]};break;case"PBKDF2":if("derivekey"!==t.toLowerCase())return{algorithm:{name:"PBKDF2"},usages:[]};r={algorithm:{name:"PBKDF2",hash:{name:"SHA-256"},salt:new Uint8Array([]),iterations:1e4},usages:["encrypt","decrypt"]}}return r}},{key:"getHashAlgorithm",value:function(e){var t=ua;switch(e.algorithmId){case"1.2.840.10045.4.1":case"1.2.840.113549.1.1.5":t="SHA-1";break;case"1.2.840.10045.4.3.2":case"1.2.840.113549.1.1.11":t="SHA-256";break;case"1.2.840.10045.4.3.3":case"1.2.840.113549.1.1.12":t="SHA-384";break;case"1.2.840.10045.4.3.4":case"1.2.840.113549.1.1.13":t="SHA-512";break;case"1.2.840.113549.1.1.10":try{var r=new tu({schema:e.algorithmParams});if(r.hashAlgorithm){var a=this.getAlgorithmByOID(r.hashAlgorithm.algorithmId);if(!("name"in a))return ua;t=a.name}else t="SHA-1"}catch(e){}}return t}},{key:"encryptEncryptedContentInfo",value:(m=s(a().mark((function e(t){var r,n,i,s,u,o,l,c,h,f,m,v,d,g;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return la.assert(t,"password","contentEncryptionAlgorithm","hmacHashAlgorithm","iterationCount","contentToEncrypt","contentToEncrypt","contentType"),r=this.getOIDByAlgorithm(t.contentEncryptionAlgorithm,!0,"contentEncryptionAlgorithm"),n=this.getOIDByAlgorithm({name:"PBKDF2"},!0,"PBKDF2"),i=this.getOIDByAlgorithm({name:"HMAC",hash:{name:t.hmacHashAlgorithm}},!0,"hmacHashAlgorithm"),s=new ArrayBuffer(16),u=new Uint8Array(s),this.getRandomValues(u),o=new ArrayBuffer(64),l=new Uint8Array(o),this.getRandomValues(l),c=new Uint8Array(t.contentToEncrypt),h=new uu({salt:new Lt({valueHex:o}),iterationCount:t.iterationCount,prf:new Ha({algorithmId:i,algorithmParams:new Dt})}),f=new Uint8Array(t.password),e.next=15,this.importKey("raw",f,"PBKDF2",!1,["deriveKey"]);case 15:return m=e.sent,e.next=18,this.deriveKey({name:"PBKDF2",hash:{name:t.hmacHashAlgorithm},salt:l,iterations:t.iterationCount},m,t.contentEncryptionAlgorithm,!1,["encrypt"]);case 18:return v=e.sent,e.next=21,this.encrypt({name:t.contentEncryptionAlgorithm.name,iv:u},v,c);case 21:return d=e.sent,g=new hu({keyDerivationFunc:new Ha({algorithmId:n,algorithmParams:h.toSchema()}),encryptionScheme:new Ha({algorithmId:r,algorithmParams:new Lt({valueHex:s})})}),e.abrupt("return",new zs({contentType:t.contentType,contentEncryptionAlgorithm:new Ha({algorithmId:"1.2.840.113549.1.5.13",algorithmParams:g.toSchema()}),encryptedContent:new Lt({valueHex:d})}));case 24:case"end":return e.stop()}}),e,this)}))),function(e){return m.apply(this,arguments)})},{key:"decryptEncryptedContentInfo",value:(f=s(a().mark((function e(t){var r,n,i,s,u,o,l,c,h,f,m,v,d;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(la.assert(t,"password","encryptedContentInfo"),"1.2.840.113549.1.5.13"===t.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId){e.next=3;break}throw new Error('Unknown "contentEncryptionAlgorithm": '.concat(t.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId));case 3:e.prev=3,r=new hu({schema:t.encryptedContentInfo.contentEncryptionAlgorithm.algorithmParams}),e.next=10;break;case 7:throw e.prev=7,e.t0=e.catch(3),new Error('Incorrectly encoded "pbes2Parameters"');case 10:e.prev=10,n=new uu({schema:r.keyDerivationFunc.algorithmParams}),e.next=17;break;case 14:throw e.prev=14,e.t1=e.catch(10),new Error('Incorrectly encoded "pbkdf2Params"');case 17:return i=this.getAlgorithmByOID(r.encryptionScheme.algorithmId,!0),s=r.encryptionScheme.algorithmParams.valueBlock.valueHex,u=new Uint8Array(s),o=n.salt.valueBlock.valueHex,l=new Uint8Array(o),c=n.iterationCount,h="SHA-1",n.prf&&(f=this.getAlgorithmByOID(n.prf.algorithmId,!0),h=f.hash.name),e.next=27,this.importKey("raw",t.password,"PBKDF2",!1,["deriveKey"]);case 27:return m=e.sent,e.next=30,this.deriveKey({name:"PBKDF2",hash:{name:h},salt:l,iterations:c},m,i,!1,["decrypt"]);case 30:return v=e.sent,d=t.encryptedContentInfo.getEncryptedContent(),e.abrupt("return",this.decrypt({name:i.name,iv:u},v,d));case 33:case"end":return e.stop()}}),e,this,[[3,7],[10,14]])}))),function(e){return f.apply(this,arguments)})},{key:"stampDataWithPassword",value:(c=s(a().mark((function e(t){var r,n,i,s;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t instanceof Object!=0){e.next=2;break}throw new Error('Parameters must have type "Object"');case 2:la.assert(t,"password","hashAlgorithm","iterationCount","salt","contentToStamp"),e.t0=t.hashAlgorithm.toLowerCase(),e.next="sha-1"===e.t0?6:"sha-256"===e.t0?8:"sha-384"===e.t0?10:"sha-512"===e.t0?12:14;break;case 6:return r=160,e.abrupt("break",15);case 8:return r=256,e.abrupt("break",15);case 10:return r=384,e.abrupt("break",15);case 12:return r=512,e.abrupt("break",15);case 14:throw new Error('Incorrect "parameters.hashAlgorithm" parameter: '.concat(t.hashAlgorithm));case 15:return n={name:"HMAC",length:r,hash:{name:t.hashAlgorithm}},e.next=18,mu(this,t.hashAlgorithm,r,t.password,t.salt,t.iterationCount);case 18:return i=e.sent,e.next=21,this.importKey("raw",new Uint8Array(i),n,!1,["sign"]);case 21:return s=e.sent,e.abrupt("return",this.sign(n,s,new Uint8Array(t.contentToStamp)));case 23:case"end":return e.stop()}}),e,this)}))),function(e){return c.apply(this,arguments)})},{key:"verifyDataStampedWithPassword",value:(o=s(a().mark((function e(t){var r,n,i,s;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:la.assert(t,"password","hashAlgorithm","salt","iterationCount","contentToVerify","signatureToVerify"),r=0,e.t0=t.hashAlgorithm.toLowerCase(),e.next="sha-1"===e.t0?5:"sha-256"===e.t0?7:"sha-384"===e.t0?9:"sha-512"===e.t0?11:13;break;case 5:return r=160,e.abrupt("break",14);case 7:return r=256,e.abrupt("break",14);case 9:return r=384,e.abrupt("break",14);case 11:return r=512,e.abrupt("break",14);case 13:throw new Error('Incorrect "parameters.hashAlgorithm" parameter: '.concat(t.hashAlgorithm));case 14:return n={name:"HMAC",length:r,hash:{name:t.hashAlgorithm}},e.next=17,mu(this,t.hashAlgorithm,r,t.password,t.salt,t.iterationCount);case 17:return i=e.sent,e.next=20,this.importKey("raw",new Uint8Array(i),n,!1,["verify"]);case 20:return s=e.sent,e.abrupt("return",this.verify(n,s,new Uint8Array(t.signatureToVerify),new Uint8Array(t.contentToVerify)));case 22:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"getSignatureParameters",value:(i=s(a().mark((function e(t){var r,n,i,s,u,o,l,c=arguments;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=c.length>1&&void 0!==c[1]?c[1]:"SHA-1",this.getOIDByAlgorithm({name:r},!0,"hashAlgorithm"),n=new Ha,i=this.getAlgorithmParameters(t.algorithm.name,"sign"),Object.keys(i.algorithm).length){e.next=6;break}throw new Error("Parameter 'algorithm' is empty");case 6:(s=i.algorithm).hash.name=r,e.t0=t.algorithm.name.toUpperCase(),e.next="RSASSA-PKCS1-V1_5"===e.t0||"ECDSA"===e.t0?11:"RSA-PSS"===e.t0?13:29;break;case 11:return n.algorithmId=this.getOIDByAlgorithm(s,!0),e.abrupt("break",30);case 13:e.t1=r.toUpperCase(),e.next="SHA-256"===e.t1?16:"SHA-384"===e.t1?18:"SHA-512"===e.t1?20:22;break;case 16:return s.saltLength=32,e.abrupt("break",22);case 18:return s.saltLength=48,e.abrupt("break",22);case 20:return s.saltLength=64,e.abrupt("break",22);case 22:return u={},"SHA-1"!==r.toUpperCase()&&(o=this.getOIDByAlgorithm({name:r},!0,"hashAlgorithm"),u.hashAlgorithm=new Ha({algorithmId:o,algorithmParams:new Dt}),u.maskGenAlgorithm=new Ha({algorithmId:"1.2.840.113549.1.1.8",algorithmParams:u.hashAlgorithm.toSchema()})),20!==s.saltLength&&(u.saltLength=s.saltLength),l=new tu(u),n.algorithmId="1.2.840.113549.1.1.10",n.algorithmParams=l.toSchema(),e.abrupt("break",30);case 29:throw new Error("Unsupported signature algorithm: ".concat(t.algorithm.name));case 30:return e.abrupt("return",{signatureAlgorithm:n,parameters:i});case 31:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"signWithPrivateKey",value:(n=s(a().mark((function e(t,r,n){var i;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sign(n.algorithm,r,t);case 2:if(i=e.sent,"ECDSA"!==n.algorithm.name){e.next=5;break}return e.abrupt("return",Su(i));case 5:return e.abrupt("return",i);case 6:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return n.apply(this,arguments)})},{key:"fillPublicKeyParameters",value:function(e,t){var r,a={},n=this.getHashAlgorithm(t);if(n===ua)throw new Error("Unsupported signature algorithm: ".concat(t.algorithmId));r="1.2.840.113549.1.1.10"===t.algorithmId?t.algorithmId:e.algorithm.algorithmId;var i=this.getAlgorithmByOID(r,!0);if(a.algorithm=this.getAlgorithmParameters(i.name,"importKey"),"hash"in a.algorithm.algorithm&&(a.algorithm.algorithm.hash.name=n),"ECDSA"===i.name){var s=e.algorithm;if(!s.algorithmParams)throw new Error("Algorithm parameters for ECDSA public key are missed");var u=s.algorithmParams;if("idBlock"in s.algorithmParams&&(1!==u.idBlock.tagClass||6!==u.idBlock.tagNumber))throw new Error("Incorrect type for ECDSA public key parameters");var o=this.getAlgorithmByOID(u.valueBlock.toString(),!0);a.algorithm.algorithm.namedCurve=o.name}return a}},{key:"getPublicKey",value:(r=s(a().mark((function e(t,r,n){var i;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n||(n=this.fillPublicKeyParameters(t,r)),i=t.toSchema().toBER(!1),e.abrupt("return",this.importKey("spki",i,n.algorithm.algorithm,!0,n.algorithm.usages));case 3:case"end":return e.stop()}}),e,this)}))),function(e,t,a){return r.apply(this,arguments)})},{key:"verifyWithPublicKey",value:(t=s(a().mark((function e(t,r,n,i,s){var u,o,l,c,h,f,m,v,d,g,p,y,k;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s){e.next=9;break}if(s=this.getHashAlgorithm(i)){e.next=4;break}throw new Error("Unsupported signature algorithm: ".concat(i.algorithmId));case 4:return e.next=6,this.getPublicKey(n,i);case 6:u=e.sent,e.next=24;break;case 9:if(o={},l="1.2.840.113549.1.1.10"===i.algorithmId?i.algorithmId:n.algorithm.algorithmId,c=this.getAlgorithmByOID(l,!0),o.algorithm=this.getAlgorithmParameters(c.name,"importKey"),"hash"in o.algorithm.algorithm&&(o.algorithm.algorithm.hash.name=s),"ECDSA"!==c.name){e.next=21;break}if(h=!1,"algorithmParams"in n.algorithm==1&&"idBlock"in n.algorithm.algorithmParams&&1===n.algorithm.algorithmParams.idBlock.tagClass&&6===n.algorithm.algorithmParams.idBlock.tagNumber&&(h=!0),!1!==h){e.next=19;break}throw new Error("Incorrect type for ECDSA public key parameters");case 19:f=this.getAlgorithmByOID(n.algorithm.algorithmParams.valueBlock.toString(),!0),o.algorithm.algorithm.namedCurve=f.name;case 21:return e.next=23,this.getPublicKey(n,null,o);case 23:u=e.sent;case 24:if("hash"in(m=this.getAlgorithmParameters(u.algorithm.name,"verify")).algorithm&&(m.algorithm.hash.name=s),v=r.valueBlock.valueHexView,"ECDSA"!==u.algorithm.name){e.next=34;break}if(d=rs.find(u.algorithm.namedCurve)){e.next=31;break}throw new Error("Unsupported named curve in use");case 31:g=At(v),ca.assert(g,"Signature value"),v=Au(g.result,d.size);case 34:return"RSA-PSS"===u.algorithm.name&&(p=new tu({schema:i.algorithmParams}),m.algorithm.saltLength="saltLength"in p?p.saltLength:20,y="SHA-1","hashAlgorithm"in p&&(k=this.getAlgorithmByOID(p.hashAlgorithm.algorithmId,!0),y=k.name),m.algorithm.hash.name=y),e.abrupt("return",this.verify(m.algorithm,u,v,t));case 36:case"end":return e.stop()}}),e,this)}))),function(e,r,a,n,i){return t.apply(this,arguments)})}]),y}(fu),pu={name:"none",crypto:null};function yu(e){return!(!e||"object"!==n(e)||!("crypto"in e))}function ku(e){var t=null;if((arguments.length<=1?0:arguments.length-1)<2)t=!(arguments.length<=1)&&arguments.length-1?arguments.length<=1?void 0:arguments[1]:"undefined"!=typeof self&&self.crypto?new gu({name:"browser",crypto:self.crypto}):null;else{var r=arguments.length<=1?void 0:arguments[1],a=arguments.length<=2?void 0:arguments[2];yu(a)?t=a:yu(r)?t=r:"subtle"in r&&"getRandomValues"in r&&(t=new gu({crypto:r}))}if("undefined"!=typeof process&&"pid"in process&&"undefined"!=typeof global&&"undefined"==typeof window){if(void 0===global[process.pid])global[process.pid]={};else if("object"!==n(global[process.pid]))throw new Error("Name global.".concat(process.pid," already exists and it is not an object"));if(void 0===global[process.pid].pkijs)global[process.pid].pkijs={};else if("object"!==n(global[process.pid].pkijs))throw new Error("Name global.".concat(process.pid,".pkijs already exists and it is not an object"));global[process.pid].pkijs.engine={name:e,crypto:t}}else pu={name:e,crypto:t}}function wu(){if("undefined"!=typeof process&&"pid"in process&&"undefined"!=typeof global&&"undefined"==typeof window){var e;try{e=global[process.pid].pkijs.engine}catch(e){throw new Error("Please call 'setEngine' before call to 'getEngine'")}return e}return pu}function bu(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=wu();if(!t.crypto&&e)throw new Error("Unable to create WebCrypto object");return t.crypto}function Su(e){if(e.byteLength%2!=0)return sa;var t=e.byteLength/2,r=new ArrayBuffer(t);new Uint8Array(r).set(new Uint8Array(e,0,t));var a=new Gt({valueHex:r}),n=new ArrayBuffer(t);new Uint8Array(n).set(new Uint8Array(e,t,t));var i=new Gt({valueHex:n});return new sr({value:[a.convertToDER(),i.convertToDER()]}).toBER(!1)}function Au(e,t){if(!(e instanceof sr&&2===e.valueBlock.value.length&&e.valueBlock.value[0]instanceof Gt&&e.valueBlock.value[1]instanceof Gt))return sa;var r=e.valueBlock.value[0].convertFromDER().valueBlock.valueHexView,a=e.valueBlock.value[1].convertFromDER().valueBlock.valueHexView,n=new Uint8Array(2*t);return n.set(r,t-r.byteLength),n.set(a,2*t-a.byteLength),n.buffer}function Nu(e,t,r,a,n){return Cu.apply(this,arguments)}function Cu(){return(Cu=s(a().mark((function e(t,r,n,i,s){var u,o,l,c;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t.toUpperCase(),e.next="SHA-1"===e.t0||"SHA-256"===e.t0||"SHA-384"===e.t0||"SHA-512"===e.t0?3:4;break;case 3:return e.abrupt("break",5);case 4:throw new oa("Unknown hash function: ".concat(t));case 5:if(oa.assert(r,"zBuffer","ArrayBuffer"),0!==r.byteLength){e.next=8;break}throw new oa("'zBuffer' has zero length, error");case 8:if(oa.assert(i,"SharedInfo","ArrayBuffer"),!(n>255)){e.next=11;break}throw new oa("Please set 'Counter' argument to value less or equal to 255");case 11:return u=new ArrayBuffer(4),(o=new Uint8Array(u))[0]=0,o[1]=0,o[2]=0,o[3]=n,l=Te(l=sa,r),l=Te(l,u),l=Te(l,i),e.next=23,s.digest({name:t},l);case 23:return c=e.sent,e.abrupt("return",{counter:n,result:c});case 25:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function xu(e,t,r,a){return Eu.apply(this,arguments)}function Eu(){return Eu=s(a().mark((function e(t,r,n,i){var s,u,o,l,c,h,f,m,v,d,g,p,y,k,w,b,S=arguments;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:s=S.length>4&&void 0!==S[4]?S[4]:bu(!0),u=0,o=1,e.t0=t.toUpperCase(),e.next="SHA-1"===e.t0?6:"SHA-256"===e.t0?8:"SHA-384"===e.t0?10:"SHA-512"===e.t0?12:14;break;case 6:return u=160,e.abrupt("break",15);case 8:return u=256,e.abrupt("break",15);case 10:return u=384,e.abrupt("break",15);case 12:return u=512,e.abrupt("break",15);case 14:throw new oa("Unknown hash function: ".concat(t));case 15:if(oa.assert(r,"Zbuffer","ArrayBuffer"),0!==r.byteLength){e.next=18;break}throw new oa("'Zbuffer' has zero length, error");case 18:oa.assert(i,"SharedInfo","ArrayBuffer"),l=n/u,Math.floor(l)>0&&(o=Math.floor(l),l-o>0&&o++),c=[],h=1;case 23:if(!(h<=o)){e.next=32;break}return e.t1=c,e.next=27,Nu(t,r,h,i,s);case 27:e.t2=e.sent,e.t1.push.call(e.t1,e.t2);case 29:h++,e.next=23;break;case 32:f=sa,m=1,v=!0;case 35:if(!v){e.next=59;break}v=!1,d=E(c),e.prev=38,d.s();case 40:if((g=d.n()).done){e.next=48;break}if((p=g.value).counter!==m){e.next=46;break}return f=Te(f,p.result),v=!0,e.abrupt("break",48);case 46:e.next=40;break;case 48:e.next=53;break;case 50:e.prev=50,e.t3=e.catch(38),d.e(e.t3);case 53:return e.prev=53,d.f(),e.finish(53);case 56:m++,e.next=35;break;case 59:if(n>>=3,!(f.byteLength>n)){e.next=66;break}for(y=new ArrayBuffer(n),k=new Uint8Array(y),w=new Uint8Array(f),b=0;b<n;b++)k[b]=w[b];return e.abrupt("return",y);case 66:return e.abrupt("return",f);case 67:case"end":return e.stop()}}),e,null,[[38,50,53,56]])}))),Eu.apply(this,arguments)}var Iu="version",Bu="logID",Vu="extensions",Du="timestamp",Ou="hashAlgorithm",Pu="signatureAlgorithm",Ru="signature",Uu="none",Tu="sha1",Lu="sha224",Hu="sha256",Mu="sha384",Ku="sha512",_u="anonymous",ju="ecdsa",Ju=function(e){h(n,e);var t,r=w(n);function n(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return u(this,n),(e=r.call(this)).version=Oe(t,Iu,n.defaultValues(Iu)),e.logID=Oe(t,Bu,n.defaultValues(Bu)),e.timestamp=Oe(t,Du,n.defaultValues(Du)),e.extensions=Oe(t,Vu,n.defaultValues(Vu)),e.hashAlgorithm=Oe(t,Ou,n.defaultValues(Ou)),e.signatureAlgorithm=Oe(t,Pu,n.defaultValues(Pu)),e.signature=Oe(t,Ru,n.defaultValues(Ru)),"stream"in t&&t.stream&&e.fromStream(t.stream),t.schema&&e.fromSchema(t.schema),e}return l(n,[{key:"fromSchema",value:function(e){if(e instanceof ta==!1)throw new Error("Object's schema was not verified against input data for SignedCertificateTimestamp");var t=new ia({stream:new aa({buffer:e.data})});this.fromStream(t)}},{key:"fromStream",value:function(e){var t=e.getUint16();if(this.version=e.getBlock(1)[0],0===this.version){this.logID=new Uint8Array(e.getBlock(32)).buffer.slice(0),this.timestamp=new Date(Re(new Uint8Array(e.getBlock(8)),8));var r=e.getUint16();switch(this.extensions=new Uint8Array(e.getBlock(r)).buffer.slice(0),e.getBlock(1)[0]){case 0:this.hashAlgorithm=Uu;break;case 1:this.hashAlgorithm="md5";break;case 2:this.hashAlgorithm=Tu;break;case 3:this.hashAlgorithm=Lu;break;case 4:this.hashAlgorithm=Hu;break;case 5:this.hashAlgorithm=Mu;break;case 6:this.hashAlgorithm=Ku;break;default:throw new Error("Object's stream was not correct for SignedCertificateTimestamp")}switch(e.getBlock(1)[0]){case 0:this.signatureAlgorithm=_u;break;case 1:this.signatureAlgorithm="rsa";break;case 2:this.signatureAlgorithm="dsa";break;case 3:this.signatureAlgorithm=ju;break;default:throw new Error("Object's stream was not correct for SignedCertificateTimestamp")}var a=e.getUint16(),n=At(new Uint8Array(e.getBlock(a)).buffer.slice(0));if(ca.assert(n,"SignedCertificateTimestamp"),this.signature=n.result,t!==47+r+a)throw new Error("Object's stream was not correct for SignedCertificateTimestamp")}}},{key:"toSchema",value:function(){var e=this.toStream();return new ta({data:e.stream.buffer})}},{key:"toStream",value:function(){var e=new ia;e.appendUint16(47+this.extensions.byteLength+this.signature.valueBeforeDecodeView.byteLength),e.appendChar(this.version),e.appendView(new Uint8Array(this.logID));var t,r,a=new ArrayBuffer(8),n=new Uint8Array(a),i=Ue(this.timestamp.valueOf(),8);switch(n.set(new Uint8Array(i),8-i.byteLength),e.appendView(n),e.appendUint16(this.extensions.byteLength),this.extensions.byteLength&&e.appendView(new Uint8Array(this.extensions)),this.hashAlgorithm.toLowerCase()){case Uu:t=0;break;case"md5":t=1;break;case Tu:t=2;break;case Lu:t=3;break;case Hu:t=4;break;case Mu:t=5;break;case Ku:t=6;break;default:throw new Error("Incorrect data for hashAlgorithm: ".concat(this.hashAlgorithm))}switch(e.appendChar(t),this.signatureAlgorithm.toLowerCase()){case _u:r=0;break;case"rsa":r=1;break;case"dsa":r=2;break;case ju:r=3;break;default:throw new Error("Incorrect data for signatureAlgorithm: ".concat(this.signatureAlgorithm))}e.appendChar(r);var s=this.signature.toBER(!1);return e.appendUint16(s.byteLength),e.appendView(new Uint8Array(s)),e}},{key:"toJSON",value:function(){return{version:this.version,logID:Pe(this.logID),timestamp:this.timestamp,extensions:Pe(this.extensions),hashAlgorithm:this.hashAlgorithm,signatureAlgorithm:this.signatureAlgorithm,signature:this.signature.toJSON()}}},{key:"verify",value:(t=s(a().mark((function e(t,r){var n,i,s,u,o,l,c,h,f,m,v,d,g,p=arguments;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=p.length>2&&void 0!==p[2]?p[2]:0,i=p.length>3&&void 0!==p[3]?p[3]:bu(!0),s=Je(qe(this.logID)),u=null,o=new ia,l=E(t),e.prev=6,l.s();case 8:if((c=l.n()).done){e.next=15;break}if((h=c.value).log_id!==s){e.next=13;break}return u=h.key,e.abrupt("break",15);case 13:e.next=8;break;case 15:e.next=20;break;case 17:e.prev=17,e.t0=e.catch(6),l.e(e.t0);case 20:return e.prev=20,l.f(),e.finish(20);case 23:if(u){e.next=25;break}throw new Error("Public key not found for CT with logId: ".concat(s));case 25:return f=Xe(Fe(u)),m=vs.fromBER(f),o.appendChar(0),o.appendChar(0),v=new ArrayBuffer(8),d=new Uint8Array(v),g=Ue(this.timestamp.valueOf(),8),d.set(new Uint8Array(g),8-g.byteLength),o.appendView(d),o.appendUint16(n),0===n&&o.appendUint24(r.byteLength),o.appendView(new Uint8Array(r)),o.appendUint16(this.extensions.byteLength),0!==this.extensions.byteLength&&o.appendView(new Uint8Array(this.extensions)),e.abrupt("return",i.verifyWithPublicKey(o.buffer.slice(0,o.length),new Lt({valueHex:this.signature.toBER(!1)}),m,{algorithmId:ua},"SHA-256"));case 40:case"end":return e.stop()}}),e,this,[[6,17,20,23]])}))),function(e,r){return t.apply(this,arguments)})}],[{key:"defaultValues",value:function(e){switch(e){case Iu:return 0;case Bu:case Vu:return sa;case Du:return new Date(0);case Ou:case Pu:return ua;case Ru:return new Zr;default:return S(f(n),"defaultValues",this).call(this,e)}}}]),n}(ha);Ju.CLASS_NAME="SignedCertificateTimestamp";var Fu="timestamps",qu=function(e){h(r,e);var t=w(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return u(this,r),(e=t.call(this)).timestamps=Oe(a,Fu,r.defaultValues(Fu)),a.schema&&e.fromSchema(a.schema),e}return l(r,[{key:"fromSchema",value:function(e){if(e instanceof Lt==!1)throw new Error("Object's schema was not verified against input data for SignedCertificateTimestampList");var t=new ia({stream:new aa({buffer:e.valueBlock.valueHex})});if(t.getUint16()!==t.length)throw new Error("Object's schema was not verified against input data for SignedCertificateTimestampList");for(;t.length;)this.timestamps.push(new Ju({stream:t}))}},{key:"toSchema",value:function(){var e,t=new ia,r=0,a=[],n=E(this.timestamps);try{for(n.s();!(e=n.n()).done;){var i=e.value.toStream();a.push(i),r+=i.stream.buffer.byteLength}}catch(e){n.e(e)}finally{n.f()}t.appendUint16(r);for(var s=0,u=a;s<u.length;s++){var o=u[s];t.appendView(o.stream.view)}return new Lt({valueHex:t.stream.buffer.slice(0)})}},{key:"toJSON",value:function(){return{timestamps:Array.from(this.timestamps,(function(e){return e.toJSON()}))}}}],[{key:"defaultValues",value:function(e){return e===Fu?[]:S(f(r),"defaultValues",this).call(this,e)}},{key:"compareWithDefault",value:function(e,t){return e===Fu?0===t.length:S(f(r),"defaultValues",this).call(this,e)}},{key:"schema",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=Oe(t,"names",{});return null!==(e=r.optional)&&void 0!==e||(r.optional=!1),new Lt({name:r.blockName||"SignedCertificateTimestampList",optional:r.optional})}}]),r}(ha);qu.CLASS_NAME="SignedCertificateTimestampList";var Xu="attributes",Wu=[Xu],Gu=function(e){h(r,e);var t=w(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return u(this,r),(e=t.call(this)).attributes=Oe(a,Xu,r.defaultValues(Xu)),a.schema&&e.fromSchema(a.schema),e}return l(r,[{key:"fromSchema",value:function(e){Ge(e,Wu);var t=ra(e,e,r.schema({names:{attributes:Xu}}));ca.assertSchema(t,this.className),this.attributes=Array.from(t.result.attributes,(function(e){return new qa({schema:e})}))}},{key:"toSchema",value:function(){return new sr({value:Array.from(this.attributes,(function(e){return e.toSchema()}))})}},{key:"toJSON",value:function(){return{attributes:Array.from(this.attributes,(function(e){return e.toJSON()}))}}}],[{key:"defaultValues",value:function(e){return e===Xu?[]:S(f(r),"defaultValues",this).call(this,e)}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Oe(e,"names",{});return new sr({name:t.blockName||ua,value:[new ea({name:t.attributes||ua,value:qa.schema()})]})}}]),r}(ha);Gu.CLASS_NAME="SubjectDirectoryAttributes";var zu=function(){function e(){u(this,e)}return l(e,null,[{key:"getItems",value:function(){return this.types||(this.types={},e.register(tn,"SubjectAltName",_a),e.register(rn,"IssuerAltName",_a),e.register(mn,"AuthorityKeyIdentifier",Dn),e.register(an,"BasicConstraints",Rn),e.register("1.3.6.1.4.1.311.21.1","MicrosoftCaVersion",Ln),e.register(cn,"CertificatePolicies",Gn),e.register("1.3.6.1.4.1.311.21.10","CertificatePoliciesMicrosoft",Gn),e.register("1.3.6.1.4.1.311.21.7","MicrosoftCertTemplateV2",$n),e.register(on,"CRLDistributionPoints",li),e.register(ln,"FreshestCRL",li),e.register("2.5.29.37","ExtKeyUsage",fi),e.register(sn,"CertificateIssuer",Za),e.register(gn,"AuthorityInfoAccess",vi),e.register("1.3.6.1.5.5.7.1.11","SubjectInfoAccess",vi),e.register(nn,"IssuingDistributionPoint",Ai),e.register(un,"NameConstraints",Oi),e.register(vn,"PolicyConstraints",Ti),e.register(fn,"PolicyMappings",Ji),e.register("2.5.29.16","PrivateKeyUsagePeriod",Wi),e.register("1.3.6.1.5.5.7.1.3","QCStatements",ts),e.register("1.3.6.1.4.1.11129.2.4.2","SignedCertificateTimestampList",qu),e.register("2.5.29.9","SubjectDirectoryAttributes",Gu)),this.types}},{key:"fromBER",value:function(e,t){var r=At(t);if(-1===r.offset)return null;var a=this.find(e);if(a)try{return new a.type({schema:r.result})}catch(t){var n=new a.type;return n.parsingError="Incorrectly formatted value of extension ".concat(a.name," (").concat(e,")"),n}return r.result}},{key:"find",value:function(e){return this.getItems()[e]||null}},{key:"register",value:function(e,t,r){this.getItems()[e]={name:t,type:r}}}]),e}(),Qu="extnID",Yu="critical",Zu="extnValue",$u="parsedValue",eo=[Qu,Yu,Zu],to=function(e){h(r,e);var t=w(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return u(this,r),(e=t.call(this)).extnID=Oe(a,Qu,r.defaultValues(Qu)),e.critical=Oe(a,Yu,r.defaultValues(Yu)),e.extnValue=Zu in a?new Lt({valueHex:a.extnValue}):r.defaultValues(Zu),$u in a&&(e.parsedValue=Oe(a,$u,r.defaultValues($u))),a.schema&&e.fromSchema(a.schema),e}return l(r,[{key:"parsedValue",get:function(){if(void 0===this._parsedValue){var e=zu.fromBER(this.extnID,this.extnValue.valueBlock.valueHexView);this._parsedValue=e}return this._parsedValue||void 0},set:function(e){this._parsedValue=e}},{key:"fromSchema",value:function(e){Ge(e,eo);var t=ra(e,e,r.schema({names:{extnID:Qu,critical:Yu,extnValue:Zu}}));ca.assertSchema(t,this.className),this.extnID=t.result.extnID.valueBlock.toString(),Yu in t.result&&(this.critical=t.result.critical.valueBlock.value),this.extnValue=t.result.extnValue}},{key:"toSchema",value:function(){var e=[];return e.push(new $t({value:this.extnID})),this.critical!==r.defaultValues(Yu)&&e.push(new Rt({value:this.critical})),e.push(this.extnValue),new sr({value:e})}},{key:"toJSON",value:function(){var e={extnID:this.extnID,extnValue:this.extnValue.toJSON()};return this.critical!==r.defaultValues(Yu)&&(e.critical=this.critical),this.parsedValue&&this.parsedValue.toJSON&&(e.parsedValue=this.parsedValue.toJSON()),e}}],[{key:"defaultValues",value:function(e){switch(e){case Qu:return ua;case Yu:return!1;case Zu:return new Lt;case $u:return{};default:return S(f(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Oe(e,"names",{});return new sr({name:t.blockName||ua,value:[new $t({name:t.extnID||ua}),new Rt({name:t.critical||ua,optional:!0}),new Lt({name:t.extnValue||ua})]})}}]),r}(ha);to.CLASS_NAME="Extension";var ro="extensions",ao=[ro],no=function(e){h(r,e);var t=w(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return u(this,r),(e=t.call(this)).extensions=Oe(a,ro,r.defaultValues(ro)),a.schema&&e.fromSchema(a.schema),e}return l(r,[{key:"fromSchema",value:function(e){Ge(e,ao);var t=ra(e,e,r.schema({names:{extensions:ro}}));ca.assertSchema(t,this.className),this.extensions=Array.from(t.result.extensions,(function(e){return new to({schema:e})}))}},{key:"toSchema",value:function(){return new sr({value:Array.from(this.extensions,(function(e){return e.toSchema()}))})}},{key:"toJSON",value:function(){return{extensions:this.extensions.map((function(e){return e.toJSON()}))}}}],[{key:"defaultValues",value:function(e){return e===ro?[]:S(f(r),"defaultValues",this).call(this,e)}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=Oe(e,"names",{});return new sr({optional:t,name:r.blockName||ua,value:[new ea({name:r.extensions||ua,value:to.schema(r.extension||{})})]})}}]),r}(ha);no.CLASS_NAME="Extensions";var io="issuer",so="serialNumber",uo="issuerUID",oo=[io,so,uo],lo=function(e){h(r,e);var t=w(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return u(this,r),(e=t.call(this)).issuer=Oe(a,io,r.defaultValues(io)),e.serialNumber=Oe(a,so,r.defaultValues(so)),uo in a&&(e.issuerUID=Oe(a,uo,r.defaultValues(uo))),a.schema&&e.fromSchema(a.schema),e}return l(r,[{key:"fromSchema",value:function(e){Ge(e,oo);var t=ra(e,e,r.schema({names:{issuer:{names:{blockName:io}},serialNumber:so,issuerUID:uo}}));ca.assertSchema(t,this.className),this.issuer=new Za({schema:t.result.issuer}),this.serialNumber=t.result.serialNumber,uo in t.result&&(this.issuerUID=t.result.issuerUID)}},{key:"toSchema",value:function(){var e=new sr({value:[this.issuer.toSchema(),this.serialNumber]});return this.issuerUID&&e.valueBlock.value.push(this.issuerUID),e}},{key:"toJSON",value:function(){var e={issuer:this.issuer.toJSON(),serialNumber:this.serialNumber.toJSON()};return this.issuerUID&&(e.issuerUID=this.issuerUID.toJSON()),e}}],[{key:"defaultValues",value:function(e){switch(e){case io:return new Za;case so:return new Gt;case uo:return new _t;default:return S(f(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Oe(e,"names",{});return new sr({name:t.blockName||ua,value:[Za.schema(t.issuer||{}),new Gt({name:t.serialNumber||ua}),new _t({optional:!0,name:t.issuerUID||ua})]})}}]),r}(ha);lo.CLASS_NAME="IssuerSerial";var co="version",ho="baseCertificateID",fo="subjectName",mo="issuer",vo="signature",go="serialNumber",po="attrCertValidityPeriod",yo="attributes",ko="issuerUniqueID",wo="extensions",bo=[co,ho,fo,mo,vo,go,po,yo,ko,wo],So=function(e){h(r,e);var t=w(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return u(this,r),(e=t.call(this)).version=Oe(a,co,r.defaultValues(co)),ho in a&&(e.baseCertificateID=Oe(a,ho,r.defaultValues(ho))),fo in a&&(e.subjectName=Oe(a,fo,r.defaultValues(fo))),e.issuer=Oe(a,mo,r.defaultValues(mo)),e.signature=Oe(a,vo,r.defaultValues(vo)),e.serialNumber=Oe(a,go,r.defaultValues(go)),e.attrCertValidityPeriod=Oe(a,po,r.defaultValues(po)),e.attributes=Oe(a,yo,r.defaultValues(yo)),ko in a&&(e.issuerUniqueID=Oe(a,ko,r.defaultValues(ko))),wo in a&&(e.extensions=Oe(a,wo,r.defaultValues(wo))),a.schema&&e.fromSchema(a.schema),e}return l(r,[{key:"fromSchema",value:function(e){Ge(e,bo);var t=ra(e,e,r.schema({names:{version:co,baseCertificateID:ho,subjectName:fo,issuer:mo,signature:{names:{blockName:vo}},serialNumber:go,attrCertValidityPeriod:{names:{blockName:po}},attributes:yo,issuerUniqueID:ko,extensions:{names:{blockName:wo}}}}));ca.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,ho in t.result&&(this.baseCertificateID=new lo({schema:new sr({value:t.result.baseCertificateID.valueBlock.value})})),fo in t.result&&(this.subjectName=new Za({schema:new sr({value:t.result.subjectName.valueBlock.value})})),this.issuer=t.result.issuer,this.signature=new Ha({schema:t.result.signature}),this.serialNumber=t.result.serialNumber,this.attrCertValidityPeriod=new za({schema:t.result.attrCertValidityPeriod}),this.attributes=Array.from(t.result.attributes.valueBlock.value,(function(e){return new qa({schema:e})})),ko in t.result&&(this.issuerUniqueID=t.result.issuerUniqueID),wo in t.result&&(this.extensions=new no({schema:t.result.extensions}))}},{key:"toSchema",value:function(){var e=new sr({value:[new Gt({value:this.version})]});return this.baseCertificateID&&e.valueBlock.value.push(new xt({idBlock:{tagClass:3,tagNumber:0},value:this.baseCertificateID.toSchema().valueBlock.value})),this.subjectName&&e.valueBlock.value.push(new xt({idBlock:{tagClass:3,tagNumber:1},value:this.subjectName.toSchema().valueBlock.value})),e.valueBlock.value.push(this.issuer.toSchema()),e.valueBlock.value.push(this.signature.toSchema()),e.valueBlock.value.push(this.serialNumber),e.valueBlock.value.push(this.attrCertValidityPeriod.toSchema()),e.valueBlock.value.push(new sr({value:Array.from(this.attributes,(function(e){return e.toSchema()}))})),this.issuerUniqueID&&e.valueBlock.value.push(this.issuerUniqueID),this.extensions&&e.valueBlock.value.push(this.extensions.toSchema()),e}},{key:"toJSON",value:function(){var e={version:this.version};return this.baseCertificateID&&(e.baseCertificateID=this.baseCertificateID.toJSON()),this.subjectName&&(e.subjectName=this.subjectName.toJSON()),e.issuer=this.issuer.toJSON(),e.signature=this.signature.toJSON(),e.serialNumber=this.serialNumber.toJSON(),e.attrCertValidityPeriod=this.attrCertValidityPeriod.toJSON(),e.attributes=Array.from(this.attributes,(function(e){return e.toJSON()})),this.issuerUniqueID&&(e.issuerUniqueID=this.issuerUniqueID.toJSON()),this.extensions&&(e.extensions=this.extensions.toJSON()),e}}],[{key:"defaultValues",value:function(e){switch(e){case co:return 0;case ho:return new lo;case fo:case mo:return new Za;case vo:return new Ha;case go:return new Gt;case po:return new za;case yo:return[];case ko:return new _t;case wo:return new no;default:return S(f(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Oe(e,"names",{});return new sr({name:t.blockName||ua,value:[new Gt({name:t.version||ua}),new $r({value:[new xt({name:t.baseCertificateID||ua,idBlock:{tagClass:3,tagNumber:0},value:lo.schema().valueBlock.value}),new xt({name:t.subjectName||ua,idBlock:{tagClass:3,tagNumber:1},value:Za.schema().valueBlock.value})]}),Za.schema({names:{blockName:t.issuer||ua}}),Ha.schema(t.signature||{}),new Gt({name:t.serialNumber||ua}),za.schema(t.attrCertValidityPeriod||{}),new sr({name:t.attributes||ua,value:[new ea({value:qa.schema()})]}),new _t({optional:!0,name:t.issuerUniqueID||ua}),no.schema(t.extensions||{},!0)]})}}]),r}(ha);So.CLASS_NAME="AttributeCertificateInfoV1";var Ao="acinfo",No="signatureAlgorithm",Co="signatureValue",xo=[Ao,Co,No],Eo=function(e){h(r,e);var t=w(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return u(this,r),(e=t.call(this)).acinfo=Oe(a,Ao,r.defaultValues(Ao)),e.signatureAlgorithm=Oe(a,No,r.defaultValues(No)),e.signatureValue=Oe(a,Co,r.defaultValues(Co)),a.schema&&e.fromSchema(a.schema),e}return l(r,[{key:"fromSchema",value:function(e){Ge(e,xo);var t=ra(e,e,r.schema({names:{acinfo:{names:{blockName:Ao}},signatureAlgorithm:{names:{blockName:No}},signatureValue:Co}}));ca.assertSchema(t,this.className),this.acinfo=new So({schema:t.result.acinfo}),this.signatureAlgorithm=new Ha({schema:t.result.signatureAlgorithm}),this.signatureValue=t.result.signatureValue}},{key:"toSchema",value:function(){return new sr({value:[this.acinfo.toSchema(),this.signatureAlgorithm.toSchema(),this.signatureValue]})}},{key:"toJSON",value:function(){return{acinfo:this.acinfo.toJSON(),signatureAlgorithm:this.signatureAlgorithm.toJSON(),signatureValue:this.signatureValue.toJSON()}}}],[{key:"defaultValues",value:function(e){switch(e){case Ao:return new So;case No:return new Ha;case Co:return new _t;default:return S(f(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Oe(e,"names",{});return new sr({name:t.blockName||ua,value:[So.schema(t.acinfo||{}),Ha.schema(t.signatureAlgorithm||{}),new _t({name:t.signatureValue||ua})]})}}]),r}(ha);Eo.CLASS_NAME="AttributeCertificateV1";var Io="digestedObjectType",Bo="otherObjectTypeID",Vo="digestAlgorithm",Do="objectDigest",Oo=[Io,Bo,Vo,Do],Po=function(e){h(r,e);var t=w(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return u(this,r),(e=t.call(this)).digestedObjectType=Oe(a,Io,r.defaultValues(Io)),Bo in a&&(e.otherObjectTypeID=Oe(a,Bo,r.defaultValues(Bo))),e.digestAlgorithm=Oe(a,Vo,r.defaultValues(Vo)),e.objectDigest=Oe(a,Do,r.defaultValues(Do)),a.schema&&e.fromSchema(a.schema),e}return l(r,[{key:"fromSchema",value:function(e){Ge(e,Oo);var t=ra(e,e,r.schema({names:{digestedObjectType:Io,otherObjectTypeID:Bo,digestAlgorithm:{names:{blockName:Vo}},objectDigest:Do}}));ca.assertSchema(t,this.className),this.digestedObjectType=t.result.digestedObjectType,Bo in t.result&&(this.otherObjectTypeID=t.result.otherObjectTypeID),this.digestAlgorithm=new Ha({schema:t.result.digestAlgorithm}),this.objectDigest=t.result.objectDigest}},{key:"toSchema",value:function(){var e=new sr({value:[this.digestedObjectType]});return this.otherObjectTypeID&&e.valueBlock.value.push(this.otherObjectTypeID),e.valueBlock.value.push(this.digestAlgorithm.toSchema()),e.valueBlock.value.push(this.objectDigest),e}},{key:"toJSON",value:function(){var e={digestedObjectType:this.digestedObjectType.toJSON(),digestAlgorithm:this.digestAlgorithm.toJSON(),objectDigest:this.objectDigest.toJSON()};return this.otherObjectTypeID&&(e.otherObjectTypeID=this.otherObjectTypeID.toJSON()),e}}],[{key:"defaultValues",value:function(e){switch(e){case Io:return new zt;case Bo:return new $t;case Vo:return new Ha;case Do:return new _t;default:return S(f(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Oe(e,"names",{});return new sr({name:t.blockName||ua,value:[new zt({name:t.digestedObjectType||ua}),new $t({optional:!0,name:t.otherObjectTypeID||ua}),Ha.schema(t.digestAlgorithm||{}),new _t({name:t.objectDigest||ua})]})}}]),r}(ha);Po.CLASS_NAME="ObjectDigestInfo";var Ro="issuerName",Uo="baseCertificateID",To="objectDigestInfo",Lo=[Ro,Uo,To],Ho=function(e){h(r,e);var t=w(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return u(this,r),e=t.call(this),Ro in a&&(e.issuerName=Oe(a,Ro,r.defaultValues(Ro))),Uo in a&&(e.baseCertificateID=Oe(a,Uo,r.defaultValues(Uo))),To in a&&(e.objectDigestInfo=Oe(a,To,r.defaultValues(To))),a.schema&&e.fromSchema(a.schema),e}return l(r,[{key:"fromSchema",value:function(e){Ge(e,Lo);var t=ra(e,e,r.schema({names:{issuerName:Ro,baseCertificateID:Uo,objectDigestInfo:To}}));ca.assertSchema(t,this.className),Ro in t.result&&(this.issuerName=new Za({schema:t.result.issuerName})),Uo in t.result&&(this.baseCertificateID=new lo({schema:new sr({value:t.result.baseCertificateID.valueBlock.value})})),To in t.result&&(this.objectDigestInfo=new Po({schema:new sr({value:t.result.objectDigestInfo.valueBlock.value})}))}},{key:"toSchema",value:function(){var e=new sr;return this.issuerName&&e.valueBlock.value.push(this.issuerName.toSchema()),this.baseCertificateID&&e.valueBlock.value.push(new xt({idBlock:{tagClass:3,tagNumber:0},value:this.baseCertificateID.toSchema().valueBlock.value})),this.objectDigestInfo&&e.valueBlock.value.push(new xt({idBlock:{tagClass:3,tagNumber:1},value:this.objectDigestInfo.toSchema().valueBlock.value})),e}},{key:"toJSON",value:function(){var e={};return this.issuerName&&(e.issuerName=this.issuerName.toJSON()),this.baseCertificateID&&(e.baseCertificateID=this.baseCertificateID.toJSON()),this.objectDigestInfo&&(e.objectDigestInfo=this.objectDigestInfo.toJSON()),e}}],[{key:"defaultValues",value:function(e){switch(e){case Ro:return new Za;case Uo:return new lo;case To:return new Po;default:return S(f(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Oe(e,"names",{});return new sr({name:t.blockName||ua,value:[Za.schema({names:{blockName:t.issuerName}},!0),new xt({optional:!0,name:t.baseCertificateID||ua,idBlock:{tagClass:3,tagNumber:0},value:lo.schema().valueBlock.value}),new xt({optional:!0,name:t.objectDigestInfo||ua,idBlock:{tagClass:3,tagNumber:1},value:Po.schema().valueBlock.value})]})}}]),r}(ha);Ho.CLASS_NAME="V2Form";var Mo="baseCertificateID",Ko="entityName",_o="objectDigestInfo",jo=[Mo,Ko,_o],Jo=function(e){h(r,e);var t=w(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return u(this,r),e=t.call(this),Mo in a&&(e.baseCertificateID=Oe(a,Mo,r.defaultValues(Mo))),Ko in a&&(e.entityName=Oe(a,Ko,r.defaultValues(Ko))),_o in a&&(e.objectDigestInfo=Oe(a,_o,r.defaultValues(_o))),a.schema&&e.fromSchema(a.schema),e}return l(r,[{key:"fromSchema",value:function(e){Ge(e,jo);var t=ra(e,e,r.schema({names:{baseCertificateID:Mo,entityName:Ko,objectDigestInfo:_o}}));ca.assertSchema(t,this.className),Mo in t.result&&(this.baseCertificateID=new lo({schema:new sr({value:t.result.baseCertificateID.valueBlock.value})})),Ko in t.result&&(this.entityName=new Za({schema:new sr({value:t.result.entityName.valueBlock.value})})),_o in t.result&&(this.objectDigestInfo=new Po({schema:new sr({value:t.result.objectDigestInfo.valueBlock.value})}))}},{key:"toSchema",value:function(){var e=new sr;return this.baseCertificateID&&e.valueBlock.value.push(new xt({idBlock:{tagClass:3,tagNumber:0},value:this.baseCertificateID.toSchema().valueBlock.value})),this.entityName&&e.valueBlock.value.push(new xt({idBlock:{tagClass:3,tagNumber:1},value:this.entityName.toSchema().valueBlock.value})),this.objectDigestInfo&&e.valueBlock.value.push(new xt({idBlock:{tagClass:3,tagNumber:2},value:this.objectDigestInfo.toSchema().valueBlock.value})),e}},{key:"toJSON",value:function(){var e={};return this.baseCertificateID&&(e.baseCertificateID=this.baseCertificateID.toJSON()),this.entityName&&(e.entityName=this.entityName.toJSON()),this.objectDigestInfo&&(e.objectDigestInfo=this.objectDigestInfo.toJSON()),e}}],[{key:"defaultValues",value:function(e){switch(e){case Mo:return new lo;case Ko:return new Za;case _o:return new Po;default:return S(f(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Oe(e,"names",{});return new sr({name:t.blockName||ua,value:[new xt({optional:!0,name:t.baseCertificateID||ua,idBlock:{tagClass:3,tagNumber:0},value:lo.schema().valueBlock.value}),new xt({optional:!0,name:t.entityName||ua,idBlock:{tagClass:3,tagNumber:1},value:Za.schema().valueBlock.value}),new xt({optional:!0,name:t.objectDigestInfo||ua,idBlock:{tagClass:3,tagNumber:2},value:Po.schema().valueBlock.value})]})}}]),r}(ha);Jo.CLASS_NAME="Holder";var Fo="version",qo="holder",Xo="issuer",Wo="signature",Go="serialNumber",zo="attrCertValidityPeriod",Qo="attributes",Yo="issuerUniqueID",Zo="extensions",$o=[Fo,qo,Xo,Wo,Go,zo,Qo,Yo,Zo],el=function(e){h(r,e);var t=w(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return u(this,r),(e=t.call(this)).version=Oe(a,Fo,r.defaultValues(Fo)),e.holder=Oe(a,qo,r.defaultValues(qo)),e.issuer=Oe(a,Xo,r.defaultValues(Xo)),e.signature=Oe(a,Wo,r.defaultValues(Wo)),e.serialNumber=Oe(a,Go,r.defaultValues(Go)),e.attrCertValidityPeriod=Oe(a,zo,r.defaultValues(zo)),e.attributes=Oe(a,Qo,r.defaultValues(Qo)),Yo in a&&(e.issuerUniqueID=Oe(a,Yo,r.defaultValues(Yo))),Zo in a&&(e.extensions=Oe(a,Zo,r.defaultValues(Zo))),a.schema&&e.fromSchema(a.schema),e}return l(r,[{key:"fromSchema",value:function(e){Ge(e,$o);var t=ra(e,e,r.schema({names:{version:Fo,holder:{names:{blockName:qo}},issuer:Xo,signature:{names:{blockName:Wo}},serialNumber:Go,attrCertValidityPeriod:{names:{blockName:zo}},attributes:Qo,issuerUniqueID:Yo,extensions:{names:{blockName:Zo}}}}));if(ca.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,this.holder=new Jo({schema:t.result.holder}),3!==t.result.issuer.idBlock.tagClass)throw new Error("Incorrect value for 'issuer' in AttributeCertificateInfoV2");this.issuer=new Ho({schema:new sr({value:t.result.issuer.valueBlock.value})}),this.signature=new Ha({schema:t.result.signature}),this.serialNumber=t.result.serialNumber,this.attrCertValidityPeriod=new za({schema:t.result.attrCertValidityPeriod}),this.attributes=Array.from(t.result.attributes.valueBlock.value,(function(e){return new qa({schema:e})})),Yo in t.result&&(this.issuerUniqueID=t.result.issuerUniqueID),Zo in t.result&&(this.extensions=new no({schema:t.result.extensions}))}},{key:"toSchema",value:function(){var e=new sr({value:[new Gt({value:this.version}),this.holder.toSchema(),new xt({idBlock:{tagClass:3,tagNumber:0},value:this.issuer.toSchema().valueBlock.value}),this.signature.toSchema(),this.serialNumber,this.attrCertValidityPeriod.toSchema(),new sr({value:Array.from(this.attributes,(function(e){return e.toSchema()}))})]});return this.issuerUniqueID&&e.valueBlock.value.push(this.issuerUniqueID),this.extensions&&e.valueBlock.value.push(this.extensions.toSchema()),e}},{key:"toJSON",value:function(){var e={version:this.version,holder:this.holder.toJSON(),issuer:this.issuer.toJSON(),signature:this.signature.toJSON(),serialNumber:this.serialNumber.toJSON(),attrCertValidityPeriod:this.attrCertValidityPeriod.toJSON(),attributes:Array.from(this.attributes,(function(e){return e.toJSON()}))};return this.issuerUniqueID&&(e.issuerUniqueID=this.issuerUniqueID.toJSON()),this.extensions&&(e.extensions=this.extensions.toJSON()),e}}],[{key:"defaultValues",value:function(e){switch(e){case Fo:return 1;case qo:return new Jo;case Xo:return{};case Wo:return new Ha;case Go:return new Gt;case zo:return new za;case Qo:return[];case Yo:return new _t;case Zo:return new no;default:return S(f(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Oe(e,"names",{});return new sr({name:t.blockName||ua,value:[new Gt({name:t.version||ua}),Jo.schema(t.holder||{}),new $r({value:[Za.schema({names:{blockName:t.issuer||ua}}),new xt({name:t.issuer||ua,idBlock:{tagClass:3,tagNumber:0},value:Ho.schema().valueBlock.value})]}),Ha.schema(t.signature||{}),new Gt({name:t.serialNumber||ua}),za.schema(t.attrCertValidityPeriod||{}),new sr({name:t.attributes||ua,value:[new ea({value:qa.schema()})]}),new _t({optional:!0,name:t.issuerUniqueID||ua}),no.schema(t.extensions||{},!0)]})}}]),r}(ha);el.CLASS_NAME="AttributeCertificateInfoV2";var tl="acinfo",rl="signatureAlgorithm",al="signatureValue",nl=[tl,rl,al],il=function(e){h(r,e);var t=w(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return u(this,r),(e=t.call(this)).acinfo=Oe(a,tl,r.defaultValues(tl)),e.signatureAlgorithm=Oe(a,rl,r.defaultValues(rl)),e.signatureValue=Oe(a,al,r.defaultValues(al)),a.schema&&e.fromSchema(a.schema),e}return l(r,[{key:"fromSchema",value:function(e){Ge(e,nl);var t=ra(e,e,r.schema({names:{acinfo:{names:{blockName:tl}},signatureAlgorithm:{names:{blockName:rl}},signatureValue:al}}));ca.assertSchema(t,this.className),this.acinfo=new el({schema:t.result.acinfo}),this.signatureAlgorithm=new Ha({schema:t.result.signatureAlgorithm}),this.signatureValue=t.result.signatureValue}},{key:"toSchema",value:function(){return new sr({value:[this.acinfo.toSchema(),this.signatureAlgorithm.toSchema(),this.signatureValue]})}},{key:"toJSON",value:function(){return{acinfo:this.acinfo.toJSON(),signatureAlgorithm:this.signatureAlgorithm.toJSON(),signatureValue:this.signatureValue.toJSON()}}}],[{key:"defaultValues",value:function(e){switch(e){case tl:return new el;case rl:return new Ha;case al:return new _t;default:return S(f(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Oe(e,"names",{});return new sr({name:t.blockName||ua,value:[el.schema(t.acinfo||{}),Ha.schema(t.signatureAlgorithm||{}),new _t({name:t.signatureValue||ua})]})}}]),r}(ha);il.CLASS_NAME="AttributeCertificateV2";var sl="contentType",ul="content",ol=[sl,ul],ll=function(e){h(r,e);var t=w(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return u(this,r),(e=t.call(this)).contentType=Oe(a,sl,r.defaultValues(sl)),e.content=Oe(a,ul,r.defaultValues(ul)),a.schema&&e.fromSchema(a.schema),e}return l(r,[{key:"fromSchema",value:function(e){Ge(e,ol);var t=ra(e,e,r.schema());ca.assertSchema(t,this.className),this.contentType=t.result.contentType.valueBlock.toString(),this.content=t.result.content}},{key:"toSchema",value:function(){return new sr({value:[new $t({value:this.contentType}),new xt({idBlock:{tagClass:3,tagNumber:0},value:[this.content]})]})}},{key:"toJSON",value:function(){var e={contentType:this.contentType};return this.content instanceof Zr||(e.content=this.content.toJSON()),e}}],[{key:"defaultValues",value:function(e){switch(e){case sl:return ua;case ul:return new Zr;default:return S(f(r),"defaultValues",this).call(this,e)}}},{key:"compareWithDefault",value:function(e,t){switch(e){case sl:return"string"==typeof t&&t===this.defaultValues(sl);case ul:return t instanceof Zr;default:return S(f(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Oe(e,"names",{});return"optional"in t==!1&&(t.optional=!1),new sr({name:t.blockName||"ContentInfo",optional:t.optional,value:[new $t({name:t.contentType||sl}),new xt({idBlock:{tagClass:3,tagNumber:0},value:[new Zr({name:t.content||ul})]})]})}}]),r}(ha);ll.CLASS_NAME="ContentInfo",ll.DATA=pn,ll.SIGNED_DATA=yn,ll.ENVELOPED_DATA=kn,ll.ENCRYPTED_DATA=wn;var cl,hl="type",fl="value",ml="utcTimeName",vl="generalTimeName",dl=[ml,vl];!function(e){e[e.UTCTime=0]="UTCTime",e[e.GeneralizedTime=1]="GeneralizedTime",e[e.empty=2]="empty"}(cl||(cl={}));var gl=function(e){h(r,e);var t=w(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return u(this,r),(e=t.call(this)).type=Oe(a,hl,r.defaultValues(hl)),e.value=Oe(a,fl,r.defaultValues(fl)),a.schema&&e.fromSchema(a.schema),e}return l(r,[{key:"fromSchema",value:function(e){Ge(e,dl);var t=ra(e,e,r.schema({names:{utcTimeName:ml,generalTimeName:vl}}));ca.assertSchema(t,this.className),ml in t.result&&(this.type=0,this.value=t.result.utcTimeName.toDate()),vl in t.result&&(this.type=1,this.value=t.result.generalTimeName.toDate())}},{key:"toSchema",value:function(){return 0===this.type?new Kr({valueDate:this.value}):1===this.type?new jr({valueDate:this.value}):{}}},{key:"toJSON",value:function(){return{type:this.type,value:this.value}}}],[{key:"defaultValues",value:function(e){switch(e){case hl:return 0;case fl:return new Date(0,0,0);default:return S(f(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=Oe(e,"names",{});return new $r({optional:t,value:[new Kr({name:r.utcTimeName||ua}),new jr({name:r.generalTimeName||ua})]})}}]),r}(ha);gl.CLASS_NAME="Time";var pl="tbs",yl="version",kl="serialNumber",wl="signature",bl="issuer",Sl="notBefore",Al="notAfter",Nl="subject",Cl="subjectPublicKeyInfo",xl="issuerUniqueID",El="subjectUniqueID",Il="extensions",Bl="signatureAlgorithm",Vl="signatureValue",Dl="tbsCertificate",Ol="".concat(Dl,".").concat(yl),Pl="".concat(Dl,".").concat(kl),Rl="".concat(Dl,".").concat(wl),Ul="".concat(Dl,".").concat(bl),Tl="".concat(Dl,".").concat(Sl),Ll="".concat(Dl,".").concat(Al),Hl="".concat(Dl,".").concat(Nl),Ml="".concat(Dl,".").concat(Cl),Kl="".concat(Dl,".").concat(xl),_l="".concat(Dl,".").concat(El),jl="".concat(Dl,".").concat(Il),Jl=[Dl,Ol,Pl,Rl,Ul,Tl,Ll,Hl,Ml,Kl,_l,jl,Bl,Vl];function Fl(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Oe(e,"names",{});return new sr({name:t.blockName||Dl,value:[new xt({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new Gt({name:t.tbsCertificateVersion||Ol})]}),new Gt({name:t.tbsCertificateSerialNumber||Pl}),Ha.schema(t.signature||{names:{blockName:Rl}}),ya.schema(t.issuer||{names:{blockName:Ul}}),new sr({name:t.tbsCertificateValidity||"tbsCertificate.validity",value:[gl.schema(t.notBefore||{names:{utcTimeName:Tl,generalTimeName:Tl}}),gl.schema(t.notAfter||{names:{utcTimeName:Ll,generalTimeName:Ll}})]}),ya.schema(t.subject||{names:{blockName:Hl}}),vs.schema(t.subjectPublicKeyInfo||{names:{blockName:Ml}}),new wt({name:t.tbsCertificateIssuerUniqueID||Kl,optional:!0,idBlock:{tagClass:3,tagNumber:1}}),new wt({name:t.tbsCertificateSubjectUniqueID||_l,optional:!0,idBlock:{tagClass:3,tagNumber:2}}),new xt({optional:!0,idBlock:{tagClass:3,tagNumber:3},value:[no.schema(t.extensions||{names:{blockName:jl}})]})]})}var ql=function(e){h(c,e);var t,r,n,i,o=w(c);function c(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return u(this,c),(e=o.call(this)).tbsView=new Uint8Array(Oe(t,pl,c.defaultValues(pl))),e.version=Oe(t,yl,c.defaultValues(yl)),e.serialNumber=Oe(t,kl,c.defaultValues(kl)),e.signature=Oe(t,wl,c.defaultValues(wl)),e.issuer=Oe(t,bl,c.defaultValues(bl)),e.notBefore=Oe(t,Sl,c.defaultValues(Sl)),e.notAfter=Oe(t,Al,c.defaultValues(Al)),e.subject=Oe(t,Nl,c.defaultValues(Nl)),e.subjectPublicKeyInfo=Oe(t,Cl,c.defaultValues(Cl)),xl in t&&(e.issuerUniqueID=Oe(t,xl,c.defaultValues(xl))),El in t&&(e.subjectUniqueID=Oe(t,El,c.defaultValues(El))),Il in t&&(e.extensions=Oe(t,Il,c.defaultValues(Il))),e.signatureAlgorithm=Oe(t,Bl,c.defaultValues(Bl)),e.signatureValue=Oe(t,Vl,c.defaultValues(Vl)),t.schema&&e.fromSchema(t.schema),e}return l(c,[{key:"tbs",get:function(){return Ie.toArrayBuffer(this.tbsView)},set:function(e){this.tbsView=new Uint8Array(e)}},{key:"fromSchema",value:function(e){Ge(e,Jl);var t=ra(e,e,c.schema({names:{tbsCertificate:{names:{extensions:{names:{extensions:jl}}}}}}));ca.assertSchema(t,this.className),this.tbsView=t.result.tbsCertificate.valueBeforeDecodeView,Ol in t.result&&(this.version=t.result[Ol].valueBlock.valueDec),this.serialNumber=t.result[Pl],this.signature=new Ha({schema:t.result[Rl]}),this.issuer=new ya({schema:t.result[Ul]}),this.notBefore=new gl({schema:t.result[Tl]}),this.notAfter=new gl({schema:t.result[Ll]}),this.subject=new ya({schema:t.result[Hl]}),this.subjectPublicKeyInfo=new vs({schema:t.result[Ml]}),Kl in t.result&&(this.issuerUniqueID=t.result[Kl].valueBlock.valueHex),_l in t.result&&(this.subjectUniqueID=t.result[_l].valueBlock.valueHex),jl in t.result&&(this.extensions=Array.from(t.result[jl],(function(e){return new to({schema:e})}))),this.signatureAlgorithm=new Ha({schema:t.result.signatureAlgorithm}),this.signatureValue=t.result.signatureValue}},{key:"encodeTBS",value:function(){var e=[];return yl in this&&this.version!==c.defaultValues(yl)&&e.push(new xt({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new Gt({value:this.version})]})),e.push(this.serialNumber),e.push(this.signature.toSchema()),e.push(this.issuer.toSchema()),e.push(new sr({value:[this.notBefore.toSchema(),this.notAfter.toSchema()]})),e.push(this.subject.toSchema()),e.push(this.subjectPublicKeyInfo.toSchema()),this.issuerUniqueID&&e.push(new wt({optional:!0,idBlock:{tagClass:3,tagNumber:1},valueHex:this.issuerUniqueID})),this.subjectUniqueID&&e.push(new wt({optional:!0,idBlock:{tagClass:3,tagNumber:2},valueHex:this.subjectUniqueID})),this.extensions&&e.push(new xt({optional:!0,idBlock:{tagClass:3,tagNumber:3},value:[new sr({value:Array.from(this.extensions,(function(e){return e.toSchema()}))})]})),new sr({value:e})}},{key:"toSchema",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!1===t){if(!this.tbsView.byteLength)return c.schema().value[0];var r=At(this.tbsView);ca.assert(r,"TBS Certificate"),e=r.result}else e=this.encodeTBS();return new sr({value:[e,this.signatureAlgorithm.toSchema(),this.signatureValue]})}},{key:"toJSON",value:function(){var e={tbs:De.ToHex(this.tbsView),version:this.version,serialNumber:this.serialNumber.toJSON(),signature:this.signature.toJSON(),issuer:this.issuer.toJSON(),notBefore:this.notBefore.toJSON(),notAfter:this.notAfter.toJSON(),subject:this.subject.toJSON(),subjectPublicKeyInfo:this.subjectPublicKeyInfo.toJSON(),signatureAlgorithm:this.signatureAlgorithm.toJSON(),signatureValue:this.signatureValue.toJSON()};return yl in this&&this.version!==c.defaultValues(yl)&&(e.version=this.version),this.issuerUniqueID&&(e.issuerUniqueID=De.ToHex(this.issuerUniqueID)),this.subjectUniqueID&&(e.subjectUniqueID=De.ToHex(this.subjectUniqueID)),this.extensions&&(e.extensions=Array.from(this.extensions,(function(e){return e.toJSON()}))),e}},{key:"getPublicKey",value:(i=s(a().mark((function e(t){var r,n=arguments;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.length>1&&void 0!==n[1]?n[1]:bu(!0),e.abrupt("return",r.getPublicKey(this.subjectPublicKeyInfo,this.signatureAlgorithm,t));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"getKeyHash",value:(n=s(a().mark((function e(){var t,r,n=arguments;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:"SHA-1",r=n.length>1&&void 0!==n[1]?n[1]:bu(!0),e.abrupt("return",r.digest({name:t},this.subjectPublicKeyInfo.subjectPublicKey.valueBlock.valueHexView));case 3:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"sign",value:(r=s(a().mark((function e(t){var r,n,i,s,u,o=arguments;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=o.length>1&&void 0!==o[1]?o[1]:"SHA-1",n=o.length>2&&void 0!==o[2]?o[2]:bu(!0),t){e.next=4;break}throw new Error("Need to provide a private key for signing");case 4:return e.next=6,n.getSignatureParameters(t,r);case 6:return i=e.sent,s=i.parameters,this.signature=i.signatureAlgorithm,this.signatureAlgorithm=i.signatureAlgorithm,this.tbsView=new Uint8Array(this.encodeTBS().toBER()),e.next=13,n.signWithPrivateKey(this.tbsView,t,s);case 13:u=e.sent,this.signatureValue=new _t({valueHex:u});case 15:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"verify",value:(t=s(a().mark((function e(t){var r,n,i=arguments;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=i.length>1&&void 0!==i[1]?i[1]:bu(!0),t?n=t.subjectPublicKeyInfo:this.issuer.isEqual(this.subject)&&(n=this.subjectPublicKeyInfo),n instanceof vs){e.next=4;break}throw new Error("Please provide issuer certificate as a parameter");case 4:return e.abrupt("return",r.verifyWithPublicKey(this.tbsView,this.signatureValue,n,this.signatureAlgorithm));case 5:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}],[{key:"defaultValues",value:function(e){switch(e){case pl:return sa;case yl:return 0;case kl:return new Gt;case wl:return new Ha;case bl:return new ya;case Sl:case Al:return new gl;case Nl:return new ya;case Cl:return new vs;case xl:case El:return sa;case Il:return[];case Bl:return new Ha;case Vl:return new _t;default:return S(f(c),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Oe(e,"names",{});return new sr({name:t.blockName||ua,value:[Fl(t.tbsCertificate),Ha.schema(t.signatureAlgorithm||{names:{blockName:Bl}}),new _t({name:t.signatureValue||Vl})]})}}]),c}(ha);function Xl(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(t&&e.issuer.isEqual(t.issuer)&&e.serialNumber.isEqual(t.serialNumber))return null;var r=!1;if(e.extensions){var a,n=E(e.extensions);try{for(n.s();!(a=n.n()).done;){var i=a.value;if(i.extnID===an&&i.parsedValue instanceof Rn&&i.parsedValue.cA){r=!0;break}}}catch(e){n.e(e)}finally{n.f()}}return r?e:null}ql.CLASS_NAME="Certificate";var Wl="certId",Gl="certValue",zl="parsedValue",Ql=[Wl,Gl],Yl=function(e){h(r,e);var t=w(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return u(this,r),(e=t.call(this)).certId=Oe(a,Wl,r.defaultValues(Wl)),e.certValue=Oe(a,Gl,r.defaultValues(Gl)),zl in a&&(e.parsedValue=Oe(a,zl,r.defaultValues(zl))),a.schema&&e.fromSchema(a.schema),e}return l(r,[{key:"fromSchema",value:function(e){Ge(e,Ql);var t=ra(e,e,r.schema({names:{id:Wl,value:Gl}}));ca.assertSchema(t,this.className),this.certId=t.result.certId.valueBlock.toString(),this.certValue=t.result.certValue;var a=this.certValue.valueBlock.valueHexView;switch(this.certId){case Sn:try{this.parsedValue=ql.fromBER(a)}catch(e){il.fromBER(a)}break;case An:this.parsedValue=il.fromBER(a);break;default:throw new Error("Incorrect CERT_ID value in CertBag: ".concat(this.certId))}}},{key:"toSchema",value:function(){return zl in this&&("acinfo"in this.parsedValue?this.certId=An:this.certId=Sn,this.certValue=new Lt({valueHex:this.parsedValue.toSchema().toBER(!1)})),new sr({value:[new $t({value:this.certId}),new xt({idBlock:{tagClass:3,tagNumber:0},value:["toSchema"in this.certValue?this.certValue.toSchema():this.certValue]})]})}},{key:"toJSON",value:function(){return{certId:this.certId,certValue:this.certValue.toJSON()}}}],[{key:"defaultValues",value:function(e){switch(e){case Wl:return ua;case Gl:return new Zr;case zl:return{};default:return S(f(r),"defaultValues",this).call(this,e)}}},{key:"compareWithDefault",value:function(e,t){switch(e){case Wl:return t===ua;case Gl:return t instanceof Zr;case zl:return t instanceof Object&&0===Object.keys(t).length;default:return S(f(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Oe(e,"names",{});return new sr({name:t.blockName||ua,value:[new $t({name:t.id||"id"}),new xt({idBlock:{tagClass:3,tagNumber:0},value:[new Zr({name:t.value||"value"})]})]})}}]),r}(ha);Yl.CLASS_NAME="CertBag";var Zl="userCertificate",$l="revocationDate",ec="crlEntryExtensions",tc=[Zl,$l,ec],rc=function(e){h(r,e);var t=w(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return u(this,r),(e=t.call(this)).userCertificate=Oe(a,Zl,r.defaultValues(Zl)),e.revocationDate=Oe(a,$l,r.defaultValues($l)),ec in a&&(e.crlEntryExtensions=Oe(a,ec,r.defaultValues(ec))),a.schema&&e.fromSchema(a.schema),e}return l(r,[{key:"fromSchema",value:function(e){Ge(e,tc);var t=ra(e,e,r.schema());ca.assertSchema(t,this.className),this.userCertificate=t.result.userCertificate,this.revocationDate=new gl({schema:t.result.revocationDate}),ec in t.result&&(this.crlEntryExtensions=new no({schema:t.result.crlEntryExtensions}))}},{key:"toSchema",value:function(){var e=[this.userCertificate,this.revocationDate.toSchema()];return this.crlEntryExtensions&&e.push(this.crlEntryExtensions.toSchema()),new sr({value:e})}},{key:"toJSON",value:function(){var e={userCertificate:this.userCertificate.toJSON(),revocationDate:this.revocationDate.toJSON()};return this.crlEntryExtensions&&(e.crlEntryExtensions=this.crlEntryExtensions.toJSON()),e}}],[{key:"defaultValues",value:function(e){switch(e){case Zl:return new Gt;case $l:return new gl;case ec:return new no;default:return S(f(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Oe(e,"names",{});return new sr({name:t.blockName||ua,value:[new Gt({name:t.userCertificate||Zl}),gl.schema({names:{utcTimeName:t.revocationDate||$l,generalTimeName:t.revocationDate||$l}}),no.schema({names:{blockName:t.crlEntryExtensions||ec}},!0)]})}}]),r}(ha);rc.CLASS_NAME="RevokedCertificate";var ac="tbs",nc="version",ic="signature",sc="issuer",uc="thisUpdate",oc="nextUpdate",lc="revokedCertificates",cc="crlExtensions",hc="signatureAlgorithm",fc="signatureValue",mc="tbsCertList",vc="".concat(mc,".version"),dc="".concat(mc,".signature"),gc="".concat(mc,".issuer"),pc="".concat(mc,".thisUpdate"),yc="".concat(mc,".nextUpdate"),kc="".concat(mc,".revokedCertificates"),wc="".concat(mc,".extensions"),bc=[mc,vc,dc,gc,pc,yc,kc,wc,hc,fc];function Sc(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Oe(e,"names",{});return new sr({name:t.blockName||mc,value:[new Gt({optional:!0,name:t.tbsCertListVersion||vc,value:2}),Ha.schema(t.signature||{names:{blockName:dc}}),ya.schema(t.issuer||{names:{blockName:gc}}),gl.schema(t.tbsCertListThisUpdate||{names:{utcTimeName:pc,generalTimeName:pc}}),gl.schema(t.tbsCertListNextUpdate||{names:{utcTimeName:yc,generalTimeName:yc}},!0),new sr({optional:!0,value:[new ea({name:t.tbsCertListRevokedCertificates||kc,value:new sr({value:[new Gt,gl.schema(),no.schema({},!0)]})})]}),new xt({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[no.schema(t.crlExtensions||{names:{blockName:wc}})]})]})}var Ac=[mn,rn,"2.5.29.20","2.5.29.27",nn,ln,gn,"2.5.29.21","2.5.29.24",sn],Nc=function(e){h(i,e);var t,r,n=w(i);function i(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return u(this,i),(e=n.call(this)).tbsView=new Uint8Array(Oe(t,ac,i.defaultValues(ac))),e.version=Oe(t,nc,i.defaultValues(nc)),e.signature=Oe(t,ic,i.defaultValues(ic)),e.issuer=Oe(t,sc,i.defaultValues(sc)),e.thisUpdate=Oe(t,uc,i.defaultValues(uc)),oc in t&&(e.nextUpdate=Oe(t,oc,i.defaultValues(oc))),lc in t&&(e.revokedCertificates=Oe(t,lc,i.defaultValues(lc))),cc in t&&(e.crlExtensions=Oe(t,cc,i.defaultValues(cc))),e.signatureAlgorithm=Oe(t,hc,i.defaultValues(hc)),e.signatureValue=Oe(t,fc,i.defaultValues(fc)),t.schema&&e.fromSchema(t.schema),e}return l(i,[{key:"tbs",get:function(){return Ie.toArrayBuffer(this.tbsView)},set:function(e){this.tbsView=new Uint8Array(e)}},{key:"fromSchema",value:function(e){Ge(e,bc);var t=ra(e,e,i.schema());ca.assertSchema(t,this.className),this.tbsView=t.result.tbsCertList.valueBeforeDecodeView,vc in t.result&&(this.version=t.result[vc].valueBlock.valueDec),this.signature=new Ha({schema:t.result[dc]}),this.issuer=new ya({schema:t.result[gc]}),this.thisUpdate=new gl({schema:t.result[pc]}),yc in t.result&&(this.nextUpdate=new gl({schema:t.result[yc]})),kc in t.result&&(this.revokedCertificates=Array.from(t.result[kc],(function(e){return new rc({schema:e})}))),wc in t.result&&(this.crlExtensions=new no({schema:t.result[wc]})),this.signatureAlgorithm=new Ha({schema:t.result.signatureAlgorithm}),this.signatureValue=t.result.signatureValue}},{key:"encodeTBS",value:function(){var e=[];return this.version!==i.defaultValues(nc)&&e.push(new Gt({value:this.version})),e.push(this.signature.toSchema()),e.push(this.issuer.toSchema()),e.push(this.thisUpdate.toSchema()),this.nextUpdate&&e.push(this.nextUpdate.toSchema()),this.revokedCertificates&&e.push(new sr({value:Array.from(this.revokedCertificates,(function(e){return e.toSchema()}))})),this.crlExtensions&&e.push(new xt({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[this.crlExtensions.toSchema()]})),new sr({value:e})}},{key:"toSchema",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(t)e=this.encodeTBS();else{if(!this.tbsView.byteLength)return i.schema();var r=At(this.tbsView);ca.assert(r,"TBS Certificate Revocation List"),e=r.result}return new sr({value:[e,this.signatureAlgorithm.toSchema(),this.signatureValue]})}},{key:"toJSON",value:function(){var e={tbs:De.ToHex(this.tbsView),version:this.version,signature:this.signature.toJSON(),issuer:this.issuer.toJSON(),thisUpdate:this.thisUpdate.toJSON(),signatureAlgorithm:this.signatureAlgorithm.toJSON(),signatureValue:this.signatureValue.toJSON()};return this.version!==i.defaultValues(nc)&&(e.version=this.version),this.nextUpdate&&(e.nextUpdate=this.nextUpdate.toJSON()),this.revokedCertificates&&(e.revokedCertificates=Array.from(this.revokedCertificates,(function(e){return e.toJSON()}))),this.crlExtensions&&(e.crlExtensions=this.crlExtensions.toJSON()),e}},{key:"isCertificateRevoked",value:function(e){if(!this.issuer.isEqual(e.issuer))return!1;if(!this.revokedCertificates)return!1;var t,r=E(this.revokedCertificates);try{for(r.s();!(t=r.n()).done;){if(t.value.userCertificate.isEqual(e.serialNumber))return!0}}catch(e){r.e(e)}finally{r.f()}return!1}},{key:"sign",value:(r=s(a().mark((function e(t){var r,n,i,s,u,o=arguments;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=o.length>1&&void 0!==o[1]?o[1]:"SHA-1",n=o.length>2&&void 0!==o[2]?o[2]:bu(!0),t){e.next=4;break}throw new Error("Need to provide a private key for signing");case 4:return e.next=6,n.getSignatureParameters(t,r);case 6:return i=e.sent,s=i.parameters,this.signature=i.signatureAlgorithm,this.signatureAlgorithm=i.signatureAlgorithm,this.tbsView=new Uint8Array(this.encodeTBS().toBER()),e.next=13,n.signWithPrivateKey(this.tbsView,t,s);case 13:u=e.sent,this.signatureValue=new _t({valueHex:u});case 15:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"verify",value:(t=s(a().mark((function e(){var t,r,n,i,s,u,o=arguments;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=o.length>0&&void 0!==o[0]?o[0]:{},r=o.length>1&&void 0!==o[1]?o[1]:bu(!0),!t.issuerCertificate){e.next=6;break}if(n=t.issuerCertificate.subjectPublicKeyInfo,this.issuer.isEqual(t.issuerCertificate.subject)){e.next=6;break}return e.abrupt("return",!1);case 6:if(t.publicKeyInfo&&(n=t.publicKeyInfo),n){e.next=9;break}throw new Error("Issuer's certificate must be provided as an input parameter");case 9:if(!this.crlExtensions){e.next=28;break}i=E(this.crlExtensions.extensions),e.prev=11,i.s();case 13:if((s=i.n()).done){e.next=20;break}if(!(u=s.value).critical){e.next=18;break}if(Ac.includes(u.extnID)){e.next=18;break}return e.abrupt("return",!1);case 18:e.next=13;break;case 20:e.next=25;break;case 22:e.prev=22,e.t0=e.catch(11),i.e(e.t0);case 25:return e.prev=25,i.f(),e.finish(25);case 28:return e.abrupt("return",r.verifyWithPublicKey(this.tbsView,this.signatureValue,n,this.signatureAlgorithm));case 29:case"end":return e.stop()}}),e,this,[[11,22,25,28]])}))),function(){return t.apply(this,arguments)})}],[{key:"defaultValues",value:function(e){switch(e){case ac:return sa;case nc:return 0;case ic:return new Ha;case sc:return new ya;case uc:case oc:return new gl;case lc:return[];case cc:return new no;case hc:return new Ha;case fc:return new _t;default:return S(f(i),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Oe(e,"names",{});return new sr({name:t.blockName||"CertificateList",value:[Sc(e),Ha.schema(t.signatureAlgorithm||{names:{blockName:hc}}),new _t({name:t.signatureValue||fc})]})}}]),i}(ha);Nc.CLASS_NAME="CertificateRevocationList";var Cc="crlId",xc="crlValue",Ec="parsedValue",Ic=[Cc,xc],Bc=function(e){h(r,e);var t=w(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return u(this,r),(e=t.call(this)).crlId=Oe(a,Cc,r.defaultValues(Cc)),e.crlValue=Oe(a,xc,r.defaultValues(xc)),Ec in a&&(e.parsedValue=Oe(a,Ec,r.defaultValues(Ec))),a.schema&&e.fromSchema(a.schema),e}return l(r,[{key:"fromSchema",value:function(e){Ge(e,Ic);var t=ra(e,e,r.schema({names:{id:Cc,value:xc}}));if(ca.assertSchema(t,this.className),this.crlId=t.result.crlId.valueBlock.toString(),this.crlValue=t.result.crlValue,this.crlId!==Nn)throw new Error("Incorrect CRL_ID value in CRLBag: ".concat(this.crlId));this.parsedValue=Nc.fromBER(this.certValue.valueBlock.valueHex)}},{key:"toSchema",value:function(){return this.parsedValue&&(this.crlId=Nn,this.crlValue=new Lt({valueHex:this.parsedValue.toSchema().toBER(!1)})),new sr({value:[new $t({value:this.crlId}),new xt({idBlock:{tagClass:3,tagNumber:0},value:[this.crlValue.toSchema()]})]})}},{key:"toJSON",value:function(){return{crlId:this.crlId,crlValue:this.crlValue.toJSON()}}}],[{key:"defaultValues",value:function(e){switch(e){case Cc:return ua;case xc:return new Zr;case Ec:return{};default:return S(f(r),"defaultValues",this).call(this,e)}}},{key:"compareWithDefault",value:function(e,t){switch(e){case Cc:return t===ua;case xc:return t instanceof Zr;case Ec:return t instanceof Object&&0===Object.keys(t).length;default:return S(f(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Oe(e,"names",{});return new sr({name:t.blockName||ua,value:[new $t({name:t.id||"id"}),new xt({idBlock:{tagClass:3,tagNumber:0},value:[new Zr({name:t.value||"value"})]})]})}}]),r}(ha);Bc.CLASS_NAME="CRLBag";var Vc="version",Dc="encryptedContentInfo",Oc="unprotectedAttrs",Pc=[Vc,Dc,Oc],Rc=function(e){h(o,e);var t,n,i=w(o);function o(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return u(this,o),(e=i.call(this)).version=Oe(t,Vc,o.defaultValues(Vc)),e.encryptedContentInfo=Oe(t,Dc,o.defaultValues(Dc)),Oc in t&&(e.unprotectedAttrs=Oe(t,Oc,o.defaultValues(Oc))),t.schema&&e.fromSchema(t.schema),e}return l(o,[{key:"fromSchema",value:function(e){Ge(e,Pc);var t=ra(e,e,o.schema({names:{version:Vc,encryptedContentInfo:{names:{blockName:Dc}},unprotectedAttrs:Oc}}));ca.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,this.encryptedContentInfo=new zs({schema:t.result.encryptedContentInfo}),Oc in t.result&&(this.unprotectedAttrs=Array.from(t.result.unprotectedAttrs,(function(e){return new qa({schema:e})})))}},{key:"toSchema",value:function(){var e=[];return e.push(new Gt({value:this.version})),e.push(this.encryptedContentInfo.toSchema()),this.unprotectedAttrs&&e.push(new xt({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:Array.from(this.unprotectedAttrs,(function(e){return e.toSchema()}))})),new sr({value:e})}},{key:"toJSON",value:function(){var e={version:this.version,encryptedContentInfo:this.encryptedContentInfo.toJSON()};return this.unprotectedAttrs&&(e.unprotectedAttrs=Array.from(this.unprotectedAttrs,(function(e){return e.toJSON()}))),e}},{key:"encrypt",value:(n=s(a().mark((function e(t){var n;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return oa.assert(t,"parameters","object"),n=r(r({},t),{},{contentType:"1.2.840.113549.1.7.1"}),e.next=4,bu(!0).encryptEncryptedContentInfo(n);case 4:this.encryptedContentInfo=e.sent;case 5:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"decrypt",value:(t=s(a().mark((function e(t){var n,i,s=arguments;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=s.length>1&&void 0!==s[1]?s[1]:bu(!0),oa.assert(t,"parameters","object"),i=r(r({},t),{},{encryptedContentInfo:this.encryptedContentInfo}),e.abrupt("return",n.decryptEncryptedContentInfo(i));case 4:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}],[{key:"defaultValues",value:function(e){switch(e){case Vc:return 0;case Dc:return new zs;case Oc:return[];default:return S(f(o),"defaultValues",this).call(this,e)}}},{key:"compareWithDefault",value:function(e,t){switch(e){case Vc:return 0===t;case Dc:return zs.compareWithDefault("contentType",t.contentType)&&zs.compareWithDefault("contentEncryptionAlgorithm",t.contentEncryptionAlgorithm)&&zs.compareWithDefault("encryptedContent",t.encryptedContent);case Oc:return 0===t.length;default:return S(f(o),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Oe(e,"names",{});return new sr({name:t.blockName||ua,value:[new Gt({name:t.version||ua}),zs.schema(t.encryptedContentInfo||{}),new xt({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new ea({name:t.unprotectedAttrs||ua,value:qa.schema()})]})]})}}]),o}(ha);Rc.CLASS_NAME="EncryptedData";var Uc="encryptionAlgorithm",Tc="encryptedData",Lc="parsedValue",Hc=[Uc,Tc],Mc=function(e){h(o,e);var t,n,i=w(o);function o(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return u(this,o),(e=i.call(this)).encryptionAlgorithm=Oe(t,Uc,o.defaultValues(Uc)),e.encryptedData=Oe(t,Tc,o.defaultValues(Tc)),Lc in t&&(e.parsedValue=Oe(t,Lc,o.defaultValues(Lc))),t.schema&&e.fromSchema(t.schema),e}return l(o,[{key:"fromSchema",value:function(e){Ge(e,Hc);var t=ra(e,e,o.schema({names:{encryptionAlgorithm:{names:{blockName:Uc}},encryptedData:Tc}}));ca.assertSchema(t,this.className),this.encryptionAlgorithm=new Ha({schema:t.result.encryptionAlgorithm}),this.encryptedData=t.result.encryptedData}},{key:"toSchema",value:function(){return new sr({value:[this.encryptionAlgorithm.toSchema(),this.encryptedData]})}},{key:"toJSON",value:function(){return{encryptionAlgorithm:this.encryptionAlgorithm.toJSON(),encryptedData:this.encryptedData.toJSON()}}},{key:"parseInternalValues",value:(n=s(a().mark((function e(t){var r,n,i,s=arguments;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=s.length>1&&void 0!==s[1]?s[1]:bu(!0),n=new Rc({encryptedContentInfo:new zs({contentEncryptionAlgorithm:this.encryptionAlgorithm,encryptedContent:this.encryptedData})}),e.next=4,n.decrypt(t,r);case 4:i=e.sent,this.parsedValue=Fs.fromBER(i);case 6:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"makeInternalValues",value:(t=s(a().mark((function e(t){var n,i;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.parsedValue){e.next=2;break}throw new Error('Please initialize "parsedValue" first');case 2:return n=new Rc,i=r(r({},t),{},{contentToEncrypt:this.parsedValue.toSchema().toBER(!1)}),e.next=6,n.encrypt(i);case 6:if(n.encryptedContentInfo.encryptedContent){e.next=8;break}throw new Error("The filed `encryptedContent` in EncryptedContentInfo is empty");case 8:this.encryptionAlgorithm=n.encryptedContentInfo.contentEncryptionAlgorithm,this.encryptedData=n.encryptedContentInfo.encryptedContent;case 10:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}],[{key:"defaultValues",value:function(e){switch(e){case Uc:return new Ha;case Tc:return new Lt;case Lc:return{};default:return S(f(o),"defaultValues",this).call(this,e)}}},{key:"compareWithDefault",value:function(e,t){switch(e){case Uc:return Ha.compareWithDefault("algorithmId",t.algorithmId)&&"algorithmParams"in t==!1;case Tc:return t.isEqual(o.defaultValues(e));case Lc:return t instanceof Object&&0===Object.keys(t).length;default:return S(f(o),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Oe(e,"names",{});return new sr({name:t.blockName||ua,value:[Ha.schema(t.encryptionAlgorithm||{names:{blockName:Uc}}),new $r({value:[new Lt({name:t.encryptedData||Tc}),new Lt({idBlock:{isConstructed:!0},name:t.encryptedData||Tc})]})]})}}]),o}(ha);Mc.CLASS_NAME="PKCS8ShroudedKeyBag";var Kc="secretTypeId",_c="secretValue",jc=[Kc,_c],Jc=function(e){h(r,e);var t=w(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return u(this,r),(e=t.call(this)).secretTypeId=Oe(a,Kc,r.defaultValues(Kc)),e.secretValue=Oe(a,_c,r.defaultValues(_c)),a.schema&&e.fromSchema(a.schema),e}return l(r,[{key:"fromSchema",value:function(e){Ge(e,jc);var t=ra(e,e,r.schema({names:{id:Kc,value:_c}}));ca.assertSchema(t,this.className),this.secretTypeId=t.result.secretTypeId.valueBlock.toString(),this.secretValue=t.result.secretValue}},{key:"toSchema",value:function(){return new sr({value:[new $t({value:this.secretTypeId}),new xt({idBlock:{tagClass:3,tagNumber:0},value:[this.secretValue.toSchema()]})]})}},{key:"toJSON",value:function(){return{secretTypeId:this.secretTypeId,secretValue:this.secretValue.toJSON()}}}],[{key:"defaultValues",value:function(e){switch(e){case Kc:return ua;case _c:return new Zr;default:return S(f(r),"defaultValues",this).call(this,e)}}},{key:"compareWithDefault",value:function(e,t){switch(e){case Kc:return t===ua;case _c:return t instanceof Zr;default:return S(f(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Oe(e,"names",{});return new sr({name:t.blockName||ua,value:[new $t({name:t.id||"id"}),new xt({idBlock:{tagClass:3,tagNumber:0},value:[new Zr({name:t.value||"value"})]})]})}}]),r}(ha);Jc.CLASS_NAME="SecretBag";var Fc=function(){function e(){u(this,e)}return l(e,null,[{key:"getItems",value:function(){return this.items||(this.items={},e.register("1.2.840.113549.1.12.10.1.1",Fs),e.register("1.2.840.113549.1.12.10.1.2",Mc),e.register("1.2.840.113549.1.12.10.1.3",Yl),e.register("1.2.840.113549.1.12.10.1.4",Bc),e.register("1.2.840.113549.1.12.10.1.5",Jc),e.register("1.2.840.113549.1.12.10.1.6",Yc)),this.items}},{key:"register",value:function(e,t){this.getItems()[e]=t}},{key:"find",value:function(e){return this.getItems()[e]||null}}]),e}(),qc="bagId",Xc="bagValue",Wc="bagAttributes",Gc=[qc,Xc,Wc],zc=function(e){h(r,e);var t=w(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return u(this,r),(e=t.call(this)).bagId=Oe(a,qc,r.defaultValues(qc)),e.bagValue=Oe(a,Xc,r.defaultValues(Xc)),Wc in a&&(e.bagAttributes=Oe(a,Wc,r.defaultValues(Wc))),a.schema&&e.fromSchema(a.schema),e}return l(r,[{key:"fromSchema",value:function(e){Ge(e,Gc);var t=ra(e,e,r.schema({names:{bagId:qc,bagValue:Xc,bagAttributes:Wc}}));ca.assertSchema(t,this.className),this.bagId=t.result.bagId.valueBlock.toString();var a=Fc.find(this.bagId);if(!a)throw new Error("Invalid BAG_ID for SafeBag: ".concat(this.bagId));this.bagValue=new a({schema:t.result.bagValue}),Wc in t.result&&(this.bagAttributes=Array.from(t.result.bagAttributes,(function(e){return new qa({schema:e})})))}},{key:"toSchema",value:function(){var e=[new $t({value:this.bagId}),new xt({idBlock:{tagClass:3,tagNumber:0},value:[this.bagValue.toSchema()]})];return this.bagAttributes&&e.push(new ur({value:Array.from(this.bagAttributes,(function(e){return e.toSchema()}))})),new sr({value:e})}},{key:"toJSON",value:function(){var e={bagId:this.bagId,bagValue:this.bagValue.toJSON()};return this.bagAttributes&&(e.bagAttributes=Array.from(this.bagAttributes,(function(e){return e.toJSON()}))),e}}],[{key:"defaultValues",value:function(e){switch(e){case qc:return ua;case Xc:return new Zr;case Wc:return[];default:return S(f(r),"defaultValues",this).call(this,e)}}},{key:"compareWithDefault",value:function(e,t){switch(e){case qc:return t===ua;case Xc:return t instanceof Zr;case Wc:return 0===t.length;default:return S(f(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Oe(e,"names",{});return new sr({name:t.blockName||ua,value:[new $t({name:t.bagId||qc}),new xt({idBlock:{tagClass:3,tagNumber:0},value:[new Zr({name:t.bagValue||Xc})]}),new ur({optional:!0,value:[new ea({name:t.bagAttributes||Wc,value:qa.schema()})]})]})}}]),r}(ha);zc.CLASS_NAME="SafeBag";var Qc="safeBags",Yc=function(e){h(r,e);var t=w(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return u(this,r),(e=t.call(this)).safeBags=Oe(a,Qc,r.defaultValues(Qc)),a.schema&&e.fromSchema(a.schema),e}return l(r,[{key:"fromSchema",value:function(e){Ge(e,[Qc]);var t=ra(e,e,r.schema({names:{safeBags:Qc}}));ca.assertSchema(t,this.className),this.safeBags=Array.from(t.result.safeBags,(function(e){return new zc({schema:e})}))}},{key:"toSchema",value:function(){return new sr({value:Array.from(this.safeBags,(function(e){return e.toSchema()}))})}},{key:"toJSON",value:function(){return{safeBags:Array.from(this.safeBags,(function(e){return e.toJSON()}))}}}],[{key:"defaultValues",value:function(e){return e===Qc?[]:S(f(r),"defaultValues",this).call(this,e)}},{key:"compareWithDefault",value:function(e,t){return e===Qc?0===t.length:S(f(r),"defaultValues",this).call(this,e)}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Oe(e,"names",{});return new sr({name:t.blockName||ua,value:[new ea({name:t.safeBags||ua,value:zc.schema()})]})}}]),r}(ha);Yc.CLASS_NAME="SafeContents";var Zc="otherCertFormat",$c="otherCert",eh=[Zc,$c],th=function(e){h(r,e);var t=w(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return u(this,r),(e=t.call(this)).otherCertFormat=Oe(a,Zc,r.defaultValues(Zc)),e.otherCert=Oe(a,$c,r.defaultValues($c)),a.schema&&e.fromSchema(a.schema),e}return l(r,[{key:"fromSchema",value:function(e){Ge(e,eh);var t=ra(e,e,r.schema());ca.assertSchema(t,this.className),this.otherCertFormat=t.result.otherCertFormat.valueBlock.toString(),this.otherCert=t.result.otherCert}},{key:"toSchema",value:function(){return new sr({value:[new $t({value:this.otherCertFormat}),this.otherCert]})}},{key:"toJSON",value:function(){var e={otherCertFormat:this.otherCertFormat};return this.otherCert instanceof Zr||(e.otherCert=this.otherCert.toJSON()),e}}],[{key:"defaultValues",value:function(e){switch(e){case Zc:return ua;case $c:return new Zr;default:return S(f(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Oe(e,"names",{});return new sr({name:t.blockName||ua,value:[new $t({name:t.otherCertFormat||Zc}),new Zr({name:t.otherCert||$c})]})}}]),r}(ha),rh="certificates",ah=[rh],nh=function(e){h(r,e);var t=w(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return u(this,r),(e=t.call(this)).certificates=Oe(a,rh,r.defaultValues(rh)),a.schema&&e.fromSchema(a.schema),e}return l(r,[{key:"fromSchema",value:function(e){Ge(e,ah);var t=ra(e,e,r.schema());ca.assertSchema(t,this.className),this.certificates=Array.from(t.result.certificates||[],(function(e){var t=e.idBlock.tagNumber;if(1===e.idBlock.tagClass)return new ql({schema:e});var r=new sr({value:e.valueBlock.value});switch(t){case 1:return 1===r.valueBlock.value[0].valueBlock.value[0].valueBlock.valueDec?new il({schema:r}):new Eo({schema:r});case 2:return new il({schema:r});case 3:return new th({schema:r})}return e}))}},{key:"toSchema",value:function(){return new ur({value:Array.from(this.certificates,(function(e){switch(!0){case e instanceof ql:return e.toSchema();case e instanceof Eo:return new xt({idBlock:{tagClass:3,tagNumber:1},value:e.toSchema().valueBlock.value});case e instanceof il:return new xt({idBlock:{tagClass:3,tagNumber:2},value:e.toSchema().valueBlock.value});case e instanceof th:return new xt({idBlock:{tagClass:3,tagNumber:3},value:e.toSchema().valueBlock.value})}return e.toSchema()}))})}},{key:"toJSON",value:function(){return{certificates:Array.from(this.certificates,(function(e){return e.toJSON()}))}}}],[{key:"defaultValues",value:function(e){return e===rh?[]:S(f(r),"defaultValues",this).call(this,e)}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Oe(e,"names",{});return new ur({name:t.blockName||ua,value:[new ea({name:t.certificates||rh,value:new $r({value:[ql.schema(),new xt({idBlock:{tagClass:3,tagNumber:0},value:[new Zr]}),new xt({idBlock:{tagClass:3,tagNumber:1},value:[new sr]}),new xt({idBlock:{tagClass:3,tagNumber:2},value:il.schema().valueBlock.value}),new xt({idBlock:{tagClass:3,tagNumber:3},value:th.schema().valueBlock.value})]})})]})}}]),r}(ha);nh.CLASS_NAME="CertificateSet";var ih="otherRevInfoFormat",sh="otherRevInfo",uh=[ih,sh],oh=function(e){h(r,e);var t=w(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return u(this,r),(e=t.call(this)).otherRevInfoFormat=Oe(a,ih,r.defaultValues(ih)),e.otherRevInfo=Oe(a,sh,r.defaultValues(sh)),a.schema&&e.fromSchema(a.schema),e}return l(r,[{key:"fromSchema",value:function(e){Ge(e,uh);var t=ra(e,e,r.schema());ca.assertSchema(t,this.className),this.otherRevInfoFormat=t.result.otherRevInfoFormat.valueBlock.toString(),this.otherRevInfo=t.result.otherRevInfo}},{key:"toSchema",value:function(){return new sr({value:[new $t({value:this.otherRevInfoFormat}),this.otherRevInfo]})}},{key:"toJSON",value:function(){var e={otherRevInfoFormat:this.otherRevInfoFormat};return this.otherRevInfo instanceof Zr||(e.otherRevInfo=this.otherRevInfo.toJSON()),e}}],[{key:"defaultValues",value:function(e){switch(e){case ih:return ua;case sh:return new Zr;default:return S(f(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Oe(e,"names",{});return new sr({name:t.blockName||ua,value:[new $t({name:t.otherRevInfoFormat||ih}),new Zr({name:t.otherRevInfo||sh})]})}}]),r}(ha);oh.CLASS_NAME="OtherRevocationInfoFormat";var lh="crls",ch="otherRevocationInfos",hh=[lh],fh=function(e){h(r,e);var t=w(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return u(this,r),(e=t.call(this)).crls=Oe(a,lh,r.defaultValues(lh)),e.otherRevocationInfos=Oe(a,ch,r.defaultValues(ch)),a.schema&&e.fromSchema(a.schema),e}return l(r,[{key:"fromSchema",value:function(e){Ge(e,hh);var t=ra(e,e,r.schema({names:{crls:lh}}));if(ca.assertSchema(t,this.className),t.result.crls){var a,n=E(t.result.crls);try{for(n.s();!(a=n.n()).done;){var i=a.value;1===i.idBlock.tagClass?this.crls.push(new Nc({schema:i})):this.otherRevocationInfos.push(new oh({schema:i}))}}catch(e){n.e(e)}finally{n.f()}}}},{key:"toSchema",value:function(){var e=[];return e.push.apply(e,N(Array.from(this.crls,(function(e){return e.toSchema()})))),e.push.apply(e,N(Array.from(this.otherRevocationInfos,(function(e){var t=e.toSchema();return t.idBlock.tagClass=3,t.idBlock.tagNumber=1,t})))),new ur({value:e})}},{key:"toJSON",value:function(){return{crls:Array.from(this.crls,(function(e){return e.toJSON()})),otherRevocationInfos:Array.from(this.otherRevocationInfos,(function(e){return e.toJSON()}))}}}],[{key:"defaultValues",value:function(e){switch(e){case lh:case ch:return[];default:return S(f(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Oe(e,"names",{});return new ur({name:t.blockName||ua,value:[new ea({name:t.crls||ua,value:new $r({value:[Nc.schema(),new xt({idBlock:{tagClass:3,tagNumber:1},value:[new $t,new Zr]})]})})]})}}]),r}(ha);fh.CLASS_NAME="RevocationInfoChoices";var mh="certs",vh="crls",dh=[mh,vh],gh=function(e){h(r,e);var t=w(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return u(this,r),(e=t.call(this)).crls=Oe(a,vh,r.defaultValues(vh)),a.schema&&e.fromSchema(a.schema),e}return l(r,[{key:"fromSchema",value:function(e){Ge(e,dh);var t=ra(e,e,r.schema({names:{certs:mh,crls:vh}}));ca.assertSchema(t,this.className),mh in t.result&&(this.certs=new nh({schema:new ur({value:t.result.certs.valueBlock.value})})),vh in t.result&&(this.crls=new fh({schema:new ur({value:t.result.crls.valueBlock.value})}))}},{key:"toSchema",value:function(){var e=[];return this.certs&&e.push(new xt({idBlock:{tagClass:3,tagNumber:0},value:this.certs.toSchema().valueBlock.value})),this.crls&&e.push(new xt({idBlock:{tagClass:3,tagNumber:1},value:this.crls.toSchema().valueBlock.value})),new sr({value:e})}},{key:"toJSON",value:function(){var e={};return this.certs&&(e.certs=this.certs.toJSON()),this.crls&&(e.crls=this.crls.toJSON()),e}}],[{key:"defaultValues",value:function(e){switch(e){case mh:return new nh;case vh:return new fh;default:return S(f(r),"defaultValues",this).call(this,e)}}},{key:"compareWithDefault",value:function(e,t){switch(e){case mh:return 0===t.certificates.length;case vh:return 0===t.crls.length&&0===t.otherRevocationInfos.length;default:return S(f(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Oe(e,"names",{});return new sr({name:t.blockName||ua,value:[new xt({name:t.certs||ua,optional:!0,idBlock:{tagClass:3,tagNumber:0},value:nh.schema().valueBlock.value}),new xt({name:t.crls||ua,optional:!0,idBlock:{tagClass:3,tagNumber:1},value:fh.schema().valueBlock.value})]})}}]),r}(ha);gh.CLASS_NAME="OriginatorInfo";var ph="issuer",yh="serialNumber",kh=[ph,yh],wh=function(e){h(r,e);var t=w(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return u(this,r),(e=t.call(this)).issuer=Oe(a,ph,r.defaultValues(ph)),e.serialNumber=Oe(a,yh,r.defaultValues(yh)),a.schema&&e.fromSchema(a.schema),e}return l(r,[{key:"fromSchema",value:function(e){Ge(e,kh);var t=ra(e,e,r.schema({names:{issuer:{names:{blockName:ph}},serialNumber:yh}}));ca.assertSchema(t,this.className),this.issuer=new ya({schema:t.result.issuer}),this.serialNumber=t.result.serialNumber}},{key:"toSchema",value:function(){return new sr({value:[this.issuer.toSchema(),this.serialNumber]})}},{key:"toJSON",value:function(){return{issuer:this.issuer.toJSON(),serialNumber:this.serialNumber.toJSON()}}}],[{key:"defaultValues",value:function(e){switch(e){case ph:return new ya;case yh:return new Gt;default:return S(f(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Oe(e,"names",{});return new sr({name:t.blockName||ua,value:[ya.schema(t.issuer||{}),new Gt({name:t.serialNumber||ua})]})}}]),r}(ha);wh.CLASS_NAME="IssuerAndSerialNumber";var bh="variant",Sh="value",Ah=["blockName"],Nh=function(e){h(r,e);var t=w(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return u(this,r),(e=t.call(this)).variant=Oe(a,bh,r.defaultValues(bh)),Sh in a&&(e.value=Oe(a,Sh,r.defaultValues(Sh))),a.schema&&e.fromSchema(a.schema),e}return l(r,[{key:"fromSchema",value:function(e){Ge(e,Ah);var t=ra(e,e,r.schema({names:{blockName:"blockName"}}));ca.assertSchema(t,this.className),1===t.result.blockName.idBlock.tagClass?(this.variant=1,this.value=new wh({schema:t.result.blockName})):(this.variant=2,this.value=new Lt({valueHex:t.result.blockName.valueBlock.valueHex}))}},{key:"toSchema",value:function(){switch(this.variant){case 1:if(!(this.value instanceof wh))throw new Error("Incorrect type of RecipientIdentifier.value. It should be IssuerAndSerialNumber.");return this.value.toSchema();case 2:if(!(this.value instanceof Lt))throw new Error("Incorrect type of RecipientIdentifier.value. It should be ASN.1 OctetString.");return new wt({idBlock:{tagClass:3,tagNumber:0},valueHex:this.value.valueBlock.valueHexView});default:return new Zr}}},{key:"toJSON",value:function(){var e={variant:this.variant};return 1!==this.variant&&2!==this.variant||!this.value||(e.value=this.value.toJSON()),e}}],[{key:"defaultValues",value:function(e){switch(e){case bh:return-1;case Sh:return{};default:return S(f(r),"defaultValues",this).call(this,e)}}},{key:"compareWithDefault",value:function(e,t){switch(e){case bh:return-1===t;case Sh:return 0===Object.keys(t).length;default:return S(f(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Oe(e,"names",{});return new $r({value:[wh.schema({names:{blockName:t.blockName||ua}}),new wt({name:t.blockName||ua,idBlock:{tagClass:3,tagNumber:0}})]})}}]),r}(ha);Nh.CLASS_NAME="RecipientIdentifier";var Ch="version",xh="rid",Eh="keyEncryptionAlgorithm",Ih="encryptedKey",Bh="recipientCertificate",Vh=[Ch,xh,Eh,Ih],Dh=function(e){h(r,e);var t=w(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return u(this,r),(e=t.call(this)).version=Oe(a,Ch,r.defaultValues(Ch)),e.rid=Oe(a,xh,r.defaultValues(xh)),e.keyEncryptionAlgorithm=Oe(a,Eh,r.defaultValues(Eh)),e.encryptedKey=Oe(a,Ih,r.defaultValues(Ih)),e.recipientCertificate=Oe(a,Bh,r.defaultValues(Bh)),a.schema&&e.fromSchema(a.schema),e}return l(r,[{key:"fromSchema",value:function(e){Ge(e,Vh);var t=ra(e,e,r.schema({names:{version:Ch,rid:{names:{blockName:xh}},keyEncryptionAlgorithm:{names:{blockName:Eh}},encryptedKey:Ih}}));ca.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,3===t.result.rid.idBlock.tagClass?this.rid=new Lt({valueHex:t.result.rid.valueBlock.valueHex}):this.rid=new wh({schema:t.result.rid}),this.keyEncryptionAlgorithm=new Ha({schema:t.result.keyEncryptionAlgorithm}),this.encryptedKey=t.result.encryptedKey}},{key:"toSchema",value:function(){var e=[];return this.rid instanceof wh?(this.version=0,e.push(new Gt({value:this.version})),e.push(this.rid.toSchema())):(this.version=2,e.push(new Gt({value:this.version})),e.push(new wt({idBlock:{tagClass:3,tagNumber:0},valueHex:this.rid.valueBlock.valueHexView}))),e.push(this.keyEncryptionAlgorithm.toSchema()),e.push(this.encryptedKey),new sr({value:e})}},{key:"toJSON",value:function(){return{version:this.version,rid:this.rid.toJSON(),keyEncryptionAlgorithm:this.keyEncryptionAlgorithm.toJSON(),encryptedKey:this.encryptedKey.toJSON()}}}],[{key:"defaultValues",value:function(e){switch(e){case Ch:return-1;case xh:return{};case Eh:return new Ha;case Ih:return new Lt;case Bh:return new ql;default:return S(f(r),"defaultValues",this).call(this,e)}}},{key:"compareWithDefault",value:function(e,t){switch(e){case Ch:return t===r.defaultValues(Ch);case xh:return 0===Object.keys(t).length;case Eh:case Ih:return t.isEqual(r.defaultValues(e));case Bh:return!1;default:return S(f(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Oe(e,"names",{});return new sr({name:t.blockName||ua,value:[new Gt({name:t.version||ua}),Nh.schema(t.rid||{}),Ha.schema(t.keyEncryptionAlgorithm||{}),new Lt({name:t.encryptedKey||ua})]})}}]),r}(ha);Dh.CLASS_NAME="KeyTransRecipientInfo";var Oh="algorithm",Ph="publicKey",Rh=[Oh,Ph],Uh=function(e){h(r,e);var t=w(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return u(this,r),(e=t.call(this)).algorithm=Oe(a,Oh,r.defaultValues(Oh)),e.publicKey=Oe(a,Ph,r.defaultValues(Ph)),a.schema&&e.fromSchema(a.schema),e}return l(r,[{key:"fromSchema",value:function(e){Ge(e,Rh);var t=ra(e,e,r.schema({names:{algorithm:{names:{blockName:Oh}},publicKey:Ph}}));ca.assertSchema(t,this.className),this.algorithm=new Ha({schema:t.result.algorithm}),this.publicKey=t.result.publicKey}},{key:"toSchema",value:function(){return new sr({value:[this.algorithm.toSchema(),this.publicKey]})}},{key:"toJSON",value:function(){return{algorithm:this.algorithm.toJSON(),publicKey:this.publicKey.toJSON()}}}],[{key:"defaultValues",value:function(e){switch(e){case Oh:return new Ha;case Ph:return new _t;default:return S(f(r),"defaultValues",this).call(this,e)}}},{key:"compareWithDefault",value:function(e,t){switch(e){case Oh:case Ph:return t.isEqual(r.defaultValues(e));default:return S(f(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Oe(e,"names",{});return new sr({name:t.blockName||ua,value:[Ha.schema(t.algorithm||{}),new _t({name:t.publicKey||ua})]})}}]),r}(ha);Uh.CLASS_NAME="OriginatorPublicKey";var Th="variant",Lh="value",Hh=["blockName"],Mh=function(e){h(r,e);var t=w(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return u(this,r),(e=t.call(this)).variant=Oe(a,Th,r.defaultValues(Th)),Lh in a&&(e.value=Oe(a,Lh,r.defaultValues(Lh))),a.schema&&e.fromSchema(a.schema),e}return l(r,[{key:"fromSchema",value:function(e){Ge(e,Hh);var t=ra(e,e,r.schema({names:{blockName:"blockName"}}));ca.assertSchema(t,this.className),1===t.result.blockName.idBlock.tagClass?(this.variant=1,this.value=new wh({schema:t.result.blockName})):0===t.result.blockName.idBlock.tagNumber?(t.result.blockName.idBlock.tagClass=1,t.result.blockName.idBlock.tagNumber=4,this.variant=2,this.value=t.result.blockName):(this.variant=3,this.value=new Uh({schema:new sr({value:t.result.blockName.valueBlock.value})}))}},{key:"toSchema",value:function(){switch(this.variant){case 1:return this.value.toSchema();case 2:return this.value.idBlock.tagClass=3,this.value.idBlock.tagNumber=0,this.value;case 3:var e=this.value.toSchema();return e.idBlock.tagClass=3,e.idBlock.tagNumber=1,e;default:return new Zr}}},{key:"toJSON",value:function(){var e={variant:this.variant};return 1!==this.variant&&2!==this.variant&&3!==this.variant||(e.value=this.value.toJSON()),e}}],[{key:"defaultValues",value:function(e){switch(e){case Th:return-1;case Lh:return{};default:return S(f(r),"defaultValues",this).call(this,e)}}},{key:"compareWithDefault",value:function(e,t){switch(e){case Th:return-1===t;case Lh:return 0===Object.keys(t).length;default:return S(f(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Oe(e,"names",{});return new $r({value:[wh.schema({names:{blockName:t.blockName||ua}}),new wt({idBlock:{tagClass:3,tagNumber:0},name:t.blockName||ua}),new xt({idBlock:{tagClass:3,tagNumber:1},name:t.blockName||ua,value:Uh.schema().valueBlock.value})]})}}]),r}(ha);Mh.CLASS_NAME="OriginatorIdentifierOrKey";var Kh="keyAttrId",_h="keyAttr",jh=[Kh,_h],Jh=function(e){h(r,e);var t=w(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return u(this,r),(e=t.call(this)).keyAttrId=Oe(a,Kh,r.defaultValues(Kh)),_h in a&&(e.keyAttr=Oe(a,_h,r.defaultValues(_h))),a.schema&&e.fromSchema(a.schema),e}return l(r,[{key:"fromSchema",value:function(e){Ge(e,jh);var t=ra(e,e,r.schema({names:{keyAttrId:Kh,keyAttr:_h}}));ca.assertSchema(t,this.className),this.keyAttrId=t.result.keyAttrId.valueBlock.toString(),_h in t.result&&(this.keyAttr=t.result.keyAttr)}},{key:"toSchema",value:function(){var e=[];return e.push(new $t({value:this.keyAttrId})),_h in this&&e.push(this.keyAttr),new sr({value:e})}},{key:"toJSON",value:function(){var e={keyAttrId:this.keyAttrId};return _h in this&&(e.keyAttr=this.keyAttr.toJSON()),e}}],[{key:"defaultValues",value:function(e){switch(e){case Kh:return ua;case _h:return{};default:return S(f(r),"defaultValues",this).call(this,e)}}},{key:"compareWithDefault",value:function(e,t){switch(e){case Kh:return"string"==typeof t&&t===ua;case _h:return 0===Object.keys(t).length;default:return S(f(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Oe(e,"names",{});return new sr({optional:t.optional||!0,name:t.blockName||ua,value:[new $t({name:t.keyAttrId||ua}),new Zr({optional:!0,name:t.keyAttr||ua})]})}}]),r}(ha);Jh.CLASS_NAME="OtherKeyAttribute";var Fh="subjectKeyIdentifier",qh="date",Xh="other",Wh=[Fh,qh,Xh],Gh=function(e){h(r,e);var t=w(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return u(this,r),(e=t.call(this)).subjectKeyIdentifier=Oe(a,Fh,r.defaultValues(Fh)),qh in a&&(e.date=Oe(a,qh,r.defaultValues(qh))),Xh in a&&(e.other=Oe(a,Xh,r.defaultValues(Xh))),a.schema&&e.fromSchema(a.schema),e}return l(r,[{key:"fromSchema",value:function(e){Ge(e,Wh);var t=ra(e,e,r.schema({names:{subjectKeyIdentifier:Fh,date:qh,other:{names:{blockName:Xh}}}}));ca.assertSchema(t,this.className),this.subjectKeyIdentifier=t.result.subjectKeyIdentifier,qh in t.result&&(this.date=t.result.date),Xh in t.result&&(this.other=new Jh({schema:t.result.other}))}},{key:"toSchema",value:function(){var e=[];return e.push(this.subjectKeyIdentifier),this.date&&e.push(this.date),this.other&&e.push(this.other.toSchema()),new sr({value:e})}},{key:"toJSON",value:function(){var e={subjectKeyIdentifier:this.subjectKeyIdentifier.toJSON()};return this.date&&(e.date=this.date.toJSON()),this.other&&(e.other=this.other.toJSON()),e}}],[{key:"defaultValues",value:function(e){switch(e){case Fh:return new Lt;case qh:return new jr;case Xh:return new Jh;default:return S(f(r),"defaultValues",this).call(this,e)}}},{key:"compareWithDefault",value:function(e,t){switch(e){case Fh:return t.isEqual(r.defaultValues(Fh));case qh:return 0===t.year&&0===t.month&&0===t.day&&0===t.hour&&0===t.minute&&0===t.second&&0===t.millisecond;case Xh:return t.keyAttrId===ua&&"keyAttr"in t==!1;default:return S(f(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Oe(e,"names",{});return new sr({name:t.blockName||ua,value:[new Lt({name:t.subjectKeyIdentifier||ua}),new jr({optional:!0,name:t.date||ua}),Jh.schema(t.other||{})]})}}]),r}(ha);Gh.CLASS_NAME="RecipientKeyIdentifier";var zh="variant",Qh="value",Yh=["blockName"],Zh=function(e){h(r,e);var t=w(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return u(this,r),(e=t.call(this)).variant=Oe(a,zh,r.defaultValues(zh)),e.value=Oe(a,Qh,r.defaultValues(Qh)),a.schema&&e.fromSchema(a.schema),e}return l(r,[{key:"fromSchema",value:function(e){Ge(e,Yh);var t=ra(e,e,r.schema({names:{blockName:"blockName"}}));ca.assertSchema(t,this.className),1===t.result.blockName.idBlock.tagClass?(this.variant=1,this.value=new wh({schema:t.result.blockName})):(this.variant=2,this.value=new Gh({schema:new sr({value:t.result.blockName.valueBlock.value})}))}},{key:"toSchema",value:function(){switch(this.variant){case 1:return this.value.toSchema();case 2:return new xt({idBlock:{tagClass:3,tagNumber:0},value:this.value.toSchema().valueBlock.value});default:return new Zr}}},{key:"toJSON",value:function(){var e={variant:this.variant};return 1!==this.variant&&2!==this.variant||(e.value=this.value.toJSON()),e}}],[{key:"defaultValues",value:function(e){switch(e){case zh:return-1;case Qh:return{};default:return S(f(r),"defaultValues",this).call(this,e)}}},{key:"compareWithDefault",value:function(e,t){switch(e){case zh:return-1===t;case Qh:return 0===Object.keys(t).length;default:return S(f(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Oe(e,"names",{});return new $r({value:[wh.schema(t.issuerAndSerialNumber||{names:{blockName:t.blockName||ua}}),new xt({name:t.blockName||ua,idBlock:{tagClass:3,tagNumber:0},value:Gh.schema(t.rKeyId||{names:{blockName:t.blockName||ua}}).valueBlock.value})]})}}]),r}(ha);Zh.CLASS_NAME="KeyAgreeRecipientIdentifier";var $h="rid",ef="encryptedKey",tf=[$h,ef],rf=function(e){h(r,e);var t=w(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return u(this,r),(e=t.call(this)).rid=Oe(a,$h,r.defaultValues($h)),e.encryptedKey=Oe(a,ef,r.defaultValues(ef)),a.schema&&e.fromSchema(a.schema),e}return l(r,[{key:"fromSchema",value:function(e){Ge(e,tf);var t=ra(e,e,r.schema({names:{rid:{names:{blockName:$h}},encryptedKey:ef}}));ca.assertSchema(t,this.className),this.rid=new Zh({schema:t.result.rid}),this.encryptedKey=t.result.encryptedKey}},{key:"toSchema",value:function(){return new sr({value:[this.rid.toSchema(),this.encryptedKey]})}},{key:"toJSON",value:function(){return{rid:this.rid.toJSON(),encryptedKey:this.encryptedKey.toJSON()}}}],[{key:"defaultValues",value:function(e){switch(e){case $h:return new Zh;case ef:return new Lt;default:return S(f(r),"defaultValues",this).call(this,e)}}},{key:"compareWithDefault",value:function(e,t){switch(e){case $h:return-1===t.variant&&"value"in t==!1;case ef:return t.isEqual(r.defaultValues(ef));default:return S(f(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Oe(e,"names",{});return new sr({name:t.blockName||ua,value:[Zh.schema(t.rid||{}),new Lt({name:t.encryptedKey||ua})]})}}]),r}(ha);rf.CLASS_NAME="RecipientEncryptedKey";var af="encryptedKeys",nf="RecipientEncryptedKeys",sf=[nf],uf=function(e){h(r,e);var t=w(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return u(this,r),(e=t.call(this)).encryptedKeys=Oe(a,af,r.defaultValues(af)),a.schema&&e.fromSchema(a.schema),e}return l(r,[{key:"fromSchema",value:function(e){Ge(e,sf);var t=ra(e,e,r.schema({names:{RecipientEncryptedKeys:nf}}));ca.assertSchema(t,this.className),this.encryptedKeys=Array.from(t.result.RecipientEncryptedKeys,(function(e){return new rf({schema:e})}))}},{key:"toSchema",value:function(){return new sr({value:Array.from(this.encryptedKeys,(function(e){return e.toSchema()}))})}},{key:"toJSON",value:function(){return{encryptedKeys:Array.from(this.encryptedKeys,(function(e){return e.toJSON()}))}}}],[{key:"defaultValues",value:function(e){return e===af?[]:S(f(r),"defaultValues",this).call(this,e)}},{key:"compareWithDefault",value:function(e,t){return e===af?0===t.length:S(f(r),"defaultValues",this).call(this,e)}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Oe(e,"names",{});return new sr({name:t.blockName||ua,value:[new ea({name:t.RecipientEncryptedKeys||ua,value:rf.schema()})]})}}]),r}(ha);uf.CLASS_NAME="RecipientEncryptedKeys";var of="version",lf="originator",cf="ukm",hf="keyEncryptionAlgorithm",ff="recipientEncryptedKeys",mf="recipientCertificate",vf="recipientPublicKey",df=[of,lf,cf,hf,ff],gf=function(e){h(r,e);var t=w(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return u(this,r),(e=t.call(this)).version=Oe(a,of,r.defaultValues(of)),e.originator=Oe(a,lf,r.defaultValues(lf)),cf in a&&(e.ukm=Oe(a,cf,r.defaultValues(cf))),e.keyEncryptionAlgorithm=Oe(a,hf,r.defaultValues(hf)),e.recipientEncryptedKeys=Oe(a,ff,r.defaultValues(ff)),e.recipientCertificate=Oe(a,mf,r.defaultValues(mf)),e.recipientPublicKey=Oe(a,vf,r.defaultValues(vf)),a.schema&&e.fromSchema(a.schema),e}return l(r,[{key:"fromSchema",value:function(e){Ge(e,df);var t=ra(e,e,r.schema({names:{version:of,originator:{names:{blockName:lf}},ukm:cf,keyEncryptionAlgorithm:{names:{blockName:hf}},recipientEncryptedKeys:{names:{blockName:ff}}}}));ca.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,this.originator=new Mh({schema:t.result.originator}),cf in t.result&&(this.ukm=t.result.ukm),this.keyEncryptionAlgorithm=new Ha({schema:t.result.keyEncryptionAlgorithm}),this.recipientEncryptedKeys=new uf({schema:t.result.recipientEncryptedKeys})}},{key:"toSchema",value:function(){var e=[];return e.push(new Gt({value:this.version})),e.push(new xt({idBlock:{tagClass:3,tagNumber:0},value:[this.originator.toSchema()]})),this.ukm&&e.push(new xt({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[this.ukm]})),e.push(this.keyEncryptionAlgorithm.toSchema()),e.push(this.recipientEncryptedKeys.toSchema()),new sr({value:e})}},{key:"toJSON",value:function(){var e={version:this.version,originator:this.originator.toJSON(),keyEncryptionAlgorithm:this.keyEncryptionAlgorithm.toJSON(),recipientEncryptedKeys:this.recipientEncryptedKeys.toJSON()};return this.ukm&&(e.ukm=this.ukm.toJSON()),e}}],[{key:"defaultValues",value:function(e){switch(e){case of:return 0;case lf:return new Mh;case cf:return new Lt;case hf:return new Ha;case ff:return new uf;case mf:return new ql;case vf:return null;default:return S(f(r),"defaultValues",this).call(this,e)}}},{key:"compareWithDefault",value:function(e,t){switch(e){case of:return 0===t;case lf:return-1===t.variant&&"value"in t==!1;case cf:return t.isEqual(r.defaultValues(cf));case hf:return t.algorithmId===ua&&"algorithmParams"in t==!1;case ff:return 0===t.encryptedKeys.length;case mf:case vf:return!1;default:return S(f(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Oe(e,"names",{});return new sr({name:t.blockName||ua,value:[new Gt({name:t.version||ua}),new xt({idBlock:{tagClass:3,tagNumber:0},value:[Mh.schema(t.originator||{})]}),new xt({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new Lt({name:t.ukm||ua})]}),Ha.schema(t.keyEncryptionAlgorithm||{}),uf.schema(t.recipientEncryptedKeys||{})]})}}]),r}(ha);gf.CLASS_NAME="KeyAgreeRecipientInfo";var pf="keyIdentifier",yf="date",kf="other",wf=[pf,yf,kf],bf=function(e){h(r,e);var t=w(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return u(this,r),(e=t.call(this)).keyIdentifier=Oe(a,pf,r.defaultValues(pf)),yf in a&&(e.date=Oe(a,yf,r.defaultValues(yf))),kf in a&&(e.other=Oe(a,kf,r.defaultValues(kf))),a.schema&&e.fromSchema(a.schema),e}return l(r,[{key:"fromSchema",value:function(e){Ge(e,wf);var t=ra(e,e,r.schema({names:{keyIdentifier:pf,date:yf,other:{names:{blockName:kf}}}}));ca.assertSchema(t,this.className),this.keyIdentifier=t.result.keyIdentifier,yf in t.result&&(this.date=t.result.date),kf in t.result&&(this.other=new Jh({schema:t.result.other}))}},{key:"toSchema",value:function(){var e=[];return e.push(this.keyIdentifier),this.date&&e.push(this.date),this.other&&e.push(this.other.toSchema()),new sr({value:e})}},{key:"toJSON",value:function(){var e={keyIdentifier:this.keyIdentifier.toJSON()};return this.date&&(e.date=this.date),this.other&&(e.other=this.other.toJSON()),e}}],[{key:"defaultValues",value:function(e){switch(e){case pf:return new Lt;case yf:return new jr;case kf:return new Jh;default:return S(f(r),"defaultValues",this).call(this,e)}}},{key:"compareWithDefault",value:function(e,t){switch(e){case pf:return t.isEqual(r.defaultValues(pf));case yf:return 0===t.year&&0===t.month&&0===t.day&&0===t.hour&&0===t.minute&&0===t.second&&0===t.millisecond;case kf:return t.compareWithDefault("keyAttrId",t.keyAttrId)&&"keyAttr"in t==!1;default:return S(f(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Oe(e,"names",{});return new sr({name:t.blockName||ua,value:[new Lt({name:t.keyIdentifier||ua}),new jr({optional:!0,name:t.date||ua}),Jh.schema(t.other||{})]})}}]),r}(ha);bf.CLASS_NAME="KEKIdentifier";var Sf="version",Af="kekid",Nf="keyEncryptionAlgorithm",Cf="encryptedKey",xf="preDefinedKEK",Ef=[Sf,Af,Nf,Cf],If=function(e){h(r,e);var t=w(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return u(this,r),(e=t.call(this)).version=Oe(a,Sf,r.defaultValues(Sf)),e.kekid=Oe(a,Af,r.defaultValues(Af)),e.keyEncryptionAlgorithm=Oe(a,Nf,r.defaultValues(Nf)),e.encryptedKey=Oe(a,Cf,r.defaultValues(Cf)),e.preDefinedKEK=Oe(a,xf,r.defaultValues(xf)),a.schema&&e.fromSchema(a.schema),e}return l(r,[{key:"fromSchema",value:function(e){Ge(e,Ef);var t=ra(e,e,r.schema({names:{version:Sf,kekid:{names:{blockName:Af}},keyEncryptionAlgorithm:{names:{blockName:Nf}},encryptedKey:Cf}}));ca.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,this.kekid=new bf({schema:t.result.kekid}),this.keyEncryptionAlgorithm=new Ha({schema:t.result.keyEncryptionAlgorithm}),this.encryptedKey=t.result.encryptedKey}},{key:"toSchema",value:function(){return new sr({value:[new Gt({value:this.version}),this.kekid.toSchema(),this.keyEncryptionAlgorithm.toSchema(),this.encryptedKey]})}},{key:"toJSON",value:function(){return{version:this.version,kekid:this.kekid.toJSON(),keyEncryptionAlgorithm:this.keyEncryptionAlgorithm.toJSON(),encryptedKey:this.encryptedKey.toJSON()}}}],[{key:"defaultValues",value:function(e){switch(e){case Sf:return 0;case Af:return new bf;case Nf:return new Ha;case Cf:return new Lt;case xf:return sa;default:return S(f(r),"defaultValues",this).call(this,e)}}},{key:"compareWithDefault",value:function(e,t){switch(e){case"KEKRecipientInfo":return t===r.defaultValues(Sf);case Af:return t.compareWithDefault("keyIdentifier",t.keyIdentifier)&&"date"in t==!1&&"other"in t==!1;case Nf:return t.algorithmId===ua&&"algorithmParams"in t==!1;case Cf:return t.isEqual(r.defaultValues(Cf));case xf:return 0===t.byteLength;default:return S(f(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Oe(e,"names",{});return new sr({name:t.blockName||ua,value:[new Gt({name:t.version||ua}),bf.schema(t.kekid||{}),Ha.schema(t.keyEncryptionAlgorithm||{}),new Lt({name:t.encryptedKey||ua})]})}}]),r}(ha);If.CLASS_NAME="KEKRecipientInfo";var Bf="version",Vf="keyDerivationAlgorithm",Df="keyEncryptionAlgorithm",Of="encryptedKey",Pf="password",Rf=[Bf,Vf,Df,Of],Uf=function(e){h(r,e);var t=w(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return u(this,r),(e=t.call(this)).version=Oe(a,Bf,r.defaultValues(Bf)),Vf in a&&(e.keyDerivationAlgorithm=Oe(a,Vf,r.defaultValues(Vf))),e.keyEncryptionAlgorithm=Oe(a,Df,r.defaultValues(Df)),e.encryptedKey=Oe(a,Of,r.defaultValues(Of)),e.password=Oe(a,Pf,r.defaultValues(Pf)),a.schema&&e.fromSchema(a.schema),e}return l(r,[{key:"fromSchema",value:function(e){Ge(e,Rf);var t=ra(e,e,r.schema({names:{version:Bf,keyDerivationAlgorithm:Vf,keyEncryptionAlgorithm:{names:{blockName:Df}},encryptedKey:Of}}));ca.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,Vf in t.result&&(this.keyDerivationAlgorithm=new Ha({schema:new sr({value:t.result.keyDerivationAlgorithm.valueBlock.value})})),this.keyEncryptionAlgorithm=new Ha({schema:t.result.keyEncryptionAlgorithm}),this.encryptedKey=t.result.encryptedKey}},{key:"toSchema",value:function(){var e=[];return e.push(new Gt({value:this.version})),this.keyDerivationAlgorithm&&e.push(new xt({idBlock:{tagClass:3,tagNumber:0},value:this.keyDerivationAlgorithm.toSchema().valueBlock.value})),e.push(this.keyEncryptionAlgorithm.toSchema()),e.push(this.encryptedKey),new sr({value:e})}},{key:"toJSON",value:function(){var e={version:this.version,keyEncryptionAlgorithm:this.keyEncryptionAlgorithm.toJSON(),encryptedKey:this.encryptedKey.toJSON()};return this.keyDerivationAlgorithm&&(e.keyDerivationAlgorithm=this.keyDerivationAlgorithm.toJSON()),e}}],[{key:"defaultValues",value:function(e){switch(e){case Bf:return-1;case Vf:case Df:return new Ha;case Of:return new Lt;case Pf:return sa;default:return S(f(r),"defaultValues",this).call(this,e)}}},{key:"compareWithDefault",value:function(e,t){switch(e){case Bf:return-1===t;case Vf:case Df:return t.algorithmId===ua&&"algorithmParams"in t==!1;case Of:return t.isEqual(r.defaultValues(Of));case Pf:return 0===t.byteLength;default:return S(f(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Oe(e,"names",{});return new sr({name:t.blockName||ua,value:[new Gt({name:t.version||ua}),new xt({name:t.keyDerivationAlgorithm||ua,optional:!0,idBlock:{tagClass:3,tagNumber:0},value:Ha.schema().valueBlock.value}),Ha.schema(t.keyEncryptionAlgorithm||{}),new Lt({name:t.encryptedKey||ua})]})}}]),r}(ha);Uf.CLASS_NAME="PasswordRecipientInfo";var Tf="oriType",Lf="oriValue",Hf=[Tf,Lf],Mf=function(e){h(r,e);var t=w(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return u(this,r),(e=t.call(this)).oriType=Oe(a,Tf,r.defaultValues(Tf)),e.oriValue=Oe(a,Lf,r.defaultValues(Lf)),a.schema&&e.fromSchema(a.schema),e}return l(r,[{key:"fromSchema",value:function(e){Ge(e,Hf);var t=ra(e,e,r.schema({names:{oriType:Tf,oriValue:Lf}}));ca.assertSchema(t,this.className),this.oriType=t.result.oriType.valueBlock.toString(),this.oriValue=t.result.oriValue}},{key:"toSchema",value:function(){return new sr({value:[new $t({value:this.oriType}),this.oriValue]})}},{key:"toJSON",value:function(){var e={oriType:this.oriType};return r.compareWithDefault(Lf,this.oriValue)||(e.oriValue=this.oriValue.toJSON()),e}}],[{key:"defaultValues",value:function(e){switch(e){case Tf:return ua;case Lf:return{};default:return S(f(r),"defaultValues",this).call(this,e)}}},{key:"compareWithDefault",value:function(e,t){switch(e){case Tf:return t===ua;case Lf:return 0===Object.keys(t).length;default:return S(f(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Oe(e,"names",{});return new sr({name:t.blockName||ua,value:[new $t({name:t.oriType||ua}),new Zr({name:t.oriValue||ua})]})}}]),r}(ha);Mf.CLASS_NAME="OtherRecipientInfo";var Kf="variant",_f="value",jf=["blockName"],Jf=function(e){h(r,e);var t=w(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return u(this,r),(e=t.call(this)).variant=Oe(a,Kf,r.defaultValues(Kf)),_f in a&&(e.value=Oe(a,_f,r.defaultValues(_f))),a.schema&&e.fromSchema(a.schema),e}return l(r,[{key:"fromSchema",value:function(e){Ge(e,jf);var t=ra(e,e,r.schema({names:{blockName:"blockName"}}));if(ca.assertSchema(t,this.className),1===t.result.blockName.idBlock.tagClass)this.variant=1,this.value=new Dh({schema:t.result.blockName});else{var a=new sr({value:t.result.blockName.valueBlock.value});switch(t.result.blockName.idBlock.tagNumber){case 1:this.variant=2,this.value=new gf({schema:a});break;case 2:this.variant=3,this.value=new If({schema:a});break;case 3:this.variant=4,this.value=new Uf({schema:a});break;case 4:this.variant=5,this.value=new Mf({schema:a});break;default:throw new Error("Incorrect structure of RecipientInfo block")}}}},{key:"toSchema",value:function(){la.assertEmpty(this.value,"value","RecipientInfo");var e=this.value.toSchema();switch(this.variant){case 1:return e;case 2:case 3:case 4:return e.idBlock.tagClass=3,e.idBlock.tagNumber=this.variant-1,e;default:return new Zr}}},{key:"toJSON",value:function(){var e={variant:this.variant};return this.value&&this.variant>=1&&this.variant<=4&&(e.value=this.value.toJSON()),e}}],[{key:"defaultValues",value:function(e){switch(e){case Kf:return-1;case _f:return{};default:return S(f(r),"defaultValues",this).call(this,e)}}},{key:"compareWithDefault",value:function(e,t){switch(e){case Kf:return t===r.defaultValues(e);case _f:return 0===Object.keys(t).length;default:return S(f(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Oe(e,"names",{});return new $r({value:[Dh.schema({names:{blockName:t.blockName||ua}}),new xt({name:t.blockName||ua,idBlock:{tagClass:3,tagNumber:1},value:gf.schema().valueBlock.value}),new xt({name:t.blockName||ua,idBlock:{tagClass:3,tagNumber:2},value:If.schema().valueBlock.value}),new xt({name:t.blockName||ua,idBlock:{tagClass:3,tagNumber:3},value:Uf.schema().valueBlock.value}),new xt({name:t.blockName||ua,idBlock:{tagClass:3,tagNumber:4},value:Mf.schema().valueBlock.value})]})}}]),r}(ha);Jf.CLASS_NAME="RecipientInfo";var Ff="hashAlgorithm",qf="maskGenAlgorithm",Xf="pSourceAlgorithm",Wf=[Ff,qf,Xf],Gf=function(e){h(r,e);var t=w(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return u(this,r),(e=t.call(this)).hashAlgorithm=Oe(a,Ff,r.defaultValues(Ff)),e.maskGenAlgorithm=Oe(a,qf,r.defaultValues(qf)),e.pSourceAlgorithm=Oe(a,Xf,r.defaultValues(Xf)),a.schema&&e.fromSchema(a.schema),e}return l(r,[{key:"fromSchema",value:function(e){Ge(e,Wf);var t=ra(e,e,r.schema({names:{hashAlgorithm:{names:{blockName:Ff}},maskGenAlgorithm:{names:{blockName:qf}},pSourceAlgorithm:{names:{blockName:Xf}}}}));ca.assertSchema(t,this.className),Ff in t.result&&(this.hashAlgorithm=new Ha({schema:t.result.hashAlgorithm})),qf in t.result&&(this.maskGenAlgorithm=new Ha({schema:t.result.maskGenAlgorithm})),Xf in t.result&&(this.pSourceAlgorithm=new Ha({schema:t.result.pSourceAlgorithm}))}},{key:"toSchema",value:function(){var e=[];return this.hashAlgorithm.isEqual(r.defaultValues(Ff))||e.push(new xt({idBlock:{tagClass:3,tagNumber:0},value:[this.hashAlgorithm.toSchema()]})),this.maskGenAlgorithm.isEqual(r.defaultValues(qf))||e.push(new xt({idBlock:{tagClass:3,tagNumber:1},value:[this.maskGenAlgorithm.toSchema()]})),this.pSourceAlgorithm.isEqual(r.defaultValues(Xf))||e.push(new xt({idBlock:{tagClass:3,tagNumber:2},value:[this.pSourceAlgorithm.toSchema()]})),new sr({value:e})}},{key:"toJSON",value:function(){var e={};return this.hashAlgorithm.isEqual(r.defaultValues(Ff))||(e.hashAlgorithm=this.hashAlgorithm.toJSON()),this.maskGenAlgorithm.isEqual(r.defaultValues(qf))||(e.maskGenAlgorithm=this.maskGenAlgorithm.toJSON()),this.pSourceAlgorithm.isEqual(r.defaultValues(Xf))||(e.pSourceAlgorithm=this.pSourceAlgorithm.toJSON()),e}}],[{key:"defaultValues",value:function(e){switch(e){case Ff:return new Ha({algorithmId:"1.3.14.3.2.26",algorithmParams:new Dt});case qf:return new Ha({algorithmId:"1.2.840.113549.1.1.8",algorithmParams:new Ha({algorithmId:"1.3.14.3.2.26",algorithmParams:new Dt}).toSchema()});case Xf:return new Ha({algorithmId:"1.2.840.113549.1.1.9",algorithmParams:new Lt({valueHex:new Uint8Array([218,57,163,238,94,107,75,13,50,85,191,239,149,96,24,144,175,216,7,9]).buffer})});default:return S(f(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Oe(e,"names",{});return new sr({name:t.blockName||ua,value:[new xt({idBlock:{tagClass:3,tagNumber:0},optional:!0,value:[Ha.schema(t.hashAlgorithm||{})]}),new xt({idBlock:{tagClass:3,tagNumber:1},optional:!0,value:[Ha.schema(t.maskGenAlgorithm||{})]}),new xt({idBlock:{tagClass:3,tagNumber:2},optional:!0,value:[Ha.schema(t.pSourceAlgorithm||{})]})]})}}]),r}(ha);Gf.CLASS_NAME="RSAESOAEPParams";var zf="keyInfo",Qf="entityUInfo",Yf="suppPubInfo",Zf=[zf,Qf,Yf],$f=function(e){h(r,e);var t=w(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return u(this,r),(e=t.call(this)).keyInfo=Oe(a,zf,r.defaultValues(zf)),Qf in a&&(e.entityUInfo=Oe(a,Qf,r.defaultValues(Qf))),e.suppPubInfo=Oe(a,Yf,r.defaultValues(Yf)),a.schema&&e.fromSchema(a.schema),e}return l(r,[{key:"fromSchema",value:function(e){Ge(e,Zf);var t=ra(e,e,r.schema({names:{keyInfo:{names:{blockName:zf}},entityUInfo:Qf,suppPubInfo:Yf}}));ca.assertSchema(t,this.className),this.keyInfo=new Ha({schema:t.result.keyInfo}),Qf in t.result&&(this.entityUInfo=t.result.entityUInfo.valueBlock.value[0]),this.suppPubInfo=t.result.suppPubInfo.valueBlock.value[0]}},{key:"toSchema",value:function(){var e=[];return e.push(this.keyInfo.toSchema()),this.entityUInfo&&e.push(new xt({idBlock:{tagClass:3,tagNumber:0},value:[this.entityUInfo]})),e.push(new xt({idBlock:{tagClass:3,tagNumber:2},value:[this.suppPubInfo]})),new sr({value:e})}},{key:"toJSON",value:function(){var e={keyInfo:this.keyInfo.toJSON(),suppPubInfo:this.suppPubInfo.toJSON()};return this.entityUInfo&&(e.entityUInfo=this.entityUInfo.toJSON()),e}}],[{key:"defaultValues",value:function(e){switch(e){case zf:return new Ha;case Qf:case Yf:return new Lt;default:return S(f(r),"defaultValues",this).call(this,e)}}},{key:"compareWithDefault",value:function(e,t){switch(e){case zf:case Qf:case Yf:return t.isEqual(r.defaultValues(e));default:return S(f(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Oe(e,"names",{});return new sr({name:t.blockName||ua,value:[Ha.schema(t.keyInfo||{}),new xt({name:t.entityUInfo||ua,idBlock:{tagClass:3,tagNumber:0},optional:!0,value:[new Lt]}),new xt({name:t.suppPubInfo||ua,idBlock:{tagClass:3,tagNumber:2},value:[new Lt]})]})}}]),r}(ha);$f.CLASS_NAME="ECCCMSSharedInfo";var em="version",tm="originatorInfo",rm="recipientInfos",am="encryptedContentInfo",nm="unprotectedAttrs",im=[em,tm,rm,am,nm],sm={kdfAlgorithm:"SHA-512",kekEncryptionLength:256},um={"P-256":256,"P-384":384,"P-521":528},om=function(e){h(i,e);var t,r,n=w(i);function i(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return u(this,i),(e=n.call(this)).version=Oe(t,em,i.defaultValues(em)),tm in t&&(e.originatorInfo=Oe(t,tm,i.defaultValues(tm))),e.recipientInfos=Oe(t,rm,i.defaultValues(rm)),e.encryptedContentInfo=Oe(t,am,i.defaultValues(am)),nm in t&&(e.unprotectedAttrs=Oe(t,nm,i.defaultValues(nm))),t.schema&&e.fromSchema(t.schema),e}return l(i,[{key:"fromSchema",value:function(e){Ge(e,im);var t=ra(e,e,i.schema({names:{version:em,originatorInfo:tm,recipientInfos:rm,encryptedContentInfo:{names:{blockName:am}},unprotectedAttrs:nm}}));ca.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,tm in t.result&&(this.originatorInfo=new gh({schema:new sr({value:t.result.originatorInfo.valueBlock.value})})),this.recipientInfos=Array.from(t.result.recipientInfos,(function(e){return new Jf({schema:e})})),this.encryptedContentInfo=new zs({schema:t.result.encryptedContentInfo}),nm in t.result&&(this.unprotectedAttrs=Array.from(t.result.unprotectedAttrs,(function(e){return new qa({schema:e})})))}},{key:"toSchema",value:function(){var e=[];return e.push(new Gt({value:this.version})),this.originatorInfo&&e.push(new xt({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:this.originatorInfo.toSchema().valueBlock.value})),e.push(new ur({value:Array.from(this.recipientInfos,(function(e){return e.toSchema()}))})),e.push(this.encryptedContentInfo.toSchema()),this.unprotectedAttrs&&e.push(new xt({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:Array.from(this.unprotectedAttrs,(function(e){return e.toSchema()}))})),new sr({value:e})}},{key:"toJSON",value:function(){var e={version:this.version,recipientInfos:Array.from(this.recipientInfos,(function(e){return e.toJSON()})),encryptedContentInfo:this.encryptedContentInfo.toJSON()};return this.originatorInfo&&(e.originatorInfo=this.originatorInfo.toJSON()),this.unprotectedAttrs&&(e.unprotectedAttrs=Array.from(this.unprotectedAttrs,(function(e){return e.toJSON()}))),e}},{key:"addRecipientByCertificate",value:function(e,t,r){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:bu(!0),n=Object.assign({useOAEP:!0,oaepHashAlgorithm:"SHA-512"},sm,t||{});if(-1!==e.subjectPublicKeyInfo.algorithm.algorithmId.indexOf("1.2.840.113549"))r=1;else{if(-1===e.subjectPublicKeyInfo.algorithm.algorithmId.indexOf("1.2.840.10045"))throw new Error("Unknown type of certificate's public key: ".concat(e.subjectPublicKeyInfo.algorithm.algorithmId));r=2}switch(r){case 1:var i,s;if(!0===n.useOAEP){i=a.getOIDByAlgorithm({name:"RSA-OAEP"},!0,"keyEncryptionAlgorithm");var u=a.getOIDByAlgorithm({name:n.oaepHashAlgorithm},!0,"RSAES-OAEP-params"),o=new Ha({algorithmId:u,algorithmParams:new Dt}),l=new Gf({hashAlgorithm:o,maskGenAlgorithm:new Ha({algorithmId:"1.2.840.113549.1.1.8",algorithmParams:o.toSchema()})});s=l.toSchema()}else{if((i=a.getOIDByAlgorithm({name:"RSAES-PKCS1-v1_5"}))===ua)throw new Error("Can not find OID for RSAES-PKCS1-v1_5");s=new Dt}var c=new Dh({version:0,rid:new wh({issuer:e.issuer,serialNumber:e.serialNumber}),keyEncryptionAlgorithm:new Ha({algorithmId:i,algorithmParams:s}),recipientCertificate:e});this.recipientInfos.push(new Jf({variant:1,value:c}));break;case 2:var h=new Zh({variant:1,value:new wh({issuer:e.issuer,serialNumber:e.serialNumber})});this._addKeyAgreeRecipientInfo(h,n,{recipientCertificate:e},a);break;default:throw new Error('Unknown "variant" value: '.concat(r))}return!0}},{key:"addRecipientByPreDefinedData",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2?arguments[2]:void 0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:bu(!0);if(oa.assert(e,"preDefinedData","ArrayBuffer"),!e.byteLength)throw new Error("Pre-defined data could have zero length");if(!t.keyIdentifier){var n=new ArrayBuffer(16),i=new Uint8Array(n);a.getRandomValues(i),t.keyIdentifier=n}switch(t.hmacHashAlgorithm||(t.hmacHashAlgorithm="SHA-512"),void 0===t.iterationCount&&(t.iterationCount=2048),t.keyEncryptionAlgorithm||(t.keyEncryptionAlgorithm={name:"AES-KW",length:256}),t.keyEncryptionAlgorithmParams||(t.keyEncryptionAlgorithmParams=new Dt),r){case 1:var s=a.getOIDByAlgorithm(t.keyEncryptionAlgorithm,!0,"keyEncryptionAlgorithm"),u=new If({version:4,kekid:new bf({keyIdentifier:new Lt({valueHex:t.keyIdentifier})}),keyEncryptionAlgorithm:new Ha({algorithmId:s,algorithmParams:t.keyEncryptionAlgorithmParams}),preDefinedKEK:e});this.recipientInfos.push(new Jf({variant:3,value:u}));break;case 2:var o=a.getOIDByAlgorithm({name:"PBKDF2"},!0,"keyDerivationAlgorithm"),l=new ArrayBuffer(64),c=new Uint8Array(l);a.getRandomValues(c);var h=a.getOIDByAlgorithm({name:"HMAC",hash:{name:t.hmacHashAlgorithm}},!0,"hmacHashAlgorithm"),f=new uu({salt:new Lt({valueHex:l}),iterationCount:t.iterationCount,prf:new Ha({algorithmId:h,algorithmParams:new Dt})}),m=a.getOIDByAlgorithm(t.keyEncryptionAlgorithm,!0,"keyEncryptionAlgorithm"),v=new Uf({version:0,keyDerivationAlgorithm:new Ha({algorithmId:o,algorithmParams:f.toSchema()}),keyEncryptionAlgorithm:new Ha({algorithmId:m,algorithmParams:t.keyEncryptionAlgorithmParams}),password:e});this.recipientInfos.push(new Jf({variant:4,value:v}));break;default:throw new Error('Unknown value for "variant": '.concat(r))}}},{key:"addRecipientByKeyIdentifier",value:function(e,t,r){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:bu(!0),n=Object.assign({},sm,r||{}),i=new Zh({variant:2,value:new Gh({subjectKeyIdentifier:new Lt({valueHex:t})})});this._addKeyAgreeRecipientInfo(i,n,{recipientPublicKey:e},a)}},{key:"_addKeyAgreeRecipientInfo",value:function(e,t,r){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:bu(!0),n=new rf({rid:e}),i=a.getOIDByAlgorithm({name:"AES-KW",length:t.kekEncryptionLength},!0,"keyEncryptionAlgorithm"),s=new Ha({algorithmId:i}),u=a.getOIDByAlgorithm({name:"ECDH",kdf:t.kdfAlgorithm},!0,"KeyAgreeRecipientInfo"),o=new ArrayBuffer(64),l=new Uint8Array(o);a.getRandomValues(l);var c={version:3,ukm:new Lt({valueHex:o}),keyEncryptionAlgorithm:new Ha({algorithmId:u,algorithmParams:s.toSchema()}),recipientEncryptedKeys:new uf({encryptedKeys:[n]})},h=new gf(Object.assign(c,r));this.recipientInfos.push(new Jf({variant:2,value:h}))}},{key:"encrypt",value:(r=s(a().mark((function e(t,r){var n,i,u,o,l,c,h,f,m,v,d,g,p,y,k=this,w=arguments;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=w.length>2&&void 0!==w[2]?w[2]:bu(!0),i=new ArrayBuffer(16),u=new Uint8Array(i),n.getRandomValues(u),o=new Uint8Array(r),l=n.getOIDByAlgorithm(t,!0,"contentEncryptionAlgorithm"),e.next=8,n.generateKey(t,!0,["encrypt"]);case 8:return c=e.sent,e.next=11,n.encrypt({name:t.name,iv:u},c,o);case 11:return h=e.sent,e.next=14,n.exportKey("raw",c);case 14:f=e.sent,this.version=2,this.encryptedContentInfo=new zs({contentType:"1.2.840.113549.1.7.1",contentEncryptionAlgorithm:new Ha({algorithmId:l,algorithmParams:new Lt({valueHex:i})}),encryptedContent:new Lt({valueHex:h})}),m=function(){var e=s(a().mark((function e(t){var r,i,s,u,o,l,h,f,m,v,d,g,p,y,w,b,S,A,N,C,x,E;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(r=k.recipientInfos[t].value).recipientPublicKey){e.next=6;break}i=r.recipientPublicKey.algorithm.namedCurve,s=r.recipientPublicKey,e.next=27;break;case 6:if(!r.recipientCertificate){e.next=26;break}if((u=r.recipientCertificate.subjectPublicKeyInfo.algorithm.algorithmParams).constructor.blockName()===$t.blockName()){e.next=10;break}throw new Error('Incorrect "recipientCertificate" for index '.concat(t));case 10:o=u.valueBlock.toString(),e.t0=o,e.next="1.2.840.10045.3.1.7"===e.t0?14:"1.3.132.0.34"===e.t0?16:"1.3.132.0.35"===e.t0?18:20;break;case 14:return i="P-256",e.abrupt("break",21);case 16:return i="P-384",e.abrupt("break",21);case 18:return i="P-521",e.abrupt("break",21);case 20:throw new Error("Incorrect curve OID for index ".concat(t));case 21:return e.next=23,r.recipientCertificate.getPublicKey({algorithm:{algorithm:{name:"ECDH",namedCurve:i},usages:[]}},n);case 23:s=e.sent,e.next=27;break;case 26:throw new Error("Unsupported RecipientInfo");case 27:return l=um[i],e.next=30,n.generateKey({name:"ECDH",namedCurve:i},!0,["deriveBits"]);case 30:return h=e.sent,e.next=33,n.exportKey("spki",h.publicKey);case 33:return f=e.sent,e.next=36,n.deriveBits({name:"ECDH",public:s},h.privateKey,l);case 36:for(m=e.sent,v=new Ha({schema:r.keyEncryptionAlgorithm.algorithmParams}),d=n.getAlgorithmByOID(v.algorithmId,!0,"aesKWAlgorithm"),g=d.length,p=new ArrayBuffer(4),y=new Uint8Array(p),w=3;w>=0;w--)y[w]=g,g>>=8;return b=new $f({keyInfo:new Ha({algorithmId:v.algorithmId}),entityUInfo:r.ukm,suppPubInfo:new Lt({valueHex:p})}),S=b.toSchema().toBER(!1),A=n.getAlgorithmByOID(r.keyEncryptionAlgorithm.algorithmId,!0,"ecdhAlgorithm"),e.next=48,xu(A.kdf,m,d.length,S,n);case 48:return N=e.sent,e.next=51,n.importKey("raw",N,{name:"AES-KW"},!0,["wrapKey"]);case 51:return C=e.sent,e.next=54,n.wrapKey("raw",c,C,{name:"AES-KW"});case 54:return x=e.sent,(E=new Mh).variant=3,E.value=Uh.fromBER(f),r.originator=E,r.recipientEncryptedKeys.encryptedKeys[0].encryptedKey=new Lt({valueHex:x}),e.abrupt("return",{ecdhPrivateKey:h.privateKey});case 61:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),v=function(){var e=s(a().mark((function e(t){var r,i,s,u,o,l;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=k.recipientInfos[t].value,"RSA-OAEP"!==(i=n.getAlgorithmByOID(r.keyEncryptionAlgorithm.algorithmId,!0,"keyEncryptionAlgorithm")).name){e.next=8;break}if(s=r.keyEncryptionAlgorithm.algorithmParams,u=new Gf({schema:s}),i.hash=n.getAlgorithmByOID(u.hashAlgorithm.algorithmId),"name"in i.hash!=0){e.next=8;break}throw new Error("Incorrect OID for hash algorithm: ".concat(u.hashAlgorithm.algorithmId));case 8:return e.prev=8,e.next=11,r.recipientCertificate.getPublicKey({algorithm:{algorithm:i,usages:["encrypt","wrapKey"]}},n);case 11:return o=e.sent,e.next=14,n.encrypt(o.algorithm,o,f);case 14:l=e.sent,r.encryptedKey=new Lt({valueHex:l}),e.next=20;break;case 18:e.prev=18,e.t0=e.catch(8);case 20:case"end":return e.stop()}}),e,null,[[8,18]])})));return function(t){return e.apply(this,arguments)}}(),d=function(){var e=s(a().mark((function e(t){var r,i,s,u;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=k.recipientInfos[t].value,i=n.getAlgorithmByOID(r.keyEncryptionAlgorithm.algorithmId,!0,"kekAlgorithm"),e.next=4,n.importKey("raw",new Uint8Array(r.preDefinedKEK),i,!0,["wrapKey"]);case 4:return s=e.sent,e.next=7,n.wrapKey("raw",c,s,i);case 7:u=e.sent,r.encryptedKey=new Lt({valueHex:u});case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),g=function(){var e=s(a().mark((function e(t){var r,i,s,u,o,l,h,f,m,v,d;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((r=k.recipientInfos[t].value).keyDerivationAlgorithm){e.next=3;break}throw new Error('Please append encoded "keyDerivationAlgorithm"');case 3:if(r.keyDerivationAlgorithm.algorithmParams){e.next=5;break}throw new Error('Incorrectly encoded "keyDerivationAlgorithm"');case 5:e.prev=5,i=new uu({schema:r.keyDerivationAlgorithm.algorithmParams}),e.next=12;break;case 9:throw e.prev=9,e.t0=e.catch(5),new Error('Incorrectly encoded "keyDerivationAlgorithm"');case 12:return s=new Uint8Array(r.password),e.next=15,n.importKey("raw",s,"PBKDF2",!1,["deriveKey"]);case 15:return u=e.sent,o=n.getAlgorithmByOID(r.keyEncryptionAlgorithm.algorithmId,!0,"kekAlgorithm"),l="SHA-1",i.prf&&(h=n.getAlgorithmByOID(i.prf.algorithmId,!0,"prfAlgorithm"),l=h.hash.name),f=new Uint8Array(i.salt.valueBlock.valueHex),m=i.iterationCount,e.next=23,n.deriveKey({name:"PBKDF2",hash:{name:l},salt:f,iterations:m},u,o,!0,["wrapKey"]);case 23:return v=e.sent,e.next=26,n.wrapKey("raw",c,v,o);case 26:d=e.sent,r.encryptedKey=new Lt({valueHex:d});case 28:case"end":return e.stop()}}),e,null,[[5,9]])})));return function(t){return e.apply(this,arguments)}}(),p=[],y=0;case 23:if(!(y<this.recipientInfos.length)){e.next=55;break}e.t0=this.recipientInfos[y].variant,e.next=1===e.t0?27:2===e.t0?33:3===e.t0?39:4===e.t0?45:51;break;case 27:return e.t1=p,e.next=30,v(y);case 30:return e.t2=e.sent,e.t1.push.call(e.t1,e.t2),e.abrupt("break",52);case 33:return e.t3=p,e.next=36,m(y);case 36:return e.t4=e.sent,e.t3.push.call(e.t3,e.t4),e.abrupt("break",52);case 39:return e.t5=p,e.next=42,d(y);case 42:return e.t6=e.sent,e.t5.push.call(e.t5,e.t6),e.abrupt("break",52);case 45:return e.t7=p,e.next=48,g(y);case 48:return e.t8=e.sent,e.t7.push.call(e.t7,e.t8),e.abrupt("break",52);case 51:throw new Error("Unknown recipient type in array with index ".concat(y));case 52:y++,e.next=23;break;case 55:return e.abrupt("return",p);case 56:case"end":return e.stop()}}),e,this)}))),function(e,t){return r.apply(this,arguments)})},{key:"decrypt",value:(t=s(a().mark((function e(t,r){var n,i,u,o,l,c,h,f,m,v,d,g,p=this,y=arguments;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=y.length>2&&void 0!==y[2]?y[2]:bu(!0),i=r||{},!(t+1>this.recipientInfos.length)){e.next=4;break}throw new Error('Maximum value for "index" is: '.concat(this.recipientInfos.length-1));case 4:u=function(){var e=s(a().mark((function e(t){var r,u,o,l,c,h,f,m,v,d,g,y,k,w,b,S,A,N,C;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(k=function(){return(k=s(a().mark((function e(t){var i,s,u,o,l,c,h,f,m,v;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t=t||!1,i=new Ha({schema:r.keyEncryptionAlgorithm.algorithmParams}),s=n.getAlgorithmByOID(i.algorithmId,!0,"kwAlgorithm"),u=s.length,o=new ArrayBuffer(4),l=new Uint8Array(o),c=3;c>=0;c--)l[c]=u,u>>=8;if(h={algorithmId:i.algorithmId},t&&(h.algorithmParams=new Dt),f=new $f({keyInfo:new Ha(h),entityUInfo:r.ukm,suppPubInfo:new Lt({valueHex:o})}),m=f.toSchema().toBER(!1),(v=n.getAlgorithmByOID(r.keyEncryptionAlgorithm.algorithmId,!0,"ecdhAlgorithm")).name){e.next=14;break}throw new Error("Incorrect OID for key encryption algorithm: ".concat(r.keyEncryptionAlgorithm.algorithmId));case 14:return e.abrupt("return",xu(v.kdf,g,s.length,m,n));case 15:case"end":return e.stop()}}),e)})))).apply(this,arguments)},y=function(e){return k.apply(this,arguments)},r=p.recipientInfos[t].value,c=r.originator,!i.recipientCertificate){e.next=11;break}if((h=i.recipientCertificate.subjectPublicKeyInfo.algorithm.algorithmParams).constructor.blockName()===$t.blockName()){e.next=8;break}throw new Error('Incorrect "recipientCertificate" for index '.concat(t));case 8:u=h.valueBlock.toString(),e.next=19;break;case 11:if(!c.value.algorithm.algorithmParams){e.next=18;break}if((f=c.value.algorithm.algorithmParams).constructor.blockName()===$t.blockName()){e.next=15;break}throw new Error("Incorrect originator for index ".concat(t));case 15:u=f.valueBlock.toString(),e.next=19;break;case 18:throw new Error('Parameter "recipientCertificate" is mandatory for "KeyAgreeRecipientInfo" if algorithm params are missing from originator');case 19:if(i.recipientPrivateKey){e.next=21;break}throw new Error('Parameter "recipientPrivateKey" is mandatory for "KeyAgreeRecipientInfo"');case 21:e.t0=u,e.next="1.2.840.10045.3.1.7"===e.t0?24:"1.3.132.0.34"===e.t0?27:"1.3.132.0.35"===e.t0?30:33;break;case 24:return o="P-256",l=256,e.abrupt("break",34);case 27:return o="P-384",l=384,e.abrupt("break",34);case 30:return o="P-521",l=528,e.abrupt("break",34);case 33:throw new Error("Incorrect curve OID for index ".concat(t));case 34:return e.next=36,n.importKey("pkcs8",i.recipientPrivateKey,{name:"ECDH",namedCurve:o},!0,["deriveBits"]);case 36:return m=e.sent,"algorithmParams"in c.value.algorithm==0&&(c.value.algorithm.algorithmParams=new $t({value:u})),v=c.value.toSchema().toBER(!1),e.next=41,n.importKey("spki",v,{name:"ECDH",namedCurve:o},!0,[]);case 41:return d=e.sent,e.next=44,n.deriveBits({name:"ECDH",public:d},m,l);case 44:return g=e.sent,e.next=47,y();case 47:return w=e.sent,b=function(){var e=s(a().mark((function e(t){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",n.importKey("raw",t,{name:"AES-KW"},!0,["unwrapKey"]));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),e.next=51,b(w);case 51:return S=e.sent,A=function(){var e=s(a().mark((function e(t){var i,s;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=p.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId,s=n.getAlgorithmByOID(i,!0,"contentEncryptionAlgorithm"),e.abrupt("return",n.unwrapKey("raw",r.recipientEncryptedKeys.encryptedKeys[0].encryptedKey.valueBlock.valueHexView,t,{name:"AES-KW"},s,!0,["decrypt"]));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),e.prev=53,e.next=56,A(S);case 56:return e.abrupt("return",e.sent);case 59:return e.prev=59,e.t1=e.catch(53),e.next=63,y(!0);case 63:return N=e.sent,e.next=66,b(N);case 66:return C=e.sent,e.abrupt("return",A(C));case 68:case"end":return e.stop()}}),e,null,[[53,59]])})));return function(t){return e.apply(this,arguments)}}(),o=function(){var e=s(a().mark((function e(t){var r,s,u,o,l,c,h,f;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=p.recipientInfos[t].value,i.recipientPrivateKey){e.next=3;break}throw new Error('Parameter "recipientPrivateKey" is mandatory for "KeyTransRecipientInfo"');case 3:if("RSA-OAEP"!==(s=n.getAlgorithmByOID(r.keyEncryptionAlgorithm.algorithmId,!0,"keyEncryptionAlgorithm")).name){e.next=10;break}if(u=r.keyEncryptionAlgorithm.algorithmParams,o=new Gf({schema:u}),s.hash=n.getAlgorithmByOID(o.hashAlgorithm.algorithmId),"name"in s.hash!=0){e.next=10;break}throw new Error("Incorrect OID for hash algorithm: ".concat(o.hashAlgorithm.algorithmId));case 10:return e.next=12,n.importKey("pkcs8",i.recipientPrivateKey,s,!0,["decrypt"]);case 12:return l=e.sent,e.next=15,n.decrypt(l.algorithm,l,r.encryptedKey.valueBlock.valueHexView);case 15:if(c=e.sent,h=p.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId,"name"in(f=n.getAlgorithmByOID(h,!0,"contentEncryptionAlgorithm"))!=0){e.next=20;break}throw new Error('Incorrect "contentEncryptionAlgorithm": '.concat(h));case 20:return e.abrupt("return",n.importKey("raw",c,f,!0,["decrypt"]));case 21:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),l=function(){var e=s(a().mark((function e(t){var r,s,u,o,l;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=p.recipientInfos[t].value,i.preDefinedData){e.next=3;break}throw new Error('Parameter "preDefinedData" is mandatory for "KEKRecipientInfo"');case 3:return s=n.getAlgorithmByOID(r.keyEncryptionAlgorithm.algorithmId,!0,"kekAlgorithm"),e.next=6,n.importKey("raw",i.preDefinedData,s,!0,["unwrapKey"]);case 6:if(u=e.sent,o=p.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId,(l=n.getAlgorithmByOID(o,!0,"contentEncryptionAlgorithm")).name){e.next=11;break}throw new Error('Incorrect "contentEncryptionAlgorithm": '.concat(o));case 11:return e.abrupt("return",n.unwrapKey("raw",r.encryptedKey.valueBlock.valueHexView,u,s,l,!0,["decrypt"]));case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),c=function(){var e=s(a().mark((function e(t){var r,s,u,o,l,c,h,f,m,v;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=p.recipientInfos[t].value,i.preDefinedData){e.next=3;break}throw new Error('Parameter "preDefinedData" is mandatory for "KEKRecipientInfo"');case 3:if(r.keyDerivationAlgorithm){e.next=5;break}throw new Error('Please append encoded "keyDerivationAlgorithm"');case 5:if(r.keyDerivationAlgorithm.algorithmParams){e.next=7;break}throw new Error('Incorrectly encoded "keyDerivationAlgorithm"');case 7:e.prev=7,s=new uu({schema:r.keyDerivationAlgorithm.algorithmParams}),e.next=14;break;case 11:throw e.prev=11,e.t0=e.catch(7),new Error('Incorrectly encoded "keyDerivationAlgorithm"');case 14:return e.next=16,n.importKey("raw",i.preDefinedData,"PBKDF2",!1,["deriveKey"]);case 16:return u=e.sent,o=n.getAlgorithmByOID(r.keyEncryptionAlgorithm.algorithmId,!0,"keyEncryptionAlgorithm"),l=s.prf?n.getAlgorithmByOID(s.prf.algorithmId,!0,"prfAlgorithm").hash.name:"SHA-1",c=new Uint8Array(s.salt.valueBlock.valueHex),h=s.iterationCount,e.next=23,n.deriveKey({name:"PBKDF2",hash:{name:l},salt:c,iterations:h},u,o,!0,["unwrapKey"]);case 23:return f=e.sent,m=p.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId,v=n.getAlgorithmByOID(m,!0,"contentEncryptionAlgorithm"),e.abrupt("return",n.unwrapKey("raw",r.encryptedKey.valueBlock.valueHexView,f,o,v,!0,["decrypt"]));case 27:case"end":return e.stop()}}),e,null,[[7,11]])})));return function(t){return e.apply(this,arguments)}}(),e.t0=this.recipientInfos[t].variant,e.next=1===e.t0?11:2===e.t0?15:3===e.t0?19:4===e.t0?23:27;break;case 11:return e.next=13,o(t);case 13:case 17:case 21:case 25:return h=e.sent,e.abrupt("break",28);case 15:return e.next=17,u(t);case 19:return e.next=21,l(t);case 23:return e.next=25,c(t);case 27:throw new Error("Unknown recipient type in array with index ".concat(t));case 28:if(f=this.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId,m=n.getAlgorithmByOID(f,!0,"contentEncryptionAlgorithm"),v=this.encryptedContentInfo.contentEncryptionAlgorithm.algorithmParams.valueBlock.valueHex,d=new Uint8Array(v),this.encryptedContentInfo.encryptedContent){e.next=34;break}throw new Error("Required property `encryptedContent` is empty");case 34:return g=this.encryptedContentInfo.getEncryptedContent(),e.abrupt("return",n.decrypt({name:m.name,iv:d},h,g));case 36:case"end":return e.stop()}}),e,this)}))),function(e,r){return t.apply(this,arguments)})}],[{key:"defaultValues",value:function(e){switch(e){case em:return 0;case tm:return new gh;case rm:return[];case am:return new zs;case nm:return[];default:return S(f(i),"defaultValues",this).call(this,e)}}},{key:"compareWithDefault",value:function(e,t){switch(e){case em:return t===i.defaultValues(e);case tm:return 0===t.certs.certificates.length&&0===t.crls.crls.length;case rm:case nm:return 0===t.length;case am:return zs.compareWithDefault("contentType",t.contentType)&&zs.compareWithDefault("contentEncryptionAlgorithm",t.contentEncryptionAlgorithm)&&zs.compareWithDefault("encryptedContent",t.encryptedContent);default:return S(f(i),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Oe(e,"names",{});return new sr({name:t.blockName||ua,value:[new Gt({name:t.version||ua}),new xt({name:t.originatorInfo||ua,optional:!0,idBlock:{tagClass:3,tagNumber:0},value:gh.schema().valueBlock.value}),new ur({value:[new ea({name:t.recipientInfos||ua,value:Jf.schema()})]}),zs.schema(t.encryptedContentInfo||{}),new xt({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new ea({name:t.unprotectedAttrs||ua,value:qa.schema()})]})]})}}]),i}(ha);om.CLASS_NAME="EnvelopedData";var lm="safeContents",cm="parsedValue",hm="contentInfos",fm=function(e){h(i,e);var t,r,n=w(i);function i(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return u(this,i),(e=n.call(this)).safeContents=Oe(t,lm,i.defaultValues(lm)),cm in t&&(e.parsedValue=Oe(t,cm,i.defaultValues(cm))),t.schema&&e.fromSchema(t.schema),e}return l(i,[{key:"fromSchema",value:function(e){Ge(e,[hm]);var t=ra(e,e,i.schema({names:{contentInfos:hm}}));ca.assertSchema(t,this.className),this.safeContents=Array.from(t.result.contentInfos,(function(e){return new ll({schema:e})}))}},{key:"toSchema",value:function(){return new sr({value:Array.from(this.safeContents,(function(e){return e.toSchema()}))})}},{key:"toJSON",value:function(){return{safeContents:Array.from(this.safeContents,(function(e){return e.toJSON()}))}}},{key:"parseInternalValues",value:(r=s(a().mark((function e(t){var r,n,i,s,u,o,l,c,h,f,m,v,d,g,p,y,k,w=arguments;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=w.length>1&&void 0!==w[1]?w[1]:bu(!0),la.assert(t,lm),oa.assert(t.safeContents,lm,"Array"),t.safeContents.length===this.safeContents.length){e.next=5;break}throw new oa('Length of "parameters.safeContents" must be equal to "this.safeContents.length"');case 5:this.parsedValue={safeContents:[]},n=E(this.safeContents.entries()),e.prev=7,n.s();case 9:if((i=n.n()).done){e.next=41;break}s=A(i.value,2),u=s[0],o=s[1],l=t.safeContents[u],c="parameters.safeContents[".concat(u,"]"),e.t0=o.contentType,e.next=e.t0===pn?16:e.t0===kn?20:e.t0===wn?30:38;break;case 16:return oa.assert(o.content,"this.safeContents[j].content",Lt),h=o.content.getValue(),this.parsedValue.safeContents.push({privacyMode:0,value:Yc.fromBER(h)}),e.abrupt("break",39);case 20:return f=new om({schema:o.content}),la.assert(c,l,"recipientCertificate","recipientKey"),v=(m=l).recipientCertificate,d=m.recipientKey,e.next=27,f.decrypt(0,{recipientCertificate:v,recipientPrivateKey:d},r);case 27:return g=e.sent,this.parsedValue.safeContents.push({privacyMode:2,value:Yc.fromBER(g)}),e.abrupt("break",39);case 30:return p=new Rc({schema:o.content}),la.assert(c,l,"password"),y=l.password,e.next=35,p.decrypt({password:y},r);case 35:return k=e.sent,this.parsedValue.safeContents.push({privacyMode:1,value:Yc.fromBER(k)}),e.abrupt("break",39);case 38:throw new Error('Unknown "contentType" for AuthenticatedSafe: " '.concat(o.contentType));case 39:e.next=9;break;case 41:e.next=46;break;case 43:e.prev=43,e.t1=e.catch(7),n.e(e.t1);case 46:return e.prev=46,n.f(),e.finish(46);case 49:case"end":return e.stop()}}),e,this,[[7,43,46,49]])}))),function(e){return r.apply(this,arguments)})},{key:"makeInternalValues",value:(t=s(a().mark((function e(t){var r,n,i,s,u,o,l,c,h,f,m,v,d,g=arguments;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=g.length>1&&void 0!==g[1]?g[1]:bu(!0),this.parsedValue){e.next=3;break}throw new Error('Please run "parseValues" first or add "parsedValue" manually');case 3:if(oa.assert(this.parsedValue,"this.parsedValue","object"),oa.assert(this.parsedValue.safeContents,"this.parsedValue.safeContents","Array"),oa.assert(t,"parameters","object"),la.assert(t,"safeContents"),oa.assert(t.safeContents,"parameters.safeContents","Array"),t.safeContents.length===this.parsedValue.safeContents.length){e.next=10;break}throw new oa('Length of "parameters.safeContents" must be equal to "this.parsedValue.safeContents"');case 10:this.safeContents=[],n=E(this.parsedValue.safeContents.entries()),e.prev=12,n.s();case 14:if((i=n.n()).done){e.next=54;break}s=A(i.value,2),u=s[0],o=s[1],la.assert("content",o,"privacyMode","value"),oa.assert(o.value,"content.value",Yc),e.t0=o.privacyMode,e.next=0===e.t0?21:1===e.t0?24:2===e.t0?31:51;break;case 21:return l=o.value.toSchema().toBER(!1),this.safeContents.push(new ll({contentType:"1.2.840.113549.1.7.1",content:new Lt({valueHex:l})})),e.abrupt("break",52);case 24:return c=new Rc,(h=t.safeContents[u]).contentToEncrypt=o.value.toSchema().toBER(!1),e.next=29,c.encrypt(h);case 29:return this.safeContents.push(new ll({contentType:"1.2.840.113549.1.7.6",content:c.toSchema()})),e.abrupt("break",52);case 31:f=new om,m=o.value.toSchema().toBER(!1),v=t.safeContents[u],la.assert("parameters.safeContents[".concat(u,"]"),v,"encryptingCertificate","encryptionAlgorithm"),e.t1=!0,e.next=e.t1===("aes-cbc"===v.encryptionAlgorithm.name.toLowerCase())||e.t1===("aes-gcm"===v.encryptionAlgorithm.name.toLowerCase())?38:39;break;case 38:return e.abrupt("break",40);case 39:throw new Error('Incorrect parameter "encryptionAlgorithm" in "parameters.safeContents[i]": '.concat(v.encryptionAlgorithm));case 40:e.t2=!0,e.next=e.t2===(128===v.encryptionAlgorithm.length)||e.t2===(192===v.encryptionAlgorithm.length)||e.t2===(256===v.encryptionAlgorithm.length)?43:44;break;case 43:return e.abrupt("break",45);case 44:throw new Error('Incorrect parameter "encryptionAlgorithm.length" in "parameters.safeContents[i]": '.concat(v.encryptionAlgorithm.length));case 45:return d=v.encryptionAlgorithm,f.addRecipientByCertificate(v.encryptingCertificate,{},void 0,r),e.next=49,f.encrypt(d,m,r);case 49:return this.safeContents.push(new ll({contentType:"1.2.840.113549.1.7.3",content:f.toSchema()})),e.abrupt("break",52);case 51:throw new Error('Incorrect value for "content.privacyMode": '.concat(o.privacyMode));case 52:e.next=14;break;case 54:e.next=59;break;case 56:e.prev=56,e.t3=e.catch(12),n.e(e.t3);case 59:return e.prev=59,n.f(),e.finish(59);case 62:return e.abrupt("return",this);case 63:case"end":return e.stop()}}),e,this,[[12,56,59,62]])}))),function(e){return t.apply(this,arguments)})}],[{key:"defaultValues",value:function(e){switch(e){case lm:return[];case cm:return{};default:return S(f(i),"defaultValues",this).call(this,e)}}},{key:"compareWithDefault",value:function(e,t){switch(e){case lm:return 0===t.length;case cm:return t instanceof Object&&0===Object.keys(t).length;default:return S(f(i),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Oe(e,"names",{});return new sr({name:t.blockName||ua,value:[new ea({name:t.contentInfos||ua,value:ll.schema()})]})}}]),i}(ha);fm.CLASS_NAME="AuthenticatedSafe";var mm="hashAlgorithm",vm="issuerNameHash",dm="issuerKeyHash",gm="serialNumber",pm=[mm,vm,dm,gm],ym=function(e){h(i,e);var t,r,n=w(i);function i(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return u(this,i),(e=n.call(this)).hashAlgorithm=Oe(t,mm,i.defaultValues(mm)),e.issuerNameHash=Oe(t,vm,i.defaultValues(vm)),e.issuerKeyHash=Oe(t,dm,i.defaultValues(dm)),e.serialNumber=Oe(t,gm,i.defaultValues(gm)),t.schema&&e.fromSchema(t.schema),e}return l(i,[{key:"fromSchema",value:function(e){Ge(e,pm);var t=ra(e,e,i.schema({names:{hashAlgorithm:mm,issuerNameHash:vm,issuerKeyHash:dm,serialNumber:gm}}));ca.assertSchema(t,this.className),this.hashAlgorithm=new Ha({schema:t.result.hashAlgorithm}),this.issuerNameHash=t.result.issuerNameHash,this.issuerKeyHash=t.result.issuerKeyHash,this.serialNumber=t.result.serialNumber}},{key:"toSchema",value:function(){return new sr({value:[this.hashAlgorithm.toSchema(),this.issuerNameHash,this.issuerKeyHash,this.serialNumber]})}},{key:"toJSON",value:function(){return{hashAlgorithm:this.hashAlgorithm.toJSON(),issuerNameHash:this.issuerNameHash.toJSON(),issuerKeyHash:this.issuerKeyHash.toJSON(),serialNumber:this.serialNumber.toJSON()}}},{key:"isEqual",value:function(e){return this.hashAlgorithm.algorithmId===e.hashAlgorithm.algorithmId&&(!!Ie.isEqual(this.issuerNameHash.valueBlock.valueHexView,e.issuerNameHash.valueBlock.valueHexView)&&(!!Ie.isEqual(this.issuerKeyHash.valueBlock.valueHexView,e.issuerKeyHash.valueBlock.valueHexView)&&!!this.serialNumber.isEqual(e.serialNumber)))}},{key:"createForCertificate",value:(r=s(a().mark((function e(t,r){var n,i,s,u,o,l,c=arguments;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=c.length>2&&void 0!==c[2]?c[2]:bu(!0),la.assert(r,mm,"issuerCertificate"),i=n.getOIDByAlgorithm({name:r.hashAlgorithm},!0,"hashAlgorithm"),this.hashAlgorithm=new Ha({algorithmId:i,algorithmParams:new Dt}),s=r.issuerCertificate,this.serialNumber=t.serialNumber,e.next=8,n.digest({name:r.hashAlgorithm},s.subject.toSchema().toBER(!1));case 8:return u=e.sent,this.issuerNameHash=new Lt({valueHex:u}),o=s.subjectPublicKeyInfo.subjectPublicKey.valueBlock.valueHexView,e.next=13,n.digest({name:r.hashAlgorithm},o);case 13:l=e.sent,this.issuerKeyHash=new Lt({valueHex:l});case 15:case"end":return e.stop()}}),e,this)}))),function(e,t){return r.apply(this,arguments)})}],[{key:"create",value:(t=s(a().mark((function e(t,r){var n,s,u=arguments;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=u.length>2&&void 0!==u[2]?u[2]:bu(!0),s=new i,e.next=4,s.createForCertificate(t,r,n);case 4:return e.abrupt("return",s);case 5:case"end":return e.stop()}}),e)}))),function(e,r){return t.apply(this,arguments)})},{key:"defaultValues",value:function(e){switch(e){case mm:return new Ha;case vm:case dm:return new Lt;case gm:return new Gt;default:return S(f(i),"defaultValues",this).call(this,e)}}},{key:"compareWithDefault",value:function(e,t){switch(e){case mm:return t.algorithmId===ua&&"algorithmParams"in t==!1;case vm:case dm:case gm:return t.isEqual(i.defaultValues(gm));default:return S(f(i),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Oe(e,"names",{});return new sr({name:t.blockName||ua,value:[Ha.schema(t.hashAlgorithmObject||{names:{blockName:t.hashAlgorithm||ua}}),new Lt({name:t.issuerNameHash||ua}),new Lt({name:t.issuerKeyHash||ua}),new Gt({name:t.serialNumber||ua})]})}}]),i}(ha);ym.CLASS_NAME="CertID";var km="certID",wm="certStatus",bm="thisUpdate",Sm="nextUpdate",Am="singleExtensions",Nm=[km,wm,bm,Sm,Am],Cm=function(e){h(r,e);var t=w(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return u(this,r),(e=t.call(this)).certID=Oe(a,km,r.defaultValues(km)),e.certStatus=Oe(a,wm,r.defaultValues(wm)),e.thisUpdate=Oe(a,bm,r.defaultValues(bm)),Sm in a&&(e.nextUpdate=Oe(a,Sm,r.defaultValues(Sm))),Am in a&&(e.singleExtensions=Oe(a,Am,r.defaultValues(Am))),a.schema&&e.fromSchema(a.schema),e}return l(r,[{key:"fromSchema",value:function(e){Ge(e,Nm);var t=ra(e,e,r.schema({names:{certID:{names:{blockName:km}},certStatus:wm,thisUpdate:bm,nextUpdate:Sm,singleExtensions:{names:{blockName:Am}}}}));ca.assertSchema(t,this.className),this.certID=new ym({schema:t.result.certID}),this.certStatus=t.result.certStatus,this.thisUpdate=t.result.thisUpdate.toDate(),Sm in t.result&&(this.nextUpdate=t.result.nextUpdate.toDate()),Am in t.result&&(this.singleExtensions=Array.from(t.result.singleExtensions.valueBlock.value,(function(e){return new to({schema:e})})))}},{key:"toSchema",value:function(){var e=[];return e.push(this.certID.toSchema()),e.push(this.certStatus),e.push(new jr({valueDate:this.thisUpdate})),this.nextUpdate&&e.push(new xt({idBlock:{tagClass:3,tagNumber:0},value:[new jr({valueDate:this.nextUpdate})]})),this.singleExtensions&&e.push(new sr({value:Array.from(this.singleExtensions,(function(e){return e.toSchema()}))})),new sr({value:e})}},{key:"toJSON",value:function(){var e={certID:this.certID.toJSON(),certStatus:this.certStatus.toJSON(),thisUpdate:this.thisUpdate};return this.nextUpdate&&(e.nextUpdate=this.nextUpdate),this.singleExtensions&&(e.singleExtensions=Array.from(this.singleExtensions,(function(e){return e.toJSON()}))),e}}],[{key:"defaultValues",value:function(e){switch(e){case km:return new ym;case wm:return{};case bm:case Sm:return new Date(0,0,0);case Am:return[];default:return S(f(r),"defaultValues",this).call(this,e)}}},{key:"compareWithDefault",value:function(e,t){switch(e){case km:return ym.compareWithDefault("hashAlgorithm",t.hashAlgorithm)&&ym.compareWithDefault("issuerNameHash",t.issuerNameHash)&&ym.compareWithDefault("issuerKeyHash",t.issuerKeyHash)&&ym.compareWithDefault("serialNumber",t.serialNumber);case wm:return 0===Object.keys(t).length;case bm:case Sm:return t===r.defaultValues(e);default:return S(f(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Oe(e,"names",{});return new sr({name:t.blockName||ua,value:[ym.schema(t.certID||{}),new $r({value:[new wt({name:t.certStatus||ua,idBlock:{tagClass:3,tagNumber:0}}),new xt({name:t.certStatus||ua,idBlock:{tagClass:3,tagNumber:1},value:[new jr,new xt({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new zt]})]}),new wt({name:t.certStatus||ua,idBlock:{tagClass:3,tagNumber:2},lenBlock:{length:1}})]}),new jr({name:t.thisUpdate||ua}),new xt({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new jr({name:t.nextUpdate||ua})]}),new xt({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[no.schema(t.singleExtensions||{})]})]})}}]),r}(ha);Cm.CLASS_NAME="SingleResponse";var xm="tbs",Em="version",Im="responderID",Bm="producedAt",Vm="responses",Dm="responseExtensions",Om="ResponseData",Pm="".concat(Om,".").concat(Em),Rm="".concat(Om,".").concat(Im),Um="".concat(Om,".").concat(Bm),Tm="".concat(Om,".").concat(Vm),Lm="".concat(Om,".").concat(Dm),Hm=[Om,Pm,Rm,Um,Tm,Lm],Mm=function(e){h(r,e);var t=w(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return u(this,r),(e=t.call(this)).tbsView=new Uint8Array(Oe(a,xm,r.defaultValues(xm))),Em in a&&(e.version=Oe(a,Em,r.defaultValues(Em))),e.responderID=Oe(a,Im,r.defaultValues(Im)),e.producedAt=Oe(a,Bm,r.defaultValues(Bm)),e.responses=Oe(a,Vm,r.defaultValues(Vm)),Dm in a&&(e.responseExtensions=Oe(a,Dm,r.defaultValues(Dm))),a.schema&&e.fromSchema(a.schema),e}return l(r,[{key:"tbs",get:function(){return Ie.toArrayBuffer(this.tbsView)},set:function(e){this.tbsView=new Uint8Array(e)}},{key:"fromSchema",value:function(e){Ge(e,Hm);var t=ra(e,e,r.schema());ca.assertSchema(t,this.className),this.tbsView=t.result.ResponseData.valueBeforeDecodeView,Pm in t.result&&(this.version=t.result[Pm].valueBlock.valueDec),1===t.result[Rm].idBlock.tagNumber?this.responderID=new ya({schema:t.result[Rm].valueBlock.value[0]}):this.responderID=t.result[Rm].valueBlock.value[0],this.producedAt=t.result[Um].toDate(),this.responses=Array.from(t.result[Tm],(function(e){return new Cm({schema:e})})),Lm in t.result&&(this.responseExtensions=Array.from(t.result[Lm].valueBlock.value,(function(e){return new to({schema:e})})))}},{key:"toSchema",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!1===t){if(!this.tbsView.byteLength)return r.schema();var a=At(this.tbsView);ca.assert(a,"TBS Response Data"),e=a.result}else{var n=[];Em in this&&n.push(new xt({idBlock:{tagClass:3,tagNumber:0},value:[new Gt({value:this.version})]})),this.responderID instanceof ya?n.push(new xt({idBlock:{tagClass:3,tagNumber:1},value:[this.responderID.toSchema()]})):n.push(new xt({idBlock:{tagClass:3,tagNumber:2},value:[this.responderID]})),n.push(new jr({valueDate:this.producedAt})),n.push(new sr({value:Array.from(this.responses,(function(e){return e.toSchema()}))})),this.responseExtensions&&n.push(new xt({idBlock:{tagClass:3,tagNumber:1},value:[new sr({value:Array.from(this.responseExtensions,(function(e){return e.toSchema()}))})]})),e=new sr({value:n})}return e}},{key:"toJSON",value:function(){var e={};return Em in this&&(e.version=this.version),this.responderID&&(e.responderID=this.responderID),this.producedAt&&(e.producedAt=this.producedAt),this.responses&&(e.responses=Array.from(this.responses,(function(e){return e.toJSON()}))),this.responseExtensions&&(e.responseExtensions=Array.from(this.responseExtensions,(function(e){return e.toJSON()}))),e}}],[{key:"defaultValues",value:function(e){switch(e){case Em:return 0;case xm:return sa;case Im:return{};case Bm:return new Date(0,0,0);case Vm:case Dm:return[];default:return S(f(r),"defaultValues",this).call(this,e)}}},{key:"compareWithDefault",value:function(e,t){switch(e){case xm:return 0===t.byteLength;case Im:return 0===Object.keys(t).length;case Bm:return t===r.defaultValues(e);case Vm:case Dm:return 0===t.length;default:return S(f(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Oe(e,"names",{});return new sr({name:t.blockName||Om,value:[new xt({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new Gt({name:t.version||Pm})]}),new $r({value:[new xt({name:t.responderID||Rm,idBlock:{tagClass:3,tagNumber:1},value:[ya.schema(t.ResponseDataByName||{names:{blockName:"ResponseData.byName"}})]}),new xt({name:t.responderID||Rm,idBlock:{tagClass:3,tagNumber:2},value:[new Lt({name:t.ResponseDataByKey||"ResponseData.byKey"})]})]}),new jr({name:t.producedAt||Um}),new sr({value:[new ea({name:Tm,value:Cm.schema(t.response||{})})]}),new xt({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[no.schema(t.extensions||{names:{blockName:Lm}})]})]})}}]),r}(ha);Mm.CLASS_NAME="ResponseData";var Km,_m="trustedCerts",jm="certs",Jm="crls",Fm="ocsps",qm="checkDate",Xm="findOrigin",Wm="findIssuer";!function(e){e[e.unknown=-1]="unknown",e[e.success=0]="success",e[e.noRevocation=11]="noRevocation",e[e.noPath=60]="noPath",e[e.noValidPath=97]="noValidPath"}(Km||(Km={}));var Gm=function(e){h(r,e);var t=w(r);function r(e,a){var n;return u(this,r),(n=t.call(this,a)).name=r.NAME,n.code=e,n.message=a,n}return l(r)}(g(Error));function zm(e,t){for(var r=0;r<t.length;r++)if(Ie.isEqual(e.tbsView,t[r].tbsView))return!0;return!1}Gm.NAME="ChainValidationError";var Qm=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};u(this,e),this.trustedCerts=Oe(t,_m,this.defaultValues(_m)),this.certs=Oe(t,jm,this.defaultValues(jm)),this.crls=Oe(t,Jm,this.defaultValues(Jm)),this.ocsps=Oe(t,Fm,this.defaultValues(Fm)),this.checkDate=Oe(t,qm,this.defaultValues(qm)),this.findOrigin=Oe(t,Xm,this.defaultValues(Xm)),this.findIssuer=Oe(t,Wm,this.defaultValues(Wm))}var t,r,i;return l(e,[{key:"defaultFindIssuer",value:(i=s(a().mark((function e(t,r){var n,i,s,u,o,l,c,h,f,m,v,d,g,p,y,k,w=arguments;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(f=function(e){if(null!==s&&e.extensions){var r,a=!1,n=E(e.extensions);try{for(n.s();!(r=n.n()).done;){var l=r.value;if(l.extnID===$a&&l.parsedValue){a=!0,Ie.isEqual(l.parsedValue.valueBlock.valueHex,s.valueBlock.valueHexView)&&i.push(e);break}}}catch(e){n.e(e)}finally{n.f()}if(a)return}var c=!1;null!==o&&(c=e.serialNumber.isEqual(o)),null!==u?e.subject.isEqual(u)&&c&&i.push(e):t.issuer.isEqual(e.subject)&&i.push(e)},n=w.length>2&&void 0!==w[2]?w[2]:bu(!0),i=[],s=null,u=null,o=null,!t.subject.isEqual(t.issuer)){e.next=17;break}return e.prev=7,e.next=10,t.verify(void 0,n);case 10:if(!e.sent){e.next=13;break}return e.abrupt("return",[t]);case 13:e.next=17;break;case 15:e.prev=15,e.t0=e.catch(7);case 17:if(!t.extensions){e.next=36;break}l=E(t.extensions),e.prev=19,l.s();case 21:if((c=l.n()).done){e.next=28;break}if(!((h=c.value).extnID===mn&&h.parsedValue instanceof Dn)){e.next=26;break}return h.parsedValue.keyIdentifier?s=h.parsedValue.keyIdentifier:(h.parsedValue.authorityCertIssuer&&(u=h.parsedValue.authorityCertIssuer),h.parsedValue.authorityCertSerialNumber&&(o=h.parsedValue.authorityCertSerialNumber)),e.abrupt("break",28);case 26:e.next=21;break;case 28:e.next=33;break;case 30:e.prev=30,e.t1=e.catch(19),l.e(e.t1);case 33:return e.prev=33,l.f(),e.finish(33);case 36:m=E(r.trustedCerts);try{for(m.s();!(v=m.n()).done;)d=v.value,f(d)}catch(e){m.e(e)}finally{m.f()}g=E(r.certs);try{for(g.s();!(p=g.n()).done;)y=p.value,f(y)}catch(e){g.e(e)}finally{g.f()}k=0;case 41:if(!(k<i.length)){e.next=55;break}return e.prev=42,e.next=45,t.verify(i[k],n);case 45:!1===e.sent&&i.splice(k,1),e.next=52;break;case 49:e.prev=49,e.t2=e.catch(42),i.splice(k,1);case 52:k++,e.next=41;break;case 55:return e.abrupt("return",i);case 56:case"end":return e.stop()}}),e,null,[[7,15],[19,30,33,36],[42,49]])}))),function(e,t){return i.apply(this,arguments)})},{key:"defaultValues",value:function(t){switch(t){case _m:case jm:case Jm:case Fm:return[];case qm:return new Date;case Xm:return e.defaultFindOrigin;case Wm:return this.defaultFindIssuer;default:throw new Error("Invalid member name for CertificateChainValidationEngine class: ".concat(t))}}},{key:"sort",value:(r=s(a().mark((function e(){var t,r,n,i,u,o,l,c,h,f,m,v,d,g,p,y,k,w,b,S,C,x,I,B=this,V=arguments;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:c=function(){return c=s(a().mark((function e(t){var r,n,i,s,u,o,l,c,h=arguments;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=h.length>1&&void 0!==h[1]&&h[1],n=!1,i=!1,s=!1,u=!1,!t.extensions){e.next=22;break}o=0;case 7:if(!(o<t.extensions.length)){e.next=16;break}if(!(l=t.extensions[o]).critical||l.parsedValue){e.next=11;break}return e.abrupt("return",{result:!1,resultCode:6,resultMessage:"Unable to parse critical certificate extension: ".concat(l.extnID)});case 11:l.extnID===en&&(s=!0,4==(4&(c=new Uint8Array(l.parsedValue.valueBlock.valueHex))[0])&&(i=!0),2==(2&c[0])&&(u=!0)),l.extnID===an&&"cA"in l.parsedValue&&!0===l.parsedValue.cA&&(n=!0);case 13:o++,e.next=7;break;case 16:if(!0!==i||!1!==n){e.next=18;break}return e.abrupt("return",{result:!1,resultCode:3,resultMessage:'Unable to build certificate chain - using "keyCertSign" flag set without BasicConstraints'});case 18:if(!0!==s||!0!==n||!1!==i){e.next=20;break}return e.abrupt("return",{result:!1,resultCode:4,resultMessage:'Unable to build certificate chain - "keyCertSign" flag was not set'});case 20:if(!0!==n||!0!==s||!r||!1!==u){e.next=22;break}return e.abrupt("return",{result:!1,resultCode:5,resultMessage:'Unable to build certificate chain - intermediate certificate must have "cRLSign" key usage flag'});case 22:if(!1!==n){e.next=24;break}return e.abrupt("return",{result:!1,resultCode:7,resultMessage:"Unable to build certificate chain - more than one possible end-user certificate"});case 24:return e.abrupt("return",{result:!0,resultCode:0,resultMessage:ua});case 25:case"end":return e.stop()}}),e)}))),c.apply(this,arguments)},l=function(e){return c.apply(this,arguments)},t=V.length>0&&void 0!==V[0]&&V[0],r=V.length>1&&void 0!==V[1]?V[1]:bu(!0),n=[],i=function(){var e=s(a().mark((function e(t,r){var n,s,u,o,l,c,h;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=function(e){for(var t=!0,r=0;r<e.length;r++){for(var a=0;a<e.length;a++)if(a!==r&&e[r]===e[a]){t=!1;break}if(!t)break}return t},n=[],!zm(t,B.trustedCerts)){e.next=4;break}return e.abrupt("return",[[t]]);case 4:return e.next=6,B.findIssuer(t,B,r);case 6:if(0!==(u=e.sent).length){e.next=9;break}throw new Error("No valid certificate paths found");case 9:o=0;case 10:if(!(o<u.length)){e.next=21;break}if(!Ie.isEqual(u[o].tbsView,t.tbsView)){e.next=14;break}return n.push([u[o]]),e.abrupt("continue",18);case 14:return e.next=16,i(u[o],r);case 16:for(l=e.sent,c=0;c<l.length;c++)(h=l[c].slice()).splice(0,0,u[o]),s(h)?n.push(h):n.push(l[c]);case 18:o++,e.next=10;break;case 21:return e.abrupt("return",n);case 22:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),u=function(){var e=s(a().mark((function e(t){var i,s,u,o,l,c;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=[],u=[],(i=[]).push.apply(i,N(n.filter((function(e){return t.issuer.isEqual(e.subject)})))),0!==i.length){e.next=6;break}return e.abrupt("return",{status:1,statusMessage:"No certificate's issuers"});case 6:if(s.push.apply(s,N(B.crls.filter((function(e){return e.issuer.isEqual(t.issuer)})))),0!==s.length){e.next=9;break}return e.abrupt("return",{status:2,statusMessage:"No CRLs for specific certificate issuer"});case 9:o=0;case 10:if(!(o<s.length)){e.next=33;break}if(!((l=s[o]).nextUpdate&&l.nextUpdate.value<B.checkDate)){e.next=14;break}return e.abrupt("continue",30);case 14:c=0;case 15:if(!(c<i.length)){e.next=30;break}return e.prev=16,e.next=19,s[o].verify({issuerCertificate:i[c]},r);case 19:if(!e.sent){e.next=23;break}return u.push({crl:s[o],certificate:i[c]}),e.abrupt("break",30);case 23:e.next=27;break;case 25:e.prev=25,e.t0=e.catch(16);case 27:c++,e.next=15;break;case 30:o++,e.next=10;break;case 33:if(!u.length){e.next=35;break}return e.abrupt("return",{status:0,statusMessage:ua,result:u});case 35:return e.abrupt("return",{status:3,statusMessage:"No valid CRLs found"});case 36:case"end":return e.stop()}}),e,null,[[16,25]])})));return function(t){return e.apply(this,arguments)}}(),o=function(){var e=s(a().mark((function e(t,n){var i,s,u,o;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((i=r.getAlgorithmByOID(t.signatureAlgorithm.algorithmId)).name){e.next=3;break}return e.abrupt("return",1);case 3:if(i.hash){e.next=5;break}return e.abrupt("return",1);case 5:s=0;case 6:if(!(s<B.ocsps.length)){e.next=18;break}return u=B.ocsps[s],e.next=10,u.getCertificateStatus(t,n,r);case 10:if(!(o=e.sent).isForCertificate){e.next=15;break}if(0!==o.status){e.next=14;break}return e.abrupt("return",0);case 14:return e.abrupt("return",1);case 15:s++,e.next=6;break;case 18:return e.abrupt("return",2);case 19:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),h=function(){var e=s(a().mark((function e(r,n){var i,s,c,h,f,m,v,d,g,p,y,k,w,b,S,N;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=0;case 1:if(!(i<r.length)){e.next=7;break}if(!(r[i].notBefore.value>n||r[i].notAfter.value<n)){e.next=4;break}return e.abrupt("return",{result:!1,resultCode:8,resultMessage:"The certificate is either not yet valid or expired"});case 4:i++,e.next=1;break;case 7:if(!(r.length<2)){e.next=9;break}return e.abrupt("return",{result:!1,resultCode:9,resultMessage:"Too short certificate path"});case 9:s=r.length-2;case 10:if(!(s>=0)){e.next=17;break}if(!1!==r[s].issuer.isEqual(r[s].subject)){e.next=14;break}if(!1!==r[s].issuer.isEqual(r[s+1].subject)){e.next=14;break}return e.abrupt("return",{result:!1,resultCode:10,resultMessage:"Incorrect name chaining"});case 14:s--,e.next=10;break;case 17:if(0===B.crls.length&&0===B.ocsps.length){e.next=86;break}c=0;case 19:if(!(c<r.length-1)){e.next=86;break}if(h=2,f={status:0,statusMessage:ua},0===B.ocsps.length){e.next=31;break}return e.next=25,o(r[c],r[c+1]);case 25:h=e.sent,e.t0=h,e.next=0===e.t0?29:1===e.t0?30:31;break;case 29:return e.abrupt("continue",83);case 30:return e.abrupt("return",{result:!1,resultCode:12,resultMessage:"One of certificates was revoked via OCSP response"});case 31:if(0===B.crls.length){e.next=55;break}return e.next=34,u(r[c]);case 34:if(0!==(f=e.sent).status||!f.result){e.next=51;break}m=0;case 37:if(!(m<f.result.length)){e.next=49;break}if(!f.result[m].crl.isCertificateRevoked(r[c])){e.next=41;break}return e.abrupt("return",{result:!1,resultCode:12,resultMessage:"One of certificates had been revoked"});case 41:return e.next=43,l(f.result[m].certificate,!0);case 43:if(!1!==e.sent.result){e.next=46;break}return e.abrupt("return",{result:!1,resultCode:13,resultMessage:"CRL issuer certificate is not a CA certificate or does not have crlSign flag"});case 46:m++,e.next=37;break;case 49:e.next=53;break;case 51:if(!1!==t){e.next=53;break}throw new Gm(Km.noRevocation,"No revocation values found for one of certificates: ".concat(f.statusMessage));case 53:e.next=57;break;case 55:if(2!==h){e.next=57;break}return e.abrupt("return",{result:!1,resultCode:11,resultMessage:"No revocation values found for one of certificates"});case 57:if(2!==h||2!==f.status||!t){e.next=83;break}if(v=r[c+1],d=!1,!v.extensions){e.next=81;break}g=E(v.extensions),e.prev=62,g.s();case 64:if((p=g.n()).done){e.next=73;break}y=p.value,e.t1=y.extnID,e.next=e.t1===on||e.t1===ln||e.t1===gn?69:71;break;case 69:return d=!0,e.abrupt("break",71);case 71:e.next=64;break;case 73:e.next=78;break;case 75:e.prev=75,e.t2=e.catch(62),g.e(e.t2);case 78:return e.prev=78,g.f(),e.finish(78);case 81:if(!d){e.next=83;break}throw new Gm(Km.noRevocation,"No revocation values found for one of certificates: ".concat(f.statusMessage));case 83:c++,e.next=19;break;case 86:k=E(r.entries()),e.prev=87,k.s();case 89:if((w=k.n()).done){e.next=100;break}if(b=A(w.value,2),S=b[0],N=b[1],S){e.next=93;break}return e.abrupt("continue",98);case 93:return e.next=95,l(N);case 95:if(e.sent.result){e.next=98;break}return e.abrupt("return",{result:!1,resultCode:14,resultMessage:"One of intermediate certificates is not a CA certificate"});case 98:e.next=89;break;case 100:e.next=105;break;case 102:e.prev=102,e.t3=e.catch(87),k.e(e.t3);case 105:return e.prev=105,k.f(),e.finish(105);case 108:return e.abrupt("return",{result:!0});case 109:case"end":return e.stop()}}),e,null,[[62,75,78,81],[87,102,105,108]])})));return function(t,r){return e.apply(this,arguments)}}(),n.push.apply(n,N(this.trustedCerts)),n.push.apply(n,N(this.certs)),f=0;case 12:if(!(f<n.length)){e.next=27;break}m=0;case 14:if(!(m<n.length)){e.next=24;break}if(f!==m){e.next=17;break}return e.abrupt("continue",21);case 17:if(!Ie.isEqual(n[f].tbsView,n[m].tbsView)){e.next=21;break}return n.splice(m,1),f=0,e.abrupt("break",24);case 21:m++,e.next=14;break;case 24:f++,e.next=12;break;case 27:return v=n[n.length-1],g=[v],e.next=31,i(v,r);case 31:if(0!==(d=e.sent).length){e.next=34;break}throw new Gm(Km.noPath,"Unable to find certificate path");case 34:p=0;case 35:if(!(p<d.length)){e.next=57;break}y=!1,k=0;case 38:if(!(k<d[p].length)){e.next=53;break}w=d[p][k],b=0;case 41:if(!(b<this.trustedCerts.length)){e.next=48;break}if(!Ie.isEqual(w.tbsView,this.trustedCerts[b].tbsView)){e.next=45;break}return y=!0,e.abrupt("break",48);case 45:b++,e.next=41;break;case 48:if(!y){e.next=50;break}return e.abrupt("break",53);case 50:k++,e.next=38;break;case 53:y||(d.splice(p,1),p=0);case 54:p++,e.next=35;break;case 57:if(0!==d.length){e.next=59;break}throw new Gm(Km.noValidPath,"No valid certificate paths found");case 59:for(S=d[0].length,C=0,x=0;x<d.length;x++)d[x].length<S&&(S=d[x].length,C=x);for(I=0;I<d[C].length;I++)g.push(d[C][I]);return e.next=65,h(g,this.checkDate);case 65:if(!1!==(d=e.sent).result){e.next=68;break}throw d;case 68:return e.abrupt("return",g);case 69:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"verify",value:(t=s(a().mark((function e(){var t,r,i,s,u,o,l,c,h,f,m,v,d,g,p,y,k,w,b,S,A,N,C,x,E,I,B,V,D,O,P,R,U,T,L,H,M,K,_,j,J,F,q,X,W,G,z,Q,Y,Z,$,ee,te,re,ae,ne,ie,se,ue,oe,le,ce,he,fe,me,ve,de,ge,pe,ye,ke,we,be,Se,Ae,Ne,Ce,xe,Ee,Ie,Be,Ve,De,Oe,Pe,Re,Ue,Te,Le,He,Me,Ke,_e=arguments;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(l=function(e,t){if(0===e.typesAndValues.length||0===t.typesAndValues.length)return!0;if(e.typesAndValues.length<t.typesAndValues.length)return!1;for(var r=!0,a=0,n=0;n<t.typesAndValues.length;n++){for(var i=!1,s=a;s<e.typesAndValues.length;s++)if(i=e.typesAndValues[s].isEqual(t.typesAndValues[n]),e.typesAndValues[s].type===t.typesAndValues[n].type&&(r=r&&i),!0===i){if(0===a||a===s){a=s+1;break}return!1}if(!1===i)return!1}return 0!==a&&r},o=function(e,t){var r=e.valueBlock.valueHexView,a=t.valueBlock.valueHexView;if(4===r.length&&8===a.length){for(var n=0;n<4;n++)if((r[n]^a[n])&a[n+4])return!1;return!0}if(16===r.length&&32===a.length){for(var i=0;i<16;i++)if((r[i]^a[i])&a[i+16])return!1;return!0}return!1},u=function(e,t){var r=fa(e),a=fa(t),n=r.split("/");if(a.split("/").length>1)return!1;if(n.length>1)for(var s=0;s<n.length;s++)if(n[s].length>0&&":"!==n[s].charAt(n[s].length-1)){r=n[s].split(":")[0];break}if(i(r,a)){var u=r.split("."),o=a.split(".");return 0===o[0].length||u.length===o.length}return!1},s=function(e,t){var r=fa(e),a=fa(t),n=r.split("@"),s=a.split("@");if(0===n.length||0===s.length||n.length<s.length)return!1;if(1===s.length){if(i(n[1],s[0])){var u=n[1].split("."),o=s[0].split(".");return 0===o[0].length||u.length===o.length}return!1}return 0===r.localeCompare(a)},i=function(e,t){var r=fa(e),a=fa(t),n=r.split("."),i=a.split("."),s=n.length,u=i.length;if(0===s||0===u||s<u)return!1;for(var o=0;o<s;o++)if(0===n[o].length)return!1;for(var l=0;l<u;l++)if(0===i[l].length){if(0===l){if(1===u)return!1;continue}return!1}for(var c=0;c<u;c++)if(0!==i[u-1-c].length&&0!==n[s-1-c].localeCompare(i[u-1-c]))return!1;return!0},t=_e.length>0&&void 0!==_e[0]?_e[0]:{},r=_e.length>1&&void 0!==_e[1]?_e[1]:bu(!0),e.prev=7,0!==this.certs.length){e.next=10;break}throw new Error("Empty certificate array");case 10:return c=t.passedWhenNotRevValues||!1,h=t.initialPolicySet||[hn],f=t.initialExplicitPolicy||!1,m=t.initialPolicyMappingInhibit||!1,v=t.initialInhibitPolicy||!1,d=t.initialPermittedSubtreesSet||[],g=t.initialExcludedSubtreesSet||[],p=t.initialRequiredNameForms||[],y=f,k=m,w=v,b=[!1,!1,!1],S=0,A=0,N=0,C=d,x=g,E=p,e.next=31,this.sort(c,r);case 31:for(this.certs=e.sent,(I=[]).push(hn),B=[],V=new Array(this.certs.length-1),D=0;D<this.certs.length-1;D++)V[D]=!0;B.push(V),O=new Array(this.certs.length-1),P=new Array(this.certs.length-1),R=y?this.certs.length-1:-1,U=this.certs.length-2;case 42:if(!(U>=0)){e.next=100;break}if(!(T=this.certs[U]).extensions){e.next=97;break}L=0;case 46:if(!(L<T.extensions.length)){e.next=83;break}if((H=T.extensions[L]).extnID!==cn){e.next=74;break}P[U]=H.parsedValue,M=0;case 51:if(!(M<I.length)){e.next=58;break}if(I[M]!==hn){e.next=55;break}return delete B[M][U],e.abrupt("break",58);case 55:M++,e.next=51;break;case 58:K=0;case 59:if(!(K<H.parsedValue.certificatePolicies.length)){e.next=74;break}_=-1,j=H.parsedValue.certificatePolicies[K].policyIdentifier,J=0;case 63:if(!(J<I.length)){e.next=70;break}if(j!==I[J]){e.next=67;break}return _=J,e.abrupt("break",70);case 67:J++,e.next=63;break;case 70:-1===_?(I.push(j),(F=new Array(this.certs.length-1))[U]=!0,B.push(F)):B[_][U]=!0;case 71:K++,e.next=59;break;case 74:if(H.extnID!==fn){e.next=78;break}if(!k){e.next=77;break}return e.abrupt("return",{result:!1,resultCode:98,resultMessage:"Policy mapping prohibited"});case 77:O[U]=H.parsedValue;case 78:H.extnID===vn&&!1===y&&(0===H.parsedValue.requireExplicitPolicy?(y=!0,R=U):!1===b[0]?(b[0]=!0,S=H.parsedValue.requireExplicitPolicy):S=S>H.parsedValue.requireExplicitPolicy?H.parsedValue.requireExplicitPolicy:S,0===H.parsedValue.inhibitPolicyMapping?k=!0:!1===b[1]?(b[1]=!0,A=H.parsedValue.inhibitPolicyMapping+1):A=A>H.parsedValue.inhibitPolicyMapping+1?H.parsedValue.inhibitPolicyMapping+1:A),H.extnID===dn&&!1===w&&(0===H.parsedValue.valueBlock.valueDec?w=!0:!1===b[2]?(b[2]=!0,N=H.parsedValue.valueBlock.valueDec):N=N>H.parsedValue.valueBlock.valueDec?H.parsedValue.valueBlock.valueDec:N);case 80:L++,e.next=46;break;case 83:if(!0!==w){e.next=94;break}q=-1,X=0;case 86:if(!(X<I.length)){e.next=93;break}if(I[X]!==hn){e.next=90;break}return q=X,e.abrupt("break",93);case 90:X++,e.next=86;break;case 93:-1!==q&&delete B[0][U];case 94:!1===y&&!0===b[0]&&0==--S&&(y=!0,R=U,b[0]=!1),!1===k&&!0===b[1]&&0==--A&&(k=!0,b[1]=!1),!1===w&&!0===b[2]&&0==--N&&(w=!0,b[2]=!1);case 97:U--,e.next=42;break;case 100:W=0;case 101:if(!(W<this.certs.length-1)){e.next=118;break}if(!(W<this.certs.length-2&&void 0!==O[W+1])){e.next=115;break}G=0;case 104:if(!(G<O[W+1].mappings.length)){e.next=115;break}if(O[W+1].mappings[G].issuerDomainPolicy!==hn&&O[W+1].mappings[G].subjectDomainPolicy!==hn){e.next=107;break}return e.abrupt("return",{result:!1,resultCode:99,resultMessage:'The "anyPolicy" should not be a part of policy mapping scheme'});case 107:for(z=-1,Q=-1,Y=0;Y<I.length;Y++)I[Y]===O[W+1].mappings[G].issuerDomainPolicy&&(z=Y),I[Y]===O[W+1].mappings[G].subjectDomainPolicy&&(Q=Y);for(void 0!==B[z][W]&&delete B[z][W],Z=0;Z<P[W].certificatePolicies.length;Z++)if(O[W+1].mappings[G].subjectDomainPolicy===P[W].certificatePolicies[Z].policyIdentifier&&-1!==z&&-1!==Q)for($=0;$<=W;$++)void 0!==B[Q][$]&&(B[z][$]=!0,delete B[Q][$]);case 112:G++,e.next=104;break;case 115:W++,e.next=101;break;case 118:for(ee=0;ee<I.length;ee++)if(I[ee]===hn)for(te=0;te<R;te++)delete B[ee][te];re=[],ae=0;case 121:if(!(ae<B.length)){e.next=149;break}ne=!0,ie=0;case 124:if(!(ie<this.certs.length-1)){e.next=145;break}if(se=!1,!(ie<R&&I[ae]===hn&&I.length>1)){e.next=129;break}return ne=!1,e.abrupt("break",145);case 129:if(void 0!==B[ae][ie]){e.next=142;break}if(!(ie>=R)){e.next=139;break}ue=0;case 132:if(!(ue<I.length)){e.next=139;break}if(I[ue]!==hn){e.next=136;break}return!0===B[ue][ie]&&(se=!0),e.abrupt("break",139);case 136:ue++,e.next=132;break;case 139:if(se){e.next=142;break}return ne=!1,e.abrupt("break",145);case 142:ie++,e.next=124;break;case 145:!0===ne&&re.push(I[ae]);case 146:ae++,e.next=121;break;case 149:if(oe=[],1!==h.length||h[0]!==hn||!1!==y){e.next=154;break}oe=h,e.next=171;break;case 154:if(1!==re.length||re[0]!==hn){e.next=158;break}oe=h,e.next=171;break;case 158:le=0;case 159:if(!(le<re.length)){e.next=171;break}ce=0;case 161:if(!(ce<h.length)){e.next=168;break}if(h[ce]!==re[le]&&h[ce]!==hn){e.next=165;break}return oe.push(re[le]),e.abrupt("break",168);case 165:ce++,e.next=161;break;case 168:le++,e.next=159;break;case 171:if(he={result:oe.length>0,resultCode:0,resultMessage:oe.length>0?ua:'Zero "userConstrPolicies" array, no intersections with "authConstrPolicies"',authConstrPolicies:re,userConstrPolicies:oe,explicitPolicyIndicator:y,policyMappings:O,certificatePath:this.certs},0!==oe.length){e.next=174;break}return e.abrupt("return",he);case 174:if(!1!==he.result){e.next=176;break}return e.abrupt("return",he);case 176:fe=this.certs.length-2;case 178:if(!(fe>=0)){e.next=296;break}if(me=this.certs[fe],ve=[],de=[],ge=[],me.extensions)for(pe=0;pe<me.extensions.length;pe++)(ye=me.extensions[pe]).extnID===un&&("permittedSubtrees"in ye.parsedValue&&(de=de.concat(ye.parsedValue.permittedSubtrees)),"excludedSubtrees"in ye.parsedValue&&(ge=ge.concat(ye.parsedValue.excludedSubtrees))),ye.extnID===tn&&(ve=ve.concat(ye.parsedValue.altNames));ke=E.length<=0,we=0;case 186:if(!(we<E.length)){e.next=207;break}e.t0=E[we].base.type,e.next=4===e.t0?190:204;break;case 190:if(E[we].base.value.typesAndValues.length===me.subject.typesAndValues.length){e.next=192;break}return e.abrupt("continue",204);case 192:ke=!0,be=0;case 194:if(!(be<me.subject.typesAndValues.length)){e.next=201;break}if(me.subject.typesAndValues[be].type===E[we].base.value.typesAndValues[be].type){e.next=198;break}return ke=!1,e.abrupt("break",201);case 198:be++,e.next=194;break;case 201:if(!0!==ke){e.next=203;break}return e.abrupt("break",204);case 203:return e.abrupt("break",204);case 204:we++,e.next=186;break;case 207:if(!1!==ke){e.next=212;break}throw he.result=!1,he.resultCode=21,he.resultMessage="No necessary name form found",he;case 212:Se=[[],[],[],[],[]],Ae=0;case 214:if(!(Ae<C.length)){e.next=231;break}e.t1=C[Ae].base.type,e.next=1===e.t1?218:2===e.t1?220:4===e.t1?222:6===e.t1?224:7===e.t1?226:228;break;case 218:return Se[0].push(C[Ae]),e.abrupt("break",228);case 220:return Se[1].push(C[Ae]),e.abrupt("break",228);case 222:return Se[2].push(C[Ae]),e.abrupt("break",228);case 224:return Se[3].push(C[Ae]),e.abrupt("break",228);case 226:return Se[4].push(C[Ae]),e.abrupt("break",228);case 228:Ae++,e.next=214;break;case 231:Ne=0;case 232:if(!(Ne<5)){e.next=265;break}Ce=!1,xe=!1,Ee=Se[Ne],Ie=0;case 237:if(!(Ie<Ee.length)){e.next=257;break}e.t2=Ne,e.next=0===e.t2?241:1===e.t2?243:2===e.t2?245:3===e.t2?248:4===e.t2?250:252;break;case 241:if(ve.length>0)for(Be=0;Be<ve.length;Be++)1===ve[Be].type&&(xe=!0,Ce=Ce||s(ve[Be].value,Ee[Ie].base.value));else for(Ve=0;Ve<me.subject.typesAndValues.length;Ve++)"1.2.840.113549.1.9.1"!==me.subject.typesAndValues[Ve].type&&"0.9.2342.19200300.100.1.3"!==me.subject.typesAndValues[Ve].type||(xe=!0,Ce=Ce||s(me.subject.typesAndValues[Ve].value.valueBlock.value,Ee[Ie].base.value));return e.abrupt("break",252);case 243:if(ve.length>0)for(De=0;De<ve.length;De++)2===ve[De].type&&(xe=!0,Ce=Ce||i(ve[De].value,Ee[Ie].base.value));return e.abrupt("break",252);case 245:return xe=!0,Ce=l(me.subject,Ee[Ie].base.value),e.abrupt("break",252);case 248:if(ve.length>0)for(Oe=0;Oe<ve.length;Oe++)6===ve[Oe].type&&(xe=!0,Ce=Ce||u(ve[Oe].value,Ee[Ie].base.value));return e.abrupt("break",252);case 250:if(ve.length>0)for(Pe=0;Pe<ve.length;Pe++)7===ve[Pe].type&&(xe=!0,Ce=Ce||o(ve[Pe].value,Ee[Ie].base.value));return e.abrupt("break",252);case 252:if(!Ce){e.next=254;break}return e.abrupt("break",257);case 254:Ie++,e.next=237;break;case 257:if(!(!1===Ce&&Ee.length>0&&xe)){e.next=262;break}throw he.result=!1,he.resultCode=41,he.resultMessage='Failed to meet "permitted sub-trees" name constraint',he;case 262:Ne++,e.next=232;break;case 265:Re=!1,Ue=0;case 267:if(!(Ue<x.length)){e.next=286;break}e.t3=x[Ue].base.type,e.next=1===e.t3?271:2===e.t3?273:4===e.t3?275:6===e.t3?277:7===e.t3?279:281;break;case 271:if(ve.length>=0)for(Te=0;Te<ve.length;Te++)1===ve[Te].type&&(Re=Re||s(ve[Te].value,x[Ue].base.value));else for(Le=0;Le<me.subject.typesAndValues.length;Le++)"1.2.840.113549.1.9.1"!==me.subject.typesAndValues[Le].type&&"0.9.2342.19200300.100.1.3"!==me.subject.typesAndValues[Le].type||(Re=Re||s(me.subject.typesAndValues[Le].value.valueBlock.value,x[Ue].base.value));return e.abrupt("break",281);case 273:if(ve.length>0)for(He=0;He<ve.length;He++)2===ve[He].type&&(Re=Re||i(ve[He].value,x[Ue].base.value));return e.abrupt("break",281);case 275:return Re=Re||l(me.subject,x[Ue].base.value),e.abrupt("break",281);case 277:if(ve.length>0)for(Me=0;Me<ve.length;Me++)6===ve[Me].type&&(Re=Re||u(ve[Me].value,x[Ue].base.value));return e.abrupt("break",281);case 279:if(ve.length>0)for(Ke=0;Ke<ve.length;Ke++)7===ve[Ke].type&&(Re=Re||o(ve[Ke].value,x[Ue].base.value));return e.abrupt("break",281);case 281:if(!Re){e.next=283;break}return e.abrupt("break",286);case 283:Ue++,e.next=267;break;case 286:if(!0!==Re){e.next=291;break}throw he.result=!1,he.resultCode=42,he.resultMessage='Failed to meet "excluded sub-trees" name constraint',he;case 291:C=C.concat(de),x=x.concat(ge);case 293:fe--,e.next=178;break;case 296:return e.abrupt("return",he);case 299:if(e.prev=299,e.t4=e.catch(7),!(e.t4 instanceof Error)){e.next=305;break}if(!(e.t4 instanceof Gm)){e.next=304;break}return e.abrupt("return",{result:!1,resultCode:e.t4.code,resultMessage:e.t4.message,error:e.t4});case 304:return e.abrupt("return",{result:!1,resultCode:Km.unknown,resultMessage:e.t4.message,error:e.t4});case 305:if(!e.t4||"object"!==n(e.t4)||!("resultMessage"in e.t4)){e.next=307;break}return e.abrupt("return",e.t4);case 307:return e.abrupt("return",{result:!1,resultCode:-1,resultMessage:"".concat(e.t4)});case 308:case"end":return e.stop()}}),e,this,[[7,299]])}))),function(){return t.apply(this,arguments)})}],[{key:"defaultFindOrigin",value:function(e,t){0===e.tbsView.byteLength&&(e.tbsView=new Uint8Array(e.encodeTBS().toBER()));var r,a=E(t.certs);try{for(a.s();!(r=a.n()).done;){var n=r.value;if(0===n.tbsView.byteLength&&(n.tbsView=new Uint8Array(n.encodeTBS().toBER())),Ie.isEqual(e.tbsView,n.tbsView))return"Intermediate Certificates"}}catch(e){a.e(e)}finally{a.f()}var i,s=E(t.trustedCerts);try{for(s.s();!(i=s.n()).done;){var u=i.value;if(0===u.tbsView.byteLength&&(u.tbsView=new Uint8Array(u.encodeTBS().toBER())),Ie.isEqual(e.tbsView,u.tbsView))return"Trusted Certificates"}}catch(e){s.e(e)}finally{s.f()}return"Unknown"}}]),e}(),Ym="tbsResponseData",Zm="signatureAlgorithm",$m="signature",ev="certs",tv="BasicOCSPResponse",rv="".concat(tv,".").concat(Ym),av="".concat(tv,".").concat(Zm),nv="".concat(tv,".").concat($m),iv="".concat(tv,".").concat(ev),sv=[rv,av,nv,iv],uv=function(e){h(o,e);var t,r,n,i=w(o);function o(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return u(this,o),(e=i.call(this)).tbsResponseData=Oe(t,Ym,o.defaultValues(Ym)),e.signatureAlgorithm=Oe(t,Zm,o.defaultValues(Zm)),e.signature=Oe(t,$m,o.defaultValues($m)),ev in t&&(e.certs=Oe(t,ev,o.defaultValues(ev))),t.schema&&e.fromSchema(t.schema),e}return l(o,[{key:"fromSchema",value:function(e){Ge(e,sv);var t=ra(e,e,o.schema());ca.assertSchema(t,this.className),this.tbsResponseData=new Mm({schema:t.result[rv]}),this.signatureAlgorithm=new Ha({schema:t.result[av]}),this.signature=t.result[nv],iv in t.result&&(this.certs=Array.from(t.result[iv],(function(e){return new ql({schema:e})})))}},{key:"toSchema",value:function(){var e=[];return e.push(this.tbsResponseData.toSchema()),e.push(this.signatureAlgorithm.toSchema()),e.push(this.signature),this.certs&&e.push(new xt({idBlock:{tagClass:3,tagNumber:0},value:[new sr({value:Array.from(this.certs,(function(e){return e.toSchema()}))})]})),new sr({value:e})}},{key:"toJSON",value:function(){var e={tbsResponseData:this.tbsResponseData.toJSON(),signatureAlgorithm:this.signatureAlgorithm.toJSON(),signature:this.signature.toJSON()};return this.certs&&(e.certs=Array.from(this.certs,(function(e){return e.toJSON()}))),e}},{key:"getCertificateStatus",value:(n=s(a().mark((function e(t,r){var n,i,s,u,o,l,c,h,f,m,v,d,g,p,y,k=arguments;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=k.length>2&&void 0!==k[2]?k[2]:bu(!0),i={isForCertificate:!1,status:2},s={},u=[],o=E(this.tbsResponseData.responses),e.prev=5,o.s();case 7:if((l=o.n()).done){e.next=18;break}if(c=l.value,h=n.getAlgorithmByOID(c.certID.hashAlgorithm.algorithmId,!0,"CertID.hashAlgorithm"),s[h.name]){e.next=16;break}return s[h.name]=1,f=new ym,u.push(f),e.next=16,f.createForCertificate(t,{hashAlgorithm:h.name,issuerCertificate:r},n);case 16:e.next=7;break;case 18:e.next=23;break;case 20:e.prev=20,e.t0=e.catch(5),o.e(e.t0);case 23:return e.prev=23,o.f(),e.finish(23);case 26:m=E(this.tbsResponseData.responses),e.prev=27,m.s();case 29:if((v=m.n()).done){e.next=69;break}d=v.value,g=E(u),e.prev=32,g.s();case 34:if((p=g.n()).done){e.next=59;break}if(y=p.value,!d.certID.isEqual(y)){e.next=57;break}i.isForCertificate=!0,e.prev=38,e.t1=d.certStatus.idBlock.isConstructed,e.next=!0===e.t1?42:!1===e.t1?44:52;break;case 42:return 1===d.certStatus.idBlock.tagNumber&&(i.status=1),e.abrupt("break",52);case 44:e.t2=d.certStatus.idBlock.tagNumber,e.next=0===e.t2?47:2===e.t2?49:51;break;case 47:return i.status=0,e.abrupt("break",51);case 49:return i.status=2,e.abrupt("break",51);case 51:return e.abrupt("break",52);case 52:e.next=56;break;case 54:e.prev=54,e.t3=e.catch(38);case 56:return e.abrupt("return",i);case 57:e.next=34;break;case 59:e.next=64;break;case 61:e.prev=61,e.t4=e.catch(32),g.e(e.t4);case 64:return e.prev=64,g.f(),e.finish(64);case 67:e.next=29;break;case 69:e.next=74;break;case 71:e.prev=71,e.t5=e.catch(27),m.e(e.t5);case 74:return e.prev=74,m.f(),e.finish(74);case 77:return e.abrupt("return",i);case 78:case"end":return e.stop()}}),e,this,[[5,20,23,26],[27,71,74,77],[32,61,64,67],[38,54]])}))),function(e,t){return n.apply(this,arguments)})},{key:"sign",value:(r=s(a().mark((function e(t){var r,n,i,s,u,o=arguments;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=o.length>1&&void 0!==o[1]?o[1]:"SHA-1",n=o.length>2&&void 0!==o[2]?o[2]:bu(!0),t){e.next=4;break}throw new Error("Need to provide a private key for signing");case 4:return e.next=6,n.getSignatureParameters(t,r);case 6:if(i=e.sent,"name"in(s=i.parameters.algorithm)){e.next=10;break}throw new Error("Empty algorithm");case 10:return this.signatureAlgorithm=i.signatureAlgorithm,this.tbsResponseData.tbsView=new Uint8Array(this.tbsResponseData.toSchema(!0).toBER()),e.next=14,n.signWithPrivateKey(this.tbsResponseData.tbsView,t,{algorithm:s});case 14:u=e.sent,this.signature=new _t({valueHex:u});case 16:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"verify",value:(t=s(a().mark((function e(){var t,r,n,i,s,u,o,l,c,h,f,m,v,d,g,p,y,k,w,b,S=arguments;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=S.length>0&&void 0!==S[0]?S[0]:{},r=S.length>1&&void 0!==S[1]?S[1]:bu(!0),n=null,i=-1,s=t.trustedCerts||[],this.certs){e.next=7;break}throw new Error("No certificates attached to the BasicOCSPResponse");case 7:e.t0=!0,e.next=e.t0===this.tbsResponseData.responderID instanceof ya?10:e.t0===this.tbsResponseData.responderID instanceof Lt?29:51;break;case 10:u=E(this.certs.entries()),e.prev=11,u.s();case 13:if((o=u.n()).done){e.next=20;break}if(l=A(o.value,2),c=l[0],!l[1].subject.isEqual(this.tbsResponseData.responderID)){e.next=18;break}return i=c,e.abrupt("break",20);case 18:e.next=13;break;case 20:e.next=25;break;case 22:e.prev=22,e.t1=e.catch(11),u.e(e.t1);case 25:return e.prev=25,u.f(),e.finish(25);case 28:return e.abrupt("break",52);case 29:h=E(this.certs.entries()),e.prev=30,h.s();case 32:if((f=h.n()).done){e.next=42;break}return m=A(f.value,2),v=m[0],d=m[1],e.next=36,r.digest({name:"sha-1"},d.subjectPublicKeyInfo.subjectPublicKey.valueBlock.valueHexView);case 36:if(!Me(e.sent,this.tbsResponseData.responderID.valueBlock.valueHex)){e.next=40;break}return i=v,e.abrupt("break",42);case 40:e.next=32;break;case 42:e.next=47;break;case 44:e.prev=44,e.t2=e.catch(30),h.e(e.t2);case 47:return e.prev=47,h.f(),e.finish(47);case 50:return e.abrupt("break",52);case 51:throw new Error("Wrong value for responderID");case 52:if(-1!==i){e.next=54;break}throw new Error("Correct certificate was not found in OCSP response");case 54:n=this.certs[i],g=[n],p=E(this.certs),e.prev=57,p.s();case 59:if((y=p.n()).done){e.next=67;break}return k=y.value,e.next=63,Xl(k,n);case 63:(w=e.sent)&&g.push(w);case 65:e.next=59;break;case 67:e.next=72;break;case 69:e.prev=69,e.t3=e.catch(57),p.e(e.t3);case 72:return e.prev=72,p.f(),e.finish(72);case 75:return b=new Qm({certs:g,trustedCerts:s}),e.next=78,b.verify({},r);case 78:if(e.sent.result){e.next=81;break}throw new Error("Validation of signer's certificate failed");case 81:return e.abrupt("return",r.verifyWithPublicKey(this.tbsResponseData.tbsView,this.signature,this.certs[i].subjectPublicKeyInfo,this.signatureAlgorithm));case 82:case"end":return e.stop()}}),e,this,[[11,22,25,28],[30,44,47,50],[57,69,72,75]])}))),function(){return t.apply(this,arguments)})}],[{key:"defaultValues",value:function(e){switch(e){case Ym:return new Mm;case Zm:return new Ha;case $m:return new _t;case ev:return[];default:return S(f(o),"defaultValues",this).call(this,e)}}},{key:"compareWithDefault",value:function(e,t){switch(e){case"type":var r=Mm.compareWithDefault("tbs",t.tbs)&&Mm.compareWithDefault("responderID",t.responderID)&&Mm.compareWithDefault("producedAt",t.producedAt)&&Mm.compareWithDefault("responses",t.responses);return"responseExtensions"in t&&(r=r&&Mm.compareWithDefault("responseExtensions",t.responseExtensions)),r;case Zm:return t.algorithmId===ua&&"algorithmParams"in t==!1;case $m:return t.isEqual(o.defaultValues(e));case ev:return 0===t.length;default:return S(f(o),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Oe(e,"names",{});return new sr({name:t.blockName||tv,value:[Mm.schema(t.tbsResponseData||{names:{blockName:rv}}),Ha.schema(t.signatureAlgorithm||{names:{blockName:av}}),new _t({name:t.signature||nv}),new xt({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new sr({value:[new ea({name:iv,value:ql.schema(t.certs||{})})]})]})]})}}]),o}(ha);uv.CLASS_NAME="BasicOCSPResponse";var ov="tbs",lv="version",cv="subject",hv="subjectPublicKeyInfo",fv="attributes",mv="signatureAlgorithm",vv="signatureValue",dv="CertificationRequestInfo",gv="".concat(dv,".version"),pv="".concat(dv,".subject"),yv="".concat(dv,".subjectPublicKeyInfo"),kv="".concat(dv,".attributes"),wv=[dv,gv,pv,yv,kv,mv,vv];function bv(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Oe(e,"names",{});return new sr({name:t.CertificationRequestInfo||dv,value:[new Gt({name:t.CertificationRequestInfoVersion||gv}),ya.schema(t.subject||{names:{blockName:pv}}),vs.schema({names:{blockName:yv}}),new xt({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new ea({optional:!0,name:t.CertificationRequestInfoAttributes||kv,value:qa.schema(t.attributes||{})})]})]})}var Sv=function(e){h(o,e);var t,r,n,i=w(o);function o(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return u(this,o),(e=i.call(this)).tbsView=new Uint8Array(Oe(t,ov,o.defaultValues(ov))),e.version=Oe(t,lv,o.defaultValues(lv)),e.subject=Oe(t,cv,o.defaultValues(cv)),e.subjectPublicKeyInfo=Oe(t,hv,o.defaultValues(hv)),fv in t&&(e.attributes=Oe(t,fv,o.defaultValues(fv))),e.signatureAlgorithm=Oe(t,mv,o.defaultValues(mv)),e.signatureValue=Oe(t,vv,o.defaultValues(vv)),t.schema&&e.fromSchema(t.schema),e}return l(o,[{key:"tbs",get:function(){return Ie.toArrayBuffer(this.tbsView)},set:function(e){this.tbsView=new Uint8Array(e)}},{key:"fromSchema",value:function(e){Ge(e,wv);var t=ra(e,e,o.schema());ca.assertSchema(t,this.className),this.tbsView=t.result.CertificationRequestInfo.valueBeforeDecodeView,this.version=t.result[gv].valueBlock.valueDec,this.subject=new ya({schema:t.result[pv]}),this.subjectPublicKeyInfo=new vs({schema:t.result[yv]}),kv in t.result&&(this.attributes=Array.from(t.result[kv],(function(e){return new qa({schema:e})}))),this.signatureAlgorithm=new Ha({schema:t.result.signatureAlgorithm}),this.signatureValue=t.result.signatureValue}},{key:"encodeTBS",value:function(){var e=[new Gt({value:this.version}),this.subject.toSchema(),this.subjectPublicKeyInfo.toSchema()];return fv in this&&e.push(new xt({idBlock:{tagClass:3,tagNumber:0},value:Array.from(this.attributes||[],(function(e){return e.toSchema()}))})),new sr({value:e})}},{key:"toSchema",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!1===t){if(0===this.tbsView.byteLength)return o.schema();var r=At(this.tbsView);ca.assert(r,"PKCS#10 Certificate Request"),e=r.result}else e=this.encodeTBS();return new sr({value:[e,this.signatureAlgorithm.toSchema(),this.signatureValue]})}},{key:"toJSON",value:function(){var e={tbs:De.ToHex(this.tbsView),version:this.version,subject:this.subject.toJSON(),subjectPublicKeyInfo:this.subjectPublicKeyInfo.toJSON(),signatureAlgorithm:this.signatureAlgorithm.toJSON(),signatureValue:this.signatureValue.toJSON()};return fv in this&&(e.attributes=Array.from(this.attributes||[],(function(e){return e.toJSON()}))),e}},{key:"sign",value:(n=s(a().mark((function e(t){var r,n,i,s,u,o=arguments;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=o.length>1&&void 0!==o[1]?o[1]:"SHA-1",n=o.length>2&&void 0!==o[2]?o[2]:bu(!0),t){e.next=4;break}throw new Error("Need to provide a private key for signing");case 4:return e.next=6,n.getSignatureParameters(t,r);case 6:return i=e.sent,s=i.parameters,this.signatureAlgorithm=i.signatureAlgorithm,this.tbsView=new Uint8Array(this.encodeTBS().toBER()),e.next=12,n.signWithPrivateKey(this.tbsView,t,s);case 12:u=e.sent,this.signatureValue=new _t({valueHex:u});case 14:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"verify",value:(r=s(a().mark((function e(){var t,r=arguments;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.length>0&&void 0!==r[0]?r[0]:bu(!0),e.abrupt("return",t.verifyWithPublicKey(this.tbsView,this.signatureValue,this.subjectPublicKeyInfo,this.signatureAlgorithm));case 2:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"getPublicKey",value:(t=s(a().mark((function e(t){var r,n=arguments;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.length>1&&void 0!==n[1]?n[1]:bu(!0),e.abrupt("return",r.getPublicKey(this.subjectPublicKeyInfo,this.signatureAlgorithm,t));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}],[{key:"defaultValues",value:function(e){switch(e){case ov:return sa;case lv:return 0;case cv:return new ya;case hv:return new vs;case fv:return[];case mv:return new Ha;case vv:return new _t;default:return S(f(o),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Oe(e,"names",{});return new sr({value:[bv(t.certificationRequestInfo||{}),new sr({name:t.signatureAlgorithm||mv,value:[new $t,new Zr({optional:!0})]}),new _t({name:t.signatureValue||vv})]})}}]),o}(ha);Sv.CLASS_NAME="CertificationRequest";var Av="digestAlgorithm",Nv="digest",Cv=[Av,Nv],xv=function(e){h(r,e);var t=w(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return u(this,r),(e=t.call(this)).digestAlgorithm=Oe(a,Av,r.defaultValues(Av)),e.digest=Oe(a,Nv,r.defaultValues(Nv)),a.schema&&e.fromSchema(a.schema),e}return l(r,[{key:"fromSchema",value:function(e){Ge(e,Cv);var t=ra(e,e,r.schema({names:{digestAlgorithm:{names:{blockName:Av}},digest:Nv}}));ca.assertSchema(t,this.className),this.digestAlgorithm=new Ha({schema:t.result.digestAlgorithm}),this.digest=t.result.digest}},{key:"toSchema",value:function(){return new sr({value:[this.digestAlgorithm.toSchema(),this.digest]})}},{key:"toJSON",value:function(){return{digestAlgorithm:this.digestAlgorithm.toJSON(),digest:this.digest.toJSON()}}}],[{key:"defaultValues",value:function(e){switch(e){case Av:return new Ha;case Nv:return new Lt;default:return S(f(r),"defaultValues",this).call(this,e)}}},{key:"compareWithDefault",value:function(e,t){switch(e){case Av:return Ha.compareWithDefault("algorithmId",t.algorithmId)&&"algorithmParams"in t==!1;case Nv:return t.isEqual(r.defaultValues(e));default:return S(f(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Oe(e,"names",{});return new sr({name:t.blockName||ua,value:[Ha.schema(t.digestAlgorithm||{names:{blockName:Av}}),new Lt({name:t.digest||Nv})]})}}]),r}(ha);xv.CLASS_NAME="DigestInfo";var Ev="eContentType",Iv="eContent",Bv=[Ev,Iv],Vv=function(e){h(r,e);var t=w(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(u(this,r),(e=t.call(this)).eContentType=Oe(a,Ev,r.defaultValues(Ev)),Iv in a&&(e.eContent=Oe(a,Iv,r.defaultValues(Iv)),1===e.eContent.idBlock.tagClass&&4===e.eContent.idBlock.tagNumber&&!1===e.eContent.idBlock.isConstructed)){for(var n=new Lt({idBlock:{isConstructed:!0},isConstructed:!0}),i=0,s=e.eContent.valueBlock.valueHexView.slice().buffer,o=s.byteLength;o>0;){for(var l=new Uint8Array(s,i,i+65536>s.byteLength?s.byteLength-i:65536),c=new ArrayBuffer(l.length),h=new Uint8Array(c),f=0;f<h.length;f++)h[f]=l[f];n.valueBlock.value.push(new Lt({valueHex:c})),o-=l.length,i+=l.length}e.eContent=n}return a.schema&&e.fromSchema(a.schema),e}return l(r,[{key:"fromSchema",value:function(e){Ge(e,Bv);var t=ra(e,e,r.schema({names:{eContentType:Ev,eContent:Iv}}));ca.assertSchema(t,this.className),this.eContentType=t.result.eContentType.valueBlock.toString(),Iv in t.result&&(this.eContent=t.result.eContent)}},{key:"toSchema",value:function(){var e=[];return e.push(new $t({value:this.eContentType})),this.eContent&&!1===r.compareWithDefault(Iv,this.eContent)&&e.push(new xt({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[this.eContent]})),new sr({value:e})}},{key:"toJSON",value:function(){var e={eContentType:this.eContentType};return this.eContent&&!1===r.compareWithDefault(Iv,this.eContent)&&(e.eContent=this.eContent.toJSON()),e}}],[{key:"defaultValues",value:function(e){switch(e){case Ev:return ua;case Iv:return new Lt;default:return S(f(r),"defaultValues",this).call(this,e)}}},{key:"compareWithDefault",value:function(e,t){switch(e){case Ev:return t===ua;case Iv:return 1===t.idBlock.tagClass&&4===t.idBlock.tagNumber&&t.isEqual(r.defaultValues(Iv));default:return S(f(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Oe(e,"names",{});return new sr({name:t.blockName||ua,value:[new $t({name:t.eContentType||ua}),new xt({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new Zr({name:t.eContent||ua})]})]})}}]),r}(ha);Vv.CLASS_NAME="EncapsulatedContentInfo";var Dv="mac",Ov="macSalt",Pv="iterations",Rv=[Dv,Ov,Pv],Uv=function(e){h(r,e);var t=w(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return u(this,r),(e=t.call(this)).mac=Oe(a,Dv,r.defaultValues(Dv)),e.macSalt=Oe(a,Ov,r.defaultValues(Ov)),Pv in a&&(e.iterations=Oe(a,Pv,r.defaultValues(Pv))),a.schema&&e.fromSchema(a.schema),e}return l(r,[{key:"fromSchema",value:function(e){Ge(e,Rv);var t=ra(e,e,r.schema({names:{mac:{names:{blockName:Dv}},macSalt:Ov,iterations:Pv}}));ca.assertSchema(t,this.className),this.mac=new xv({schema:t.result.mac}),this.macSalt=t.result.macSalt,Pv in t.result&&(this.iterations=t.result.iterations.valueBlock.valueDec)}},{key:"toSchema",value:function(){var e=[this.mac.toSchema(),this.macSalt];return void 0!==this.iterations&&e.push(new Gt({value:this.iterations})),new sr({value:e})}},{key:"toJSON",value:function(){var e={mac:this.mac.toJSON(),macSalt:this.macSalt.toJSON()};return void 0!==this.iterations&&(e.iterations=this.iterations),e}}],[{key:"defaultValues",value:function(e){switch(e){case Dv:return new xv;case Ov:return new Lt;case Pv:return 1;default:return S(f(r),"defaultValues",this).call(this,e)}}},{key:"compareWithDefault",value:function(e,t){switch(e){case Dv:return xv.compareWithDefault("digestAlgorithm",t.digestAlgorithm)&&xv.compareWithDefault("digest",t.digest);case Ov:return t.isEqual(r.defaultValues(e));case Pv:return t===r.defaultValues(e);default:return S(f(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Oe(e,"names",{});return new sr({name:t.blockName||ua,optional:t.optional||!0,value:[xv.schema(t.mac||{names:{blockName:Dv}}),new Lt({name:t.macSalt||Ov}),new Gt({optional:!0,name:t.iterations||Pv})]})}}]),r}(ha);Uv.CLASS_NAME="MacData";var Tv="hashAlgorithm",Lv="hashedMessage",Hv=[Tv,Lv],Mv=function(e){h(n,e);var t,r=w(n);function n(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return u(this,n),(e=r.call(this)).hashAlgorithm=Oe(t,Tv,n.defaultValues(Tv)),e.hashedMessage=Oe(t,Lv,n.defaultValues(Lv)),t.schema&&e.fromSchema(t.schema),e}return l(n,[{key:"fromSchema",value:function(e){Ge(e,Hv);var t=ra(e,e,n.schema({names:{hashAlgorithm:{names:{blockName:Tv}},hashedMessage:Lv}}));ca.assertSchema(t,this.className),this.hashAlgorithm=new Ha({schema:t.result.hashAlgorithm}),this.hashedMessage=t.result.hashedMessage}},{key:"toSchema",value:function(){return new sr({value:[this.hashAlgorithm.toSchema(),this.hashedMessage]})}},{key:"toJSON",value:function(){return{hashAlgorithm:this.hashAlgorithm.toJSON(),hashedMessage:this.hashedMessage.toJSON()}}}],[{key:"create",value:(t=s(a().mark((function e(t,r){var i,s,u,o,l=arguments;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=l.length>2&&void 0!==l[2]?l[2]:bu(!0),s=i.getOIDByAlgorithm({name:t},!0,"hashAlgorithm"),e.next=4,i.digest(t,r);case 4:return u=e.sent,o=new n({hashAlgorithm:new Ha({algorithmId:s,algorithmParams:new Dt}),hashedMessage:new Lt({valueHex:u})}),e.abrupt("return",o);case 7:case"end":return e.stop()}}),e)}))),function(e,r){return t.apply(this,arguments)})},{key:"defaultValues",value:function(e){switch(e){case Tv:return new Ha;case Lv:return new Lt;default:return S(f(n),"defaultValues",this).call(this,e)}}},{key:"compareWithDefault",value:function(e,t){switch(e){case Tv:return t.algorithmId===ua&&"algorithmParams"in t==!1;case Lv:return 0===t.isEqual(n.defaultValues(e));default:return S(f(n),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Oe(e,"names",{});return new sr({name:t.blockName||ua,value:[Ha.schema(t.hashAlgorithm||{}),new Lt({name:t.hashedMessage||ua})]})}}]),n}(ha);Mv.CLASS_NAME="MessageImprint";var Kv="reqCert",_v="singleRequestExtensions",jv=[Kv,_v],Jv=function(e){h(r,e);var t=w(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return u(this,r),(e=t.call(this)).reqCert=Oe(a,Kv,r.defaultValues(Kv)),_v in a&&(e.singleRequestExtensions=Oe(a,_v,r.defaultValues(_v))),a.schema&&e.fromSchema(a.schema),e}return l(r,[{key:"fromSchema",value:function(e){Ge(e,jv);var t=ra(e,e,r.schema({names:{reqCert:{names:{blockName:Kv}},extensions:{names:{blockName:_v}}}}));ca.assertSchema(t,this.className),this.reqCert=new ym({schema:t.result.reqCert}),_v in t.result&&(this.singleRequestExtensions=Array.from(t.result.singleRequestExtensions.valueBlock.value,(function(e){return new to({schema:e})})))}},{key:"toSchema",value:function(){var e=[];return e.push(this.reqCert.toSchema()),this.singleRequestExtensions&&e.push(new xt({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new sr({value:Array.from(this.singleRequestExtensions,(function(e){return e.toSchema()}))})]})),new sr({value:e})}},{key:"toJSON",value:function(){var e={reqCert:this.reqCert.toJSON()};return this.singleRequestExtensions&&(e.singleRequestExtensions=Array.from(this.singleRequestExtensions,(function(e){return e.toJSON()}))),e}}],[{key:"defaultValues",value:function(e){switch(e){case Kv:return new ym;case _v:return[];default:return S(f(r),"defaultValues",this).call(this,e)}}},{key:"compareWithDefault",value:function(e,t){switch(e){case Kv:return t.isEqual(r.defaultValues(e));case _v:return 0===t.length;default:return S(f(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Oe(e,"names",{});return new sr({name:t.blockName||ua,value:[ym.schema(t.reqCert||{}),new xt({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[to.schema(t.extensions||{names:{blockName:t.singleRequestExtensions||ua}})]})]})}}]),r}(ha);Jv.CLASS_NAME="Request";var Fv="tbs",qv="version",Xv="requestorName",Wv="requestList",Gv="requestExtensions",zv="TBSRequest",Qv="".concat(zv,".").concat(qv),Yv="".concat(zv,".").concat(Xv),Zv="".concat(zv,".requests"),$v="".concat(zv,".").concat(Gv),ed=[zv,Qv,Yv,Zv,$v],td=function(e){h(r,e);var t=w(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return u(this,r),(e=t.call(this)).tbsView=new Uint8Array(Oe(a,Fv,r.defaultValues(Fv))),qv in a&&(e.version=Oe(a,qv,r.defaultValues(qv))),Xv in a&&(e.requestorName=Oe(a,Xv,r.defaultValues(Xv))),e.requestList=Oe(a,Wv,r.defaultValues(Wv)),Gv in a&&(e.requestExtensions=Oe(a,Gv,r.defaultValues(Gv))),a.schema&&e.fromSchema(a.schema),e}return l(r,[{key:"tbs",get:function(){return Ie.toArrayBuffer(this.tbsView)},set:function(e){this.tbsView=new Uint8Array(e)}},{key:"fromSchema",value:function(e){Ge(e,ed);var t=ra(e,e,r.schema());ca.assertSchema(t,this.className),this.tbsView=t.result.TBSRequest.valueBeforeDecodeView,Qv in t.result&&(this.version=t.result[Qv].valueBlock.valueDec),Yv in t.result&&(this.requestorName=new Na({schema:t.result[Yv]})),this.requestList=Array.from(t.result[Zv],(function(e){return new Jv({schema:e})})),$v in t.result&&(this.requestExtensions=Array.from(t.result[$v].valueBlock.value,(function(e){return new to({schema:e})})))}},{key:"toSchema",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!1===t){if(0===this.tbsView.byteLength)return r.schema();var a=At(this.tbsView);if(ca.assert(a,"TBS Request"),!(a.result instanceof sr))throw new Error("ASN.1 result should be SEQUENCE");e=a.result}else{var n=[];void 0!==this.version&&n.push(new xt({idBlock:{tagClass:3,tagNumber:0},value:[new Gt({value:this.version})]})),this.requestorName&&n.push(new xt({idBlock:{tagClass:3,tagNumber:1},value:[this.requestorName.toSchema()]})),n.push(new sr({value:Array.from(this.requestList,(function(e){return e.toSchema()}))})),this.requestExtensions&&n.push(new xt({idBlock:{tagClass:3,tagNumber:2},value:[new sr({value:Array.from(this.requestExtensions,(function(e){return e.toSchema()}))})]})),e=new sr({value:n})}return e}},{key:"toJSON",value:function(){var e={};return null!=this.version&&(e.version=this.version),this.requestorName&&(e.requestorName=this.requestorName.toJSON()),e.requestList=Array.from(this.requestList,(function(e){return e.toJSON()})),this.requestExtensions&&(e.requestExtensions=Array.from(this.requestExtensions,(function(e){return e.toJSON()}))),e}}],[{key:"defaultValues",value:function(e){switch(e){case Fv:return sa;case qv:return 0;case Xv:return new Na;case Wv:case Gv:return[];default:return S(f(r),"defaultValues",this).call(this,e)}}},{key:"compareWithDefault",value:function(e,t){switch(e){case Fv:return 0===t.byteLength;case qv:return t===r.defaultValues(e);case Xv:return t.type===Na.defaultValues("type")&&0===Object.keys(t.value).length;case Wv:case Gv:return 0===t.length;default:return S(f(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Oe(e,"names",{});return new sr({name:t.blockName||zv,value:[new xt({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new Gt({name:t.TBSRequestVersion||Qv})]}),new xt({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[Na.schema(t.requestorName||{names:{blockName:Yv}})]}),new sr({name:t.requestList||"TBSRequest.requestList",value:[new ea({name:t.requests||Zv,value:Jv.schema(t.requestNames||{})})]}),new xt({optional:!0,idBlock:{tagClass:3,tagNumber:2},value:[no.schema(t.extensions||{names:{blockName:t.requestExtensions||$v}})]})]})}}]),r}(ha);td.CLASS_NAME="TBSRequest";var rd="signatureAlgorithm",ad="signature",nd="certs",id=function(e){h(r,e);var t=w(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return u(this,r),(e=t.call(this)).signatureAlgorithm=Oe(a,rd,id.defaultValues(rd)),e.signature=Oe(a,ad,id.defaultValues(ad)),nd in a&&(e.certs=Oe(a,nd,id.defaultValues(nd))),a.schema&&e.fromSchema(a.schema),e}return l(r,[{key:"fromSchema",value:function(e){Ge(e,[rd,ad,nd]);var t=ra(e,e,id.schema({names:{signatureAlgorithm:{names:{blockName:rd}},signature:ad,certs:nd}}));ca.assertSchema(t,this.className),this.signatureAlgorithm=new Ha({schema:t.result.signatureAlgorithm}),this.signature=t.result.signature,nd in t.result&&(this.certs=Array.from(t.result.certs,(function(e){return new ql({schema:e})})))}},{key:"toSchema",value:function(){var e=[];return e.push(this.signatureAlgorithm.toSchema()),e.push(this.signature),this.certs&&e.push(new xt({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new sr({value:Array.from(this.certs,(function(e){return e.toSchema()}))})]})),new sr({value:e})}},{key:"toJSON",value:function(){var e={signatureAlgorithm:this.signatureAlgorithm.toJSON(),signature:this.signature.toJSON()};return this.certs&&(e.certs=Array.from(this.certs,(function(e){return e.toJSON()}))),e}}],[{key:"defaultValues",value:function(e){switch(e){case rd:return new Ha;case ad:return new _t;case nd:return[];default:return S(f(r),"defaultValues",this).call(this,e)}}},{key:"compareWithDefault",value:function(e,t){switch(e){case rd:return t.algorithmId===ua&&"algorithmParams"in t==!1;case ad:return t.isEqual(id.defaultValues(e));case nd:return 0===t.length;default:return S(f(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Oe(e,"names",{});return new sr({name:t.blockName||ua,value:[Ha.schema(t.signatureAlgorithm||{}),new _t({name:t.signature||ua}),new xt({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new sr({value:[new ea({name:t.certs||ua,value:ql.schema({})})]})]})]})}}]),r}(ha);id.CLASS_NAME="Signature";var sd="tbsRequest",ud="optionalSignature",od=[sd,ud],ld=function(e){h(i,e);var t,r,n=w(i);function i(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return u(this,i),(e=n.call(this)).tbsRequest=Oe(t,sd,i.defaultValues(sd)),ud in t&&(e.optionalSignature=Oe(t,ud,i.defaultValues(ud))),t.schema&&e.fromSchema(t.schema),e}return l(i,[{key:"fromSchema",value:function(e){Ge(e,od);var t=ra(e,e,i.schema());ca.assertSchema(t,this.className),this.tbsRequest=new td({schema:t.result.tbsRequest}),ud in t.result&&(this.optionalSignature=new id({schema:t.result.optionalSignature}))}},{key:"toSchema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=[];return t.push(this.tbsRequest.toSchema(e)),this.optionalSignature&&t.push(new xt({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[this.optionalSignature.toSchema()]})),new sr({value:t})}},{key:"toJSON",value:function(){var e={tbsRequest:this.tbsRequest.toJSON()};return this.optionalSignature&&(e.optionalSignature=this.optionalSignature.toJSON()),e}},{key:"createForCertificate",value:(r=s(a().mark((function e(t,r){var n,i,s=arguments;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=s.length>2&&void 0!==s[2]?s[2]:bu(!0),i=new ym,e.next=4,i.createForCertificate(t,r,n);case 4:this.tbsRequest.requestList.push(new Jv({reqCert:i}));case 5:case"end":return e.stop()}}),e,this)}))),function(e,t){return r.apply(this,arguments)})},{key:"sign",value:(t=s(a().mark((function e(t){var r,n,i,s,u,o,l=arguments;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=l.length>1&&void 0!==l[1]?l[1]:"SHA-1",n=l.length>2&&void 0!==l[2]?l[2]:bu(!0),la.assertEmpty(t,"privateKey","OCSPRequest.sign method"),this.optionalSignature){e.next=5;break}throw new Error('Need to create "optionalSignature" field before signing');case 5:return e.next=7,n.getSignatureParameters(t,r);case 7:return i=e.sent,s=i.parameters,this.optionalSignature.signatureAlgorithm=i.signatureAlgorithm,u=this.tbsRequest.toSchema(!0).toBER(!1),e.next=13,n.signWithPrivateKey(u,t,s);case 13:o=e.sent,this.optionalSignature.signature=new _t({valueHex:o});case 15:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"verify",value:function(){}}],[{key:"defaultValues",value:function(e){switch(e){case sd:return new td;case ud:return new id;default:return S(f(i),"defaultValues",this).call(this,e)}}},{key:"compareWithDefault",value:function(e,t){switch(e){case sd:return td.compareWithDefault("tbs",t.tbs)&&td.compareWithDefault("version",t.version)&&td.compareWithDefault("requestorName",t.requestorName)&&td.compareWithDefault("requestList",t.requestList)&&td.compareWithDefault("requestExtensions",t.requestExtensions);case ud:return id.compareWithDefault("signatureAlgorithm",t.signatureAlgorithm)&&id.compareWithDefault("signature",t.signature)&&id.compareWithDefault("certs",t.certs);default:return S(f(i),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Oe(e,"names",{});return new sr({name:t.blockName||"OCSPRequest",value:[td.schema(t.tbsRequest||{names:{blockName:sd}}),new xt({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[id.schema(t.optionalSignature||{names:{blockName:ud}})]})]})}}]),i}(ha);ld.CLASS_NAME="OCSPRequest";var cd="responseType",hd="response",fd=[cd,hd],md=function(e){h(r,e);var t=w(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return u(this,r),(e=t.call(this)).responseType=Oe(a,cd,r.defaultValues(cd)),e.response=Oe(a,hd,r.defaultValues(hd)),a.schema&&e.fromSchema(a.schema),e}return l(r,[{key:"fromSchema",value:function(e){Ge(e,fd);var t=ra(e,e,r.schema({names:{responseType:cd,response:hd}}));ca.assertSchema(t,this.className),this.responseType=t.result.responseType.valueBlock.toString(),this.response=t.result.response}},{key:"toSchema",value:function(){return new sr({value:[new $t({value:this.responseType}),this.response]})}},{key:"toJSON",value:function(){return{responseType:this.responseType,response:this.response.toJSON()}}}],[{key:"defaultValues",value:function(e){switch(e){case cd:return ua;case hd:return new Lt;default:return S(f(r),"defaultValues",this).call(this,e)}}},{key:"compareWithDefault",value:function(e,t){switch(e){case cd:return t===ua;case hd:return t.isEqual(r.defaultValues(e));default:return S(f(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Oe(e,"names",{});return new sr({name:t.blockName||ua,value:[new $t({name:t.responseType||ua}),new Lt({name:t.response||ua})]})}}]),r}(ha);md.CLASS_NAME="ResponseBytes";var vd="responseStatus",dd="responseBytes",gd=function(e){h(o,e);var t,r,n,i=w(o);function o(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return u(this,o),(e=i.call(this)).responseStatus=Oe(t,vd,o.defaultValues(vd)),dd in t&&(e.responseBytes=Oe(t,dd,o.defaultValues(dd))),t.schema&&e.fromSchema(t.schema),e}return l(o,[{key:"fromSchema",value:function(e){Ge(e,[vd,dd]);var t=ra(e,e,o.schema());ca.assertSchema(t,this.className),this.responseStatus=t.result.responseStatus,dd in t.result&&(this.responseBytes=new md({schema:t.result.responseBytes}))}},{key:"toSchema",value:function(){var e=[];return e.push(this.responseStatus),this.responseBytes&&e.push(new xt({idBlock:{tagClass:3,tagNumber:0},value:[this.responseBytes.toSchema()]})),new sr({value:e})}},{key:"toJSON",value:function(){var e={responseStatus:this.responseStatus.toJSON()};return this.responseBytes&&(e.responseBytes=this.responseBytes.toJSON()),e}},{key:"getCertificateStatus",value:(n=s(a().mark((function e(t,r){var n,i,s,u,o=arguments;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=o.length>2&&void 0!==o[2]?o[2]:bu(!0),s={isForCertificate:!1,status:2},this.responseBytes){e.next=4;break}return e.abrupt("return",s);case 4:if(this.responseBytes.responseType===xn){e.next=6;break}return e.abrupt("return",s);case 6:e.prev=6,u=At(this.responseBytes.response.valueBlock.valueHexView),ca.assert(u,"Basic OCSP response"),i=new uv({schema:u.result}),e.next=15;break;case 12:return e.prev=12,e.t0=e.catch(6),e.abrupt("return",s);case 15:return e.abrupt("return",i.getCertificateStatus(t,r,n));case 16:case"end":return e.stop()}}),e,this,[[6,12]])}))),function(e,t){return n.apply(this,arguments)})},{key:"sign",value:(r=s(a().mark((function e(t,r){var n,i,s,u=arguments;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=u.length>2&&void 0!==u[2]?u[2]:bu(!0),!this.responseBytes||this.responseBytes.responseType!==xn){e.next=4;break}return s=uv.fromBER(this.responseBytes.response.valueBlock.valueHexView),e.abrupt("return",s.sign(t,r,n));case 4:throw new Error("Unknown ResponseBytes type: ".concat((null===(i=this.responseBytes)||void 0===i?void 0:i.responseType)||"Unknown"));case 5:case"end":return e.stop()}}),e,this)}))),function(e,t){return r.apply(this,arguments)})},{key:"verify",value:(t=s(a().mark((function e(){var t,r,n,i,s=arguments;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=s.length>0&&void 0!==s[0]?s[0]:null,r=s.length>1&&void 0!==s[1]?s[1]:bu(!0),dd in this!=0){e.next=4;break}throw new Error("Empty ResponseBytes field");case 4:if(!this.responseBytes||this.responseBytes.responseType!==xn){e.next=8;break}return i=uv.fromBER(this.responseBytes.response.valueBlock.valueHexView),null!==t&&(i.certs||(i.certs=[]),i.certs.push(t)),e.abrupt("return",i.verify({},r));case 8:throw new Error("Unknown ResponseBytes type: ".concat((null===(n=this.responseBytes)||void 0===n?void 0:n.responseType)||"Unknown"));case 9:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}],[{key:"defaultValues",value:function(e){switch(e){case vd:return new zt;case dd:return new md;default:return S(f(o),"defaultValues",this).call(this,e)}}},{key:"compareWithDefault",value:function(e,t){switch(e){case vd:return t.isEqual(o.defaultValues(e));case dd:return md.compareWithDefault("responseType",t.responseType)&&md.compareWithDefault("response",t.response);default:return S(f(o),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Oe(e,"names",{});return new sr({name:t.blockName||"OCSPResponse",value:[new zt({name:t.responseStatus||vd}),new xt({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[md.schema(t.responseBytes||{names:{blockName:dd}})]})]})}}]),o}(ha);gd.CLASS_NAME="OCSPResponse";var pd="type",yd="attributes",kd="encodedValue",wd=[yd],bd=function(e){h(r,e);var t=w(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return u(this,r),(e=t.call(this)).type=Oe(a,pd,r.defaultValues(pd)),e.attributes=Oe(a,yd,r.defaultValues(yd)),e.encodedValue=Oe(a,kd,r.defaultValues(kd)),a.schema&&e.fromSchema(a.schema),e}return l(r,[{key:"fromSchema",value:function(e){Ge(e,wd);var t=ra(e,e,r.schema({names:{tagNumber:this.type,attributes:yd}}));if(ca.assertSchema(t,this.className),this.type=t.result.idBlock.tagNumber,this.encodedValue=Ie.toArrayBuffer(t.result.valueBeforeDecodeView),new Uint8Array(this.encodedValue)[0]=49,yd in t.result!=!1)this.attributes=Array.from(t.result.attributes,(function(e){return new qa({schema:e})}));else if(0===this.type)throw new Error("Wrong structure of SignedUnsignedAttributes")}},{key:"toSchema",value:function(){if(r.compareWithDefault(pd,this.type)||r.compareWithDefault(yd,this.attributes))throw new Error('Incorrectly initialized "SignedAndUnsignedAttributes" class');return new xt({optional:!0,idBlock:{tagClass:3,tagNumber:this.type},value:Array.from(this.attributes,(function(e){return e.toSchema()}))})}},{key:"toJSON",value:function(){if(r.compareWithDefault(pd,this.type)||r.compareWithDefault(yd,this.attributes))throw new Error('Incorrectly initialized "SignedAndUnsignedAttributes" class');return{type:this.type,attributes:Array.from(this.attributes,(function(e){return e.toJSON()}))}}}],[{key:"defaultValues",value:function(e){switch(e){case pd:return-1;case yd:return[];case kd:return sa;default:return S(f(r),"defaultValues",this).call(this,e)}}},{key:"compareWithDefault",value:function(e,t){switch(e){case pd:return t===r.defaultValues(pd);case yd:return 0===t.length;case kd:return 0===t.byteLength;default:return S(f(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Oe(e,"names",{});return new xt({name:t.blockName||ua,optional:!0,idBlock:{tagClass:3,tagNumber:t.tagNumber||0},value:[new ea({name:t.attributes||ua,value:qa.schema()})]})}}]),r}(ha);bd.CLASS_NAME="SignedAndUnsignedAttributes";var Sd="version",Ad="sid",Nd="digestAlgorithm",Cd="signedAttrs",xd="signatureAlgorithm",Ed="signature",Id="unsignedAttrs",Bd="SignerInfo",Vd="".concat(Bd,".").concat(Sd),Dd="".concat(Bd,".").concat(Ad),Od="".concat(Bd,".").concat(Nd),Pd="".concat(Bd,".").concat(Cd),Rd="".concat(Bd,".").concat(xd),Ud="".concat(Bd,".").concat(Ed),Td="".concat(Bd,".").concat(Id),Ld=[Vd,Dd,Od,Pd,Rd,Ud,Td],Hd=function(e){h(r,e);var t=w(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return u(this,r),(e=t.call(this)).version=Oe(a,Sd,r.defaultValues(Sd)),e.sid=Oe(a,Ad,r.defaultValues(Ad)),e.digestAlgorithm=Oe(a,Nd,r.defaultValues(Nd)),Cd in a&&(e.signedAttrs=Oe(a,Cd,r.defaultValues(Cd))),e.signatureAlgorithm=Oe(a,xd,r.defaultValues(xd)),e.signature=Oe(a,Ed,r.defaultValues(Ed)),Id in a&&(e.unsignedAttrs=Oe(a,Id,r.defaultValues(Id))),a.schema&&e.fromSchema(a.schema),e}return l(r,[{key:"fromSchema",value:function(e){Ge(e,Ld);var t=ra(e,e,r.schema());ca.assertSchema(t,this.className),this.version=t.result[Vd].valueBlock.valueDec;var a=t.result[Dd];1===a.idBlock.tagClass?this.sid=new wh({schema:a}):this.sid=a,this.digestAlgorithm=new Ha({schema:t.result[Od]}),Pd in t.result&&(this.signedAttrs=new bd({type:0,schema:t.result[Pd]})),this.signatureAlgorithm=new Ha({schema:t.result[Rd]}),this.signature=t.result[Ud],Td in t.result&&(this.unsignedAttrs=new bd({type:1,schema:t.result[Td]}))}},{key:"toSchema",value:function(){if(r.compareWithDefault(Ad,this.sid))throw new Error('Incorrectly initialized "SignerInfo" class');var e=[];return e.push(new Gt({value:this.version})),this.sid instanceof wh?e.push(this.sid.toSchema()):e.push(this.sid),e.push(this.digestAlgorithm.toSchema()),this.signedAttrs&&!1===r.compareWithDefault(Cd,this.signedAttrs)&&e.push(this.signedAttrs.toSchema()),e.push(this.signatureAlgorithm.toSchema()),e.push(this.signature),this.unsignedAttrs&&!1===r.compareWithDefault(Id,this.unsignedAttrs)&&e.push(this.unsignedAttrs.toSchema()),new sr({value:e})}},{key:"toJSON",value:function(){if(r.compareWithDefault(Ad,this.sid))throw new Error('Incorrectly initialized "SignerInfo" class');var e={version:this.version,digestAlgorithm:this.digestAlgorithm.toJSON(),signatureAlgorithm:this.signatureAlgorithm.toJSON(),signature:this.signature.toJSON()};return this.sid instanceof Zr||(e.sid=this.sid.toJSON()),this.signedAttrs&&!1===r.compareWithDefault(Cd,this.signedAttrs)&&(e.signedAttrs=this.signedAttrs.toJSON()),this.unsignedAttrs&&!1===r.compareWithDefault(Id,this.unsignedAttrs)&&(e.unsignedAttrs=this.unsignedAttrs.toJSON()),e}}],[{key:"defaultValues",value:function(e){switch(e){case Sd:return 0;case Ad:return new Zr;case Nd:return new Ha;case Cd:return new bd({type:0});case xd:return new Ha;case Ed:return new Lt;case Id:return new bd({type:1});default:return S(f(r),"defaultValues",this).call(this,e)}}},{key:"compareWithDefault",value:function(e,t){switch(e){case Sd:return r.defaultValues(Sd)===t;case Ad:return t instanceof Zr;case Nd:return t instanceof Ha!=!1&&t.isEqual(r.defaultValues(Nd));case Cd:return bd.compareWithDefault("type",t.type)&&bd.compareWithDefault("attributes",t.attributes)&&bd.compareWithDefault("encodedValue",t.encodedValue);case xd:return t instanceof Ha!=!1&&t.isEqual(r.defaultValues(xd));case Ed:case Id:return bd.compareWithDefault("type",t.type)&&bd.compareWithDefault("attributes",t.attributes)&&bd.compareWithDefault("encodedValue",t.encodedValue);default:return S(f(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Oe(e,"names",{});return new sr({name:Bd,value:[new Gt({name:t.version||Vd}),new $r({value:[wh.schema(t.sidSchema||{names:{blockName:Dd}}),new $r({value:[new xt({optional:!0,name:t.sid||Dd,idBlock:{tagClass:3,tagNumber:0},value:[new Lt]}),new wt({optional:!0,name:t.sid||Dd,idBlock:{tagClass:3,tagNumber:0}})]})]}),Ha.schema(t.digestAlgorithm||{names:{blockName:Od}}),bd.schema(t.signedAttrs||{names:{blockName:Pd,tagNumber:0}}),Ha.schema(t.signatureAlgorithm||{names:{blockName:Rd}}),new Lt({name:t.signature||Ud}),bd.schema(t.unsignedAttrs||{names:{blockName:Td,tagNumber:1}})]})}}]),r}(ha);Hd.CLASS_NAME="SignerInfo";var Md="version",Kd="policy",_d="messageImprint",jd="serialNumber",Jd="genTime",Fd="ordering",qd="nonce",Xd="accuracy",Wd="tsa",Gd="extensions",zd="TSTInfo",Qd="".concat(zd,".").concat(Md),Yd="".concat(zd,".").concat(Kd),Zd="".concat(zd,".").concat(_d),$d="".concat(zd,".").concat(jd),eg="".concat(zd,".").concat(Jd),tg="".concat(zd,".").concat(Xd),rg="".concat(zd,".").concat(Fd),ag="".concat(zd,".").concat(qd),ng="".concat(zd,".").concat(Wd),ig="".concat(zd,".").concat(Gd),sg=[Qd,Yd,Zd,$d,eg,tg,rg,ag,ng,ig],ug=function(e){h(n,e);var t,r=w(n);function n(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return u(this,n),(e=r.call(this)).version=Oe(t,Md,n.defaultValues(Md)),e.policy=Oe(t,Kd,n.defaultValues(Kd)),e.messageImprint=Oe(t,_d,n.defaultValues(_d)),e.serialNumber=Oe(t,jd,n.defaultValues(jd)),e.genTime=Oe(t,Jd,n.defaultValues(Jd)),Xd in t&&(e.accuracy=Oe(t,Xd,n.defaultValues(Xd))),Fd in t&&(e.ordering=Oe(t,Fd,n.defaultValues(Fd))),qd in t&&(e.nonce=Oe(t,qd,n.defaultValues(qd))),Wd in t&&(e.tsa=Oe(t,Wd,n.defaultValues(Wd))),Gd in t&&(e.extensions=Oe(t,Gd,n.defaultValues(Gd))),t.schema&&e.fromSchema(t.schema),e}return l(n,[{key:"fromSchema",value:function(e){Ge(e,sg);var t=ra(e,e,n.schema());ca.assertSchema(t,this.className),this.version=t.result[Qd].valueBlock.valueDec,this.policy=t.result[Yd].valueBlock.toString(),this.messageImprint=new Mv({schema:t.result[Zd]}),this.serialNumber=t.result[$d],this.genTime=t.result[eg].toDate(),tg in t.result&&(this.accuracy=new Oa({schema:t.result[tg]})),rg in t.result&&(this.ordering=t.result[rg].valueBlock.value),ag in t.result&&(this.nonce=t.result[ag]),ng in t.result&&(this.tsa=new Na({schema:t.result[ng]})),ig in t.result&&(this.extensions=Array.from(t.result[ig],(function(e){return new to({schema:e})})))}},{key:"toSchema",value:function(){var e=[];return e.push(new Gt({value:this.version})),e.push(new $t({value:this.policy})),e.push(this.messageImprint.toSchema()),e.push(this.serialNumber),e.push(new jr({valueDate:this.genTime})),this.accuracy&&e.push(this.accuracy.toSchema()),void 0!==this.ordering&&e.push(new Rt({value:this.ordering})),this.nonce&&e.push(this.nonce),this.tsa&&e.push(new xt({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[this.tsa.toSchema()]})),this.extensions&&e.push(new xt({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:Array.from(this.extensions,(function(e){return e.toSchema()}))})),new sr({value:e})}},{key:"toJSON",value:function(){var e={version:this.version,policy:this.policy,messageImprint:this.messageImprint.toJSON(),serialNumber:this.serialNumber.toJSON(),genTime:this.genTime};return this.accuracy&&(e.accuracy=this.accuracy.toJSON()),void 0!==this.ordering&&(e.ordering=this.ordering),this.nonce&&(e.nonce=this.nonce.toJSON()),this.tsa&&(e.tsa=this.tsa.toJSON()),this.extensions&&(e.extensions=Array.from(this.extensions,(function(e){return e.toJSON()}))),e}},{key:"verify",value:(t=s(a().mark((function e(t){var r,n,i,s,u=arguments;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=u.length>1&&void 0!==u[1]?u[1]:bu(!0),t.data){e.next=3;break}throw new Error('"data" is a mandatory attribute for TST_INFO verification');case 3:if(n=t.data,!t.notBefore){e.next=7;break}if(!(this.genTime<t.notBefore)){e.next=7;break}throw new Error("Generation time for TSTInfo object is less than notBefore value");case 7:if(!t.notAfter){e.next=10;break}if(!(this.genTime>t.notAfter)){e.next=10;break}throw new Error("Generation time for TSTInfo object is more than notAfter value");case 10:return i=r.getAlgorithmByOID(this.messageImprint.hashAlgorithm.algorithmId,!0,"MessageImprint.hashAlgorithm"),e.next=13,r.digest(i.name,new Uint8Array(n));case 13:return s=e.sent,e.abrupt("return",Ie.isEqual(s,this.messageImprint.hashedMessage.valueBlock.valueHexView));case 15:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}],[{key:"defaultValues",value:function(e){switch(e){case Md:return 0;case Kd:return ua;case _d:return new Mv;case jd:return new Gt;case Jd:return new Date(0,0,0);case Xd:return new Oa;case Fd:return!1;case qd:return new Gt;case Wd:return new Na;case Gd:return[];default:return S(f(n),"defaultValues",this).call(this,e)}}},{key:"compareWithDefault",value:function(e,t){switch(e){case Md:case Kd:case Jd:case Fd:return t===n.defaultValues(Fd);case _d:return Mv.compareWithDefault(Tv,t.hashAlgorithm)&&Mv.compareWithDefault(Lv,t.hashedMessage);case jd:case qd:return t.isEqual(n.defaultValues(qd));case Xd:return Oa.compareWithDefault(Ba,t.seconds)&&Oa.compareWithDefault(Va,t.millis)&&Oa.compareWithDefault(Da,t.micros);case Wd:return Na.compareWithDefault(ka,t.type)&&Na.compareWithDefault(wa,t.value);case Gd:return 0===t.length;default:return S(f(n),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Oe(e,"names",{});return new sr({name:t.blockName||zd,value:[new Gt({name:t.version||Qd}),new $t({name:t.policy||Yd}),Mv.schema(t.messageImprint||{names:{blockName:Zd}}),new Gt({name:t.serialNumber||$d}),new jr({name:t.genTime||eg}),Oa.schema(t.accuracy||{names:{blockName:tg}}),new Rt({name:t.ordering||rg,optional:!0}),new Gt({name:t.nonce||ag,optional:!0}),new xt({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[Na.schema(t.tsa||{names:{blockName:ng}})]}),new xt({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new ea({name:t.extensions||ig,value:to.schema(t.extension||{})})]})]})}}]),n}(ha);ug.CLASS_NAME="TSTInfo";var og="version",lg="digestAlgorithms",cg="encapContentInfo",hg="certificates",fg="crls",mg="signerInfos",vg="ocsps",dg="SignedData",gg="".concat(dg,".").concat(og),pg="".concat(dg,".").concat(lg),yg="".concat(dg,".").concat(cg),kg="".concat(dg,".").concat(hg),wg="".concat(dg,".").concat(fg),bg="".concat(dg,".").concat(mg),Sg=[gg,pg,yg,kg,wg,bg],Ag=function(e){h(r,e);var t=w(r);function r(e){var a,n=e.message,i=e.code,s=void 0===i?0:i,o=e.date,l=void 0===o?new Date:o,c=e.signatureVerified,h=void 0===c?null:c,f=e.signerCertificate,m=void 0===f?null:f,v=e.signerCertificateVerified,d=void 0===v?null:v,g=e.timestampSerial,p=void 0===g?null:g,y=e.certificatePath,k=void 0===y?[]:y;return u(this,r),(a=t.call(this,n)).name="SignedDataVerifyError",a.date=l,a.code=s,a.timestampSerial=p,a.signatureVerified=h,a.signerCertificate=m,a.signerCertificateVerified=d,a.certificatePath=k,a}return l(r)}(g(Error)),Ng=function(e){h(i,e);var t,r,n=w(i);function i(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return u(this,i),(e=n.call(this)).version=Oe(t,og,i.defaultValues(og)),e.digestAlgorithms=Oe(t,lg,i.defaultValues(lg)),e.encapContentInfo=Oe(t,cg,i.defaultValues(cg)),hg in t&&(e.certificates=Oe(t,hg,i.defaultValues(hg))),fg in t&&(e.crls=Oe(t,fg,i.defaultValues(fg))),vg in t&&(e.ocsps=Oe(t,vg,i.defaultValues(vg))),e.signerInfos=Oe(t,mg,i.defaultValues(mg)),t.schema&&e.fromSchema(t.schema),e}return l(i,[{key:"fromSchema",value:function(e){Ge(e,Sg);var t=ra(e,e,i.schema());if(ca.assertSchema(t,this.className),this.version=t.result[gg].valueBlock.valueDec,pg in t.result&&(this.digestAlgorithms=Array.from(t.result[pg],(function(e){return new Ha({schema:e})}))),this.encapContentInfo=new Vv({schema:t.result[yg]}),kg in t.result){var r=new nh({schema:new ur({value:t.result[kg].valueBlock.value})});this.certificates=r.certificates.slice(0)}wg in t.result&&(this.crls=Array.from(t.result[wg],(function(e){return 1===e.idBlock.tagClass?new Nc({schema:e}):(e.idBlock.tagClass=1,e.idBlock.tagNumber=16,new oh({schema:e}))}))),bg in t.result&&(this.signerInfos=Array.from(t.result[bg],(function(e){return new Hd({schema:e})})))}},{key:"toSchema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=[];if(this.certificates&&this.certificates.length&&this.certificates.some((function(e){return e instanceof th}))||this.crls&&this.crls.length&&this.crls.some((function(e){return e instanceof oh}))?this.version=5:this.certificates&&this.certificates.length&&this.certificates.some((function(e){return e instanceof il}))?this.version=4:this.certificates&&this.certificates.length&&this.certificates.some((function(e){return e instanceof Eo}))||this.signerInfos.some((function(e){return 3===e.version}))||this.encapContentInfo.eContentType!==i.ID_DATA?this.version=3:this.version=1,t.push(new Gt({value:this.version})),t.push(new ur({value:Array.from(this.digestAlgorithms,(function(e){return e.toSchema()}))})),t.push(this.encapContentInfo.toSchema()),this.certificates){var r=new nh({certificates:this.certificates}),a=r.toSchema();t.push(new xt({idBlock:{tagClass:3,tagNumber:0},value:a.valueBlock.value}))}return this.crls&&t.push(new xt({idBlock:{tagClass:3,tagNumber:1},value:Array.from(this.crls,(function(t){if(t instanceof oh){var r=t.toSchema();return r.idBlock.tagClass=3,r.idBlock.tagNumber=1,r}return t.toSchema(e)}))})),t.push(new ur({value:Array.from(this.signerInfos,(function(e){return e.toSchema()}))})),new sr({value:t})}},{key:"toJSON",value:function(){var e={version:this.version,digestAlgorithms:Array.from(this.digestAlgorithms,(function(e){return e.toJSON()})),encapContentInfo:this.encapContentInfo.toJSON(),signerInfos:Array.from(this.signerInfos,(function(e){return e.toJSON()}))};return this.certificates&&(e.certificates=Array.from(this.certificates,(function(e){return e.toJSON()}))),this.crls&&(e.crls=Array.from(this.crls,(function(e){return e.toJSON()}))),e}},{key:"verify",value:(r=s(a().mark((function e(){var t,r,n,i,s,u,o,l,c,h,f,m,v,d,g,p,y,k,w,b,S,A,C,x,I,B,V,D,O,P,R,U,T,L,H,M,K,_,j,J,F,q,X,W,G,z,Q,Y,Z,$,ee,te=arguments;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=te.length>0&&void 0!==te[0]?te[0]:{},r=t.signer,n=void 0===r?-1:r,i=t.data,s=void 0===i?sa:i,u=t.trustedCerts,o=void 0===u?[]:u,l=t.checkDate,c=void 0===l?new Date:l,h=t.checkChain,f=void 0!==h&&h,m=t.passedWhenNotRevValues,v=void 0!==m&&m,d=t.extendedMode,g=void 0!==d&&d,p=t.findOrigin,y=void 0===p?null:p,k=t.findIssuer,w=void 0===k?null:k,b=te.length>1&&void 0!==te[1]?te[1]:bu(!0),S=null,A=null,e.prev=4,C=sa,x=ua,I=[],B=this.signerInfos[n]){e.next=11;break}throw new Ag({date:c,code:1,message:"Unable to get signer by supplied index"});case 11:if(this.certificates){e.next=13;break}throw new Ag({date:c,code:2,message:"No certificates attached to this signed data"});case 13:if(!(B.sid instanceof wh)){e.next=36;break}V=E(this.certificates),e.prev=15,V.s();case 17:if((D=V.n()).done){e.next=26;break}if((O=D.value)instanceof ql){e.next=21;break}return e.abrupt("continue",24);case 21:if(!O.issuer.isEqual(B.sid.issuer)||!O.serialNumber.isEqual(B.sid.serialNumber)){e.next=24;break}return S=O,e.abrupt("break",26);case 24:e.next=17;break;case 26:e.next=31;break;case 28:e.prev=28,e.t0=e.catch(15),V.e(e.t0);case 31:return e.prev=31,V.f(),e.finish(31);case 34:e.next=61;break;case 36:P=B.sid,R=P.idBlock.isConstructed?P.valueBlock.value[0].valueBlock.valueHex:P.valueBlock.valueHex,U=E(this.certificates),e.prev=39,U.s();case 41:if((T=U.n()).done){e.next=53;break}if((L=T.value)instanceof ql){e.next=45;break}return e.abrupt("continue",51);case 45:return e.next=47,b.digest({name:"sha-1"},L.subjectPublicKeyInfo.subjectPublicKey.valueBlock.valueHexView);case 47:if(!Me(e.sent,R)){e.next=51;break}return S=L,e.abrupt("break",53);case 51:e.next=41;break;case 53:e.next=58;break;case 55:e.prev=55,e.t1=e.catch(39),U.e(e.t1);case 58:return e.prev=58,U.f(),e.finish(58);case 61:if(S){e.next=63;break}throw new Ag({date:c,code:3,message:"Unable to find signer certificate"});case 63:if(this.encapContentInfo.eContentType!==bn){e.next=81;break}if(this.encapContentInfo.eContent){e.next=66;break}throw new Ag({date:c,code:15,message:"Error during verification: TSTInfo eContent is empty",signatureVerified:null,signerCertificate:S,timestampSerial:A,signerCertificateVerified:!0});case 66:e.prev=66,H=ug.fromBER(this.encapContentInfo.eContent.valueBlock.valueHexView),e.next=73;break;case 70:throw e.prev=70,e.t2=e.catch(66),new Ag({date:c,code:15,message:"Error during verification: TSTInfo wrong ASN.1 schema ",signatureVerified:null,signerCertificate:S,timestampSerial:A,signerCertificateVerified:!0});case 73:if(c=H.genTime,A=H.serialNumber.valueBlock.valueHexView.slice(),0!==s.byteLength){e.next=77;break}throw new Ag({date:c,code:4,message:"Missed detached data input array"});case 77:return e.next=79,H.verify({data:s},b);case 79:if(e.sent){e.next=81;break}throw new Ag({date:c,code:15,message:"Error during verification: TSTInfo verification is failed",signatureVerified:!1,signerCertificate:S,timestampSerial:A,signerCertificateVerified:!0});case 81:if(!f){e.next=96;break}if(M=this.certificates.filter((function(e){return e instanceof ql&&!!Xl(e,S)})),K={checkDate:c,certs:M,trustedCerts:o},w&&(K.findIssuer=w),y&&(K.findOrigin=y),(_=new Qm(K)).certs.push(S),this.crls){j=E(this.crls);try{for(j.s();!(J=j.n()).done;)"thisUpdate"in(F=J.value)?_.crls.push(F):F.otherRevInfoFormat===xn&&_.ocsps.push(new uv({schema:F.otherRevInfo}))}catch(e){j.e(e)}finally{j.f()}}return this.ocsps&&(q=_.ocsps).push.apply(q,N(this.ocsps)),e.next=92,_.verify({passedWhenNotRevValues:v},b).catch((function(e){throw new Ag({date:c,code:5,message:"Validation of signer's certificate failed with error: ".concat(e instanceof Object?e.resultMessage:e),signerCertificate:S,signerCertificateVerified:!1})}));case 92:if((X=e.sent).certificatePath&&(I=X.certificatePath),X.result){e.next=96;break}throw new Ag({date:c,code:5,message:"Validation of signer's certificate failed: ".concat(X.resultMessage),signerCertificate:S,signerCertificateVerified:!1});case 96:if("name"in(W=b.getAlgorithmByOID(B.digestAlgorithm.algorithmId))){e.next=99;break}throw new Ag({date:c,code:7,message:"Unsupported signature algorithm: ".concat(B.digestAlgorithm.algorithmId),signerCertificate:S,signerCertificateVerified:!0});case 99:if(x=W.name,!(G=this.encapContentInfo.eContent)){e.next=105;break}s=1===G.idBlock.tagClass&&4===G.idBlock.tagNumber?G.getValue():G.valueBlock.valueBeforeDecodeView,e.next=107;break;case 105:if(0!==s.byteLength){e.next=107;break}throw new Ag({date:c,code:8,message:"Missed detached data input array",signerCertificate:S,signerCertificateVerified:!0});case 107:if(!B.signedAttrs){e.next=133;break}z=!1,Q=!1,Y=E(B.signedAttrs.attributes),e.prev=111,Y.s();case 113:if((Z=Y.n()).done){e.next=121;break}if("1.2.840.113549.1.9.3"===($=Z.value).type&&(z=!0),"1.2.840.113549.1.9.4"===$.type&&(Q=!0,C=$.values[0].valueBlock.valueHex),!z||!Q){e.next=119;break}return e.abrupt("break",121);case 119:e.next=113;break;case 121:e.next=126;break;case 123:e.prev=123,e.t3=e.catch(111),Y.e(e.t3);case 126:return e.prev=126,Y.f(),e.finish(126);case 129:if(!1!==z){e.next=131;break}throw new Ag({date:c,code:9,message:'Attribute "content-type" is a mandatory attribute for "signed attributes"',signerCertificate:S,signerCertificateVerified:!0});case 131:if(!1!==Q){e.next=133;break}throw new Ag({date:c,code:10,message:'Attribute "message-digest" is a mandatory attribute for "signed attributes"',signatureVerified:null,signerCertificate:S,signerCertificateVerified:!0});case 133:if(!B.signedAttrs){e.next=140;break}return e.next=136,b.digest(x,new Uint8Array(s));case 136:if(Me(e.sent,C)){e.next=139;break}throw new Ag({date:c,code:15,message:"Error during verification: Message digest doesn't match",signatureVerified:null,signerCertificate:S,timestampSerial:A,signerCertificateVerified:!0});case 139:s=B.signedAttrs.encodedValue;case 140:return e.next=142,b.verifyWithPublicKey(s,B.signature,S.subjectPublicKeyInfo,S.signatureAlgorithm,x);case 142:if(ee=e.sent,!g){e.next=147;break}return e.abrupt("return",{date:c,code:14,message:ua,signatureVerified:ee,signerCertificate:S,timestampSerial:A,signerCertificateVerified:!0,certificatePath:I});case 147:return e.abrupt("return",ee);case 148:e.next=155;break;case 150:if(e.prev=150,e.t4=e.catch(4),!(e.t4 instanceof Ag)){e.next=154;break}throw e.t4;case 154:throw new Ag({date:c,code:15,message:"Error during verification: ".concat(e.t4 instanceof Error?e.t4.message:e.t4),signatureVerified:null,signerCertificate:S,timestampSerial:A,signerCertificateVerified:!0});case 155:case"end":return e.stop()}}),e,this,[[4,150],[15,28,31,34],[39,55,58,61],[66,70],[111,123,126,129]])}))),function(){return r.apply(this,arguments)})},{key:"sign",value:(t=s(a().mark((function e(t,r){var n,i,s,u,o,l,c,h,f,m=arguments;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=m.length>2&&void 0!==m[2]?m[2]:"SHA-1",i=m.length>3&&void 0!==m[3]?m[3]:sa,s=m.length>4&&void 0!==m[4]?m[4]:bu(!0),t){e.next=5;break}throw new Error("Need to provide a private key for signing");case 5:if(u=s.getOIDByAlgorithm({name:n},!0,"hashAlgorithm"),0===this.digestAlgorithms.filter((function(e){return e.algorithmId===u})).length&&this.digestAlgorithms.push(new Ha({algorithmId:u,algorithmParams:new Dt})),o=this.signerInfos[r]){e.next=10;break}throw new RangeError("SignerInfo index is out of range");case 10:return o.digestAlgorithm=new Ha({algorithmId:u,algorithmParams:new Dt}),e.next=13,s.getSignatureParameters(t,n);case 13:if(l=e.sent,c=l.parameters,o.signatureAlgorithm=l.signatureAlgorithm,!o.signedAttrs){e.next=20;break}0!==o.signedAttrs.encodedValue.byteLength?i=o.signedAttrs.encodedValue:(i=o.signedAttrs.toSchema().toBER(),Ie.toUint8Array(i)[0]=49),e.next=27;break;case 20:if(!(h=this.encapContentInfo.eContent)){e.next=25;break}i=1===h.idBlock.tagClass&&4===h.idBlock.tagNumber?h.getValue():h.valueBlock.valueBeforeDecodeView,e.next=27;break;case 25:if(0!==i.byteLength){e.next=27;break}throw new Error("Missed detached data input array");case 27:return e.next=29,s.signWithPrivateKey(i,t,c);case 29:f=e.sent,o.signature=new Lt({valueHex:f});case 31:case"end":return e.stop()}}),e,this)}))),function(e,r){return t.apply(this,arguments)})}],[{key:"defaultValues",value:function(e){switch(e){case og:return 0;case lg:return[];case cg:return new Vv;case hg:case fg:case vg:case mg:return[];default:return S(f(i),"defaultValues",this).call(this,e)}}},{key:"compareWithDefault",value:function(e,t){switch(e){case og:return t===i.defaultValues(og);case cg:return Vv.compareWithDefault("eContentType",t.eContentType)&&Vv.compareWithDefault("eContent",t.eContent);case lg:case hg:case fg:case vg:case mg:return 0===t.length;default:return S(f(i),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Oe(e,"names",{});return void 0===t.optional&&(t.optional=!1),new sr({name:t.blockName||dg,optional:t.optional,value:[new Gt({name:t.version||gg}),new ur({value:[new ea({name:t.digestAlgorithms||pg,value:Ha.schema()})]}),Vv.schema(t.encapContentInfo||{names:{blockName:yg}}),new xt({name:t.certificates||kg,optional:!0,idBlock:{tagClass:3,tagNumber:0},value:nh.schema().valueBlock.value}),new xt({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:fh.schema(t.crls||{names:{crls:wg}}).valueBlock.value}),new ur({value:[new ea({name:t.signerInfos||bg,value:Hd.schema()})]})]})}}]),i}(ha);Ng.CLASS_NAME="SignedData",Ng.ID_DATA=pn;var Cg="version",xg="authSafe",Eg="macData",Ig="parsedValue",Bg=[Cg,xg,Eg],Vg=function(e){h(i,e);var t,r,n=w(i);function i(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return u(this,i),(e=n.call(this)).version=Oe(t,Cg,i.defaultValues(Cg)),e.authSafe=Oe(t,xg,i.defaultValues(xg)),Eg in t&&(e.macData=Oe(t,Eg,i.defaultValues(Eg))),Ig in t&&(e.parsedValue=Oe(t,Ig,i.defaultValues(Ig))),t.schema&&e.fromSchema(t.schema),e}return l(i,[{key:"fromSchema",value:function(e){Ge(e,Bg);var t=ra(e,e,i.schema({names:{version:Cg,authSafe:{names:{blockName:xg}},macData:{names:{blockName:Eg}}}}));ca.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,this.authSafe=new ll({schema:t.result.authSafe}),Eg in t.result&&(this.macData=new Uv({schema:t.result.macData}))}},{key:"toSchema",value:function(){var e=[new Gt({value:this.version}),this.authSafe.toSchema()];return this.macData&&e.push(this.macData.toSchema()),new sr({value:e})}},{key:"toJSON",value:function(){var e={version:this.version,authSafe:this.authSafe.toJSON()};return this.macData&&(e.macData=this.macData.toJSON()),e}},{key:"makeInternalValues",value:(r=s(a().mark((function e(){var t,r,n,i,s,u,o,l,c,h,f=arguments;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=f.length>0&&void 0!==f[0]?f[0]:{},r=f.length>1&&void 0!==f[1]?f[1]:bu(!0),oa.assert(t,"parameters","object"),this.parsedValue){e.next=5;break}throw new Error('Please call "parseValues" function first in order to make "parsedValue" data');case 5:la.assertEmpty(this.parsedValue.integrityMode,"integrityMode","parsedValue"),la.assertEmpty(this.parsedValue.authenticatedSafe,"authenticatedSafe","parsedValue"),e.t0=this.parsedValue.integrityMode,e.next=0===e.t0?10:1===e.t0?25:43;break;case 10:if("iterations"in t){e.next=12;break}throw new la("iterations");case 12:return la.assertEmpty(t.pbkdf2HashAlgorithm,"pbkdf2HashAlgorithm"),la.assertEmpty(t.hmacHashAlgorithm,"hmacHashAlgorithm"),la.assertEmpty(t.password,"password"),n=new ArrayBuffer(64),i=new Uint8Array(n),r.getRandomValues(i),s=this.parsedValue.authenticatedSafe.toSchema().toBER(!1),this.authSafe=new ll({contentType:ll.DATA,content:new Lt({valueHex:s})}),e.next=22,r.stampDataWithPassword({password:t.password,hashAlgorithm:t.hmacHashAlgorithm,salt:n,iterationCount:t.iterations,contentToStamp:s});case 22:return u=e.sent,this.macData=new Uv({mac:new xv({digestAlgorithm:new Ha({algorithmId:r.getOIDByAlgorithm({name:t.hmacHashAlgorithm},!0,"hmacHashAlgorithm")}),digest:new Lt({valueHex:u})}),macSalt:new Lt({valueHex:n}),iterations:t.iterations}),e.abrupt("break",44);case 25:if("signingCertificate"in t){e.next=27;break}throw new la("signingCertificate");case 27:return la.assertEmpty(t.privateKey,"privateKey"),la.assertEmpty(t.hashAlgorithm,"hashAlgorithm"),o=this.parsedValue.authenticatedSafe.toSchema().toBER(!1),l=new Ng({version:1,encapContentInfo:new Vv({eContentType:"1.2.840.113549.1.7.1",eContent:new Lt({valueHex:o})}),certificates:[t.signingCertificate]}),e.next=33,r.digest({name:t.hashAlgorithm},new Uint8Array(o));case 33:return c=e.sent,(h=[]).push(new qa({type:"1.2.840.113549.1.9.3",values:[new $t({value:"1.2.840.113549.1.7.1"})]})),h.push(new qa({type:"1.2.840.113549.1.9.5",values:[new Kr({valueDate:new Date})]})),h.push(new qa({type:"1.2.840.113549.1.9.4",values:[new Lt({valueHex:c})]})),l.signerInfos.push(new Hd({version:1,sid:new wh({issuer:t.signingCertificate.issuer,serialNumber:t.signingCertificate.serialNumber}),signedAttrs:new bd({type:0,attributes:h})})),e.next=41,l.sign(t.privateKey,0,t.hashAlgorithm,void 0,r);case 41:return this.authSafe=new ll({contentType:"1.2.840.113549.1.7.2",content:l.toSchema(!0)}),e.abrupt("break",44);case 43:throw new Error('Parameter "integrityMode" has unknown value: '.concat(this.parsedValue.integrityMode));case 44:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"parseInternalValues",value:(t=s(a().mark((function e(t){var r,n,i,s,u,o,l=arguments;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=l.length>1&&void 0!==l[1]?l[1]:bu(!0),oa.assert(t,"parameters","object"),void 0===t.checkIntegrity&&(t.checkIntegrity=!0),this.parsedValue={},e.t0=this.authSafe.contentType,e.next=e.t0===ll.DATA?7:e.t0===ll.SIGNED_DATA?22:35;break;case 7:if(la.assertEmpty(t.password,"password"),this.parsedValue.integrityMode=0,oa.assert(this.authSafe.content,"authSafe.content",Lt),n=this.authSafe.content.getValue(),this.parsedValue.authenticatedSafe=fm.fromBER(n),!t.checkIntegrity){e.next=21;break}if(this.macData){e.next=15;break}throw new Error('Absent "macData" value, can not check PKCS#12 data integrity');case 15:return i=r.getAlgorithmByOID(this.macData.mac.digestAlgorithm.algorithmId,!0,"digestAlgorithm"),e.next=18,r.verifyDataStampedWithPassword({password:t.password,hashAlgorithm:i.name,salt:Ie.toArrayBuffer(this.macData.macSalt.valueBlock.valueHexView),iterationCount:this.macData.iterations||0,contentToVerify:n,signatureToVerify:Ie.toArrayBuffer(this.macData.mac.digest.valueBlock.valueHexView)});case 18:if(e.sent){e.next=21;break}throw new Error("Integrity for the PKCS#12 data is broken!");case 21:case 34:return e.abrupt("break",36);case 22:return this.parsedValue.integrityMode=1,s=new Ng({schema:this.authSafe.content}),u=s.encapContentInfo.eContent,la.assert(u,"eContent","cmsSigned.encapContentInfo"),oa.assert(u,"eContent",Lt),o=u.getValue(),this.parsedValue.authenticatedSafe=fm.fromBER(o),e.next=31,s.verify({signer:0,checkChain:!1},r);case 31:if(e.sent){e.next=34;break}throw new Error("Integrity for the PKCS#12 data is broken!");case 35:throw new Error('Incorrect value for "this.authSafe.contentType": '.concat(this.authSafe.contentType));case 36:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}],[{key:"defaultValues",value:function(e){switch(e){case Cg:return 3;case xg:return new ll;case Eg:return new Uv;case Ig:return{};default:return S(f(i),"defaultValues",this).call(this,e)}}},{key:"compareWithDefault",value:function(e,t){switch(e){case Cg:return t===i.defaultValues(e);case xg:return ll.compareWithDefault("contentType",t.contentType)&&ll.compareWithDefault("content",t.content);case Eg:return Uv.compareWithDefault("mac",t.mac)&&Uv.compareWithDefault("macSalt",t.macSalt)&&Uv.compareWithDefault("iterations",t.iterations);case Ig:return t instanceof Object&&0===Object.keys(t).length;default:return S(f(i),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Oe(e,"names",{});return new sr({name:t.blockName||ua,value:[new Gt({name:t.version||Cg}),ll.schema(t.authSafe||{names:{blockName:xg}}),Uv.schema(t.macData||{names:{blockName:Eg,optional:!0}})]})}}]),i}(ha);Vg.CLASS_NAME="PFX";var Dg,Og="status",Pg="statusStrings",Rg="failInfo",Ug=[Og,Pg,Rg];!function(e){e[e.granted=0]="granted",e[e.grantedWithMods=1]="grantedWithMods",e[e.rejection=2]="rejection",e[e.waiting=3]="waiting",e[e.revocationWarning=4]="revocationWarning",e[e.revocationNotification=5]="revocationNotification"}(Dg||(Dg={}));var Tg=function(e){h(r,e);var t=w(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return u(this,r),(e=t.call(this)).status=Oe(a,Og,r.defaultValues(Og)),Pg in a&&(e.statusStrings=Oe(a,Pg,r.defaultValues(Pg))),Rg in a&&(e.failInfo=Oe(a,Rg,r.defaultValues(Rg))),a.schema&&e.fromSchema(a.schema),e}return l(r,[{key:"fromSchema",value:function(e){Ge(e,Ug);var t=ra(e,e,r.schema({names:{status:Og,statusStrings:Pg,failInfo:Rg}}));ca.assertSchema(t,this.className);var a=t.result.status;if(!0===a.valueBlock.isHexOnly||a.valueBlock.valueDec<0||a.valueBlock.valueDec>5)throw new Error('PKIStatusInfo "status" has invalid value');this.status=a.valueBlock.valueDec,Pg in t.result&&(this.statusStrings=t.result.statusStrings),Rg in t.result&&(this.failInfo=t.result.failInfo)}},{key:"toSchema",value:function(){var e=[];return e.push(new Gt({value:this.status})),this.statusStrings&&e.push(new sr({optional:!0,value:this.statusStrings})),this.failInfo&&e.push(this.failInfo),new sr({value:e})}},{key:"toJSON",value:function(){var e={status:this.status};return this.statusStrings&&(e.statusStrings=Array.from(this.statusStrings,(function(e){return e.toJSON()}))),this.failInfo&&(e.failInfo=this.failInfo.toJSON()),e}}],[{key:"defaultValues",value:function(e){switch(e){case Og:return 2;case Pg:return[];case Rg:return new _t;default:return S(f(r),"defaultValues",this).call(this,e)}}},{key:"compareWithDefault",value:function(e,t){switch(e){case Og:return t===r.defaultValues(e);case Pg:return 0===t.length;case Rg:return t.isEqual(r.defaultValues(e));default:return S(f(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Oe(e,"names",{});return new sr({name:t.blockName||ua,value:[new Gt({name:t.status||ua}),new sr({optional:!0,value:[new ea({name:t.statusStrings||ua,value:new mr})]}),new _t({name:t.failInfo||ua,optional:!0})]})}}]),r}(ha);Tg.CLASS_NAME="PKIStatusInfo";var Lg="version",Hg="messageImprint",Mg="reqPolicy",Kg="nonce",_g="certReq",jg="extensions",Jg="TimeStampReq",Fg="".concat(Jg,".").concat(Lg),qg="".concat(Jg,".").concat(Hg),Xg="".concat(Jg,".").concat(Mg),Wg="".concat(Jg,".").concat(Kg),Gg="".concat(Jg,".").concat(_g),zg="".concat(Jg,".").concat(jg),Qg=[Fg,qg,Xg,Wg,Gg,zg],Yg=function(e){h(r,e);var t=w(r);function r(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return u(this,r),(e=t.call(this)).version=Oe(a,Lg,r.defaultValues(Lg)),e.messageImprint=Oe(a,Hg,r.defaultValues(Hg)),Mg in a&&(e.reqPolicy=Oe(a,Mg,r.defaultValues(Mg))),Kg in a&&(e.nonce=Oe(a,Kg,r.defaultValues(Kg))),_g in a&&(e.certReq=Oe(a,_g,r.defaultValues(_g))),jg in a&&(e.extensions=Oe(a,jg,r.defaultValues(jg))),a.schema&&e.fromSchema(a.schema),e}return l(r,[{key:"fromSchema",value:function(e){Ge(e,Qg);var t=ra(e,e,r.schema());ca.assertSchema(t,this.className),this.version=t.result[Fg].valueBlock.valueDec,this.messageImprint=new Mv({schema:t.result[qg]}),Xg in t.result&&(this.reqPolicy=t.result[Xg].valueBlock.toString()),Wg in t.result&&(this.nonce=t.result[Wg]),Gg in t.result&&(this.certReq=t.result[Gg].valueBlock.value),zg in t.result&&(this.extensions=Array.from(t.result[zg],(function(e){return new to({schema:e})})))}},{key:"toSchema",value:function(){var e=[];return e.push(new Gt({value:this.version})),e.push(this.messageImprint.toSchema()),this.reqPolicy&&e.push(new $t({value:this.reqPolicy})),this.nonce&&e.push(this.nonce),_g in this&&!1===r.compareWithDefault(_g,this.certReq)&&e.push(new Rt({value:this.certReq})),this.extensions&&e.push(new xt({idBlock:{tagClass:3,tagNumber:0},value:Array.from(this.extensions,(function(e){return e.toSchema()}))})),new sr({value:e})}},{key:"toJSON",value:function(){var e={version:this.version,messageImprint:this.messageImprint.toJSON()};return void 0!==this.reqPolicy&&(e.reqPolicy=this.reqPolicy),void 0!==this.nonce&&(e.nonce=this.nonce.toJSON()),void 0!==this.certReq&&!1===r.compareWithDefault(_g,this.certReq)&&(e.certReq=this.certReq),this.extensions&&(e.extensions=Array.from(this.extensions,(function(e){return e.toJSON()}))),e}}],[{key:"defaultValues",value:function(e){switch(e){case Lg:return 0;case Hg:return new Mv;case Mg:return ua;case Kg:return new Gt;case _g:return!1;case jg:return[];default:return S(f(r),"defaultValues",this).call(this,e)}}},{key:"compareWithDefault",value:function(e,t){switch(e){case Lg:case Mg:case _g:return t===r.defaultValues(e);case Hg:return Mv.compareWithDefault("hashAlgorithm",t.hashAlgorithm)&&Mv.compareWithDefault("hashedMessage",t.hashedMessage);case Kg:return t.isEqual(r.defaultValues(e));case jg:return 0===t.length;default:return S(f(r),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Oe(e,"names",{});return new sr({name:t.blockName||Jg,value:[new Gt({name:t.version||Fg}),Mv.schema(t.messageImprint||{names:{blockName:qg}}),new $t({name:t.reqPolicy||Xg,optional:!0}),new Gt({name:t.nonce||Wg,optional:!0}),new Rt({name:t.certReq||Gg,optional:!0}),new xt({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new ea({name:t.extensions||zg,value:to.schema()})]})]})}}]),r}(ha);Yg.CLASS_NAME="TimeStampReq";var Zg="status",$g="timeStampToken",ep="TimeStampResp",tp="".concat(ep,".").concat(Zg),rp="".concat(ep,".").concat($g),ap=[tp,rp],np=function(e){h(i,e);var t,r,n=w(i);function i(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return u(this,i),(e=n.call(this)).status=Oe(t,Zg,i.defaultValues(Zg)),$g in t&&(e.timeStampToken=Oe(t,$g,i.defaultValues($g))),t.schema&&e.fromSchema(t.schema),e}return l(i,[{key:"fromSchema",value:function(e){Ge(e,ap);var t=ra(e,e,i.schema());ca.assertSchema(t,this.className),this.status=new Tg({schema:t.result[tp]}),rp in t.result&&(this.timeStampToken=new ll({schema:t.result[rp]}))}},{key:"toSchema",value:function(){var e=[];return e.push(this.status.toSchema()),this.timeStampToken&&e.push(this.timeStampToken.toSchema()),new sr({value:e})}},{key:"toJSON",value:function(){var e={status:this.status.toJSON()};return this.timeStampToken&&(e.timeStampToken=this.timeStampToken.toJSON()),e}},{key:"sign",value:(r=s(a().mark((function e(t,r){var n,i,s=arguments;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=s.length>2&&void 0!==s[2]?s[2]:bu(!0),this.assertContentType(),i=new Ng({schema:this.timeStampToken.content}),e.abrupt("return",i.sign(t,0,r,void 0,n));case 4:case"end":return e.stop()}}),e,this)}))),function(e,t){return r.apply(this,arguments)})},{key:"verify",value:(t=s(a().mark((function e(){var t,r,n,i=arguments;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=i.length>0&&void 0!==i[0]?i[0]:{signer:0,trustedCerts:[],data:sa},r=i.length>1&&void 0!==i[1]?i[1]:bu(!0),this.assertContentType(),n=new Ng({schema:this.timeStampToken.content}),e.abrupt("return",n.verify(t,r));case 5:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"assertContentType",value:function(){if(!this.timeStampToken)throw new Error("timeStampToken is absent in TSP response");if(this.timeStampToken.contentType!==yn)throw new Error("Wrong format of timeStampToken: ".concat(this.timeStampToken.contentType))}}],[{key:"defaultValues",value:function(e){switch(e){case Zg:return new Tg;case $g:return new ll;default:return S(f(i),"defaultValues",this).call(this,e)}}},{key:"compareWithDefault",value:function(e,t){switch(e){case Zg:return Tg.compareWithDefault(Zg,t.status)&&"statusStrings"in t==!1&&"failInfo"in t==!1;case $g:return t.contentType===ua&&t.content instanceof Zr;default:return S(f(i),"defaultValues",this).call(this,e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Oe(e,"names",{});return new sr({name:t.blockName||ep,value:[Tg.schema(t.status||{names:{blockName:tp}}),ll.schema(t.timeStampToken||{names:{blockName:rp,optional:!0}})]})}}]),i}(ha);np.CLASS_NAME="TimeStampResp",function(){if("undefined"!=typeof self){if("crypto"in self){var e="webcrypto";"webkitSubtle"in self.crypto&&(e="safari"),ku(e,new gu({name:e,crypto:crypto}))}}else if("undefined"!=typeof crypto&&"webcrypto"in crypto){var t="NodeJS ^15",r=crypto.webcrypto;ku(t,new gu({name:t,crypto:r}))}}();var ip=null,sp=function(){function e(){u(this,e)}return l(e,null,[{key:"setEngine",value:function(e,t){ip=Object.assign(t,{name:e}),ku(e,new gu({name:e,crypto:t}))}},{key:"crypto",get:function(){if(!ip)throw new ie(ne.CRYPTOGRAPHIC_NO_MODULE);return ip}},{key:"isNodePlugin",value:function(){return"undefined"==typeof self&&"undefined"==typeof window}}]),e}();sp.isNodePlugin()||sp.setEngine("W3 WebCrypto module",self.crypto);var up,op=function(){function e(){u(this,e)}return l(e,[{key:"getAlgorithmName",value:function(){return this.namespaceURI}}]),e}(),lp=function(e){h(n,e);var t,r=w(n);function n(){return u(this,n),r.apply(this,arguments)}return l(n,[{key:"Digest",value:(t=s(a().mark((function e(t){var r,n,i;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"string"==typeof t?r=oe.FromString(t,"utf8"):ArrayBuffer.isView(t)?r=new Uint8Array(t.buffer):t instanceof ArrayBuffer?r=new Uint8Array(t):(n=(new XMLSerializer).serializeToString(t),r=oe.FromString(n,"utf8")),e.next=3,sp.crypto.subtle.digest(this.algorithm,r);case 3:return i=e.sent,e.abrupt("return",new Uint8Array(i));case 5:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),n}(op),cp=function(e){h(i,e);var t,r,n=w(i);function i(){return u(this,i),n.apply(this,arguments)}return l(i,[{key:"Sign",value:(r=s(a().mark((function e(t,r,n){var i;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=oe.FromString(t,"utf8"),e.abrupt("return",sp.crypto.subtle.sign(n,r,i));case 2:case"end":return e.stop()}}),e)}))),function(e,t,a){return r.apply(this,arguments)})},{key:"Verify",value:(t=s(a().mark((function e(t,r,n,i){var s;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=oe.FromString(t,"utf8"),e.abrupt("return",sp.crypto.subtle.verify(i||this.algorithm,r,n,s));case 2:case"end":return e.stop()}}),e,this)}))),function(e,r,a,n){return t.apply(this,arguments)})}]),i}(op),hp="SHA-1",fp="SHA-256",mp="SHA-384",vp="SHA-512",dp="http://www.w3.org/2000/09/xmldsig#sha1",gp="http://www.w3.org/2001/04/xmlenc#sha256",pp="http://www.w3.org/2001/04/xmldsig-more#sha384",yp="http://www.w3.org/2001/04/xmlenc#sha512",kp=function(e){h(r,e);var t=w(r);function r(){var e;return u(this,r),(e=t.apply(this,arguments)).algorithm={name:hp},e.namespaceURI=dp,e}return l(r)}(lp),wp=function(e){h(r,e);var t=w(r);function r(){var e;return u(this,r),(e=t.apply(this,arguments)).algorithm={name:fp},e.namespaceURI=gp,e}return l(r)}(lp),bp=function(e){h(r,e);var t=w(r);function r(){var e;return u(this,r),(e=t.apply(this,arguments)).algorithm={name:mp},e.namespaceURI=pp,e}return l(r)}(lp),Sp=function(e){h(r,e);var t=w(r);function r(){var e;return u(this,r),(e=t.apply(this,arguments)).algorithm={name:vp},e.namespaceURI=yp,e}return l(r)}(lp),Ap="ECDSA",Np="http://www.w3.org/2001/04/xmldsig-more#ecdsa-sha1",Cp="http://www.w3.org/2001/04/xmldsig-more#ecdsa-sha256",xp="http://www.w3.org/2001/04/xmldsig-more#ecdsa-sha384",Ep="http://www.w3.org/2001/04/xmldsig-more#ecdsa-sha512",Ip=function(e){h(r,e);var t=w(r);function r(){var e;return u(this,r),(e=t.apply(this,arguments)).algorithm={name:Ap,hash:{name:hp}},e.namespaceURI=Np,e}return l(r)}(cp),Bp=function(e){h(r,e);var t=w(r);function r(){var e;return u(this,r),(e=t.apply(this,arguments)).algorithm={name:Ap,hash:{name:fp}},e.namespaceURI=Cp,e}return l(r)}(cp),Vp=function(e){h(r,e);var t=w(r);function r(){var e;return u(this,r),(e=t.apply(this,arguments)).algorithm={name:Ap,hash:{name:mp}},e.namespaceURI=xp,e}return l(r)}(cp),Dp=function(e){h(r,e);var t=w(r);function r(){var e;return u(this,r),(e=t.apply(this,arguments)).algorithm={name:Ap,hash:{name:vp}},e.namespaceURI=Ep,e}return l(r)}(cp),Op="HMAC",Pp="http://www.w3.org/2000/09/xmldsig#hmac-sha1",Rp="http://www.w3.org/2001/04/xmldsig-more#hmac-sha256",Up="http://www.w3.org/2001/04/xmldsig-more#hmac-sha384",Tp="http://www.w3.org/2001/04/xmldsig-more#hmac-sha512",Lp=function(e){h(r,e);var t=w(r);function r(){var e;return u(this,r),(e=t.apply(this,arguments)).algorithm={name:Op,hash:{name:hp}},e.namespaceURI=Pp,e}return l(r)}(cp),Hp=function(e){h(r,e);var t=w(r);function r(){var e;return u(this,r),(e=t.apply(this,arguments)).algorithm={name:Op,hash:{name:fp}},e.namespaceURI=Rp,e}return l(r)}(cp),Mp=function(e){h(r,e);var t=w(r);function r(){var e;return u(this,r),(e=t.apply(this,arguments)).algorithm={name:Op,hash:{name:mp}},e.namespaceURI=Up,e}return l(r)}(cp),Kp=function(e){h(r,e);var t=w(r);function r(){var e;return u(this,r),(e=t.apply(this,arguments)).algorithm={name:Op,hash:{name:vp}},e.namespaceURI=Tp,e}return l(r)}(cp),_p="RSASSA-PKCS1-v1_5",jp="http://www.w3.org/2000/09/xmldsig#rsa-sha1",Jp="http://www.w3.org/2001/04/xmldsig-more#rsa-sha256",Fp="http://www.w3.org/2001/04/xmldsig-more#rsa-sha384",qp="http://www.w3.org/2001/04/xmldsig-more#rsa-sha512",Xp=function(e){h(r,e);var t=w(r);function r(){var e;return u(this,r),(e=t.apply(this,arguments)).algorithm={name:_p,hash:{name:hp}},e.namespaceURI=jp,e}return l(r)}(cp),Wp=function(e){h(r,e);var t=w(r);function r(){var e;return u(this,r),(e=t.apply(this,arguments)).algorithm={name:_p,hash:{name:fp}},e.namespaceURI=Jp,e}return l(r)}(cp),Gp=function(e){h(r,e);var t=w(r);function r(){var e;return u(this,r),(e=t.apply(this,arguments)).algorithm={name:_p,hash:{name:mp}},e.namespaceURI=Fp,e}return l(r)}(cp),zp=function(e){h(r,e);var t=w(r);function r(){var e;return u(this,r),(e=t.apply(this,arguments)).algorithm={name:_p,hash:{name:vp}},e.namespaceURI=qp,e}return l(r)}(cp),Qp="RSA-PSS",Yp="http://www.w3.org/2007/05/xmldsig-more#rsa-pss",Zp=function(e){h(r,e);var t=w(r);function r(e){var a;return u(this,r),(a=t.call(this)).algorithm={name:Qp,hash:{name:hp}},a.namespaceURI=Yp,e&&(a.algorithm.saltLength=e),a}return l(r)}(cp),$p=function(e){h(r,e);var t=w(r);function r(e){var a;return u(this,r),(a=t.call(this,e)).algorithm.hash.name=hp,a}return l(r)}(Zp),ey=function(e){h(r,e);var t=w(r);function r(e){var a;return u(this,r),(a=t.call(this,e)).algorithm.hash.name=fp,a}return l(r)}(Zp),ty=function(e){h(r,e);var t=w(r);function r(e){var a;return u(this,r),(a=t.call(this,e)).algorithm.hash.name=mp,a}return l(r)}(Zp),ry=function(e){h(r,e);var t=w(r);function r(e){var a;return u(this,r),(a=t.call(this,e)).algorithm.hash.name=vp,a}return l(r)}(Zp),ay="http://www.w3.org/2007/05/xmldsig-more#sha1-rsa-MGF1",ny="http://www.w3.org/2007/05/xmldsig-more#sha256-rsa-MGF1",iy="http://www.w3.org/2007/05/xmldsig-more#sha384-rsa-MGF1",sy="http://www.w3.org/2007/05/xmldsig-more#sha512-rsa-MGF1",uy=function(e){h(r,e);var t=w(r);function r(){var e;return u(this,r),(e=t.call(this)).algorithm={name:Qp,hash:{name:hp}},e.namespaceURI=ay,e}return l(r)}(cp),oy=function(e){h(r,e);var t=w(r);function r(){var e;return u(this,r),(e=t.call(this)).algorithm.hash.name=hp,e.algorithm.saltLength=20,e}return l(r)}(uy),ly=function(e){h(r,e);var t=w(r);function r(){var e;return u(this,r),(e=t.call(this)).algorithm.hash.name=fp,e.algorithm.saltLength=32,e}return l(r)}(uy),cy=function(e){h(r,e);var t=w(r);function r(){var e;return u(this,r),(e=t.call(this)).algorithm.hash.name=mp,e.algorithm.saltLength=48,e}return l(r)}(uy),hy=function(e){h(r,e);var t=w(r);function r(){var e;return u(this,r),(e=t.call(this)).algorithm.hash.name=vp,e.algorithm.saltLength=64,e}return l(r)}(uy);e.XmlCanonicalizerState=void 0,(up=e.XmlCanonicalizerState||(e.XmlCanonicalizerState={}))[up.BeforeDocElement=0]="BeforeDocElement",up[up.InsideDocElement=1]="InsideDocElement",up[up.AfterDocElement=2]="AfterDocElement";var fy=function(){function t(r,a){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Ee;u(this,t),this.propagatedNamespaces=new Ee,this.result=[],this.visibleNamespaces=new Ee,this.inclusiveNamespacesPrefixList=[],this.state=e.XmlCanonicalizerState.BeforeDocElement,this.withComments=r,this.exclusive=a,this.propagatedNamespaces=n}return l(t,[{key:"InclusiveNamespacesPrefixList",get:function(){return this.inclusiveNamespacesPrefixList.join(" ")},set:function(e){this.inclusiveNamespacesPrefixList=e.split(" ")}},{key:"Canonicalize",value:function(e){if(!e)throw new ie(ne.CRYPTOGRAPHIC,"Parameter 1 is not Node");return this.WriteNode(e),this.result.join("")}},{key:"WriteNode",value:function(t){switch(t.nodeType){case ue.Document:case ue.DocumentFragment:this.WriteDocumentNode(t);break;case ue.Element:this.WriteElementNode(t);break;case ue.CDATA:case ue.SignificantWhitespace:case ue.Text:be(t.parentNode)||this.WriteTextNode(t);break;case ue.Whitespace:this.state===e.XmlCanonicalizerState.InsideDocElement&&this.WriteTextNode(t);break;case ue.Comment:this.WriteCommentNode(t);break;case ue.ProcessingInstruction:this.WriteProcessingInstructionNode(t);break;case ue.EntityReference:for(var r=0;r<t.childNodes.length;r++)this.WriteNode(t.childNodes[r]);break;case ue.Attribute:case ue.EndElement:case ue.EndEntity:throw new ie(ne.CRYPTOGRAPHIC,"Attribute node is impossible here");case ue.DocumentType:case ue.Entity:case ue.Notation:case ue.XmlDeclaration:}}},{key:"WriteDocumentNode",value:function(t){this.state=e.XmlCanonicalizerState.BeforeDocElement;for(var r=t.firstChild;null!=r;r=r.nextSibling)this.WriteNode(r)}},{key:"WriteCommentNode",value:function(t){this.withComments&&(this.state===e.XmlCanonicalizerState.AfterDocElement?this.result.push(String.fromCharCode(10)+"\x3c!--"):this.result.push("\x3c!--"),this.result.push(this.NormalizeString(t.nodeValue,ue.Comment)),this.state===e.XmlCanonicalizerState.BeforeDocElement?this.result.push("--\x3e"+String.fromCharCode(10)):this.result.push("--\x3e"))}},{key:"WriteTextNode",value:function(e){this.result.push(this.NormalizeString(e.nodeValue,e.nodeType))}},{key:"WriteProcessingInstructionNode",value:function(t){var r=t.nodeName||t.tagName;"xml"!==r&&(this.state===e.XmlCanonicalizerState.AfterDocElement?this.result.push("\n<?"):this.result.push("<?"),this.result.push(r),t.nodeValue&&(this.result.push(" "),this.result.push(this.NormalizeString(t.nodeValue,ue.ProcessingInstruction))),this.state===e.XmlCanonicalizerState.BeforeDocElement?this.result.push("?>\n"):this.result.push("?>"))}},{key:"WriteElementNode",value:function(t){var r=this.state;this.state===e.XmlCanonicalizerState.BeforeDocElement&&(this.state=e.XmlCanonicalizerState.InsideDocElement),this.result.push("<"),this.result.push(t.nodeName);var a=this.WriteNamespacesAxis(t);this.WriteAttributesAxis(t),this.result.push(">");for(var n=t.firstChild;null!=n;n=n.nextSibling)this.WriteNode(n);for(this.result.push("</"),this.result.push(t.nodeName),this.result.push(">"),r===e.XmlCanonicalizerState.BeforeDocElement&&(this.state=e.XmlCanonicalizerState.AfterDocElement);a--;)this.visibleNamespaces.Pop()}},{key:"WriteNamespacesAxis",value:function(e){for(var t=this,r=[],a=0,n=0;n<e.attributes.length;n++){var i=e.attributes[n];if(gy(i)){if("xmlns"===i.localName&&!i.prefix&&!i.nodeValue){var s={prefix:i.prefix,namespace:i.nodeValue};r.push(s),this.visibleNamespaces.Add(s),a++}var u,o=null;(u=/xmlns:([\w\.-]+)/.exec(i.nodeName))&&(o=u[1]);var l=!0;if(this.exclusive&&!this.IsNamespaceInclusive(e,o)){var c=dy(e,o);if(c>1)l=!1;else if(0===c)continue}if(!this.IsNamespaceRendered(o,i.nodeValue)&&l){var h={prefix:o,namespace:i.nodeValue};r.push(h),this.visibleNamespaces.Add(h),a++}}else if(i.prefix&&!this.IsNamespaceRendered(i.prefix,i.namespaceURI)){var f={prefix:i.prefix,namespace:i.namespaceURI};r.push(f),this.visibleNamespaces.Add(f),a++}}if(!this.IsNamespaceRendered(e.prefix,e.namespaceURI)&&"http://www.w3.org/2000/xmlns/"!==e.namespaceURI){var m={prefix:e.prefix,namespace:e.namespaceURI};r.push(m),this.visibleNamespaces.Add(m),a++}r.sort(my);var v=null;return r.forEach((function(e){e.prefix!==v&&(v=e.prefix,t.result.push(" xmlns"),e.prefix&&t.result.push(":"+e.prefix),t.result.push('="'),t.result.push(e.namespace),t.result.push('"'))})),a}},{key:"WriteAttributesAxis",value:function(e){for(var t=this,r=[],a=0;a<e.attributes.length;a++){var n=e.attributes[a];gy(n)||r.push(n)}r.sort(vy),r.forEach((function(e){null!=e&&(t.result.push(" "),t.result.push(e.nodeName),t.result.push('="'),t.result.push(t.NormalizeString(e.nodeValue,ue.Attribute)),t.result.push('"'))}))}},{key:"NormalizeString",value:function(e,t){var r=[];if(e)for(var a=0;a<e.length;a++){var n=e[a];"<"!==n||t!==ue.Attribute&&!this.IsTextNode(t)?">"===n&&this.IsTextNode(t)?r.push("&gt;"):"&"!==n||t!==ue.Attribute&&!this.IsTextNode(t)?'"'===n&&t===ue.Attribute?r.push("&quot;"):"\t"===n&&t===ue.Attribute?r.push("&#x9;"):"\n"===n&&t===ue.Attribute?r.push("&#xA;"):"\r"===n?r.push("&#xD;"):r.push(n):r.push("&amp;"):r.push("&lt;")}return r.join("")}},{key:"IsTextNode",value:function(e){switch(e){case ue.Text:case ue.CDATA:case ue.SignificantWhitespace:case ue.Whitespace:return!0}return!1}},{key:"IsNamespaceInclusive",value:function(e,t){var r=t||null;return e.prefix!==r&&-1!==this.inclusiveNamespacesPrefixList.indexOf(r||"")}},{key:"IsNamespaceRendered",value:function(e,t){if(t=t||"",!(e=e||"")&&!t)return!0;if("xml"===e&&"http://www.w3.org/XML/1998/namespace"===t)return!0;var r=this.visibleNamespaces.GetPrefix(e);return!!r&&r.namespace===t}}]),t}();function my(e,t){return e==t?0:e?t?e.prefix?t.prefix?e.prefix<t.prefix?-1:e.prefix>t.prefix?1:0:1:-1:1:-1}function vy(e,t){if(!e.namespaceURI&&t.namespaceURI)return-1;if(!t.namespaceURI&&e.namespaceURI)return 1;var r=e.namespaceURI+e.localName,a=t.namespaceURI+t.localName;return r===a?0:r<a?-1:1}function dy(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=t||null;if(e.prefix===a)return++r;if(e.attributes)for(var n=0;n<e.attributes.length;n++){var i=e.attributes[n];if(!gy(i)&&t&&e.attributes[n].prefix===t)return++r}for(var s=e.firstChild;s;s=s.nextSibling)if(s.nodeType===ue.Element){var u=s,o=dy(u,t,r);if(s.nodeType===ue.Element&&o)return++r+o}return r}function gy(e){return!(null===e||e.nodeType!==ue.Attribute||"xmlns"!==e.nodeName&&!/xmlns:/.test(e.nodeName))}function py(e,t,r,a){var i,s=arguments.length,u=s<3?t:null===a?a=Object.getOwnPropertyDescriptor(t,r):a;if("object"===("undefined"==typeof Reflect?"undefined":n(Reflect))&&"function"==typeof Reflect.decorate)u=Reflect.decorate(e,t,r,a);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(u=(s<3?i(u):s>3?i(t,r,u):i(t,r))||u);return s>3&&u&&Object.defineProperty(t,r,u),u}var yy={DefaultCanonMethod:"http://www.w3.org/TR/2001/REC-xml-c14n-20010315",DefaultDigestMethod:"http://www.w3.org/2001/04/xmlenc#sha256",DefaultPrefix:"ds",ElementNames:{CanonicalizationMethod:"CanonicalizationMethod",DigestMethod:"DigestMethod",DigestValue:"DigestValue",DSAKeyValue:"DSAKeyValue",DomainParameters:"DomainParameters",EncryptedKey:"EncryptedKey",HMACOutputLength:"HMACOutputLength",RSAPSSParams:"RSAPSSParams",MaskGenerationFunction:"MaskGenerationFunction",SaltLength:"SaltLength",KeyInfo:"KeyInfo",KeyName:"KeyName",KeyValue:"KeyValue",Modulus:"Modulus",Exponent:"Exponent",Manifest:"Manifest",Object:"Object",Reference:"Reference",RetrievalMethod:"RetrievalMethod",RSAKeyValue:"RSAKeyValue",ECDSAKeyValue:"ECDSAKeyValue",NamedCurve:"NamedCurve",PublicKey:"PublicKey",Signature:"Signature",SignatureMethod:"SignatureMethod",SignatureValue:"SignatureValue",SignedInfo:"SignedInfo",Transform:"Transform",Transforms:"Transforms",X509Data:"X509Data",PGPData:"PGPData",SPKIData:"SPKIData",SPKIexp:"SPKIexp",MgmtData:"MgmtData",X509IssuerSerial:"X509IssuerSerial",X509IssuerName:"X509IssuerName",X509SerialNumber:"X509SerialNumber",X509SKI:"X509SKI",X509SubjectName:"X509SubjectName",X509Certificate:"X509Certificate",X509CRL:"X509CRL",XPath:"XPath",X:"X",Y:"Y"},AttributeNames:{Algorithm:"Algorithm",Encoding:"Encoding",Id:"Id",MimeType:"MimeType",Type:"Type",URI:"URI"},AlgorithmNamespaces:{XmlDsigBase64Transform:"http://www.w3.org/2000/09/xmldsig#base64",XmlDsigC14NTransform:"http://www.w3.org/TR/2001/REC-xml-c14n-20010315",XmlDsigC14NWithCommentsTransform:"http://www.w3.org/TR/2001/REC-xml-c14n-20010315#WithComments",XmlDsigEnvelopedSignatureTransform:"http://www.w3.org/2000/09/xmldsig#enveloped-signature",XmlDsigXPathTransform:"http://www.w3.org/TR/1999/REC-xpath-19991116",XmlDsigXsltTransform:"http://www.w3.org/TR/1999/REC-xslt-19991116",XmlDsigExcC14NTransform:"http://www.w3.org/2001/10/xml-exc-c14n#",XmlDsigExcC14NWithCommentsTransform:"http://www.w3.org/2001/10/xml-exc-c14n#WithComments",XmlDecryptionTransform:"http://www.w3.org/2002/07/decrypt#XML",XmlLicenseTransform:"urn:mpeg:mpeg21:2003:01-REL-R-NS:licenseTransform"},Uri:{Manifest:"http://www.w3.org/2000/09/xmldsig#Manifest"},NamespaceURI:"http://www.w3.org/2000/09/xmldsig#",NamespaceURIMore:"http://www.w3.org/2007/05/xmldsig-more#",NamespaceURIPss:"http://www.example.org/xmldsig-pss/#"};e.XmlSignatureObject=function(e){h(r,e);var t=w(r);function r(){return u(this,r),t.apply(this,arguments)}return l(r)}(Ce),e.XmlSignatureObject=py([Y({localName:"xmldsig",namespaceURI:yy.NamespaceURI,prefix:yy.DefaultPrefix})],e.XmlSignatureObject),e.XmlSignatureCollection=function(e){h(r,e);var t=w(r);function r(){return u(this,r),t.apply(this,arguments)}return l(r)}(xe),e.XmlSignatureCollection=py([Y({localName:"xmldsig_collection",namespaceURI:yy.NamespaceURI,prefix:yy.DefaultPrefix})],e.XmlSignatureCollection);var ky=function(e){h(r,e);var t=w(r);function r(){return u(this,r),t.apply(this,arguments)}return l(r)}(e.XmlSignatureObject);e.CanonicalizationMethod=function(e){h(r,e);var t=w(r);function r(){return u(this,r),t.apply(this,arguments)}return l(r)}(e.XmlSignatureObject),py([$({localName:yy.AttributeNames.Algorithm,required:!0,defaultValue:yy.DefaultCanonMethod})],e.CanonicalizationMethod.prototype,"Algorithm",void 0),e.CanonicalizationMethod=py([Y({localName:yy.ElementNames.CanonicalizationMethod})],e.CanonicalizationMethod),e.DataObject=function(e){h(r,e);var t=w(r);function r(){return u(this,r),t.apply(this,arguments)}return l(r)}(e.XmlSignatureObject),py([$({localName:yy.AttributeNames.Id,defaultValue:""})],e.DataObject.prototype,"Id",void 0),py([$({localName:yy.AttributeNames.MimeType,defaultValue:""})],e.DataObject.prototype,"MimeType",void 0),py([$({localName:yy.AttributeNames.Encoding,defaultValue:""})],e.DataObject.prototype,"Encoding",void 0),e.DataObject=py([Y({localName:yy.ElementNames.Object})],e.DataObject),e.DataObjects=function(e){h(r,e);var t=w(r);function r(){return u(this,r),t.apply(this,arguments)}return l(r)}(e.XmlSignatureCollection),e.DataObjects=py([Y({localName:"xmldsig_objects",parser:e.DataObject})],e.DataObjects),e.DigestMethod=function(e){h(r,e);var t=w(r);function r(e){var a;return u(this,r),a=t.call(this),e&&(a.Algorithm=e),a}return l(r)}(e.XmlSignatureObject),py([$({localName:yy.AttributeNames.Algorithm,required:!0,defaultValue:yy.DefaultDigestMethod})],e.DigestMethod.prototype,"Algorithm",void 0),e.DigestMethod=py([Y({localName:yy.ElementNames.DigestMethod})],e.DigestMethod),e.KeyInfo=function(t){h(a,t);var r=w(a);function a(){return u(this,a),r.apply(this,arguments)}return l(a,[{key:"OnLoadXml",value:function(t){for(var r=0;r<t.childNodes.length;r++){var a=t.childNodes.item(r);if(a.nodeType===ue.Element){var n=null;switch(a.localName){case yy.ElementNames.KeyValue:n=e.KeyValue;break;case yy.ElementNames.X509Data:n=e.KeyInfoX509Data;break;case yy.ElementNames.SPKIData:n=e.SPKIData;case yy.ElementNames.KeyName:case yy.ElementNames.RetrievalMethod:case yy.ElementNames.PGPData:case yy.ElementNames.MgmtData:}if(n){var i=new n;i.LoadXml(a),this.Add(i)}}}}}]),a}(e.XmlSignatureCollection),py([$({localName:yy.AttributeNames.Id,defaultValue:""})],e.KeyInfo.prototype,"Id",void 0),e.KeyInfo=py([Y({localName:yy.ElementNames.KeyInfo})],e.KeyInfo),e.Transform=function(e){h(r,e);var t=w(r);function r(){var e;return u(this,r),(e=t.apply(this,arguments)).innerXml=null,e}return l(r,[{key:"GetOutput",value:function(){throw new ie(ne.METHOD_NOT_IMPLEMENTED)}},{key:"LoadInnerXml",value:function(e){if(!e)throw new ie(ne.PARAM_REQUIRED,"node");this.innerXml=e}},{key:"GetInnerXml",value:function(){return this.innerXml}}]),r}(e.XmlSignatureObject),py([$({localName:yy.AttributeNames.Algorithm,defaultValue:""})],e.Transform.prototype,"Algorithm",void 0),py([Z({localName:yy.ElementNames.XPath,defaultValue:""})],e.Transform.prototype,"XPath",void 0),e.Transform=py([Y({localName:yy.ElementNames.Transform})],e.Transform);var wy=function(e){h(r,e);var t=w(r);function r(){var e;return u(this,r),(e=t.apply(this,arguments)).Algorithm=yy.AlgorithmNamespaces.XmlDsigBase64Transform,e}return l(r,[{key:"GetOutput",value:function(){if(!this.innerXml)throw new ie(ne.PARAM_REQUIRED,"innerXml");return oe.FromString(this.innerXml.textContent||"","base64")}}]),r}(e.Transform),by=function(e){h(r,e);var t=w(r);function r(){var e;return u(this,r),(e=t.apply(this,arguments)).Algorithm="http://www.w3.org/TR/2001/REC-xml-c14n-20010315",e.xmlCanonicalizer=new fy(!1,!1),e}return l(r,[{key:"GetOutput",value:function(){if(!this.innerXml)throw new ie(ne.PARAM_REQUIRED,"innerXml");return this.xmlCanonicalizer.Canonicalize(this.innerXml)}}]),r}(e.Transform),Sy=function(e){h(r,e);var t=w(r);function r(){var e;return u(this,r),(e=t.apply(this,arguments)).Algorithm="http://www.w3.org/TR/2001/REC-xml-c14n-20010315#WithComments",e.xmlCanonicalizer=new fy(!0,!1),e}return l(r)}(by),Ay=function(e){h(r,e);var t=w(r);function r(){var e;return u(this,r),(e=t.apply(this,arguments)).Algorithm="http://www.w3.org/2000/09/xmldsig#enveloped-signature",e}return l(r,[{key:"GetOutput",value:function(){var e;if(!this.innerXml)throw new ie(ne.PARAM_REQUIRED,"innerXml");for(var t=this.innerXml.firstChild,r=[];t;)we(t)&&t.localName===yy.ElementNames.Signature&&t.namespaceURI===yy.NamespaceURI&&r.push(t),t=t.nextSibling;for(var a=0,n=r;a<n.length;a++){var i=n[a];null===(e=i.parentNode)||void 0===e||e.removeChild(i)}return this.innerXml}}]),r}(e.Transform),Ny=function(e){h(r,e);var t=w(r);function r(){var e;return u(this,r),(e=t.apply(this,arguments)).Algorithm="http://www.w3.org/2001/10/xml-exc-c14n#",e.xmlCanonicalizer=new fy(!1,!0),e}return l(r,[{key:"InclusiveNamespacesPrefixList",get:function(){return this.xmlCanonicalizer.InclusiveNamespacesPrefixList},set:function(e){this.xmlCanonicalizer.InclusiveNamespacesPrefixList=e}},{key:"LoadXml",value:function(e){if(S(f(r.prototype),"LoadXml",this).call(this,e),this.Element&&this.Element.childNodes)for(var t=0;t<this.Element.childNodes.length;t++){var a=this.Element.childNodes[t];if(a&&1===a.nodeType&&"InclusiveNamespaces"===a.localName)this.setInclusiveNamespacesElement(a)}}},{key:"GetOutput",value:function(){if(!this.innerXml)throw new ie(ne.PARAM_REQUIRED,"innerXml");return this.xmlCanonicalizer.Canonicalize(this.innerXml)}},{key:"setInclusiveNamespacesElement",value:function(e){var t=e.getAttribute("PrefixList");t&&t.length>0&&(this.xmlCanonicalizer.InclusiveNamespacesPrefixList=t)}}]),r}(e.Transform),Cy=function(e){h(r,e);var t=w(r);function r(){var e;return u(this,r),(e=t.apply(this,arguments)).Algorithm="http://www.w3.org/2001/10/xml-exc-c14n#WithComments",e.xmlCanonicalizer=new fy(!0,!0),e}return l(r)}(Ny);function xy(e){return e.parentNode?xy(e.parentNode):e}var Ey=function(e){h(r,e);var t=w(r);function r(){var e;return u(this,r),(e=t.apply(this,arguments)).Algorithm=yy.AlgorithmNamespaces.XmlDsigXPathTransform,e}return l(r,[{key:"GetOutput",value:function(){if(!this.innerXml)throw new ie(ne.PARAM_REQUIRED,"innerXml");this.Filter(xy(this.innerXml),this.XPath)}},{key:"Filter",value:function(e,t){for(var r=this,a=e.childNodes,n=[],i=0;a&&i<a.length;i++){var s=a.item(i);n.push(s)}n.forEach((function(e){r.Evaluate(e,t)?e.parentNode&&e.parentNode.removeChild(e):r.Filter(e,t)}))}},{key:"GetEvaluator",value:function(e){return"undefined"!=typeof self?null==e.ownerDocument?e:e.ownerDocument:require("xpath")}},{key:"Evaluate",value:function(e,t){try{var r=this.GetEvaluator(e),a=this.GetXml().firstChild,n="boolean(".concat(t,")");return!r.evaluate(n,e,{lookupNamespaceURI:function(e){return a.lookupNamespaceURI(e)}},("undefined"==typeof self?require("xpath"):self).XPathResult.ANY_TYPE,null).booleanValue}catch(e){return!1}}}]),r}(e.Transform);function Iy(e,t){var r=new t;return r.LoadXml(e.Element),r}py([Z({localName:yy.ElementNames.XPath,namespaceURI:yy.NamespaceURI,prefix:yy.DefaultPrefix,required:!0})],Ey.prototype,"XPath",void 0),e.Transforms=function(e){h(r,e);var t=w(r);function r(){return u(this,r),t.apply(this,arguments)}return l(r,[{key:"OnLoadXml",value:function(e){S(f(r.prototype),"OnLoadXml",this).call(this,e),this.items=this.GetIterator().map((function(e){switch(e.Algorithm){case yy.AlgorithmNamespaces.XmlDsigEnvelopedSignatureTransform:return Iy(e,Ay);case yy.AlgorithmNamespaces.XmlDsigC14NTransform:return Iy(e,by);case yy.AlgorithmNamespaces.XmlDsigC14NWithCommentsTransform:return Iy(e,Sy);case yy.AlgorithmNamespaces.XmlDsigExcC14NTransform:return Iy(e,Ny);case yy.AlgorithmNamespaces.XmlDsigExcC14NWithCommentsTransform:return Iy(e,Cy);case yy.AlgorithmNamespaces.XmlDsigBase64Transform:return Iy(e,wy);case yy.AlgorithmNamespaces.XmlDsigXPathTransform:return Iy(e,Ey);default:throw new ie(ne.CRYPTOGRAPHIC_UNKNOWN_TRANSFORM,e.Algorithm)}}))}}]),r}(e.XmlSignatureCollection),e.Transforms=py([Y({localName:yy.ElementNames.Transforms,parser:e.Transform})],e.Transforms),e.Reference=function(t){h(a,t);var r=w(a);function a(t){var n;return u(this,a),(n=r.call(this)).DigestMethod=new e.DigestMethod,t&&(n.Uri=t),n}return l(a)}(e.XmlSignatureObject),py([$({defaultValue:""})],e.Reference.prototype,"Id",void 0),py([$({localName:yy.AttributeNames.URI})],e.Reference.prototype,"Uri",void 0),py([$({localName:yy.AttributeNames.Type,defaultValue:""})],e.Reference.prototype,"Type",void 0),py([Z({parser:e.Transforms})],e.Reference.prototype,"Transforms",void 0),py([Z({required:!0,parser:e.DigestMethod})],e.Reference.prototype,"DigestMethod",void 0),py([Z({required:!0,localName:yy.ElementNames.DigestValue,namespaceURI:yy.NamespaceURI,prefix:yy.DefaultPrefix,converter:Se})],e.Reference.prototype,"DigestValue",void 0),e.Reference=py([Y({localName:yy.ElementNames.Reference})],e.Reference),e.References=function(e){h(r,e);var t=w(r);function r(){return u(this,r),t.apply(this,arguments)}return l(r)}(e.XmlSignatureCollection),e.References=py([Y({localName:"References",parser:e.Reference})],e.References),e.SignatureMethodOther=function(t){h(a,t);var r=w(a);function a(){return u(this,a),r.apply(this,arguments)}return l(a,[{key:"OnLoadXml",value:function(t){for(var r=0;r<t.childNodes.length;r++){var a=t.childNodes.item(r);if(a.nodeType===ue.Element&&a.nodeName!==yy.ElementNames.HMACOutputLength){var n=void 0;if(a.localName===yy.ElementNames.RSAPSSParams)n=e.PssAlgorithmParams;if(n){var i=new n;i.LoadXml(a),this.Add(i)}}}}}]),a}(e.XmlSignatureCollection),e.SignatureMethodOther=py([Y({localName:"Other"})],e.SignatureMethodOther),e.SignatureMethod=function(e){h(r,e);var t=w(r);function r(){return u(this,r),t.apply(this,arguments)}return l(r)}(e.XmlSignatureObject),py([$({localName:yy.AttributeNames.Algorithm,required:!0,defaultValue:""})],e.SignatureMethod.prototype,"Algorithm",void 0),py([Z({localName:yy.ElementNames.HMACOutputLength,namespaceURI:yy.NamespaceURI,prefix:yy.DefaultPrefix,converter:Ae})],e.SignatureMethod.prototype,"HMACOutputLength",void 0),py([Z({parser:e.SignatureMethodOther,noRoot:!0,minOccurs:0})],e.SignatureMethod.prototype,"Any",void 0),e.SignatureMethod=py([Y({localName:yy.ElementNames.SignatureMethod})],e.SignatureMethod),e.SignedInfo=function(e){h(r,e);var t=w(r);function r(){return u(this,r),t.apply(this,arguments)}return l(r)}(e.XmlSignatureObject),py([$({localName:yy.AttributeNames.Id,defaultValue:""})],e.SignedInfo.prototype,"Id",void 0),py([Z({parser:e.CanonicalizationMethod,required:!0})],e.SignedInfo.prototype,"CanonicalizationMethod",void 0),py([Z({parser:e.SignatureMethod,required:!0})],e.SignedInfo.prototype,"SignatureMethod",void 0),py([Z({parser:e.References,minOccurs:1,noRoot:!0})],e.SignedInfo.prototype,"References",void 0),e.SignedInfo=py([Y({localName:yy.ElementNames.SignedInfo})],e.SignedInfo),e.Signature=function(e){h(r,e);var t=w(r);function r(){return u(this,r),t.apply(this,arguments)}return l(r)}(e.XmlSignatureObject),py([$({localName:yy.AttributeNames.Id,defaultValue:""})],e.Signature.prototype,"Id",void 0),py([Z({parser:e.SignedInfo,required:!0})],e.Signature.prototype,"SignedInfo",void 0),py([Z({localName:yy.ElementNames.SignatureValue,namespaceURI:yy.NamespaceURI,prefix:yy.DefaultPrefix,required:!0,converter:Se,defaultValue:null})],e.Signature.prototype,"SignatureValue",void 0),py([Z({parser:e.KeyInfo})],e.Signature.prototype,"KeyInfo",void 0),py([Z({parser:e.DataObjects,noRoot:!0})],e.Signature.prototype,"ObjectList",void 0),e.Signature=py([Y({localName:yy.ElementNames.Signature})],e.Signature);var By,Vy="http://www.w3.org/2001/04/xmldsig-more#",Dy="ecdsa";function Oy(e){switch(e){case"P-256":return"urn:oid:1.2.840.10045.3.1.7";case"P-384":return"urn:oid:1.3.132.0.34";case"P-521":return"urn:oid:1.3.132.0.35"}throw new ie(ne.CRYPTOGRAPHIC,"Unknown NamedCurve")}function Py(e){switch(e){case"urn:oid:1.2.840.10045.3.1.7":return"P-256";case"urn:oid:1.3.132.0.34":return"P-384";case"urn:oid:1.3.132.0.35":return"P-521"}throw new ie(ne.CRYPTOGRAPHIC,"Unknown NamedCurve OID")}e.EcdsaPublicKey=function(e){h(r,e);var t=w(r);function r(){return u(this,r),t.apply(this,arguments)}return l(r)}(Ce),py([Z({localName:yy.ElementNames.X,namespaceURI:Vy,prefix:Dy,required:!0,converter:Se})],e.EcdsaPublicKey.prototype,"X",void 0),py([Z({localName:yy.ElementNames.Y,namespaceURI:Vy,prefix:Dy,required:!0,converter:Se})],e.EcdsaPublicKey.prototype,"Y",void 0),e.EcdsaPublicKey=py([Y({localName:yy.ElementNames.PublicKey,namespaceURI:Vy,prefix:Dy})],e.EcdsaPublicKey),e.NamedCurve=function(e){h(r,e);var t=w(r);function r(){return u(this,r),t.apply(this,arguments)}return l(r)}(Ce),py([$({localName:yy.AttributeNames.URI,required:!0})],e.NamedCurve.prototype,"Uri",void 0),e.NamedCurve=py([Y({localName:yy.ElementNames.NamedCurve,namespaceURI:Vy,prefix:Dy})],e.NamedCurve),e.DomainParameters=function(e){h(r,e);var t=w(r);function r(){return u(this,r),t.apply(this,arguments)}return l(r)}(Ce),py([Z({parser:e.NamedCurve})],e.DomainParameters.prototype,"NamedCurve",void 0),e.DomainParameters=py([Y({localName:yy.ElementNames.DomainParameters,namespaceURI:Vy,prefix:Dy})],e.DomainParameters),e.EcdsaKeyValue=function(t){h(o,t);var r,n,i=w(o);function o(){var e;return u(this,o),(e=i.apply(this,arguments)).name=yy.ElementNames.ECDSAKeyValue,e.key=null,e.jwk=null,e.keyUsage=null,e}return l(o,[{key:"NamedCurve",get:function(){return Oy(this.DomainParameters.NamedCurve.Uri)}},{key:"importKey",value:(n=s(a().mark((function t(r){var n;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("ECDSA"===r.algorithm.name.toUpperCase()){t.next=2;break}throw new ie(ne.ALGORITHM_WRONG_NAME,r.algorithm.name);case 2:return t.next=4,sp.crypto.subtle.exportKey("jwk",r);case 4:return n=t.sent,this.key=r,this.jwk=n,this.PublicKey=new e.EcdsaPublicKey,this.PublicKey.X=oe.FromString(n.x,"base64url"),this.PublicKey.Y=oe.FromString(n.y,"base64url"),this.DomainParameters||(this.DomainParameters=new e.DomainParameters),this.DomainParameters.NamedCurve||(this.DomainParameters.NamedCurve=new e.NamedCurve),this.DomainParameters.NamedCurve.Uri=Oy(n.crv),this.keyUsage=r.usages,t.abrupt("return",this);case 15:case"end":return t.stop()}}),t,this)}))),function(e){return n.apply(this,arguments)})},{key:"exportKey",value:(r=s(a().mark((function e(t){var r,n,i,s,u;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.key){e.next=2;break}return e.abrupt("return",this.key);case 2:return r=oe.ToBase64Url(this.PublicKey.X),n=oe.ToBase64Url(this.PublicKey.Y),i=Py(this.DomainParameters.NamedCurve.Uri),s={kty:"EC",crv:i,x:r,y:n,ext:!0},this.keyUsage=["verify"],e.next=9,sp.crypto.subtle.importKey("jwk",s,{name:"ECDSA",namedCurve:i},!0,this.keyUsage);case 9:return u=e.sent,this.key=u,e.abrupt("return",this.key);case 12:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})}]),o}(ky),py([Z({parser:e.DomainParameters})],e.EcdsaKeyValue.prototype,"DomainParameters",void 0),py([Z({parser:e.EcdsaPublicKey,required:!0})],e.EcdsaKeyValue.prototype,"PublicKey",void 0),e.EcdsaKeyValue=py([Y({localName:yy.ElementNames.ECDSAKeyValue,namespaceURI:Vy,prefix:Dy})],e.EcdsaKeyValue);var Ry={name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};e.RsaKeyValue=function(e){h(i,e);var t,r,n=w(i);function i(){var e;return u(this,i),(e=n.apply(this,arguments)).key=null,e.jwk=null,e.keyUsage=[],e}return l(i,[{key:"importKey",value:(r=s(a().mark((function e(t){var r,n;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((r=t.algorithm.name.toUpperCase())===_p.toUpperCase()||r===Qp.toUpperCase()){e.next=3;break}throw new ie(ne.ALGORITHM_WRONG_NAME,t.algorithm.name);case 3:return this.key=t,e.next=6,sp.crypto.subtle.exportKey("jwk",t);case 6:return n=e.sent,this.jwk=n,this.Modulus=oe.FromBase64Url(n.n),this.Exponent=oe.FromBase64Url(n.e),this.keyUsage=t.usages,e.abrupt("return",this);case 12:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"exportKey",value:(t=s(a().mark((function e(){var t,r,n,i,s,u=arguments;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=u.length>0&&void 0!==u[0]?u[0]:Ry,!this.key){e.next=3;break}return e.abrupt("return",this.key);case 3:if(this.Modulus){e.next=5;break}throw new ie(ne.CRYPTOGRAPHIC,"RsaKeyValue has no Modulus");case 5:if(r=oe.ToBase64Url(this.Modulus),this.Exponent){e.next=8;break}throw new ie(ne.CRYPTOGRAPHIC,"RsaKeyValue has no Exponent");case 8:n=oe.ToBase64Url(this.Exponent),e.t0=t.name.toUpperCase(),e.next=e.t0===_p.toUpperCase()?12:e.t0===Qp.toUpperCase()?14:16;break;case 12:return i="R",e.abrupt("break",17);case 14:return i="P",e.abrupt("break",17);case 16:throw new ie(ne.ALGORITHM_NOT_SUPPORTED,t.name);case 17:e.t1=t.hash.name.toUpperCase(),e.next=e.t1===hp?20:e.t1===fp?22:e.t1===mp?24:e.t1===vp?26:28;break;case 20:return i+="S1",e.abrupt("break",28);case 22:return i+="S256",e.abrupt("break",28);case 24:return i+="S384",e.abrupt("break",28);case 26:return i+="S512",e.abrupt("break",28);case 28:return s={kty:"RSA",alg:i,n:r,e:n,ext:!0},e.abrupt("return",sp.crypto.subtle.importKey("jwk",s,t,!0,this.keyUsage));case 30:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"LoadXml",value:function(e){S(f(i.prototype),"LoadXml",this).call(this,e),this.keyUsage=["verify"]}}]),i}(ky),py([Z({localName:yy.ElementNames.Modulus,prefix:yy.DefaultPrefix,namespaceURI:yy.NamespaceURI,required:!0,converter:Se})],e.RsaKeyValue.prototype,"Modulus",void 0),py([Z({localName:yy.ElementNames.Exponent,prefix:yy.DefaultPrefix,namespaceURI:yy.NamespaceURI,required:!0,converter:Se})],e.RsaKeyValue.prototype,"Exponent",void 0),e.RsaKeyValue=py([Y({localName:yy.ElementNames.RSAKeyValue})],e.RsaKeyValue);var Uy="http://www.w3.org/2007/05/xmldsig-more#",Ty="pss";e.MaskGenerationFunction=function(e){h(r,e);var t=w(r);function r(){return u(this,r),t.apply(this,arguments)}return l(r)}(Ce),py([Z({parser:e.DigestMethod})],e.MaskGenerationFunction.prototype,"DigestMethod",void 0),py([$({localName:yy.AttributeNames.Algorithm,defaultValue:"http://www.w3.org/2007/05/xmldsig-more#MGF1"})],e.MaskGenerationFunction.prototype,"Algorithm",void 0),e.MaskGenerationFunction=py([Y({localName:yy.ElementNames.MaskGenerationFunction,prefix:Ty,namespaceURI:Uy})],e.MaskGenerationFunction),e.PssAlgorithmParams=By=function(t){h(a,t);var r=w(a);function a(e){var t;return u(this,a),t=r.call(this),e&&t.FromAlgorithm(e),t}return l(a,[{key:"FromAlgorithm",value:function(t){this.DigestMethod=new e.DigestMethod;var r=jy.GetHashAlgorithm(t.hash);this.DigestMethod.Algorithm=r.namespaceURI,t.saltLength&&(this.SaltLength=t.saltLength)}}],[{key:"FromAlgorithm",value:function(e){return new By(e)}}]),a}(Ce),py([Z({parser:e.DigestMethod})],e.PssAlgorithmParams.prototype,"DigestMethod",void 0),py([Z({parser:e.MaskGenerationFunction})],e.PssAlgorithmParams.prototype,"MGF",void 0),py([Z({converter:Ae,prefix:Ty,namespaceURI:Uy})],e.PssAlgorithmParams.prototype,"SaltLength",void 0),py([Z({converter:Ae})],e.PssAlgorithmParams.prototype,"TrailerField",void 0),e.PssAlgorithmParams=By=py([Y({localName:yy.ElementNames.RSAPSSParams,prefix:Ty,namespaceURI:Uy})],e.PssAlgorithmParams),e.KeyValue=function(t){h(o,t);var r,n,i=w(o);function o(e){var t;return u(this,o),t=i.call(this),e&&(t.Value=e),t}return l(o,[{key:"Value",get:function(){return this.value},set:function(e){this.element=null,this.value=e}},{key:"importKey",value:(n=s(a().mark((function t(r){return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:t.t0=r.algorithm.name.toUpperCase(),t.next=t.t0===Qp.toUpperCase()||t.t0===_p.toUpperCase()?3:t.t0===Ap.toUpperCase()?7:11;break;case 3:return this.Value=new e.RsaKeyValue,t.next=6,this.Value.importKey(r);case 6:case 10:return t.abrupt("break",12);case 7:return this.Value=new e.EcdsaKeyValue,t.next=10,this.Value.importKey(r);case 11:throw new ie(ne.ALGORITHM_NOT_SUPPORTED,r.algorithm.name);case 12:return t.abrupt("return",this);case 13:case"end":return t.stop()}}),t,this)}))),function(e){return n.apply(this,arguments)})},{key:"exportKey",value:(r=s(a().mark((function e(t){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.Value){e.next=2;break}throw new ie(ne.NULL_REFERENCE);case 2:return e.abrupt("return",this.Value.exportKey(t));case 3:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"OnGetXml",value:function(e){if(!this.Value)throw new ie(ne.CRYPTOGRAPHIC,"KeyValue has empty value");var t=this.Value.GetXml();t&&e.appendChild(t)}},{key:"OnLoadXml",value:function(t){for(var r=0,a=[e.RsaKeyValue,e.EcdsaKeyValue];r<a.length;r++){var n=a[r];try{for(var i=new n,s=0;s<t.childNodes.length;s++){var u=t.childNodes.item(s);if(we(u))return i.LoadXml(u),void(this.value=i)}}catch(e){}}throw new ie(ne.CRYPTOGRAPHIC,"Unsupported KeyValue in use")}}]),o}(ky),e.KeyValue=py([Y({localName:yy.ElementNames.KeyValue})],e.KeyValue);var Ly,Hy={"2.5.4.3":{short:"CN",long:"CommonName"},"2.5.4.6":{short:"C",long:"Country"},"2.5.4.5":{long:"DeviceSerialNumber"},"0.9.2342.19200300.100.1.25":{short:"DC",long:"DomainComponent"},"1.2.840.113549.1.9.1":{short:"E",long:"EMail"},"2.5.4.42":{short:"G",long:"GivenName"},"2.5.4.43":{short:"I",long:"Initials"},"2.5.4.7":{short:"L",long:"Locality"},"2.5.4.10":{short:"O",long:"Organization"},"2.5.4.11":{short:"OU",long:"OrganizationUnit"},"2.5.4.8":{short:"ST",long:"State"},"2.5.4.9":{short:"Street",long:"StreetAddress"},"2.5.4.4":{short:"SN",long:"SurName"},"2.5.4.12":{short:"T",long:"Title"},"1.2.840.113549.1.9.8":{long:"UnstructuredAddress"},"1.2.840.113549.1.9.2":{long:"UnstructuredName"}},My=function(){function e(t){if(u(this,e),this.publicKey=null,t){var r=new Uint8Array(t);this.LoadRaw(r),this.raw=r}}var t,r;return l(e,[{key:"SerialNumber",get:function(){return this.simpl.serialNumber.valueBlock.toString()}},{key:"Issuer",get:function(){return this.NameToString(this.simpl.issuer)}},{key:"Subject",get:function(){return this.NameToString(this.simpl.subject)}},{key:"Thumbprint",value:(r=s(a().mark((function e(){var t,r=arguments;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.length>0&&void 0!==r[0]?r[0]:"SHA-1",e.abrupt("return",sp.crypto.subtle.digest(t,this.raw));case 2:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"PublicKey",get:function(){return this.publicKey}},{key:"GetRaw",value:function(){return this.raw}},{key:"exportKey",value:(t=s(a().mark((function e(t){var r,n,i;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=15;break}if((r={algorithm:t,usages:["verify"]}).algorithm.name.toUpperCase()!==Ap){e.next=9;break}if(!("crv"in(n=this.simpl.subjectPublicKeyInfo.toJSON()))||!n.crv){e.next=8;break}r.algorithm.namedCurve=n.crv,e.next=9;break;case 8:throw new Error("Cannot get Curved name from the ECDSA public key");case 9:return this.isHashedAlgorithm(r.algorithm)&&"string"==typeof r.algorithm.hash&&(r.algorithm.hash={name:r.algorithm.hash}),e.next=12,this.simpl.getPublicKey({algorithm:r});case 12:return i=e.sent,this.publicKey=i,e.abrupt("return",i);case 15:if("1.2.840.113549.1.1.1"!==this.simpl.subjectPublicKeyInfo.algorithm.algorithmId){e.next=21;break}return e.next=18,this.simpl.getPublicKey({algorithm:{algorithm:{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},usages:["verify"]}});case 18:this.publicKey=e.sent,e.next=24;break;case 21:return e.next=23,this.simpl.getPublicKey();case 23:this.publicKey=e.sent;case 24:return e.abrupt("return",this.publicKey);case 25:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"NameToString",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:",",r=[];return e.typesAndValues.forEach((function(e){var t=e.type,a=Hy[t.toString()],n=a?a.short:null;r.push("".concat(n||t,"=").concat(e.value.valueBlock.value))})),r.join(t+" ")}},{key:"LoadRaw",value:function(e){this.raw=new Uint8Array(e);var t=At(this.raw.buffer);this.simpl=new ql({schema:t.result})}},{key:"isHashedAlgorithm",value:function(e){return!!e.hash}}]),e}();e.X509IssuerSerial=function(e){h(r,e);var t=w(r);function r(){return u(this,r),t.apply(this,arguments)}return l(r)}(e.XmlSignatureObject),py([Z({localName:yy.ElementNames.X509IssuerName,namespaceURI:yy.NamespaceURI,prefix:yy.DefaultPrefix,required:!0})],e.X509IssuerSerial.prototype,"X509IssuerName",void 0),py([Z({localName:yy.ElementNames.X509SerialNumber,namespaceURI:yy.NamespaceURI,prefix:yy.DefaultPrefix,required:!0})],e.X509IssuerSerial.prototype,"X509SerialNumber",void 0),e.X509IssuerSerial=py([Y({localName:yy.ElementNames.X509IssuerSerial})],e.X509IssuerSerial),e.X509IncludeOption=void 0,(Ly=e.X509IncludeOption||(e.X509IncludeOption={}))[Ly.None=0]="None",Ly[Ly.EndCertOnly=1]="EndCertOnly",Ly[Ly.ExcludeRoot=2]="ExcludeRoot",Ly[Ly.WholeChain=3]="WholeChain",e.KeyInfoX509Data=function(t){h(o,t);var r,n,i=w(o);function o(t){var r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.X509IncludeOption.None;if(u(this,o),(r=i.call(this)).x509crl=null,r.SubjectKeyIdList=[],t)if(t instanceof Uint8Array)r.AddCertificate(new My(t));else if(t instanceof My)switch(a){case e.X509IncludeOption.None:case e.X509IncludeOption.EndCertOnly:r.AddCertificate(t);break;case e.X509IncludeOption.ExcludeRoot:r.AddCertificatesChainFrom(t,!1);break;case e.X509IncludeOption.WholeChain:r.AddCertificatesChainFrom(t,!0)}return r}return l(o,[{key:"importKey",value:(n=s(a().mark((function e(t){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new ie(ne.METHOD_NOT_SUPPORTED);case 1:case"end":return e.stop()}}),e)}))),function(e){return n.apply(this,arguments)})},{key:"exportKey",value:(r=s(a().mark((function e(t){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.Certificates.length){e.next=2;break}throw new ie(ne.NULL_REFERENCE);case 2:return e.next=4,this.Certificates[0].exportKey(t);case 4:return this.Key=e.sent,e.abrupt("return",this.Key);case 6:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"Certificates",get:function(){return this.X509CertificateList}},{key:"CRL",get:function(){return this.x509crl},set:function(e){this.x509crl=e}},{key:"IssuerSerials",get:function(){return this.IssuerSerialList}},{key:"SubjectKeyIds",get:function(){return this.SubjectKeyIdList}},{key:"SubjectNames",get:function(){return this.SubjectNameList}},{key:"AddCertificate",value:function(e){if(!e)throw new ie(ne.PARAM_REQUIRED,"certificate");this.X509CertificateList||(this.X509CertificateList=[]),this.X509CertificateList.push(e)}},{key:"AddIssuerSerial",value:function(e,t){if(null==e)throw new ie(ne.PARAM_REQUIRED,"issuerName");null==this.IssuerSerialList&&(this.IssuerSerialList=[]);var r={issuerName:e,serialNumber:t};this.IssuerSerialList.push(r)}},{key:"AddSubjectKeyId",value:function(e){var t;(this.SubjectKeyIdList&&(this.SubjectKeyIdList=[]),"string"==typeof e)?null!=e&&(t=oe.FromBase64(e),this.SubjectKeyIdList.push(t)):this.SubjectKeyIdList.push(e)}},{key:"AddSubjectName",value:function(e){null==this.SubjectNameList&&(this.SubjectNameList=[]),this.SubjectNameList.push(e)}},{key:"GetXml",value:function(){var e=this.CreateDocument(),t=this.CreateElement(e),r=this.GetPrefix();if(null!=this.IssuerSerialList&&this.IssuerSerialList.length>0&&this.IssuerSerialList.forEach((function(a){var n=e.createElementNS(yy.NamespaceURI,r+yy.ElementNames.X509IssuerSerial),i=e.createElementNS(yy.NamespaceURI,r+yy.ElementNames.X509IssuerName);i.textContent=a.issuerName,n.appendChild(i);var s=e.createElementNS(yy.NamespaceURI,r+yy.ElementNames.X509SerialNumber);s.textContent=a.serialNumber,n.appendChild(s),t.appendChild(n)})),null!=this.SubjectKeyIdList&&this.SubjectKeyIdList.length>0&&this.SubjectKeyIdList.forEach((function(a){var n=e.createElementNS(yy.NamespaceURI,r+yy.ElementNames.X509SKI);n.textContent=oe.ToBase64(a),t.appendChild(n)})),null!=this.SubjectNameList&&this.SubjectNameList.length>0&&this.SubjectNameList.forEach((function(a){var n=e.createElementNS(yy.NamespaceURI,r+yy.ElementNames.X509SubjectName);n.textContent=a,t.appendChild(n)})),null!=this.X509CertificateList&&this.X509CertificateList.length>0&&this.X509CertificateList.forEach((function(a){var n=e.createElementNS(yy.NamespaceURI,r+yy.ElementNames.X509Certificate);n.textContent=oe.ToBase64(a.GetRaw()),t.appendChild(n)})),null!=this.x509crl){var a=e.createElementNS(yy.NamespaceURI,r+yy.ElementNames.X509CRL);a.textContent=oe.ToBase64(this.x509crl),t.appendChild(a)}return t}},{key:"LoadXml",value:function(t){var r=this;S(f(o.prototype),"LoadXml",this).call(this,t),this.IssuerSerialList&&(this.IssuerSerialList=[]),this.SubjectKeyIdList&&(this.SubjectKeyIdList=[]),this.SubjectNameList&&(this.SubjectNameList=[]),this.X509CertificateList&&(this.X509CertificateList=[]),this.x509crl=null;var a=this.GetChildren(yy.ElementNames.X509IssuerSerial);a&&a.forEach((function(t){var a=e.XmlSignatureObject.GetChild(t,yy.ElementNames.X509IssuerName,yy.NamespaceURI,!0),n=e.XmlSignatureObject.GetChild(t,yy.ElementNames.X509SerialNumber,yy.NamespaceURI,!0);a&&a.textContent&&n&&n.textContent&&r.AddIssuerSerial(a.textContent,n.textContent)})),(a=this.GetChildren(yy.ElementNames.X509SKI))&&a.forEach((function(e){if(e.textContent){var t=oe.FromBase64(e.textContent);r.AddSubjectKeyId(t)}})),null!=(a=this.GetChildren(yy.ElementNames.X509SubjectName))&&a.forEach((function(e){e.textContent&&r.AddSubjectName(e.textContent)})),(a=this.GetChildren(yy.ElementNames.X509Certificate))&&a.forEach((function(e){if(e.textContent){var t=oe.FromBase64(e.textContent);r.AddCertificate(new My(t))}}));var n=this.GetChild(yy.ElementNames.X509CRL,!1);n&&n.textContent&&(this.x509crl=oe.FromBase64(n.textContent))}},{key:"AddCertificatesChainFrom",value:function(e,t){throw new ie(ne.METHOD_NOT_IMPLEMENTED)}}]),o}(ky),e.KeyInfoX509Data=py([Y({localName:yy.ElementNames.X509Data})],e.KeyInfoX509Data),e.SPKIData=function(e){h(i,e);var t,r,n=w(i);function i(){return u(this,i),n.apply(this,arguments)}return l(i,[{key:"importKey",value:(r=s(a().mark((function e(t){var r;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,sp.crypto.subtle.exportKey("spki",t);case 2:return r=e.sent,this.SPKIexp=new Uint8Array(r),this.Key=t,e.abrupt("return",this);case 6:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"exportKey",value:(t=s(a().mark((function e(t){var r;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,sp.crypto.subtle.importKey("spki",this.SPKIexp,t,!0,["verify"]);case 2:return r=e.sent,this.Key=r,e.abrupt("return",r);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),i}(ky),py([Z({localName:yy.ElementNames.SPKIexp,namespaceURI:yy.NamespaceURI,prefix:yy.DefaultPrefix,required:!0,converter:Se})],e.SPKIData.prototype,"SPKIexp",void 0),e.SPKIData=py([Y({localName:yy.ElementNames.SPKIData})],e.SPKIData);var Ky={};Ky[jp]=Xp,Ky[Jp]=Wp,Ky[Fp]=Gp,Ky[qp]=zp,Ky[Np]=Ip,Ky[Cp]=Bp,Ky[xp]=Vp,Ky[Ep]=Dp,Ky[Pp]=Lp,Ky[Rp]=Hp,Ky[Up]=Mp,Ky[Tp]=Kp,Ky[ay]=oy,Ky[ny]=ly,Ky[iy]=cy,Ky[sy]=hy;var _y={};_y[dp]=kp,_y[gp]=wp,_y[pp]=bp,_y[yp]=Sp;var jy=function(){function t(){u(this,t)}return l(t,null,[{key:"CreateFromName",value:function(e){var t;switch(e){case yy.AlgorithmNamespaces.XmlDsigBase64Transform:t=new wy;break;case yy.AlgorithmNamespaces.XmlDsigC14NTransform:t=new by;break;case yy.AlgorithmNamespaces.XmlDsigC14NWithCommentsTransform:t=new Sy;break;case yy.AlgorithmNamespaces.XmlDsigEnvelopedSignatureTransform:t=new Ay;break;case yy.AlgorithmNamespaces.XmlDsigXPathTransform:case yy.AlgorithmNamespaces.XmlDsigXsltTransform:throw new ie(ne.ALGORITHM_NOT_SUPPORTED,e);case yy.AlgorithmNamespaces.XmlDsigExcC14NTransform:t=new Ny;break;case yy.AlgorithmNamespaces.XmlDsigExcC14NWithCommentsTransform:t=new Cy;break;case yy.AlgorithmNamespaces.XmlDecryptionTransform:default:throw new ie(ne.ALGORITHM_NOT_SUPPORTED,e)}return t}},{key:"CreateSignatureAlgorithm",value:function(t){var r=Ky[t.Algorithm]||null;if(r)return new r;if(t.Algorithm===Yp){var a;if(t.Any.Some((function(t){return t instanceof e.PssAlgorithmParams&&(a=t),!!a})),a)switch(a.DigestMethod.Algorithm){case dp:return new $p(a.SaltLength);case gp:return new ey(a.SaltLength);case pp:return new ty(a.SaltLength);case yp:return new ry(a.SaltLength)}throw new ie(ne.CRYPTOGRAPHIC,"Cannot get params for RSA-PSS algoriithm")}throw new Error("signature algorithm '".concat(t.Algorithm,"' is not supported"))}},{key:"CreateHashAlgorithm",value:function(e){var t=_y[e];if(t)return new t;throw new Error("hash algorithm '"+e+"' is not supported")}},{key:"GetHashAlgorithm",value:function(e){var t="string"==typeof e?{name:e}:e;switch(t.name.toUpperCase()){case hp:return new kp;case fp:return new wp;case mp:return new bp;case vp:return new Sp;default:throw new ie(ne.ALGORITHM_NOT_SUPPORTED,t.name)}}},{key:"GetSignatureAlgorithm",value:function(e){"string"==typeof e.hash&&(e.hash={name:e.hash});var t,r=e.hash.name;if(!r)throw new Error("Signing algorithm doesn't have name for hash");switch(e.name.toUpperCase()){case _p.toUpperCase():switch(r.toUpperCase()){case hp:t=new Xp;break;case fp:t=new Wp;break;case mp:t=new Gp;break;case vp:t=new zp;break;default:throw new ie(ne.ALGORITHM_NOT_SUPPORTED,"".concat(e.name,":").concat(r))}break;case Qp.toUpperCase():var a=e.saltLength;switch(r.toUpperCase()){case hp:t=a?new $p(a):new oy;break;case fp:t=a?new ey(a):new ly;break;case mp:t=a?new ty(a):new cy;break;case vp:t=a?new ry(a):new hy;break;default:throw new ie(ne.ALGORITHM_NOT_SUPPORTED,"".concat(e.name,":").concat(r))}e.saltLength=t.algorithm.saltLength;break;case Ap:switch(r.toUpperCase()){case hp:t=new Ip;break;case fp:t=new Bp;break;case mp:t=new Vp;break;case vp:t=new Dp;break;default:throw new ie(ne.ALGORITHM_NOT_SUPPORTED,"".concat(e.name,":").concat(r))}break;case Op:switch(r.toUpperCase()){case hp:t=new Lp;break;case fp:t=new Hp;break;case mp:t=new Mp;break;case vp:t=new Kp;break;default:throw new ie(ne.ALGORITHM_NOT_SUPPORTED,"".concat(e.name,":").concat(r))}break;default:throw new ie(ne.ALGORITHM_NOT_SUPPORTED,e.name)}return t}}]),t}(),Jy=function(){function t(r){if(u(this,t),this.signature=new e.Signature,r&&r.nodeType===ue.Document)this.document=r;else if(r&&r.nodeType===ue.Element){var a=(new XMLSerializer).serializeToString(r);this.document=(new DOMParser).parseFromString(a,le)}}var r,n,i,o,c,h,f,m,v,d;return l(t,[{key:"XmlSignature",get:function(){return this.signature}},{key:"Signature",get:function(){return this.XmlSignature.SignatureValue}},{key:"Sign",value:(d=s(a().mark((function t(r,n,i){var s,u,o,l,c,h,f,m,v,d,g=arguments;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return s=g.length>3&&void 0!==g[3]?g[3]:{},be(i)?i=i.cloneNode(!0).documentElement:we(i)&&(i=i.cloneNode(!0)),l=ye({},r),n.algorithm.hash&&(l.hash=n.algorithm.hash),u=jy.GetSignatureAlgorithm(l),t.next=7,this.ApplySignOptions(this.XmlSignature,r,n,s);case 7:return o=this.XmlSignature.SignedInfo,t.next=10,this.DigestReferences(i);case 10:if(o.SignatureMethod.Algorithm=u.namespaceURI,!(u instanceof Zp)){t.next=18;break}"string"==typeof(c=ye({},n.algorithm,l)).hash&&(c.hash={name:c.hash}),h=new e.PssAlgorithmParams(c),this.XmlSignature.SignedInfo.SignatureMethod.Any.Add(h),t.next=33;break;case 18:if(Op.toUpperCase()!==r.name.toUpperCase()){t.next=33;break}f=0,m=n.algorithm,t.t0=m.hash.name.toUpperCase(),t.next=t.t0===hp?24:t.t0===fp?26:t.t0===mp?28:t.t0===vp?30:32;break;case 24:return f=m.length||160,t.abrupt("break",32);case 26:return f=m.length||256,t.abrupt("break",32);case 28:return f=m.length||384,t.abrupt("break",32);case 30:return f=m.length||512,t.abrupt("break",32);case 32:this.XmlSignature.SignedInfo.SignatureMethod.HMACOutputLength=f;case 33:return v=this.TransformSignedInfo(i),t.next=36,u.Sign(v,n,l);case 36:return d=t.sent,this.Key=n,this.XmlSignature.SignatureValue=new Uint8Array(d),we(i)&&(this.document=i.ownerDocument),t.abrupt("return",this.XmlSignature);case 41:case"end":return t.stop()}}),t,this)}))),function(e,t,r){return d.apply(this,arguments)})},{key:"SignDetached",value:(v=s(a().mark((function t(r,n){var i,s,u,o,l,c,h,f,m,v,d=arguments;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=d.length>2&&void 0!==d[2]?d[2]:{},o=ye({},r),n.algorithm.hash&&(o.hash=n.algorithm.hash),s=jy.GetSignatureAlgorithm(o),t.next=6,this.ApplySignOptions(this.XmlSignature,r,n,i);case 6:return u=this.XmlSignature.SignedInfo,t.next=9,this.DigestDetachedReferences();case 9:if(u.SignatureMethod.Algorithm=s.namespaceURI,!(s instanceof Zp)){t.next=17;break}"string"==typeof(l=ye({},n.algorithm,o)).hash&&(l.hash={name:l.hash}),c=new e.PssAlgorithmParams(l),this.XmlSignature.SignedInfo.SignatureMethod.Any.Add(c),t.next=32;break;case 17:if(Op.toUpperCase()!==r.name.toUpperCase()){t.next=32;break}h=0,f=n.algorithm,t.t0=f.hash.name.toUpperCase(),t.next=t.t0===hp?23:t.t0===fp?25:t.t0===mp?27:t.t0===vp?29:31;break;case 23:return h=f.length||160,t.abrupt("break",31);case 25:return h=f.length||256,t.abrupt("break",31);case 27:return h=f.length||384,t.abrupt("break",31);case 29:return h=f.length||512,t.abrupt("break",31);case 31:this.XmlSignature.SignedInfo.SignatureMethod.HMACOutputLength=h;case 32:return m=this.TransformSignedInfo(),t.next=35,s.Sign(m,n,o);case 35:return v=t.sent,this.Key=n,this.XmlSignature.SignatureValue=new Uint8Array(v),t.abrupt("return",this.XmlSignature);case 39:case"end":return t.stop()}}),t,this)}))),function(e,t){return v.apply(this,arguments)})},{key:"Verify",value:(m=s(a().mark((function e(t){var r,n,i,s;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t&&("algorithm"in t&&"usages"in t&&"type"in t?n=t:(n=t.key,r=t.content)),r){e.next=6;break}if((i=this.document)&&i.documentElement){e.next=5;break}throw new ie(ne.NULL_PARAM,"SignedXml","document");case 5:r=i.documentElement;case 6:return(be(r)||we(r))&&(r=r.cloneNode(!0)),e.next=9,this.ValidateReferences(r);case 9:if(!e.sent){e.next=22;break}if(!n){e.next=15;break}e.t0=[n],e.next=18;break;case 15:return e.next=17,this.GetPublicKeys();case 17:e.t0=e.sent;case 18:return s=e.t0,e.abrupt("return",this.ValidateSignatureValue(s));case 22:return e.abrupt("return",!1);case 23:case"end":return e.stop()}}),e,this)}))),function(e){return m.apply(this,arguments)})},{key:"GetXml",value:function(){return this.signature.GetXml()}},{key:"LoadXml",value:function(t){this.signature=e.Signature.LoadXml(t)}},{key:"toString",value:function(){var e=this.XmlSignature;if(e.SignedInfo.References&&e.SignedInfo.References.Some((function(e){return e.Transforms&&e.Transforms.Some((function(e){return e instanceof Ay}))}))){var t=this.document.documentElement.cloneNode(!0),r=this.XmlSignature.GetXml();if(!r)throw new ie(ne.XML_EXCEPTION,"Cannot get Xml element from Signature");var a=r.cloneNode(!0);return t.appendChild(a),(new XMLSerializer).serializeToString(t)}return this.XmlSignature.toString()}},{key:"GetPublicKeys",value:(f=s(a().mark((function t(){var r,n,i,s,u,o,l,c,h,f,m,v,d,g;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r=[],n=jy.CreateSignatureAlgorithm(this.XmlSignature.SignedInfo.SignatureMethod),i=E(this.XmlSignature.KeyInfo.GetIterator()),t.prev=3,i.s();case 5:if((s=i.n()).done){t.next=35;break}if(!((u=s.value)instanceof e.KeyInfoX509Data)){t.next=29;break}o=E(u.Certificates),t.prev=9,o.s();case 11:if((l=o.n()).done){t.next=19;break}return c=l.value,t.next=15,c.exportKey();case 15:h=t.sent,r.push(h);case 17:t.next=11;break;case 19:t.next=24;break;case 21:t.prev=21,t.t0=t.catch(9),o.e(t.t0);case 24:return t.prev=24,o.f(),t.finish(24);case 27:t.next=33;break;case 29:return t.next=31,u.exportKey();case 31:f=t.sent,r.push(f);case 33:t.next=5;break;case 35:t.next=40;break;case 37:t.prev=37,t.t1=t.catch(3),i.e(t.t1);case 40:return t.prev=40,i.f(),t.finish(40);case 43:if(!n.algorithm.name.startsWith("RSA")){t.next=58;break}m=0;case 45:if(!(m<r.length)){t.next=58;break}if(!(v=r[m]).algorithm.name.startsWith("RSA")){t.next=55;break}return t.next=50,sp.crypto.subtle.exportKey("spki",v);case 50:return d=t.sent,t.next=53,sp.crypto.subtle.importKey("spki",d,n.algorithm,!0,["verify"]);case 53:g=t.sent,r[m]=g;case 55:m++,t.next=45;break;case 58:return t.abrupt("return",r);case 59:case"end":return t.stop()}}),t,this,[[3,37,40,43],[9,21,24,27]])}))),function(){return f.apply(this,arguments)})},{key:"GetSignatureNamespaces",value:function(){var e={};return this.XmlSignature.NamespaceURI&&(e[this.XmlSignature.Prefix||""]=this.XmlSignature.NamespaceURI),e}},{key:"CopyNamespaces",value:function(e,t,r){this.InjectNamespaces(Wy(e),t,r)}},{key:"InjectNamespaces",value:function(e,t,r){for(var a in e){var n=e[a];r&&""===a||t.setAttribute("xmlns"+(a?":"+a:""),n)}}},{key:"DigestReference",value:(h=s(a().mark((function e(t,r,n){var i,s,u,o,l,c,h,f,m,v,d,g,p,y;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.contentHandler){e.next=5;break}return e.next=3,this.contentHandler(r,this);case 3:(i=e.sent)&&(t=be(i)?i.documentElement:i);case 5:if(!r.Uri){e.next=30;break}if(r.Uri.indexOf("#xpointer")?"#"===r.Uri[0]&&(s=r.Uri.substring(1)):(u=(u=(u=r.Uri).substring(9).replace(/[\r\n\t\s]/g,"")).length<2||"("!==u[0]||")"!==u[u.length-1]?"":u.substring(1,u.length-1)).length>6&&0===u.indexOf("id(")&&")"===u[u.length-1]&&(s=u.substring(4,u.length-2)),!s){e.next=30;break}o=null,l=[this.XmlSignature.KeyInfo.GetXml()],this.XmlSignature.ObjectList.ForEach((function(e){l.push(e.GetXml())})),c=0,h=l;case 12:if(!(c<h.length)){e.next=27;break}if(!(f=h[c])){e.next=24;break}if(!(o=Fy(f,s))){e.next=24;break}return m=o.cloneNode(!0),we(t)&&this.CopyNamespaces(t,m,!1),this.Parent&&(v=this.Parent instanceof Ce?this.Parent.GetXml():this.Parent,this.CopyNamespaces(v,m,!0)),this.CopyNamespaces(o,m,!1),this.InjectNamespaces(this.GetSignatureNamespaces(),m,!0),t=m,e.abrupt("break",27);case 24:c++,e.next=12;break;case 27:if(!o&&t&&we(t)&&(o=Ce.GetElementById(t,s))&&(d=o.cloneNode(!0),this.CopyNamespaces(o,d,!1),this.CopyNamespaces(t,d,!1),t=d),null!=o){e.next=30;break}throw new ie(ne.CRYPTOGRAPHIC,"Cannot get object by reference: ".concat(s));case 30:if(g=null,!r.Transforms||!r.Transforms.Count){e.next=37;break}if(!Ie.isBufferSource(t)){e.next=34;break}throw new Error("Transformation for argument 'source' of type BufferSource is not implemented");case 34:g=this.ApplyTransforms(r.Transforms,t),e.next=51;break;case 37:if(!r.Uri||"#"===r.Uri[0]){e.next=47;break}if(!we(t)){e.next=44;break}if(t.ownerDocument){e.next=41;break}throw new Error("Cannot get ownerDocument from the XML document");case 41:g=(new XMLSerializer).serializeToString(t.ownerDocument),e.next=45;break;case 44:g=Ie.toArrayBuffer(t);case 45:e.next=51;break;case 47:p=new by,Ie.isBufferSource(t)&&(t=ve(De.ToUtf8String(t)).documentElement),p.LoadInnerXml(t),g=p.GetOutput();case 51:if(r.DigestMethod.Algorithm){e.next=53;break}throw new ie(ne.NULL_PARAM,"Reference","DigestMethod");case 53:return y=jy.CreateHashAlgorithm(r.DigestMethod.Algorithm),e.abrupt("return",y.Digest(g));case 55:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return h.apply(this,arguments)})},{key:"DigestDetachedReferences",value:(c=s(a().mark((function e(){var t,r,n,i,s;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=E(this.XmlSignature.SignedInfo.References.GetIterator()),e.prev=1,t.s();case 3:if((r=t.n()).done){e.next=20;break}if(!(n=r.value).DigestValue){e.next=7;break}return e.abrupt("continue",18);case 7:if(n.DigestMethod.Algorithm||(n.DigestMethod.Algorithm=(new wp).namespaceURI),n.DigestSource){e.next=13;break}return e.next=11,this.DigestReference(void 0,n,!1);case 11:return n.DigestValue=e.sent,e.abrupt("continue",18);case 13:return i=jy.CreateHashAlgorithm(n.DigestMethod.Algorithm),e.next=16,i.Digest(n.DigestSource);case 16:s=e.sent,n.DigestValue=s;case 18:e.next=3;break;case 20:e.next=25;break;case 22:e.prev=22,e.t0=e.catch(1),t.e(e.t0);case 25:return e.prev=25,t.f(),e.finish(25);case 28:case"end":return e.stop()}}),e,this,[[1,22,25,28]])}))),function(){return c.apply(this,arguments)})},{key:"DigestReferences",value:(o=s(a().mark((function e(t){var r,n,i,s;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=E(this.XmlSignature.SignedInfo.References.GetIterator()),e.prev=1,r.s();case 3:if((n=r.n()).done){e.next=14;break}if(!(i=n.value).DigestValue){e.next=7;break}return e.abrupt("continue",12);case 7:return i.DigestMethod.Algorithm||(i.DigestMethod.Algorithm=(new wp).namespaceURI),e.next=10,this.DigestReference(t,i,!1);case 10:s=e.sent,i.DigestValue=s;case 12:e.next=3;break;case 14:e.next=19;break;case 16:e.prev=16,e.t0=e.catch(1),r.e(e.t0);case 19:return e.prev=19,r.f(),e.finish(19);case 22:case"end":return e.stop()}}),e,this,[[1,16,19,22]])}))),function(e){return o.apply(this,arguments)})},{key:"TransformSignedInfo",value:function(e){var t=jy.CreateFromName(this.XmlSignature.SignedInfo.CanonicalizationMethod.Algorithm),r=this.XmlSignature.SignedInfo.GetXml();if(!r)throw new ie(ne.XML_EXCEPTION,"Cannot get Xml element from SignedInfo");var a=r.cloneNode(!0);if(this.CopyNamespaces(r,a,!1),e&&!Ie.isBufferSource(e)&&(e.nodeType===ue.Document?this.CopyNamespaces(e.documentElement,a,!1):this.CopyNamespaces(e,a,!1)),this.Parent){var n=this.Parent instanceof Ce?this.Parent.GetXml():this.Parent;n&&this.CopyNamespaces(n,a,!1)}var i=pe(r);for(var s in i){var u=i[s];s!==a.prefix&&a.setAttribute("xmlns"+(s?":"+s:""),u)}return t.LoadInnerXml(a),t.GetOutput()}},{key:"ResolveTransform",value:function(e){if("string"==typeof e)switch(e){case"enveloped":return new Ay;case"c14n":return new by;case"c14n-com":return new Sy;case"exc-c14n":return new Ny;case"exc-c14n-com":return new Cy;case"base64":return new wy;default:throw new ie(ne.CRYPTOGRAPHIC_UNKNOWN_TRANSFORM,e)}if("xpath"===e.name){var t=new Ey;t.XPath=e.selector;var r=t.GetXml();if(r&&e.namespaces)for(var a=0,n=Object.entries(e.namespaces);a<n.length;a++){var i=A(n[a],2),s=i[0],u=i[1];r.firstChild.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:".concat(s),u)}return t}throw new ie(ne.CRYPTOGRAPHIC_UNKNOWN_TRANSFORM,e.name)}},{key:"ApplyTransforms",value:function(e,t){var r=null;if(e.Sort((function(e,t){var r=[by,Sy,Ny,Cy];return r.some((function(t){return e instanceof t}))?1:r.some((function(e){return t instanceof e}))?-1:0})).ForEach((function(e){e.LoadInnerXml(t),e instanceof Ey?e.GetOutput():r=e.GetOutput()})),1===e.Count&&e.Item(0)instanceof Ay){var a=new by;a.LoadInnerXml(t),r=a.GetOutput()}return r}},{key:"ApplySignOptions",value:(i=s(a().mark((function t(r,n,i,s){var u,o,l,c,h=this;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(s.id&&(this.XmlSignature.Id=s.id),!s.keyValue||i.algorithm.name.toUpperCase()===Op){t.next=8;break}return r.KeyInfo||(r.KeyInfo=new e.KeyInfo),u=r.KeyInfo,o=new e.KeyValue,u.Add(o),t.next=8,o.importKey(s.keyValue);case 8:s.x509&&(r.KeyInfo||(r.KeyInfo=new e.KeyInfo),l=r.KeyInfo,s.x509.forEach((function(t){var r=oe.FromBase64(t),a=new e.KeyInfoX509Data(r);l.Add(a)}))),s.references&&s.references.forEach((function(t){var a=new e.Reference;t.id&&(a.Id=t.id),null!==t.uri&&void 0!==t.uri&&(a.Uri=t.uri),t.type&&(a.Type=t.type),t.digestSource&&(a.DigestSource=t.digestSource),t.digestValue&&(a.DigestValue=new Uint8Array(t.digestValue));var n=jy.GetHashAlgorithm(t.hash);if(a.DigestMethod.Algorithm=n.namespaceURI,t.transforms&&t.transforms.length){var i=new e.Transforms;t.transforms.forEach((function(e){i.Add(h.ResolveTransform(e))})),a.Transforms=i}r.SignedInfo.References||(r.SignedInfo.References=new e.References),r.SignedInfo.References.Add(a)})),r.SignedInfo.References.Count||(c=new e.Reference,r.SignedInfo.References.Add(c));case 11:case"end":return t.stop()}}),t,this)}))),function(e,t,r,a){return i.apply(this,arguments)})},{key:"ValidateReferences",value:(n=s(a().mark((function e(t){var r,n,i,s,u,o,l;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=E(this.XmlSignature.SignedInfo.References.GetIterator()),e.prev=1,r.s();case 3:if((n=r.n()).done){e.next=15;break}return i=n.value,e.next=7,this.DigestReference(t,i,!1);case 7:if(s=e.sent,u=oe.ToBase64(s),o=oe.ToString(i.DigestValue,"base64"),u===o){e.next=13;break}throw l="Invalid digest for uri '".concat(i.Uri,"'. Calculated digest is ").concat(u," but the xml to validate supplies digest ").concat(o),new ie(ne.CRYPTOGRAPHIC,l);case 13:e.next=3;break;case 15:e.next=20;break;case 17:e.prev=17,e.t0=e.catch(1),r.e(e.t0);case 20:return e.prev=20,r.f(),e.finish(20);case 23:return e.abrupt("return",!0);case 24:case"end":return e.stop()}}),e,this,[[1,17,20,23]])}))),function(e){return n.apply(this,arguments)})},{key:"ValidateSignatureValue",value:(r=s(a().mark((function e(t){var r,n,i,s,u;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=this.TransformSignedInfo(this.document),r=jy.CreateSignatureAlgorithm(this.XmlSignature.SignedInfo.SignatureMethod),i=E(t),e.prev=3,i.s();case 5:if((s=i.n()).done){e.next=14;break}return u=s.value,e.next=9,r.Verify(n,u,this.Signature);case 9:if(!e.sent){e.next=12;break}return e.abrupt("return",!0);case 12:e.next=5;break;case 14:e.next=19;break;case 16:e.prev=16,e.t0=e.catch(3),i.e(e.t0);case 19:return e.prev=19,i.f(),e.finish(19);case 22:return e.abrupt("return",!1);case 23:case"end":return e.stop()}}),e,this,[[3,16,19,22]])}))),function(e){return r.apply(this,arguments)})}]),t}();function Fy(e,t){if(e.nodeType!==ue.Element)return null;if(e.hasAttribute("Id")&&e.getAttribute("Id")===t)return e;if(e.childNodes&&e.childNodes.length)for(var r=0;r<e.childNodes.length;r++){var a=Fy(e.childNodes[r],t);if(a)return a}return null}function qy(e,t,r){t in e||(e[t]=r)}function Xy(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(we(e)){e.namespaceURI&&"http://www.w3.org/XML/1998/namespace"!==e.namespaceURI&&qy(t,e.prefix?e.prefix:"",e.namespaceURI);for(var r=0;r<e.attributes.length;r++){var a=e.attributes.item(r);a&&"xmlns"===a.prefix&&qy(t,a.localName?a.localName:"",a.value)}e.parentNode&&Xy(e.parentNode,t)}}function Wy(e){var t={};return Xy(e,t),t}return e.Application=sp,e.CryptoConfig=jy,e.ECDSA=Ap,e.ECDSA_SHA1_NAMESPACE=Np,e.ECDSA_SHA256_NAMESPACE=Cp,e.ECDSA_SHA384_NAMESPACE=xp,e.ECDSA_SHA512_NAMESPACE=Ep,e.EcdsaSha1=Ip,e.EcdsaSha256=Bp,e.EcdsaSha384=Vp,e.EcdsaSha512=Dp,e.HMAC=Op,e.HMAC_SHA1_NAMESPACE=Pp,e.HMAC_SHA256_NAMESPACE=Rp,e.HMAC_SHA384_NAMESPACE=Up,e.HMAC_SHA512_NAMESPACE=Tp,e.HmacSha1=Lp,e.HmacSha256=Hp,e.HmacSha384=Mp,e.HmacSha512=Kp,e.KeyInfoClause=ky,e.Parse=ve,e.RSA_PKCS1=_p,e.RSA_PKCS1_SHA1_NAMESPACE=jp,e.RSA_PKCS1_SHA256_NAMESPACE=Jp,e.RSA_PKCS1_SHA384_NAMESPACE=Fp,e.RSA_PKCS1_SHA512_NAMESPACE=qp,e.RSA_PSS=Qp,e.RSA_PSS_SHA1_NAMESPACE=ay,e.RSA_PSS_SHA256_NAMESPACE=ny,e.RSA_PSS_SHA384_NAMESPACE=iy,e.RSA_PSS_SHA512_NAMESPACE=sy,e.RSA_PSS_WITH_PARAMS_NAMESPACE=Yp,e.RsaPkcs1Sha1=Xp,e.RsaPkcs1Sha256=Wp,e.RsaPkcs1Sha384=Gp,e.RsaPkcs1Sha512=zp,e.RsaPssBase=Zp,e.RsaPssSha1=$p,e.RsaPssSha256=ey,e.RsaPssSha384=ty,e.RsaPssSha512=ry,e.RsaPssWithoutParamsBase=uy,e.RsaPssWithoutParamsSha1=oy,e.RsaPssWithoutParamsSha256=ly,e.RsaPssWithoutParamsSha384=cy,e.RsaPssWithoutParamsSha512=hy,e.SHA1=hp,e.SHA1_NAMESPACE=dp,e.SHA256=fp,e.SHA256_NAMESPACE=gp,e.SHA384=mp,e.SHA384_NAMESPACE=pp,e.SHA512=vp,e.SHA512_NAMESPACE=yp,e.Select=me,e.SelectRootNamespaces=Wy,e.Sha1=kp,e.Sha256=wp,e.Sha384=bp,e.Sha512=Sp,e.SignedXml=Jy,e.Stringify=function(e){return(new XMLSerializer).serializeToString(e)},e.X509Certificate=My,e.XmlCanonicalizer=fy,e.XmlDsigBase64Transform=wy,e.XmlDsigC14NTransform=by,e.XmlDsigC14NWithCommentsTransform=Sy,e.XmlDsigEnvelopedSignatureTransform=Ay,e.XmlDsigExcC14NTransform=Ny,e.XmlDsigExcC14NWithCommentsTransform=Cy,e.XmlDsigXPathTransform=Ey,e.XmlSignature=yy,e}({});
